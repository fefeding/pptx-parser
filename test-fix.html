<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPTX Parser 修复测试</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="./dist/ppt-parser.browser.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #fileInput { margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>PPTX Parser 修复测试</h1>
        
        <div class="test-section">
            <h2>文件上传测试</h2>
            <input type="file" id="fileInput" accept=".pptx" />
            <button onclick="testPPTX()">测试 PPTX 解析</button>
            <div id="result"></div>
        </div>

        <div class="test-section">
            <h2>控制台日志</h2>
            <button onclick="clearLogs()">清空日志</button>
            <pre id="logs" style="background: #f5f5f5; padding: 10px; height: 300px; overflow-y: scroll;"></pre>
        </div>
    </div>

    <script>
        // 重定向 console.log 到页面显示
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function logToPage(message, type = 'log') {
            const logsElement = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const formattedMessage = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logsElement.textContent += formattedMessage;
            logsElement.scrollTop = logsElement.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToPage(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logToPage(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logToPage(args.join(' '), 'warn');
        };

        function clearLogs() {
            document.getElementById('logs').textContent = '';
        }

        function testPPTX() {
            const fileInput = document.getElementById('fileInput');
            const resultDiv = document.getElementById('result');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                resultDiv.innerHTML = '<div class="error">请选择一个 PPTX 文件</div>';
                return;
            }

            const file = fileInput.files[0];
            resultDiv.innerHTML = '<div class="test-section">正在解析文件...</div>';

            try {
                // 测试 PPTX 解析
                $('#result').pptxToHtml({
                    pptxFileUrl: URL.createObjectURL(file),
                    mediaProcess: true,
                    fileInput: file,
                    slidesScale: 0.8,
                    slideMode: true,
                    keyBoardShortCut: false,
                    mediaElementLoading: function(type, filename) {
                        console.log(`加载媒体元素: ${type} - ${filename}`);
                    },
                    succes: function(data) {
                        console.log('解析成功:', data);
                        resultDiv.innerHTML = `
                            <div class="success">
                                <h3>✅ 解析成功!</h3>
                                <p>幻灯片数量: ${data.slides?.length || 0}</p>
                                <p>解析时间: ${new Date().toLocaleString()}</p>
                            </div>
                        `;
                    },
                    error: function(err) {
                        console.error('解析失败:', err);
                        resultDiv.innerHTML = `
                            <div class="error">
                                <h3>❌ 解析失败</h3>
                                <p>错误信息: ${err.message || err}</p>
                            </div>
                        `;
                    }
                });
            } catch (error) {
                console.error('初始化失败:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>❌ 初始化失败</h3>
                        <p>错误信息: ${error.message || error}</p>
                    </div>
                `;
            }
        }

        // 页面加载完成后显示欢迎信息
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== PPTX Parser 修复测试页面 ===');
            console.log('请上传一个 PPTX 文件进行测试');
            console.log('重点关注媒体文件路径处理是否正确');
        });
    </script>
</body>
</html>