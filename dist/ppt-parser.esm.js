import e from"fs";import t from"jszip";const s=()=>"undefined"!=typeof window&&"undefined"!=typeof document?"browser":"node";var r;!function(e){e.TEXT="text",e.TEXT_BLOCK="text_block",e.SHAPE="shape",e.MEDIA="media",e.GRAPH="graph",e.TABLE="table",e.SMART_ART="smart_art",e.EQUATION="equation"}(r||(r={}));class i{constructor(e){this.buffer=e,this.slides={},this.totalSlides=0}async init(){this.zip=await t.loadAsync(this.buffer),await this.parseSlides(),await this.parseTheme(),await this.parseMedia()}async parseSlides(){const e=Object.keys(this.zip.files).filter(e=>/ppt\/slides\/slide\d+\.xml$/.test(e));this.totalSlides=e.length;for(const t of e){const e=parseInt(t.match(/slide(\d+)\.xml$/)[1]),s=await this.zip.file(t).async("text");this.slides[e]=this.parseSlideContent(s)}}parseSlideContent(e){return{[r.TEXT]:this.parseTextElements(e),[r.TEXT_BLOCK]:this.parseTextBlocks(e),[r.SHAPE]:this.parseShapes(e),[r.MEDIA]:this.parseMediaElements(e),[r.GRAPH]:this.parseGraphs(e),[r.TABLE]:this.parseTables(e),[r.SMART_ART]:this.parseSmartArt(e),[r.EQUATION]:this.parseEquations(e)}}parseTextElements(e){return[]}parseMediaElements(e){return[]}getSlides(){return this.slides}getTotalSlides(){return this.totalSlides}async parseTheme(){}async parseMedia(){}parseTextBlocks(e){return[]}parseShapes(e){return[]}parseGraphs(e){return[]}parseTables(e){return[]}parseSmartArt(e){return[]}parseEquations(e){return[]}}class n{constructor(e){this.env=e||s()}createElement(e,t,s){if("browser"===this.env){const r=document.createElement(e);return t&&Object.entries(t).forEach(([e,t])=>r.setAttribute(e,t)),s&&(r.innerHTML=s),r}return`<${e} ${t?Object.entries(t).map(([e,t])=>`${e}="${t}"`).join(" "):""}>${s||""}</${e}>`}mount(e,t){if("browser"===this.env){const s=document.getElementById(t);if(!s)throw new Error(`目标元素#${t}不存在`);return void s.appendChild(e)}return`\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pptxjs-ts/dist/css/pptxjs.css">\n  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nvd3@1.8.6/build/nv.d3.min.css">\n</head>\n<body>\n  <div id="${t}">${e}</div>\n</body>\n</html>\n    `}}class a{constructor(e,t){this.options=e,this.buffer=t,this.env=s(),this.domAdapter=new n(this.env),this.parser=new i(t)}async render(e){await this.parser.init();const t=this.parser.getSlides(),s=this.parser.getTotalSlides(),r=this.domAdapter.createElement("div",{class:"pptxjs-container"},"");for(let e=1;e<=s;e++){const s=t[e],i=this.renderSlide(s,e);"browser"===this.env?r.appendChild(i):r+=i}return"browser"===this.env&&this.initInteractions(r),this.domAdapter.mount(r,e)}renderSlide(e,t){return"revealjs"===this.options.slideType?this.renderRevealJsSlide(e,t):this.renderDivs2SlidesJsSlide(e,t)}renderDivs2SlidesJsSlide(e,t){const s={class:"slide","data-slide-id":t.toString(),style:`width: ${100-(this.options.incSlide?.width||0)}%; height: ${100-(this.options.incSlide?.height||0)}%`};return this.domAdapter.createElement("div",s,"")}renderRevealJsSlide(e,t){const s={class:"reveal-slide","data-slide-id":t.toString()};return this.domAdapter.createElement("section",s,"")}initInteractions(e){}}async function d(t,r){const i=await(async(t,r=s())=>"node"===r?Buffer.isBuffer(t)?t:e.promises.readFile(t):new Promise((e,s)=>{if("string"==typeof t)fetch(t).then(e=>e.arrayBuffer()).then(t=>e(Buffer.from(t))).catch(s);else if(t instanceof File){const r=new FileReader;r.onload=t=>e(Buffer.from(t.target.result)),r.onerror=s,r.readAsArrayBuffer(t)}else s(new Error("浏览器环境仅支持URL/File对象作为PPTX源"))}))(r.pptxFileUrl);return new a(r,i).render(t)}"browser"===s()&&("undefined"!=typeof window&&window.jQuery&&(window.jQuery.fn.pptxToHtml=function(e){const t=this.attr("id");if(!t)throw new Error("元素必须有ID");return d(t,e),this}),window.pptxToHtml=d);export{r as PptxElementType,d as pptxToHtml};
//# sourceMappingURL=ppt-parser.esm.js.map
