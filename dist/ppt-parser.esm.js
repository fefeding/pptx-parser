import t from"jszip";import{unescape as e}from"html-escaper";const r={p:"http://schemas.openxmlformats.org/presentationml/2006/main",a:"http://schemas.openxmlformats.org/drawingml/2006/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",mc:"http://schemas.openxmlformats.org/markup-compatibility/2006",c:"http://schemas.openxmlformats.org/drawingml/2006/chart",d:"http://schemas.openxmlformats.org/drawingml/2006/diagram"},n=914400,i=96,s=96/n,o="ppt/slides/",a="ppt/slides/_rels/",l="docProps/",c="ppt/slideLayouts/";function d(t){const e="string"==typeof t?parseInt(t||"0",10):t;return Math.round(e*s*100)/100}function p(t){return Math.round(9525*t)}function h(t){const e={};return t?.attributes?(Array.from(t.attributes).forEach(t=>{e[t.name]=t.value}),e):e}function u(t,e,r){return t?Array.from(t.getElementsByTagNameNS(r,e)):[]}function f(t,e,r){return t&&t.getElementsByTagNameNS(r,e)[0]||null}function g(t,e,r=""){return t&&t.getAttribute(e)||r}function m(t,e){if(!t)return!1;const r=t.getAttribute(e);return"1"===r||"true"===r}function y(t){const e=(new DOMParser).parseFromString(t,"application/xml"),r=Array.from(e.documentElement.children),n={};return r.forEach(t=>{const e=t.getAttribute("Id"),r=t.getAttribute("Type"),i=t.getAttribute("Target");e&&(n[e]={id:e,type:r||"",target:i||""})}),n}function b(t,e){if(!e)return e;e.startsWith("/")&&(e=e.substring(1));const r=t.indexOf("_rels/");let n=t;-1!==r&&(n=t.substring(0,r));const i=(n+e).split("/"),s=[];for(const t of i)""!==t&&"."!==t&&(".."===t?s.length>0&&s.pop():s.push(t));return s.join("/")}function x(t,e){const r=y(t);for(const t in r){const n=r[t];n.target=b(e,n.target)}return r}function $(t){const e=(new DOMParser).parseFromString(t,"application/xml"),r="http://purl.org/dc/elements/1.1/",n="http://purl.org/dc/terms/",i=(t,r)=>{const n=e.getElementsByTagNameNS(r,t)[0];return n?.textContent||void 0};return{title:i("title",r),author:i("creator",r),subject:i("subject",r),keywords:i("keywords","http://schemas.openxmlformats.org/package/2006/metadata/core-properties"),created:i("created",n),modified:i("modified",n)}}const w="v-up",v="v-mid",A="v-down",S="h-left",k="h-mid",T="h-right";function I(t,e){const r=function(t){return t&&{left:S,center:k,right:T}[t]||""}(t),n=function(t){return t&&{top:w,middle:v,bottom:A}[t]||""}(e);return r&&n?`${n.replace("v-","")}_${r.replace("h-","")}`:`${n} ${r}`.trim()}function C(t,e,r){return t.find(t=>t.type===e)}function P(t="ppt-node"){return`${t}-${Date.now()}-${Math.floor(1e4*Math.random())}`}function M(t,e,r){{const n=`[pptx-parser ${t.toUpperCase()}]`;void 0!==r?console[t](n,e,r):console[t](n,e)}}class N{constructor(t,e,r,n={},i={},s={}){this.id=t,this.rect=r,this.style={fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1},this.content=n,this.props=i,this.relsMap=s,this.name="",this.hidden=!1}getContainerStyle(){const{x:t,y:e,width:r,height:n}=this.rect,i=["position: absolute",`left: ${t}px`,`top: ${e}px`,`width: ${r}px`,`height: ${n}px`];return this.hidden&&i.push("display: none"),i.join("; ")}getDataAttributes(){const t={};return this.id&&(t["data-id"]=this.id),t["data-type"]=this.type,t}formatDataAttributes(){const t=this.getDataAttributes();return Object.entries(t).map(([t,e])=>`${t}="${e}"`).join(" ")}parsePosition(t,e="spPr",n=r.p){const i=f(t,e,n);return i?function(t){const e=f(t,"xfrm",r.a);if(!e)return{x:0,y:0,width:0,height:0};const n=f(e,"off",r.a),i=f(e,"ext",r.a);return{x:n?d(n.getAttribute("x")||"0"):0,y:n?d(n.getAttribute("y")||"0"):0,width:i?d(i.getAttribute("cx")||"0"):0,height:i?d(i.getAttribute("cy")||"0"):0}}(i):{x:0,y:0,width:0,height:0}}parseIdAndName(t,e,n=r.p){const i=f(t,e,n),s=i?f(i,"cNvPr",n):null;return{id:g(s,"id",this.generateId()),name:g(s,"name",""),hidden:m(s,"hidden")}}generateId(){return`el_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getAttributes(t){return h(t)}}class F extends N{constructor(){super(...arguments),this.type="shape"}static fromNode(t,e){try{const n=new F("","shape",{x:0,y:0,width:0,height:0},{},{},e),i=f(t,"nvSpPr",r.p),s=i?f(i,"cNvPr",r.p):null;n.id=g(s,"id",n.generateId()),n.name=g(s,"name",""),n.hidden=m(s,"hidden");const o=i?f(i,"nvPr",r.p):null,a=o?f(o,"ph",r.p):null;n.isPlaceholder=!!a;const l=a?.getAttribute("type");if(l){["title","body","dateTime","slideNumber","footer","other"].includes(l)?n.placeholderType=l:n.placeholderType="other"}const c=f(t,"spPr",r.p);n.parseShapeProperties(c,t);const d=f(t,"txBody",r.p);return d&&n.parseTextBody(d,t,e),n.shapeType=n.detectShapeType(c),n.type=n.text||n.textStyle?"text":"shape",n.rawNode=t,n}catch(t){return console.error("Failed to parse shape element:",t),null}}parseShapeProperties(t,e){if(!t)return;const n=f(t,"xfrm",r.a);if(n){const t=f(n,"off",r.a),e=f(n,"ext",r.a);t&&(this.rect.x=d(t.getAttribute("x")||"0"),this.rect.y=d(t.getAttribute("y")||"0")),e&&(this.rect.width=d(e.getAttribute("cx")||"0"),this.rect.height=d(e.getAttribute("cy")||"0"));const i=n.getAttribute("rot");null!==i&&(this.rotation=parseInt(i)/6e4),this.flipH="1"===n.getAttribute("flipH"),this.flipV="1"===n.getAttribute("flipV")}this.parseFill(t)}parseFill(t){const e=f(t,"solidFill",r.a);if(e){const t=f(e,"srgbClr",r.a);t?.getAttribute("val")&&(this.style.backgroundColor=`#${t.getAttribute("val")}`);const n=f(e,"schemeClr",r.a);n?.getAttribute("val")&&(this.style.backgroundColor=n.getAttribute("val")||"transparent")}const n=f(t,"gradFill",r.a);if(n){const t=this.parseGradientFill(n);t&&(this.style.background=this.generateGradientCSS(t))}}parseGradientFill(t){const e={type:"linear",stops:[]},n=f(t,"lin",r.a),i=f(t,"path",r.a);if(f(t,"tileRect",r.a),n){e.type="linear";const t=n.getAttribute("ang");e.angle=t?parseInt(t)/6e4%360:0}else if(i){e.type="path";const t=i.getAttribute("path");t&&(e.direction=t)}else e.type="radial";const s=f(t,"gsLst",r.a);if(s){const t=Array.from(s.children).filter(t=>"a:gs"===t.tagName||t.tagName.includes(":gs"));for(const r of t){const t=this.parseGradientStopColor(r),n=r.getAttribute("pos");t&&e.stops.push({color:t,position:n?parseInt(n)/1e5:0})}}return 0===e.stops.length&&e.stops.push({color:"#000000",position:0},{color:"#ffffff",position:100}),e}parseGradientStopColor(t){const e=f(t,"solidFill",r.a);if(!e)return null;const n=f(e,"srgbClr",r.a);if(n?.getAttribute("val"))return`#${n.getAttribute("val")}`;const i=f(e,"schemeClr",r.a);if(i?.getAttribute("val"))return i.getAttribute("val")||null;const s=f(e,"sysClr",r.a);return s?.getAttribute("val")&&s.getAttribute("val")||null}generateGradientCSS(t){const e=[...t.stops].sort((t,e)=>t.position-e.position).map(t=>`${t.color} ${t.position}%`).join(", ");switch(t.type){case"linear":return`linear-gradient(${void 0!==t.angle?t.angle:0}deg, ${e})`;case"radial":return`radial-gradient(circle, ${e})`;case"path":return`radial-gradient(${t.direction||"circle"}, ${e})`;default:return`linear-gradient(${e})`}}parseTextBody(t,e,n){const i=u(t,"p",r.a);this.textStyle=i.flatMap(t=>this.parseParagraph(t,e,n)),this.text=this.textStyle.map(t=>t.text).join("");const s=t.querySelector("a\\:p, p\\:p a\\:p"),o=s?f(s,"pPr",r.a):null;if(o){const t=f(o,"spcBef",r.a),e=t?parseInt(g(t,"spcPts","0"))/100:0,n=f(o,"spcAft",r.a),i=n?parseInt(g(n,"spcPts","0"))/100:0,s=f(o,"lnSpc",r.a),a=s?parseInt(g(s,"spcPts","0"))/100:0,l=f(o,"marL",r.a),c=l?parseInt(l.getAttribute("val")||"0")/100:0,d=f(o,"marR",r.a),p=d?parseInt(d.getAttribute("val")||"0")/100:0,h=f(o,"insT",r.a),u=h?parseInt(h.getAttribute("val")||"0")/100:0,m=f(o,"insB",r.a),y=m?parseInt(m.getAttribute("val")||"0")/100:0,b=o.getAttribute("indent"),x=b?parseInt(b)/100:0;this.paragraphStyle={align:o.getAttribute("algn")||void 0,indent:x,lineSpacing:a,spaceBefore:e,spaceAfter:i,marginLeft:c,marginRight:p,paddingTop:u,paddingBottom:y,rtl:"1"===o.getAttribute("rtl")},this.style.spaceBefore=e,this.style.spaceAfter=i,this.style.paddingTop=u,this.style.paddingBottom=y,this.style.marginLeft=c,this.style.marginRight=p}}parseParagraph(t,e,n){const i=[];this.bulletStyle=this.parseBulletStyle(t);const s=f(t,"pPr",r.a),o=s?f(s,"defRPr",r.a):null,a=o?this.parseRunProperties(o):{},l=u(t,"r",r.a);for(const t of l){const e=this.parseTextRun(t,n,a);e&&i.push(e)}const c=f(t,"endParaRPr",r.a);if(c){const t=this.parseRunProperties(c);i.forEach(e=>{!e.fontSize&&t.fontSize&&(e.fontSize=t.fontSize),!e.fontFamily&&t.fontFamily&&(e.fontFamily=t.fontFamily),!e.color&&t.color&&(e.color=t.color)})}const d=f(t,"hlinkClick",r.a);if(d){const t=d.getAttributeNS(r.r,"id")||d.getAttribute("r:id")||"";t&&n[t]&&(this.hyperlink={id:t,url:n[t].target,tooltip:d.getAttribute("tooltip")||void 0})}return i}parseBulletStyle(t){const e=f(t,"pPr",r.a);if(!e)return{};if(f(e,"buNone",r.a))return{type:"none"};const n=f(e,"buChar",r.a);if(n){return{type:"char",char:n.getAttribute("char")||"•",font:n.getAttribute("font")||void 0,color:this.parseColor(n),size:parseInt(n.getAttribute("sz")||"100")/100}}const i=f(e,"buBlip",r.a);if(i){return{type:"blip",imageSrc:i.getAttributeNS(r.r,"embed")||i.getAttribute("r:embed")||""}}const s=f(e,"buAutoNum",r.a);return s?{type:"autoNum",autoNumType:s.getAttribute("type")||"arabic",level:parseInt(s.getAttribute("startAt")||"1")}:{type:"none"}}parseTextRun(t,e,n={}){const i=f(t,"rPr",r.a),s=f(t,"t",r.a);if(!s)return null;const o={text:s.textContent||"",...n};if(i){const t=this.parseRunProperties(i);Object.assign(o,t)}return o}parseRunProperties(t){const e={},n=t.getAttribute("sz");if(n){const t=parseInt(n)/100;e.fontSize=t*(4/3)}const i=f(t,"latin",r.a),s=f(t,"ea",r.a),o=f(t,"cs",r.a),a=i?.getAttribute("typeface"),l=s?.getAttribute("typeface"),c=o?.getAttribute("typeface");a?e.fontFamily=a:l?e.fontFamily=l:c&&(e.fontFamily=c),"1"===t.getAttribute("b")&&(e.bold=!0),"1"===t.getAttribute("i")&&(e.italic=!0);const d=t.getAttribute("u");d&&(e.underline="none"===d?"none":"underline"),"1"===t.getAttribute("strike")&&(e.strike=!0);const p=f(t,"solidFill",r.a);if(p){const t=f(p,"srgbClr",r.a);if(t?.getAttribute("val")){const r=`#${t.getAttribute("val")}`;e.color=r,this.style.color=r}}const h=f(t,"highlight",r.a);if(h){const t=f(h,"srgbClr",r.a);t?.getAttribute("val")&&(e.backgroundColor=`#${t.getAttribute("val")}`)}const u=f(t,"kern",r.a);if(u){const t=u.getAttribute("val");t&&(e.letterSpacing=parseInt(t)/100)}return e}parseColor(t){const e=f(t,"solidFill",r.a);if(e){const t=f(e,"srgbClr",r.a);if(t?.getAttribute("val"))return`#${t.getAttribute("val")}`}}detectShapeType(t){if(!t)return"rectangle";const e=f(t,"prstGeom",r.a);if(e){const t=e.getAttribute("prst")||"";return{rect:"rectangle",ellipse:"ellipse",roundRect:"roundedRectangle",triangle:"triangle",diamond:"diamond",pentagon:"pentagon",hexagon:"hexagon",octagon:"octagon",star4:"star",star5:"5-point star",star6:"6-point star",star8:"8-point star",star10:"10-point star",star12:"12-point star",star16:"16-point star",star24:"24-point star",star32:"32-point star",heart:"heart",lightning:"lightning",sun:"sun",moon:"moon",cloud:"cloud",arrow:"arrow",bentArrow:"bent arrow",chevron:"chevron",home:"home",cube:"cube",bevel:"bevel",donut:"donut",noSmoking:"noSmoking",blockArc:"blockArc",foldedCorner:"foldedCorner",smileyFace:"smileyFace"}[t]||t}return f(t,"custGeom",r.a)?"custom":"rectangle"}toHTML(){const t=this.getContainerStyle(),e=this.getRotationStyle(),r=this.formatDataAttributes(),n=[...this.parseStyleString(t),...this.parseStyleString(e)].join("; ");if("text"===this.type&&this.text){const t=this.getTextStyle();return`<div ${r} style="${n}">\n        <div style="${t.replace(">CONTENT","")}">${t.split(">CONTENT")[1]||this.escapeHtml(this.text)}</div>\n      </div>`}{const n=this.getShapeStyle();return`<div ${r} style="${[...this.parseStyleString(t),...this.parseStyleString(n),...this.parseStyleString(e)].join("; ")}"></div>`}}getTextStyle(){const t=["display: flex","align-items: center",`justify-content: ${this.textStyleFromAlign(this.paragraphStyle?.align)}`,"width: 100%","height: 100%","box-sizing: border-box"];if(this.style.spaceBefore&&t.push(`padding-top: ${this.style.spaceBefore}px`),this.style.spaceAfter&&t.push(`padding-bottom: ${this.style.spaceAfter}px`),this.style.paddingTop&&t.push(`margin-top: ${this.style.paddingTop}px`),this.style.paddingBottom&&t.push(`margin-bottom: ${this.style.paddingBottom}px`),this.style.padding)t.push(`padding-left: ${this.style.padding}`),t.push(`padding-right: ${this.style.padding}`);else{const e=this.style.marginLeft||10,r=this.style.marginRight||10;t.push(`padding-left: ${e}px`),t.push(`padding-right: ${r}px`)}return this.text,this.textStyle&&this.textStyle.length>0&&this.textStyle.map(t=>{const e=[];t.fontSize&&t.fontSize>0&&e.push(`font-size: ${t.fontSize}px`),t.color&&e.push(`color: ${t.color}`),t.fontFamily&&e.push(`font-family: ${t.fontFamily}`),t.bold&&e.push("font-weight: bold"),t.italic&&e.push("font-style: italic"),t.underline&&"none"!==t.underline&&e.push("text-decoration: underline"),t.strike&&e.push("text-decoration: line-through"),t.backgroundColor&&e.push(`background-color: ${t.backgroundColor}`),t.letterSpacing&&e.push(`letter-spacing: ${t.letterSpacing}px`);return`<span${e.length>0?` style="${e.join("; ")}"`:""}>${this.escapeHtml(t.text)}</span>`}).join(""),t.join("; ")+";>CONTENT"}getRotationStyle(){return void 0===this.rotation||0===this.rotation?"":`transform: rotate(${this.rotation}deg); transform-origin: center;`}getShapeStyle(){return[`background-color: ${this.style.backgroundColor||"#ffffff"}`,`border: ${this.style.borderWidth}px solid ${this.style.borderColor}`].join("; ")}textStyleFromAlign(t){switch(t){case"right":return"flex-end";case"center":case"justify":return"center";default:return"flex-start"}}textStyleFromFontSize(){return this.textStyle?.[0]?.fontSize?this.textStyle[0].fontSize:this.style.fontSize||14}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}parseStyleString(t){return t.split(";").filter(t=>t.trim())}toParsedElement(){return{id:this.id,type:"shape",rect:this.rect,style:this.style,content:this.content,props:{isPlaceholder:this.isPlaceholder,placeholderType:this.placeholderType,shapeType:this.shapeType,textStyle:this.textStyle,paragraphStyle:this.paragraphStyle,bulletStyle:this.bulletStyle,hyperlink:this.hyperlink,rotation:this.rotation},name:this.name,hidden:this.hidden,text:this.text,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class j extends N{constructor(){super(...arguments),this.type="image",this.mediaType="image",this.src="",this.relId=""}static fromNode(t,e){try{const n=new j("","image",{x:0,y:0,width:0,height:0},"",{},e),i=f(t,"nvPicPr",r.p),s=i?f(i,"cNvPr",r.p):null;n.id=g(s,"id",n.generateId()),n.name=g(s,"name",""),n.hidden=m(s,"hidden"),n.altText=g(s,"descr","");f(t,"spPr",r.p);n.rect=n.parsePosition(t);const o=f(t,"blipFill",r.p);let a="";if(o){const t=f(o,"blip",r.a);a=t?.getAttributeNS(r.r,"embed")||t?.getAttribute("r:embed")||""}const l=i?f(i,"nvPr",r.p):null,c=l?f(l,"videoFile",r.a):null,d=l?f(l,"audioFile",r.a):null;return c?(n.mediaType="video",n.videoInfo=n.parseVideoInfo(c,a,e),n.src=n.videoInfo.src,n.relId=a):d?(n.mediaType="audio",n.audioInfo=n.parseAudioInfo(d,a,e),n.src=n.audioInfo.src,n.relId=a):(n.mediaType="image",n.src=n.parseImageSrc(a,e,t),n.relId=a,n.src.endsWith(".png")?n.mimeType="image/png":n.src.endsWith(".jpg")||n.src.endsWith(".jpeg")?n.mimeType="image/jpeg":n.src.endsWith(".gif")?n.mimeType="image/gif":n.src.endsWith(".svg")&&(n.mimeType="image/svg+xml")),n.content={src:n.src,alt:n.altText,mediaType:n.mediaType,videoInfo:n.videoInfo,audioInfo:n.audioInfo},n.props={imgId:a,mimeType:n.mimeType,mediaType:n.mediaType},n.rawNode=t,n}catch(t){return console.error("Failed to parse image element:",t),null}}parseVideoInfo(t,e,n){const i=t.getAttribute("link"),s=t.getAttributeNS(r.r,"link")||"";if(i)return{src:i,type:"link",autoplay:!0,muted:!1,controls:!0,loop:!1};{const t=n[s]?.target||"";return{src:t,type:"blob",format:this.detectVideoFormat(t),autoplay:!1,muted:!1,controls:!0,loop:!1}}}parseAudioInfo(t,e,n){const i=t.getAttribute("link"),s=t.getAttributeNS(r.r,"link")||"";if(i)return{src:i,type:"link",autoplay:!0,muted:!1,controls:!0,loop:!1};{const t=n[s]?.target||"";return{src:t,type:"blob",format:this.detectAudioFormat(t),autoplay:!1,muted:!1,controls:!0,loop:!1}}}parseImageSrc(t,e,r){if(!t||!e[t])return"";return e[t].target}detectVideoFormat(t){return t.endsWith(".mp4")?"mp4":t.endsWith(".webm")?"webm":t.endsWith(".ogg")?"ogg":void 0}detectAudioFormat(t){return t.endsWith(".mp3")?"mp3":t.endsWith(".wav")?"wav":t.endsWith(".ogg")?"ogg":void 0}getFilePath(){return"image"===this.mediaType&&this.relId&&this.relsMap[this.relId]?this.relsMap[this.relId].target:"video"===this.mediaType&&this.videoInfo&&"blob"===this.videoInfo.type?this.videoInfo.src:"audio"===this.mediaType&&this.audioInfo&&"blob"===this.audioInfo.type?this.audioInfo.src:""}getDataAttributes(){const t=super.getDataAttributes(),e=this.getFilePath();return e&&(t["data-file"]=e),this.relId&&(t["data-rel-id"]=this.relId),t}toHTML(){const t=this.getContainerStyle();return"video"===this.mediaType&&this.videoInfo?this.toVideoHTML(t):"audio"===this.mediaType&&this.audioInfo?this.toAudioHTML(t):this.toImageHTML(t)}toImageHTML(t){const e=["width: 100%","height: 100%","object-fit: contain"].join("; "),r=this.getDataAttributes();return`<div ${Object.entries(r).map(([t,e])=>`${t}="${e}"`).join(" ")} style="${t}">\n      <img src="${this.src}" alt="${this.altText||""}" style="${e}" />\n    </div>`}toVideoHTML(t){const e=this.videoInfo,r=["width: 100%","height: 100%","object-fit: contain"].join("; "),n=this.getDataAttributes(),i=Object.entries(n).map(([t,e])=>`${t}="${e}"`).join(" ");return"link"===e.type?`<div ${i} style="${t}">\n        <iframe\n          src="${e.src}"\n          style="${r}"\n          frameborder="0"\n          allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"\n          allowfullscreen>\n        </iframe>\n      </div>`:`<div ${i} style="${t}">\n        <video\n          src="${e.src}"\n          style="${r}"\n          ${e.autoplay?"autoplay":""}\n          ${e.muted?"muted":""}\n          ${e.loop?"loop":""}\n          ${e.controls?"controls":""}>\n          ${this.getVideoSourceTag(e.format)}\n        </video>\n      </div>`}getVideoSourceTag(t){if(!t)return"";const e={mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg"}[t];return e?`<source src="${this.videoInfo?.src}" type="${e}" />`:""}toAudioHTML(t){const e=this.audioInfo,r=["width: 100%","display: block"].join("; "),n=this.getDataAttributes(),i=Object.entries(n).map(([t,e])=>`${t}="${e}"`).join(" ");return"link"===e.type?`<div ${i} style="${t}">\n        <audio\n          src="${e.src}"\n          style="${r}"\n          ${e.autoplay?"autoplay":""}\n          ${e.muted?"muted":""}\n          ${e.loop?"loop":""}\n          ${e.controls?"controls":""}>\n        </audio>\n      </div>`:`<div ${i} style="${t}">\n        <audio id="audio_${this.id}" style="${r}" ${e.controls?"controls":""}>\n          ${this.getAudioSourceTag(e.format)}\n        </audio>\n      </div>`}getAudioSourceTag(t){if(!t)return"";const e={mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg"}[t];return e?`<source src="${this.audioInfo?.src}" type="${e}" />`:""}toParsedElement(){return{id:this.id,type:"image",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,relId:this.relId,src:this.src,altText:this.altText,mimeType:this.mimeType,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class L extends N{static fromNode(t,e){try{const n=f(t,"oleObj",r.p);if(!n){const n=f(t,"Fallback",r.mc);if(n){const t=f(n,"pic",r.p);if(t){const r=j.fromNode(t,e);if(r)return new L(r.id,r.rect,"",r.relId,{...r.props,isOle:!0,hasFallback:!0},e)}}return null}const i=n.getAttribute("progId")||"",s=n.getAttributeNS(r.r,"id")||n.getAttribute("r:id")||"",o=new L("",{x:0,y:0,width:0,height:0},i,s,{},e),a=f(t,"nvGraphicFramePr",r.p),l=a?f(a,"cNvPr",r.p):null;o.id=g(l,"id",o.generateId()),o.name=g(l,"name",""),o.hidden=m(l,"hidden"),o.oleName=o.name;const c=f(t,"xfrm",r.p);if(c){const t=f(c,"off",r.a),e=f(c,"ext",r.a);t&&e&&(o.rect.x=d(t.getAttribute("x")||"0"),o.rect.y=d(t.getAttribute("y")||"0"),o.rect.width=d(e.getAttribute("cx")||"0"),o.rect.height=d(e.getAttribute("cy")||"0"))}return o.content={},o.props={progId:i,relId:s,hasFallback:!1},o.rawNode=t,o}catch(t){return console.error("Failed to parse OLE element:",t),null}}constructor(t,e,r,n,i={},s={}){super(t,"ole",e,i,s),this.type="ole",this.progId=r,this.relId=n,this.oleName=""}toHTML(){const t=this.getContainerStyle();return`<div ${this.formatDataAttributes()} style="${t}">\n      <div style="${["width: 100%","height: 100%","display: flex","align-items: center","justify-content: center","background-color: #f5f5f5","border: 1px dashed #ccc","color: #666","font-size: 12px","text-align: center","padding: 10px"].join("; ")}">\n        ${this.progId||this.oleName||"OLE Object"}\n      </div>\n    </div>`}toParsedElement(){return{id:this.id,type:"ole",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,relId:this.relId,progId:this.progId,hasFallback:this.hasFallback,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class R extends N{constructor(){super(...arguments),this.type="chart",this.relId=""}static fromNode(t,e){try{const n=f(t,"nvGraphicFramePr",r.p),i=n?f(n,"cNvPr",r.p):null,s=g(i,"id",`chart_${Date.now()}`),o=g(i,"name",""),a=m(i,"hidden"),l=f(t,"xfrm",r.p);let c={x:0,y:0,width:0,height:0};if(l){const t=f(l,"off",r.a),e=f(l,"ext",r.a);t&&(c.x=d(t.getAttribute("x")||"0"),c.y=d(t.getAttribute("y")||"0")),e&&(c.width=d(e.getAttribute("cx")||"0"),c.height=d(e.getAttribute("cy")||"0"))}const p=new R(s,"chart",c,"",{},e);p.name=o,p.hidden=a;const h=f(t,"graphic",r.a),u=h?f(h,"graphicData",r.a):null;if(!u)return null;if(!(u.getAttribute("uri")||"").includes("chart"))return null;const y=f(u,"chart",r.c);if(!y)return null;const b=y.getAttribute("type")||"unknown",x=y.getAttributeNS(r.r,"id")||y.getAttribute("r:id")||"";if(p.chartType=p.detectChartType(y),p.relId=x,p.content={chartType:"unknown",data:[]},p.props={relId:x,chartType:b},p.rawNode=t,x&&e[x]){const t=e[x].target;console.log(`Chart file path: ${t}`)}return p}catch(t){return console.error("Failed to parse chart element:",t),null}}detectChartType(t){const e=Array.from(t.children);for(const t of e){const e=t.tagName;if(e.includes("lineChart"))return"lineChart";if(e.includes("barChart"))return"barChart";if(e.includes("pieChart"))return e.includes("3D")?"pie3DChart":"pieChart";if(e.includes("areaChart"))return"areaChart";if(e.includes("scatterChart"))return"scatterChart"}return"unknown"}toHTML(){const t=this.getContainerStyle(),e=this.formatDataAttributes(),r=["width: 100%","height: 100%","display: flex","align-items: center","justify-content: center","background-color: #fafafa","border: 1px solid #ddd","color: #333","font-size: 14px","text-align: center","border-radius: 4px","padding: 20px"].join("; "),n=this.getChartLabel();return this.chartData&&Array.isArray(this.chartData.series)&&this.chartData.series.length>0?`<div ${e} style="${t}">\n        <div style="width: 100%;">\n          <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">\n            ${this.chartData?.title||"Chart"}\n          </div>\n          ${this.renderChartData()}\n        </div>\n      </div>`:`<div ${e} style="${t}">\n      <div style="${r}">\n        ${n}\n      </div>\n    </div>`}getChartLabel(){const t={lineChart:"折线图",barChart:"柱状图",pieChart:"饼图",pie3DChart:"3D饼图",areaChart:"面积图",scatterChart:"散点图",unknown:"图表"};return this.chartType&&t[this.chartType]||"Chart"}renderChartData(){if(!this.chartData||!this.chartData.series)return"";const t=this.chartData;let e='<div style="margin: 10px 0;">';return t.xTitle&&(e+=`<div style="font-size: 12px; color: #666; margin-bottom: 5px;">X轴: ${t.xTitle}</div>`),t.yTitle&&(e+=`<div style="font-size: 12px; color: #666; margin-bottom: 10px;">Y轴: ${t.yTitle}</div>`),e+='<div style="display: flex; flex-wrap: wrap; gap: 10px;">',t.series&&t.series.forEach((t,r)=>{e+=`\n          <div style="\n            background: ${t.color||"#4285f4"};\n            color: white;\n            padding: 10px;\n            border-radius: 4px;\n            min-width: 150px;\n          ">\n            <div style="font-weight: bold;">${t.name||`系列 ${r+1}`}</div>\n            <div style="font-size: 12px; margin-top: 5px;">\n              数据点: ${t.points?.length||0}\n            </div>\n          </div>\n        `}),e+="</div>",e+="</div>",e}toParsedElement(){return{id:this.id,type:"chart",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,relId:this.relId,chartType:this.chartType,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class E extends N{constructor(t,e,r={},n={},i={}){super(t,"diagram",e,r,n,i),this.type="diagram",this.relId=""}static fromNode(t,e){try{const n=f(t,"nvGraphicFramePr",r.p),i=n?f(n,"cNvPr",r.p):null,s=g(i,"id",`diagram_${Date.now()}`),o=g(i,"name",""),a=m(i,"hidden"),l=f(t,"xfrm",r.p);let c={x:0,y:0,width:0,height:0};if(l){const t=f(l,"off",r.a),e=f(l,"ext",r.a);t&&(c.x=d(t.getAttribute("x")||"0"),c.y=d(t.getAttribute("y")||"0")),e&&(c.width=d(e.getAttribute("cx")||"0"),c.height=d(e.getAttribute("cy")||"0"))}const p=new E(s,c,"",{},e);p.name=o,p.hidden=a;const h=f(t,"graphic",r.a),u=h?f(h,"graphicData",r.a):null;if(!u)return null;const y=u.getAttribute("uri")||"";if(!y.includes("diagram"))return null;const b=f(u,"dgm",r.d);if(!b)return null;const x=b.getAttributeNS(r.r,"rel")||b.getAttribute("r:rel")||"";return p.relId=x,p.diagramData=p.parseDiagramData(b,e),p.content={diagramData:p.diagramData},p.props={relId:x,diagramType:y},p.rawNode=t,p}catch(t){return console.error("Failed to parse diagram element:",t),null}}parseDiagramData(t,e){const n={},i=t.getAttributeNS(r.d,"relIds")||"",s=this.parseRelIds(i);s.colors&&this.relsMap[s.colors]&&(n.colors=this.fetchColorData(this.relsMap[s.colors].target)),s.data&&this.relsMap[s.data]&&(n.data=this.fetchLayoutData(this.relsMap[s.data].target)),s.layout&&this.relsMap[s.layout]&&(n.layout=this.relsMap[s.layout].target);const o=f(t,"spTree",r.d);return o&&(n.shapes=this.parseShapes(o)),n}parseRelIds(t){const e={};if(!t)return e;const r=t.split(",").map(t=>t.trim());return r.length>=1&&(e.colors=r[0]),r.length>=2&&(e.data=r[1]),r.length>=3&&(e.layout=r[2]),r.length>=4&&(e.quickStyle=r[3]),e}async fetchColorData(t){try{t.startsWith("../")&&t.substring(3);return{}}catch(t){return void console.warn("Failed to fetch color data:",t)}}async fetchLayoutData(t){try{t.startsWith("../")&&t.substring(3);return{}}catch(t){return void console.warn("Failed to fetch layout data:",t)}}fetchColorDataSync(t){return{_needsAsyncLoad:!0,target:t}}fetchLayoutDataSync(t){return{_needsAsyncLoad:!0,target:t}}parseShapes(t){const e=[],n=Array.from(t.children);for(const t of n){const n=t.getAttribute("id")||"",i=t.tagName||"shape",s=f(t,"xfrm",r.d);let o;if(s){const t=f(s,"off",r.a),a=f(s,"ext",r.d);if(t){const e=parseInt(t.getAttribute("x")||"0"),r=parseInt(t.getAttribute("y")||"0");o={x:d(e),y:d(r)}}if(a){const t=parseInt(a.getAttribute("cx")||"0"),r=parseInt(a.getAttribute("cy")||"0");e.push({id:n,type:i,position:o,size:{width:d(t),height:d(r)}})}}else e.push({id:n,type:i})}return e}toHTML(){const t=this.getContainerStyle();return`<div ${this.formatDataAttributes()} style="${t}">\n      <div style="${["width: 100%","height: 100%","display: flex","align-items: center","justify-content: center","background-color: #f0f0f0","border: 1px dashed #ccc","color: #666","font-size: 14px","text-align: center","padding: 20px","border-radius: 4px"].join("; ")}">\n        ${this.getDiagramInfo()}\n      </div>\n    </div>`}getDiagramInfo(){const t=this.diagramData?.shapes?.length||0;let e='<div style="text-align: left;">';return e+='<div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">SmartArt / Diagram</div>',e+=`<div style="margin-bottom: 10px;">形状数量: ${t}</div>`,this.diagramData?.shapes&&t>0&&(e+='<div style="margin-top: 10px;">',this.diagramData.shapes.slice(0,10).forEach((t,r)=>{e+=`<div style="\n          display: inline-block;\n          width: 60px;\n          height: 40px;\n          background: #e0e0e0;\n          border: 1px solid #ccc;\n          border-radius: 4px;\n          margin: 5px;\n          font-size: 12px;\n        ">\n          ${t.type}\n        </div>`}),t>10&&(e+=`<div style="display: inline-block; padding: 10px;">...还有 ${t-10} 个形状</div>`),e+="</div>"),e+="</div>",e}toParsedElement(){return{id:this.id,type:"diagram",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class D extends N{constructor(){super(...arguments),this.type="table",this.rows=[],this.colWidths=[]}static fromNode(t,e){try{const n=new D("","table",{x:0,y:0,width:0,height:0},{},{},e),i=f(t,"nvGraphicFramePr",r.p),s=i?f(i,"cNvPr",r.p):null;n.id=g(s,"id",n.generateId()),n.name=g(s,"name",""),n.hidden=!1;const o=f(t,"xfrm",r.p);if(o){const t=f(o,"off",r.a),e=f(o,"ext",r.a);t&&(n.rect.x=d(t.getAttribute("x")||"0"),n.rect.y=d(t.getAttribute("y")||"0")),e&&(n.rect.width=d(e.getAttribute("cx")||"0"),n.rect.height=d(e.getAttribute("cy")||"0"))}const a=f(t,"graphic",r.a),l=a?f(a,"graphicData",r.a):null;if(!l)return null;if(!(l.getAttribute("uri")||"").includes("table"))return null;const c=f(l,"tbl",r.a);return c?(n.parseTable(c),n.tableStyle=n.parseTableStyle(c),n.rtl="1"===c.getAttribute("rtl"),n.content={rows:n.rows,colWidths:n.colWidths,tableStyle:n.tableStyle},n.props={rowCount:n.rows.length,colCount:n.colWidths.length},n.rawNode=t,n):null}catch(t){return console.error("Failed to parse table element:",t),null}}parseTable(t){const e=u(t,"tr",r.a);this.rows=e.map(t=>this.parseTableRow(t));const n=u(t,"gridCol",r.a);this.colWidths=n.map(t=>d(t.getAttribute("w")||"0"))}parseTableRow(t){const e={cells:[],style:{}},n=t.getAttribute("h");n&&(e.height=d(n));const i=u(t,"tc",r.a);return e.cells=i.map(t=>this.parseTableCell(t)),e}parseTableCell(t){const e={style:{}},n=t.getAttribute("rowSpan");n&&(e.rowSpan=parseInt(n));const i=t.getAttribute("gridSpan");i&&(e.colSpan=parseInt(i));const s=f(t,"txBody",r.a);s&&(e.text=function(t){const e=u(t,"p",r.a),n=[];return e.forEach(t=>{u(t,"r",r.a).forEach(t=>{const e=f(t,"t",r.a);e?.textContent&&n.push(e.textContent)})}),n.join("")}(s));const o=f(t,"tcPr",r.a);return o&&this.parseCellStyle(o,e),e}parseCellStyle(t,e){const n=f(t,"tcBdr",r.a);if(n){const t=this.parseBorder(n,"left"),r=this.parseBorder(n,"top");this.parseBorder(n,"right"),this.parseBorder(n,"bottom"),e.style&&(e.style.borderColor=t?.color||r?.color,e.style.borderWidth=r?.width||"1px")}const i=f(t,"fill",r.a);if(i){const t=f(i,"solidFill",r.a);if(t){const n=f(t,"srgbClr",r.a);n?.getAttribute("val")&&(e.style.backgroundColor=`#${n.getAttribute("val")}`)}}const s=t.getAttribute("vAlign");s&&e.style&&(e.style.verticalAlign=s);const o=t.getAttribute("marL"),a=t.getAttribute("marR"),l=t.getAttribute("marT"),c=t.getAttribute("marB");if(e.style){const t=parseInt(o||"0"),r=parseInt(a||"0"),n=parseInt(l||"0"),i=parseInt(c||"0"),s=[];n&&s.push(`${d(n)}px`),r&&s.push(`${d(r)}px`),i&&s.push(`${d(i)}px`),t&&s.push(`${d(t)}px`),s.length>0&&(e.style.padding=s.join(" "))}}parseBorder(t,e){const n=f(t,e,r.a);if(!n)return;const i=n.getAttribute("color");return{color:i?`#${i}`:void 0,width:parseInt(n.getAttribute("sz")||"0")/100+"px"}}parseTableStyle(t){const e={},n=f(t,"wholeTbl",r.a),i=this.parseTableWholeStyle(n);i&&(i.backgroundColor&&(this.style.backgroundColor=i.backgroundColor),i.borderColor&&i.borderWidth&&(this.style.border=`${i.borderWidth} solid ${i.borderColor}`),i.shadow&&(this.style.boxShadow=this.generateBoxShadow(i.shadow)));const s=f(t,"tblBg",r.a);if(s){const t=f(s,"fill",r.a),n=f(t,"solidFill",r.a),i=f(n,"srgbClr",r.a);i?.getAttribute("val")&&(e.firstRow={backgroundColor:`#${i.getAttribute("val")}`})}const o=f(t,"firstRow",r.a);o&&(e.firstRow=this.parseRowStyle(o));const a=f(t,"lastRow",r.a);a&&(e.lastRow={backgroundColor:this.parseRowBackgroundColor(a)});const l=f(t,"firstCol",r.a);l&&(e.firstCol={backgroundColor:this.parseRowBackgroundColor(l)});const c=f(t,"lastCol",r.a);c&&(e.lastCol={backgroundColor:this.parseRowBackgroundColor(c)});const d=f(t,"band1H",r.a);d&&(e.bandRow={odd:{backgroundColor:this.parseRowBackgroundColor(d)}});const p=f(t,"band2H",r.a);return p&&(e.bandRow||(e.bandRow={}),e.bandRow.even={backgroundColor:this.parseRowBackgroundColor(p)}),e}parseRowStyle(t){const e=f(t,"fill",r.a);if(e){const t=f(e,"solidFill",r.a),n=f(t,"srgbClr",r.a);if(n?.getAttribute("val")){return{backgroundColor:`#${n.getAttribute("val")}`}}}return{}}parseRowBackgroundColor(t){const e=f(t,"fill",r.a);if(e){const t=f(e,"solidFill",r.a),n=f(t,"srgbClr",r.a);if(n?.getAttribute("val"))return`#${n.getAttribute("val")}`}}parseTableWholeStyle(t){if(!t)return null;const e={},n=f(t,"fill",r.a);if(n){const t=f(n,"solidFill",r.a);if(t){const n=f(t,"srgbClr",r.a);n?.getAttribute("val")&&(e.backgroundColor=`#${n.getAttribute("val")}`);const i=f(t,"schemeClr",r.a);i?.getAttribute("val")&&(e.backgroundColor=i.getAttribute("val")||void 0)}f(n,"gradFill",r.a)}const i=f(t,"ln",r.a);if(i){const t=i.getAttribute("w"),n=f(i,"solidFill",r.a);if(n){const t=f(n,"srgbClr",r.a);t?.getAttribute("val")&&(e.borderColor=`#${t.getAttribute("val")}`)}if(t){const r=parseInt(t),n=Math.round(r/9525);e.borderWidth=`${n}px`}else e.borderWidth="1px"}const s=f(t,"effectLst",r.a);if(s){const t=f(s,"outerShdw",r.a);if(t){e.shadow={};const n=f(t,"solidFill",r.a);if(n){const t=f(n,"srgbClr",r.a);t?.getAttribute("val")&&(e.shadow.color=`#${t.getAttribute("val")}`)}const i=t.getAttribute("blur");i&&(e.shadow.blur=Math.round(parseInt(i)/9525));const s=t.getAttribute("dist"),o=t.getAttribute("dir");if(s&&o){const t=parseInt(s)/9525,r=parseInt(o)/6e4*Math.PI/180;e.shadow.offsetX=Math.round(t*Math.cos(r)),e.shadow.offsetY=Math.round(t*Math.sin(r))}}}return Object.keys(e).length>0?e:null}generateBoxShadow(t){if(!t)return"";const e=[];return void 0!==t.offsetX?e.push(`${t.offsetX}px`):e.push("0"),void 0!==t.offsetY?e.push(`${t.offsetY}px`):e.push("0"),void 0!==t.blur?e.push(`${t.blur}px`):e.push("0"),t.color?e.push(t.color):e.push("#000000"),e.join(" ")}toHTML(){const t=this.getContainerStyle();return`<div ${this.formatDataAttributes()} style="${t}">\n      <table style="${this.getTableStyle()}">\n        <tbody>\n${this.rows.map(t=>this.rowToHTML(t)).join("\n")}\n        </tbody>\n      </table>\n    </div>`}getTableStyle(){return["width: 100%","height: 100%","border-collapse: collapse","border-spacing: 0"].join("; ")}rowToHTML(t){return`      <tr style="${this.getRowStyle(t)}">\n${t.cells.map(t=>this.cellToHTML(t)).join("\n        ")}\n      </tr>`}getRowStyle(t){const e=[];return t.height&&e.push(`height: ${t.height}px`),t.style?.isHeader&&this.tableStyle?.firstRow?.backgroundColor?e.push(`background-color: ${this.tableStyle.firstRow.backgroundColor}`):t.style?.isFooter&&this.tableStyle?.lastRow?.backgroundColor&&e.push(`background-color: ${this.tableStyle.lastRow.backgroundColor}`),e.join("; ")}cellToHTML(t){const e=this.getCellStyle(t),r=[];t.rowSpan&&t.rowSpan>1&&r.push(`rowspan="${t.rowSpan}"`),t.colSpan&&t.colSpan>1&&r.push(`colspan="${t.colSpan}"`);return`<td${r.length>0?" "+r.join(" "):""} style="${e}">${t.text||""}</td>`}getCellStyle(t){const e=[];return t.style?.backgroundColor&&e.push(`background-color: ${t.style.backgroundColor}`),t.style?.borderColor&&t.style?.borderWidth&&e.push(`border: ${t.style.borderWidth} solid ${t.style.borderColor}`),t.style?.padding&&e.push(`padding: ${t.style.padding}`),t.style?.verticalAlign&&e.push(`vertical-align: ${t.style.verticalAlign}`),e.join("; ")}toParsedElement(){return{id:this.id,type:"table",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class z extends N{constructor(){super(...arguments),this.type="group",this.children=[]}static fromNode(t,e){try{const n=new z(`group_${Date.now()}`,"group",{x:0,y:0,width:0,height:0},[],{},e),i=f(t,"grpSpPr",r.p);return n.parseGroupProperties(i,t),Array.from(t.children).forEach(t=>{if(1!==t.nodeType)return;const r=t.tagName;let i=null;"p:sp"===r||"sp"===r?i=F.fromNode(t,e):"p:pic"===r||"pic"===r?i=j.fromNode(t,e):"p:graphicFrame"===r||"graphicFrame"===r?i=n.parseGraphicFrame(t,e):"p:grpSp"!==r&&"grpSp"!==r||(i=z.fromNode(t,e)),i&&n.children.push(i)}),n.content={},n.props={},n.name="分组",n.rawNode=t,n}catch(t){return console.error("Failed to parse group element:",t),null}}parseGraphicFrame(t,e){const n=f(t,"graphic",r.a),i=n?f(n,"graphicData",r.a):null;if(!i)return null;const s=i.getAttribute("uri")||"";return s.includes("oleObject")?L.fromNode(t,e):s.includes("chart")?R.fromNode(t,e):s.includes("diagram")?E.fromNode(t,e):s.includes("table")?D.fromNode(t,e):null}parseGroupProperties(t,e){if(!t)return;const n=f(t,"xfrm",r.a);if(n){const t=f(n,"off",r.a),e=f(n,"ext",r.a),i=f(n,"chOff",r.a),s=f(n,"chExt",r.a);if(i){const t=parseInt(i.getAttribute("x")||"0"),e=parseInt(i.getAttribute("y")||"0");this.childOffset={x:d(t),y:d(e)}}if(e&&s){const r=parseInt(e.getAttribute("cx")||"0"),n=parseInt(e.getAttribute("cy")||"0"),o=parseInt(s.getAttribute("cx")||"0"),a=parseInt(s.getAttribute("cy")||"0");this.childOffset||(this.childOffset={x:0,y:0});let l=0,c=0;i&&(l=parseInt(i.getAttribute("x")||"0"),c=parseInt(i.getAttribute("y")||"0")),t&&(this.childOffset.x+=d(parseInt(t.getAttribute("x")||"0")-l),this.childOffset.y+=d(parseInt(t.getAttribute("y")||"0")-c)),this.rect.x=d(o),this.rect.y=d(a),this.rect.width=d(r-o),this.rect.height=d(n-a)}const o=n.getAttribute("rot");null!==o&&(this.rotation=parseInt(o)/6e4),this.flipH="1"===n.getAttribute("flipH"),this.flipV="1"===n.getAttribute("flipV")}}toHTML(){const t=this.getGroupStyle();return`<div class="ppt-group" ${this.formatDataAttributes()} style="${t}">\n${this.children.map(t=>t.toHTML()).join("\n")}\n    </div>`}getGroupStyle(){const t=["position: absolute",`left: ${this.rect.x}px`,`top: ${this.rect.y}px`,`width: ${this.rect.width}px`,`height: ${this.rect.height}px`];return void 0!==this.rotation&&0!==this.rotation&&(t.push(`transform: rotate(${this.rotation}deg)`),t.push("transform-origin: center center")),this.flipH&&this.flipV?(t.push(`transform: rotate(${this.rotation||0}deg) scale(-1, -1)`),t.push("transform-origin: center center")):this.flipH?(t.push(`transform: rotate(${this.rotation||0}deg) scale(-1, 1)`),t.push("transform-origin: center center")):this.flipV&&(t.push(`transform: rotate(${this.rotation||0}deg) scale(1, -1)`),t.push("transform-origin: center center")),this.childOffset&&(t.push(`margin-left: ${this.childOffset.x}px`),t.push(`margin-top: ${this.childOffset.y}px`)),this.hidden&&t.push("display: none"),t.join("; ")}toParsedElement(){return{id:this.id,type:"group",rect:this.rect,style:this.style,content:this.content,props:{rotation:this.rotation,flipH:this.flipH,flipV:this.flipV,childOffset:this.childOffset},name:this.name,hidden:this.hidden,children:this.children.map(t=>t instanceof F||t instanceof j||t instanceof L||t instanceof R||t instanceof E||t instanceof z?t.toParsedElement():t),attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}function H(t,e){if(e.layout?.textStyles){const r=O(e.layout.textStyles,t);if(r)return r}if(e.master?.textStyles){const r=O(e.master.textStyles,t);if(r)return r}return{fontSize:14,color:"#333333",fontWeight:"normal",fontFamily:"Arial",align:"left"}}function O(t,e){switch(e){case"title":case"ctrTitle":case"subTitle":return W(t.titleParaPr);case"body":case"obj":case"chart":case"table":case"dgm":return W(t.bodyPr);default:return W(t.otherPr)}}function W(t){if(!t)return null;const e={},n=f(t,"defRPr",r.a);if(n){const t=f(n,"sz",r.a);if(t){const r=parseInt(t.getAttribute("val")||"0",10)/100;e.fontSize=r*(4/3)}const i=f(n,"solidFill",r.a);if(i){const t=f(i,"srgbClr",r.a);t?.getAttribute("val")&&(e.color=`#${t.getAttribute("val")}`);const n=f(i,"schemeClr",r.a);n?.getAttribute("val")&&(e.color=n.getAttribute("val"))}const s=f(n,"latin",r.a);s?.getAttribute("typeface")&&(e.fontFamily=s.getAttribute("typeface"));const o=f(n,"b",r.a);o&&(e.fontWeight="1"===o.getAttribute("val")||"true"===o.getAttribute("val")?"bold":"normal");const a=f(n,"i",r.a);a&&(e.italic="1"===a.getAttribute("val")||"true"===a.getAttribute("val"));const l=f(n,"u",r.a);l&&(e.underline=l.getAttribute("val")||"sng");const c=f(n,"strike",r.a);c&&(e.strike="1"===c.getAttribute("val")||"true"===c.getAttribute("val"))}const i=t.getAttribute("algn");return i&&(e.align=i),Object.keys(e).length>0?e:null}function B(t,e,r,n){if(!t.elements||!Array.isArray(t.elements))return;const i=function(t,e,r,n){return{slide:t,layout:e,master:r,theme:n}}(t,e,r,n);t.elements.forEach(t=>{"shape"!==t.type&&"text"!==t.type||function(t,e){if(t.textStyle&&t.textStyle.length>0){const r=H(t.placeholderType||"body",e);return void(r&&t.textStyle.forEach(t=>{!t.fontSize&&r.fontSize&&(t.fontSize=r.fontSize),!t.color&&r.color&&(t.color=r.color),!t.fontFamily&&r.fontFamily&&(t.fontFamily=r.fontFamily),t.bold||"bold"!==r.fontWeight||(t.bold=!0),!t.italic&&r.italic&&(t.italic=r.italic)}))}if(t.isPlaceholder&&t.placeholderType){const r=function(t,e){return t.textStyle||t.style?t.textStyle||t.style:t.isPlaceholder&&t.placeholderType?H(t.placeholderType,e):{fontSize:14,color:"#333333",fontWeight:"normal",fontFamily:"Arial",align:"left"}}(t,e);r&&(t.style={...t.style,...r})}}(t,i)})}class _{constructor(t,e,r,n,i,s,o){this.id=t.id,this.title=t.title,this.background="string"==typeof t.background?t.background:"",this.elements=e,this.rawResult=t,this.layoutElement=r,this.masterElement=n,this.layout=i,this.master=s,this.mediaMap=o}toHTML(){!this.rawResult.styleApplied&&this.layout&&(B(this.rawResult,this.layout,this.master),this.rawResult.styleApplied=!0);const t=function(t,e,r){const n=["position: relative","overflow: hidden","margin: 0 auto",`width: ${d(t)}px`,`height: ${d(e)}px`];return r?"color"===r.type&&r.value?n.push(`background: ${r.value}`):"image"===r.type&&r.value&&n.push(`background: url('${r.value}') no-repeat center/cover`):n.push("background: #ffffff"),n.join("; ")}(9144e3,6858e3,this.rawResult.background),e=this.renderMasterElements(),r=this.renderLayoutElements(),n=this.renderSlideElementsWithLayout();return`<div class="slide" style="${t}" data-slide-id="${this.id}" data-slide-title="${this.escapeHtml(this.title)}">\n${e}\n${r}\n${n}\n    </div>`}renderMasterElements(){return this.masterElement?this.masterElement.toHTML():""}renderLayoutElements(){return this.layoutElement?this.layoutElement.toHTML():""}renderSlideElementsWithLayout(){if(!this.layout)return this.elements.map(t=>t.toHTML()).join("\n");const t=[];this.elements.forEach(e=>{const r=C(this.layout?.placeholders||[],"shape"===e.type?"body":e.type),n=C(this.master?.placeholders||[],"shape"===e.type?"body":e.type);e.style,!r||function(t){const{rect:e,hAlign:r,vAlign:n}=t,i=d(e.x),s=["position: absolute",`top: ${d(e.y)}px`,`left: ${i}px`,`width: ${d(e.width)}px`,`height: ${d(e.height)}px`],o=I(r,n);s.join("; ")}(r);let i={};const s=function(t,e,r){let n={fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1,...r};return n={...n,...e},n={...n,...t},n}(e.style,r?r.style:void 0,n?n.style:void 0);s&&(i=s),e.style&&Object.assign(e.style,i);const o=e.toHTML();t.push(o)});const e=new Set;return this.elements.forEach(t=>{const r=C(this.layout?.placeholders||[],"shape"===t.type?"body":t.type);if(r){const t=`${r.type||""}_${r.idx??""}`;e.add(t)}}),t.join("")}getTextContentStyle(t,e){const r=[];if(t.fontSize&&r.push(`font-size: ${t.fontSize}px`),t.color&&r.push(`color: ${t.color}`),t.fontWeight&&r.push(`font-weight: ${t.fontWeight}`),t.textAlign&&r.push(`text-align: ${t.textAlign}`),t.backgroundColor&&"transparent"!==t.backgroundColor&&r.push(`background-color: ${t.backgroundColor}`),e){const[t,n]=e.split("_");"mid"!==t&&"center"!==t||(r.push("display: flex"),r.push("align-items: center")),"mid"!==n&&"center"!==n||r.push("justify-content: center")}return r.join("; ")}getSlideBackground(){const t=this.rawResult.background;if(!t)return"background-color: #ffffff;";if("string"==typeof t)return`background-color: ${t};`;if("color"===t.type&&t.value)return`background-color: ${t.value};`;if("image"===t.type){const e=t.value||t.relId;if(e)return`background-image: url('${e}'); background-size: cover; background-position: center;`}return"background-color: #ffffff;"}toHTMLString(){const t=["width: 960px","height: 540px","margin: 20px auto","border: 1px solid #ccc","box-shadow: 0 2px 8px rgba(0,0,0,0.1)",`background-color: ${this.background}`,"position: relative","overflow: hidden"].join("; "),e=this.toHTML();return`<div class="ppt-slide-container" style="${t}">\n      <div class="ppt-slide-header" style="padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd; font-size: 14px; font-weight: bold;">\n        ${this.escapeHtml(this.title)}\n      </div>\n      ${e}\n    </div>`}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}class X{constructor(t,e,r,n=960,i=540,s){this.id=t,this.title=e,this.slides=r,this.width=n,this.height=i,this.ratio=n/i,this.author=s}static fromParseResult(t){const e=t.slides.map(t=>{const{createElementFromData:e}=require("../elements"),r=(t.elements||[]).map(r=>r instanceof N?r:e(r,t.relsMap||{})).filter(t=>null!==t);return new _(t,r,t.layout,t.master)});return new X(t.id,t.title,e,t.props.width||960,t.props.height||540,t.author)}toHTML(){const t=[`width: ${this.width}px`,`min-height: ${this.height}px`,"margin: 20px auto","padding: 20px","background: #f9f9f9","border: 1px solid #ddd"].join("; "),e=this.slides.map(t=>t.toHTMLString()).join("\n\n");return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${this.escapeHtml(this.title)}</title>\n  <style>\n    .ppt-slide-container {\n      page-break-after: always;\n    }\n    .ppt-slide-container:last-child {\n      page-break-after: auto;\n    }\n  </style>\n</head>\n<body>\n  <div style="${t}">\n    <h1 style="text-align: center; margin-bottom: 30px;">${this.escapeHtml(this.title)}</h1>\n${e}\n  </div>\n</body>\n</html>`}toHTMLWithNavigation(){const t=this.slides.map((t,e)=>`\n        <div class="ppt-slide-page" data-index="${e}" style="display: ${0===e?"block":"none"};">\n          ${t.toHTML()}\n        </div>\n      `).join("\n"),e=`\n      <div style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000;">\n        <button onclick="prevSlide()" style="padding: 10px 20px; margin-right: 10px; cursor: pointer;">上一页</button>\n        <span id="slideCounter" style="padding: 10px;">1 / ${this.slides.length}</span>\n        <button onclick="nextSlide()" style="padding: 10px 20px; margin-left: 10px; cursor: pointer;">下一页</button>\n      </div>\n    `,r=`\n      <script>\n        let currentSlide = 0;\n        const slides = document.querySelectorAll('.ppt-slide-page');\n\n        function showSlide(index) {\n          slides.forEach((slide, i) => {\n            slide.style.display = i === index ? 'block' : 'none';\n          });\n          document.getElementById('slideCounter').textContent = (index + 1) + ' / ${this.slides.length}';\n          currentSlide = index;\n        }\n\n        function prevSlide() {\n          showSlide(Math.max(0, currentSlide - 1));\n        }\n\n        function nextSlide() {\n          showSlide(Math.min(${this.slides.length} - 1, currentSlide + 1));\n        }\n\n        document.addEventListener('keydown', (e) => {\n          if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') prevSlide();\n          if (e.key === 'ArrowRight' || e.key === 'ArrowDown') nextSlide();\n        });\n      <\/script>\n    `;return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${this.escapeHtml(this.title)}</title>\n  <style>\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      min-height: 100vh;\n      background: #333;\n    }\n    .ppt-wrapper {\n      width: ${this.width}px;\n      height: ${this.height}px;\n      background: #fff;\n      box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n    }\n  </style>\n</head>\n<body>\n  <div class="ppt-wrapper">\n${t}\n  </div>\n${e}\n${r}\n</body>\n</html>`}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}function G(t,e={},r){if(!t||!t.type)return null;switch(t.type){case"shape":case"text":{const r=new F(t.id,t.type,t.rect,t.content,t.props,e);return Object.assign(r,t),r}case"image":{let n=t.src||"";r&&t.relId&&r.has(t.relId)&&(n=r.get(t.relId)||n);const i=new j(t.id,t.rect,n,t.relId||"",t.props||{},e);return Object.assign(i,t),i.src=n,i}case"ole":{const r=new L(t.id,t.rect,t.progId,t.relId,t.props,e);return Object.assign(r,t),r}case"chart":{const r=new R(t.id,"chart",t.rect,t.content,t.props,e);return Object.assign(r,t),r}case"table":{const r=new D(t.id,t.rect,t.content,t.props,e);return Object.assign(r,t),r}case"diagram":{const r=new E(t.id,t.rect,t.content,t.props,e);return Object.assign(r,t),r}case"group":{const r=new z(t.id,t.rect,t.props,e);return Object.assign(r,t),r}default:return null}}class V extends N{constructor(t,e,r,n={}){super(t,"placeholder",r,{},n,{}),this.type="placeholder",this.placeholderType=e,this.isPlaceholder=!0,this.idx=n.idx,this.name=n.name,this.text=n.text,this.textStyle=n.textStyle}toHTML(){const t=[this.getContainerStyle(),"pointer-events: none","user-select: none"].join("; "),e=this.getPlaceholderContent();return`<div class="ppt-placeholder" data-placeholder-type="${this.placeholderType}" style="${t}">\n${e}\n</div>`}getPlaceholderContent(){switch(this.placeholderType){case"title":return this.isContentSet?this.renderTextContent():'<span class="placeholder-label">点击添加标题</span>';case"body":return this.isContentSet?this.renderTextContent():'<span class="placeholder-label">点击添加文本</span>';case"slideNumber":return'<span class="slide-number"></span>';case"footer":return this.text||'<span class="footer-text"></span>';case"dateTime":return this.text||'<span class="date-time"></span>';default:return this.text||""}}renderTextContent(){return this.text?this.textStyle&&this.textStyle.length>0?this.textStyle.map(t=>`<span style="${this.getTextRunStyle(t)}">${t.text}</span>`).join(""):`<span style="color: inherit;">${this.text}</span>`:""}get isContentSet(){return!(!this.text||!this.text.trim())}getTextRunStyle(t){const e=[];return t.fontSize&&e.push(`font-size: ${t.fontSize}px`),t.fontFamily&&e.push(`font-family: ${t.fontFamily}`),t.color&&e.push(`color: ${t.color}`),t.bold&&e.push("font-weight: bold"),t.italic&&e.push("font-style: italic"),t.underline&&e.push("text-decoration: underline"),e.join("; ")}}class U extends N{constructor(t,e,r=[],n=[],i={}){super(t,"layout",{x:0,y:0,width:960,height:540},{},i,{}),this.type="layout",this.name=e,this.placeholders=r,this.elements=n,this.textStyles=i.textStyles,this.background=i.background,this.relsMap=i.relsMap||{},this.mediaMap=i.mediaMap}static fromResult(t,e){const r=(t.placeholders||[]).map(t=>new V(t.id,t.type,t.rect,{idx:t.idx,name:t.name,rawNode:t.rawNode})),n=(t.elements||[]).map(r=>r instanceof N?r:G(r,t.relsMap||{},e)).filter(t=>null!==t);return new U(t.id,t.name,r,n,{textStyles:t.textStyles,background:t.background,relsMap:t.relsMap,colorMap:t.colorMap,mediaMap:e})}toHTML(){const t=["position: absolute","left: 0","top: 0","width: 100%","height: 100%","pointer-events: none","z-index: 1",this.getBackgroundStyle()].join("; "),e=this.placeholders.map(t=>t.toHTML()).join("\n"),r=this.elements.map(t=>t.toHTML()).join("\n");return`<div class="ppt-layout" style="${t}" data-layout-id="${this.id}" data-layout-name="${this.name||""}">\n${e}\n${r}\n</div>`}getBackgroundStyle(){if(!this.background)return"background-color: transparent;";if("color"===this.background.type&&this.background.value)return`background-color: ${this.background.value};`;if("image"===this.background.type&&this.background.relId){const t=this.mediaMap?this.mediaMap.get(this.background.relId):this.background.relId;if(t)return`background-image: url('${t}'); background-size: cover;`}return"background-color: transparent;"}}class q extends N{constructor(t,e=[],r=[],n={}){super(t,"master",{x:0,y:0,width:960,height:540},{},n,{}),this.type="master",this.masterId=n.masterId,this.elements=e,this.placeholders=r,this.textStyles=n.textStyles,this.background=n.background,this.colorMap=n.colorMap||{},this.mediaMap=n.mediaMap}static fromResult(t,e){const r=(t.placeholders||[]).map(t=>new V(t.id,t.type||"other",t.rect||{x:0,y:0,width:100,height:50},{idx:t.idx,name:t.name})),n=(t.elements||[]).map(r=>G(r,t.relsMap,e)).filter(t=>null!==t);return new q(t.id,n,r,{masterId:t.masterId,textStyles:t.textStyles,background:t.background,colorMap:t.colorMap,relsMap:t.relsMap,mediaMap:e})}toHTML(){const t=["width: 100%","height: 100%","position: absolute","top: 0","left: 0","pointer-events: none","z-index: 0",this.getBackgroundStyle()].join("; "),e=this.elements.map(t=>t.toHTML()).join("\n"),r=this.placeholders.map(t=>t.toHTML()).join("\n");return`<div class="ppt-master" style="${t}" data-master-id="${this.id}">\n${r}\n${e}\n</div>`}getBackgroundStyle(){if(!this.background)return"background-color: transparent;";if("color"===this.background.type&&this.background.value)return`background-color: ${this.background.value};`;if("image"===this.background.type&&this.background.relId){const t=this.mediaMap?this.mediaMap.get(this.background.relId):this.background.relId;if(t)return`background-image: url('${t}'); background-size: cover;`}return"background-color: transparent;"}getPlaceholderStyle(t){if(!this.textStyles)return null;switch(t){case"title":return this.parseParagraphProperties(this.textStyles.titleParaPr);case"body":return this.parseParagraphProperties(this.textStyles.bodyPr);default:return this.parseParagraphProperties(this.textStyles.otherPr)}}parseParagraphProperties(t){return t?{}:null}}class Y extends N{constructor(t,e,r,n,i,s){super(t,"theme",{x:0,y:0,width:0,height:0},{},{},{}),this.type="theme",this.name=e,this.colors=r,this.fonts=i,this.effects=s,this.themeId=n||this.sanitizeThemeName(e)}static fromResult(t,e="theme1"){return new Y(`theme_${e}`,e,t.colors,e)}getThemeClassPrefix(){return`theme-${this.themeId}`}getThemeClass(t){return`${this.getThemeClassPrefix()}-${t}`}sanitizeThemeName(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}generateThemeCSS(){const t=this.getThemeClassPrefix(),e=[];e.push(`/* ===== ${this.name} 主题样式 ===== */`),e.push(`.${t} {`),this.colors.bg1&&e.push(`  --${t}-bg1: ${this.colors.bg1};`),this.colors.tx1&&e.push(`  --${t}-tx1: ${this.colors.tx1};`),this.colors.bg2&&e.push(`  --${t}-bg2: ${this.colors.bg2};`),this.colors.tx2&&e.push(`  --${t}-tx2: ${this.colors.tx2};`),this.colors.accent1&&e.push(`  --${t}-accent1: ${this.colors.accent1};`),this.colors.accent2&&e.push(`  --${t}-accent2: ${this.colors.accent2};`),this.colors.accent3&&e.push(`  --${t}-accent3: ${this.colors.accent3};`),this.colors.accent4&&e.push(`  --${t}-accent4: ${this.colors.accent4};`),this.colors.accent5&&e.push(`  --${t}-accent5: ${this.colors.accent5};`),this.colors.accent6&&e.push(`  --${t}-accent6: ${this.colors.accent6};`),this.colors.hlink&&e.push(`  --${t}-hlink: ${this.colors.hlink};`),this.colors.folHlink&&e.push(`  --${t}-fol-hlink: ${this.colors.folHlink};`),e.push("}"),e.push("");return["bg1","tx1","bg2","tx2","accent1","accent2","accent3","accent4","accent5","accent6","hlink","fol-hlink"].forEach(r=>{const n="fol-hlink"===r?"folHlink":r;this.colors[n]&&(e.push(`.${t}-bg-${r} {`),e.push(`  background-color: var(--${t}-${r});`),e.push("}"),e.push(`.${t}-text-${r} {`),e.push(`  color: var(--${t}-${r});`),e.push("}"),e.push(`.${t}-border-${r} {`),e.push(`  border-color: var(--${t}-${r});`),e.push("}"))}),e.push(""),this.fonts&&(e.push(`/* ${this.name} 字体方案 */`),this.fonts.majorFont&&(e.push(`.${t}-font-major {`),this.fonts.majorFont.latin&&e.push(`  font-family: "${this.fonts.majorFont.latin}", sans-serif;`),this.fonts.majorFont.ea&&e.push(`  font-family: "${this.fonts.majorFont.ea}", sans-serif;`),e.push("}")),this.fonts.minorFont&&(e.push(`.${t}-font-minor {`),this.fonts.minorFont.latin&&e.push(`  font-family: "${this.fonts.minorFont.latin}", sans-serif;`),this.fonts.minorFont.ea&&e.push(`  font-family: "${this.fonts.minorFont.ea}", sans-serif;`),e.push("}")),e.push("")),e.push(`/* ${this.name} 预设样式类 */`),e.push(`.${t}-title {`),e.push(`  color: var(--${t}-tx1);`),this.fonts?.majorFont?.latin&&e.push(`  font-family: "${this.fonts.majorFont.latin}", sans-serif;`),e.push("}"),e.push(`.${t}-body {`),e.push(`  color: var(--${t}-tx2);`),this.fonts?.minorFont?.latin&&e.push(`  font-family: "${this.fonts.minorFont.latin}", sans-serif;`),e.push("}"),this.colors.hlink&&(e.push(`.${t}-link {`),e.push(`  color: var(--${t}-hlink);`),e.push("  text-decoration: none;"),e.push("}")),this.colors.folHlink&&(e.push(`.${t}-link:visited {`),e.push(`  color: var(--${t}-fol-hlink);`),e.push("}")),["accent1","accent2","accent3","accent4","accent5","accent6"].forEach((r,n)=>{this.colors[r]&&(e.push(`.${t}-accent-${n+1} {`),e.push(`  color: var(--${t}-${r});`),e.push("}"))}),e.join("\n")}getColor(t){return this.colors[t]}getMajorFont(){return this.fonts?.majorFont?.latin||this.fonts?.majorFont?.ea}getMinorFont(){return this.fonts?.minorFont?.latin||this.fonts?.minorFont?.ea}toHTML(){return""}}class J extends N{constructor(t,e=[],r=[],n=[],i={}){super(t,"tags",{x:0,y:0,width:0,height:0},{},i,{}),this.type="tags",this.tags=e,this.customProperties=r,this.extensions=n,this.slideId=i.slideId}static fromResult(t){return new J(t.id,t.tags,t.customProperties,t.extensions,{slideId:t.slideId})}toHTML(){if(!(this.tags.length>0||this.customProperties.length>0))return"";return`<div class="ppt-tags" style="${["display: none",`data-tags-id="${this.id}"`,`data-slide-id="${this.slideId||""}"`].join("; ")}" ${this.tags.length>0?`data-tags='${JSON.stringify(this.tags)}'`:""} ${this.customProperties.length>0?`data-custom-props='${JSON.stringify(this.customProperties)}'`:""} ${this.extensions.length>0?`data-extensions='${JSON.stringify(this.extensions)}'`:""}>\n</div>`}toHTMLDebug(){const t=["position: absolute","top: 10px","right: 10px","background: rgba(0, 0, 0, 0.8)","color: white","padding: 10px","border-radius: 4px","font-size: 12px","max-width: 300px","z-index: 1000","pointer-events: none"].join("; ");let e=`<strong>Tags (${this.tags.length}):</strong>`;return this.tags.length>0&&(e+="<ul>",this.tags.forEach(t=>{e+=`<li>${t.name}: ${t.value}</li>`}),e+="</ul>"),this.customProperties.length>0&&(e+=`<strong>Properties (${this.customProperties.length}):</strong><ul>`,this.customProperties.forEach(t=>{e+=`<li>${t.name}: ${t.value} (${t.type})</li>`}),e+="</ul>"),`<div class="ppt-tags-debug" style="${t}">\n${e}\n</div>`}getTag(t){return this.tags.find(e=>e.name===t)?.value}getProperty(t){return this.customProperties.find(e=>e.name===t)?.value}setTag(t,e){const r=this.tags.find(e=>e.name===t);r?r.value=e:this.tags.push({name:t,value:e})}setProperty(t,e,r){const n=this.customProperties.find(e=>e.name===t);n?(n.value=e,r&&(n.type=r)):this.customProperties.push({name:t,value:e,type:r})}}class Z extends N{constructor(t,e=[],r=[],n={}){super(t,"notesMaster",{x:0,y:0,width:800,height:600},{},n,{}),this.type="notesMaster",this.elements=e,this.placeholders=r,this.background=n.background,this.mediaMap=n.mediaMap}static fromResult(t,e){const r=(t.elements||[]).map(r=>G(r,t.relsMap,e)).filter(t=>null!==t);return new Z(t.id,r,t.placeholders||[],{background:t.background,relsMap:t.relsMap,mediaMap:e})}toHTML(){const t=this.getBackgroundStyle(),e=[this.getContainerStyle(),t].join("; "),r=this.elements.map(t=>t.toHTML()).join("\n");return`<div class="ppt-notes-master" style="${e}" data-notes-master-id="${this.id}">\n${r}\n</div>`}getBackgroundStyle(){if(!this.background)return"background-color: #ffffff;";if("color"===this.background.type&&this.background.value)return`background-color: ${this.background.value};`;if("image"===this.background.type&&this.background.relId){const t=this.mediaMap?this.mediaMap.get(this.background.relId):this.background.relId;if(t)return`background-image: url('${t}'); background-size: cover;`}return"background-color: #ffffff;"}}class K extends N{constructor(t,e,r={}){super(t,"notesSlide",e,{},r,{}),this.type="notesSlide",this.text=r.text,this.masterRef=r.masterRef,this.slideId=r.slideId}static fromResult(t){return new K(t.id,{x:0,y:0,width:800,height:600},{text:t.text,masterRef:t.masterRef,slideId:t.slideId,elements:t.elements,background:t.background,relsMap:t.relsMap})}toHTML(){const t=[this.getContainerStyle(),"background: #fff","padding: 20px","border: 1px solid #ddd","border-radius: 4px"].join("; ");let e="";return this.slideId&&(e+=`<div style="font-weight: bold; margin-bottom: 10px;">幻灯片 ${this.slideId} 备注</div>`),this.text?e+=`<div style="font-size: 14px; line-height: 1.6;">${this.text}</div>`:e+='<div style="color: #999; font-style: italic;">无备注内容</div>',`<div class="ppt-notes-slide" style="${t}" data-notes-id="${this.id}" data-slide-id="${this.slideId||""}">\n${e}\n</div>`}setMaster(t){this.master=t}}class Q extends N{constructor(t,e,r=960,n=540,i={}){super(t,"document",{x:0,y:0,width:r,height:n},{},i,{}),this.type="document",this.title=e,this.width=r,this.height=n,this.ratio=r/n,this.pageSize=i.pageSize||"16:9",this.author=i.author,this.subject=i.subject,this.keywords=i.keywords,this.description=i.description,this.created=i.created,this.modified=i.modified,this.slides=[],this.layouts={},this.masters=[],this.tags=[],this.notesMasters=[],this.notesSlides=[],this.globalRelsMap=i.globalRelsMap||{},this.mediaMap=i.mediaMap,this.theme=void 0}static fromParseResult(t){const e=new Q(t.id,t.title,t.props.width||960,t.props.height||540,{pageSize:t.props.pageSize,author:t.author,subject:t.subject,keywords:t.keywords,description:t.description,created:t.created,modified:t.modified,globalRelsMap:t.globalRelsMap,mediaMap:t.mediaMap});return t.theme&&(e.theme=Y.fromResult(t.theme,t.theme.name||"theme1")),t.masterSlides&&t.masterSlides.length>0&&(e.masters=t.masterSlides.map(t=>q.fromResult(t,e.mediaMap))),t.slideLayouts&&Object.entries(t.slideLayouts).forEach(([t,r])=>{e.layouts[t]=U.fromResult(r,e.mediaMap)}),t.notesMasters&&t.notesMasters.length>0&&(e.notesMasters=t.notesMasters.map(t=>Z.fromResult(t,e.mediaMap))),t.notesSlides&&t.notesSlides.length>0&&(e.notesSlides=t.notesSlides.map(t=>{const r=K.fromResult(t);if(t.masterRef){const n=e.notesMasters.find(e=>e.id===t.masterRef);n&&r.setMaster(n)}return r})),t.tags&&t.tags.length>0&&(e.tags=t.tags.map(t=>J.fromResult(t))),t.slides&&t.slides.length>0&&(e.slides=t.slides.map(r=>{const n=(r.elements||[]).map(t=>t instanceof N?t:G(t,r.relsMap||{},e.mediaMap)).filter(t=>null!==t);let i,s,o,a;return r.layoutId&&e.layouts[r.layoutId]&&(i=e.layouts[r.layoutId],o=t.slideLayouts?.[r.layoutId]),r.masterRefIndex&&(s=e.masters.find(t=>t.masterId===r.masterRefIndex),a=t.masterSlides?.find(t=>t.masterId===r.masterRefIndex)),new _(r,n,i,s,o,a,e.mediaMap)})),e}toHTML(t={}){return!1!==t.withNavigation?this.toHTMLWithNavigation(t):this.toHTMLDocument(t)}toHTMLDocument(t={}){const e=this.slides.map(t=>t.toHTML()).join("\n\n"),r=!1!==t.includeStyles?this.generateStyles(t):"";return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${this.escapeHtml(this.title)}</title>\n  ${r?"<style>\n"+r+"\n</style>":""}\n</head>\n<body>\n  <div class="ppt-wrapper">\n${e}\n  </div>\n</body>\n</html>`}toHTMLWithNavigation(t={}){const e=this.slides.map((t,e)=>`\n        <div class="ppt-slide-page" data-index="${e}" style="display: ${0===e?"block":"none"};">\n          ${t.toHTML()}\n        </div>\n      `).join("\n"),r=`\n      <div class="ppt-navigation" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; align-items: center; gap: 15px; background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 25px;">\n        <button onclick="prevSlide()" style="padding: 8px 16px; cursor: pointer; background: #fff; border: none; border-radius: 4px; font-size: 14px;">上一页</button>\n        <span id="slideCounter" style="color: #fff; font-size: 14px; min-width: 60px; text-align: center;">1 / ${this.slides.length}</span>\n        <button onclick="nextSlide()" style="padding: 8px 16px; cursor: pointer; background: #fff; border: none; border-radius: 4px; font-size: 14px;">下一页</button>\n      </div>\n    `,n=`\n      <script>\n        let currentSlide = 0;\n        const slides = document.querySelectorAll('.ppt-slide-page');\n\n        function showSlide(index) {\n          slides.forEach((slide, i) => {\n            slide.style.display = i === index ? 'block' : 'none';\n          });\n          document.getElementById('slideCounter').textContent = (index + 1) + ' / ${this.slides.length}';\n          currentSlide = index;\n        }\n\n        function prevSlide() {\n          showSlide(Math.max(0, currentSlide - 1));\n        }\n\n        function nextSlide() {\n          showSlide(Math.min(${this.slides.length} - 1, currentSlide + 1));\n        }\n\n        document.addEventListener('keydown', (e) => {\n          if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') prevSlide();\n          if (e.key === 'ArrowRight' || e.key === 'ArrowDown') nextSlide();\n        });\n\n        // 触摸滑动支持\n        let touchStartX = 0;\n        let touchEndX = 0;\n        document.addEventListener('touchstart', e => {\n          touchStartX = e.changedTouches[0].screenX;\n        });\n        document.addEventListener('touchend', e => {\n          touchEndX = e.changedTouches[0].screenX;\n          if (touchStartX - touchEndX > 50) nextSlide();\n          if (touchEndX - touchStartX > 50) prevSlide();\n        });\n      <\/script>\n    `,i=!1!==t.includeStyles?this.generateStyles(t):this.generateNavigationStyles();return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${this.escapeHtml(this.title)}</title>\n  ${i?"<style>\n"+i+"\n</style>":""}\n</head>\n<body>\n  <div class="ppt-wrapper">\n${e}\n  </div>\n${r}\n${!1!==t.includeScripts?n:""}\n</body>\n</html>`}generateStyles(t){const e=["/* PPTX 文档基础样式 */","* { box-sizing: border-box; margin: 0; padding: 0; }","","body {",'  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;',"  background: #333;","  min-height: 100vh;","}","",".ppt-wrapper {","  display: flex;","  justify-content: center;","  align-items: center;","  min-height: 100vh;","  padding: 20px;","}","",".ppt-container {","  background: #fff;","  box-shadow: 0 2px 8px rgba(0,0,0,0.1);","}","","/* ===== PPTXjs 核心布局类系统 ===== */","","/* 幻灯片容器基础样式 */",".slide {","  position: relative;","  overflow: hidden;","  margin: 0 auto;","  box-sizing: border-box;","}","","/* 占位符基础样式（对应版式占位符） */",".slide div.block {","  position: absolute;","  top: 0;","  left: 0;","  width: 100%;","  line-height: 1;","  box-sizing: border-box;","  display: flex;","  flex-direction: column;","}","","/* 垂直对齐类（映射版式垂直规则） */",".slide div.v-up { justify-content: flex-start; }",".slide div.v-mid { justify-content: center; }",".slide div.v-down { justify-content: flex-end; }","","/* 水平对齐类（映射版式水平规则） */",".slide div.h-left { align-items: flex-start; text-align: left; }",".slide div.h-mid { align-items: center; text-align: center; }",".slide div.h-right { align-items: flex-end; text-align: right; }","","/* 复合对齐类（高频组合） */",".slide div.up-left { justify-content: flex-start; align-items: flex-start; }",".slide div.up-center { justify-content: flex-start; align-items: center; text-align: center; }",".slide div.up-right { justify-content: flex-start; align-items: flex-end; text-align: right; }",".slide div.center-left { justify-content: center; align-items: flex-start; }",".slide div.center-center { justify-content: center; align-items: center; text-align: center; }",".slide div.center-right { justify-content: center; align-items: flex-end; text-align: right; }",".slide div.down-left { justify-content: flex-end; align-items: flex-start; }",".slide div.down-center { justify-content: flex-end; align-items: center; text-align: center; }",".slide div.down-right { justify-content: flex-end; align-items: flex-end; text-align: right; }","","/* 内容容器 */",".content {","  width: 100%;","  height: 100%;","  box-sizing: border-box;","}","","/* 文本样式（全局字体） */",".slide-prgrph {","  font-family: Arial, sans-serif;","  font-size: 14px;","  color: #333333;","  line-height: 1.4;","}","","/* ===== 原有样式 ===== */","","/* 幻灯片样式 */",".ppt-slide {","  position: relative;","  margin: 20px auto;","  border: 1px solid #ddd;","  background: #fff;","}","",".ppt-slide-page {",`  width: ${this.width}px;`,`  height: ${this.height}px;`,"  background: #fff;","  box-shadow: 0 4px 20px rgba(0,0,0,0.3);","}","","/* 布局和母版元素 */",".ppt-master-element,",".ppt-layout-element {","  pointer-events: none;","}","","/* 元素通用样式 */",".ppt-element {","  position: absolute;","}","","/* 文本元素 */",".ppt-text {","  overflow: hidden;","}","","/* 占位符样式 */",".ppt-placeholder {","  pointer-events: none;","  user-select: none;","}",""];return this.theme&&(e.push("/* ===== 主题样式 ===== */"),e.push(this.theme.generateThemeCSS()),e.push("")),t.customCss&&(e.push("/* 自定义样式 */"),e.push(t.customCss)),e.join("\n")}generateNavigationStyles(){return`* { margin: 0; padding: 0; box-sizing: border-box; }\nbody {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 100vh;\n  background: #333;\n}\n.ppt-wrapper {\n  width: ${this.width}px;\n  height: ${this.height}px;\n  background: #fff;\n  box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n}`}getSlide(t){return this.slides[t]}getLayout(t){return this.layouts[t]}getMaster(t){return this.masters.find(e=>e.id===t)}escapeHtml(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,t=>e[t])}}function tt(t){return Q.fromParseResult(t)}function et(t,e){const n=t.tagName;if("p:sp"===n||"sp"===n)return F.fromNode(t,e);if("p:pic"===n||"pic"===n)return j.fromNode(t,e);if("p:graphicFrame"===n||"graphicFrame"===n){const n=f(t,"graphic",r.a),i=n?f(n,"graphicData",r.a):null;if(!i)return null;const s=i.getAttribute("uri")||"";return s.includes("oleObject")?L.fromNode(t,e):s.includes("chart")?R.fromNode(t,e):s.includes("diagram")?E.fromNode(t,e):s.includes("table")?D.fromNode(t,e):null}return"p:grpSp"===n||"grpSp"===n?z.fromNode(t,e):null}async function rt(t,e,r=a){try{const n=`${r}${e}.xml.rels`,i=await(t.file(n)?.async("string"));return i?x(i,"_rels/.rels"):{}}catch(t){return M("warn",`Failed to parse ${r}${e} relationships`,t),{}}}function nt(t,e={},n=0){try{const i=new DOMParser,s=i.parseFromString(t,"application/xml").documentElement;if("p:sld"!==s.tagName&&!s.tagName.includes("sld"))return M("warn","Invalid slide XML root element",s.tagName),ot(n);const o=it(s,e),a=function(t,e){const n=f(t,"cSld",r.p);if(!n)return`幻灯片 ${e+1}`;const i=f(n,"spTree",r.p);if(!i)return`幻灯片 ${e+1}`;const s=u(i,"sp",r.p);for(const t of s){const e=f(t,"nvSpPr",r.p);if(!e)continue;const n=f(e,"nvPr",r.p);if(!n)continue;const i=f(n,"ph",r.p);if(!i)continue;const s=i.getAttribute("type");if("title"===s||"ctrTitle"===s){const e=f(t,"txBody",r.p);if(!e)continue;const n=st(e);if(n&&n.trim())return n.trim()}}return`幻灯片 ${e+1}`}(s,n),l=function(t,e){const n=[],i=f(t,"cSld",r.p);if(!i)return M("warn","cSld element not found"),n;const s=f(i,"spTree",r.p);if(!s)return M("warn","spTree element not found"),n;return M("info","Processing spTree children..."),Array.from(s.children).forEach((t,i)=>{if(1!==t.nodeType)return;const s=t.tagName,o=t.localName||s.split(":").pop()||s;M("info",`Processing element ${i}: tagName=${s}, localName=${o}`);let a=null;"sp"===o?a=F.fromNode(t,e):"pic"===o?a=j.fromNode(t,e):"graphicFrame"===o?a=function(t,e){try{const n=f(t,"graphic",r.a),i=n?f(n,"graphicData",r.a):null;if(!i)return M("warn","graphicData not found in graphicFrame"),null;const s=i.getAttribute("uri")||"";return s.includes("oleObject")?L.fromNode(t,e):s.includes("chart")?R.fromNode(t,e):s.includes("diagram")?E.fromNode(t,e):s.includes("table")?D.fromNode(t,e):(M("info",`Unknown graphicFrame type: ${s}`),null)}catch(t){return M("error","Failed to parse graphicFrame element",t),null}}(t,e):"grpSp"===o?a=z.fromNode(t,e):M("info",`Skipping unknown element type: tagName=${s}, localName=${o}`),a&&n.push(a)}),M("info",`Total elements parsed: ${n.length}`),n}(s,e);return M("info",`Parsed slide ${n+1}: ${l.length} elements`),{id:P("slide"),title:a,background:o,elements:l.map(t=>t),relsMap:e}}catch(t){return M("error",`Failed to parse slide ${n}`,t),ot(n)}}function it(t,e={}){const n=f(t,"bg",r.p);if(!n)return{type:"color",value:"#ffffff"};const i=f(n,"bgRef",r.p);if(i)return function(t){t.getAttribute("idx");const e=f(t,"schemeClr",r.a);if(e){const t=e.getAttribute("val");if(t)return{type:"color",value:t,schemeRef:t}}return{type:"color",value:"#ffffff"}}(i);const s=f(n,"bgPr",r.p);if(s){const t=f(s,"blipFill",r.a);if(t){const n=f(t,"blip",r.a);if(n){const t=n.getAttribute("r:embed")||n.getAttributeNS(r.r,"embed");if(t&&e[t])return{type:"image",value:e[t].target,relId:t}}}const n=f(s,"solidFill",r.a);if(n){const t=f(n,"srgbClr",r.a);if(t?.getAttribute("val"))return{type:"color",value:`#${t.getAttribute("val")}`};const e=f(n,"schemeClr",r.a);if(e){const t=e.getAttribute("val");if(t)return{type:"color",value:t||"#ffffff",schemeRef:t||void 0}}}if(f(s,"gradFill",r.a))return{type:"color",value:"#ffffff"}}return{type:"color",value:"#ffffff"}}function st(t){const e=Array.from(t.children).filter(t=>"a:p"===t.tagName||t.tagName.includes(":p")),r=[];for(const t of e){const e=Array.from(t.children).filter(t=>"a:r"===t.tagName||t.tagName.includes(":r"));for(const t of e){const e=f(t,"t","http://schemas.openxmlformats.org/drawingml/2006/main");e?.textContent&&r.push(e.textContent)}}return r.join("")}function ot(t){return{id:P("slide"),title:`幻灯片 ${t+1}`,background:"#ffffff",elements:[],relsMap:{}}}async function at(t,e,r,n){if(e.background&&"string"!=typeof e.background){const i=e.background;if("image"===i.type&&i.relId){const e=await lt(t,i.relId,r,n);e&&(i.value=e)}}let i=0;for(const s of e.elements)if("image"===s.type){i++;const o=s,a=o.relId;if(a){M("info",`Found image element in ${e.id}: relId=${a}, src=${o.src}`);const i=await lt(t,a,r,n);i?(o.src=i,M("info",`Updated image src to base64 URL, length=${i.length}`)):M("warn",`Failed to resolve image relId=${a} in ${e.id}`)}else M("warn",`Image element missing relId in ${e.id}`)}i>0&&M("info",`Found ${i} image elements in ${e.id}`)}async function lt(t,e,r,n){if(n.has(e))return M("info",`Cache hit for relId=${e}`),n.get(e);const i=r[e];if(!i)return M("warn",`No relationship found for relId=${e} in relsMap`),null;M("info",`Resolving image relId=${e}, target=${i.target}`);const s=await async function(t,e){M("info",`findImageFileInZip: targetPath=${e}`);let r=await t.file(e);if(r)return{file:r,path:e};if(e.startsWith("..")){const n=`ppt/${e.substring(3)}`;if(r=await t.file(n),r)return{file:r,path:n}}if(e.includes("media/")&&!e.startsWith("ppt/")){const n=`ppt/${e}`;if(r=await t.file(n),r)return{file:r,path:n}}if(e.startsWith("media/")){const n=`ppt/${e}`;if(r=await t.file(n),r)return{file:r,path:n}}const n=["ppt/slideLayouts/","ppt/slideMasters/","ppt/slides/","ppt/notesMasters/","ppt/notesSlides/","ppt/",""];for(const i of n){const n=i+e;if(r=await t.file(n),r)return{file:r,path:n}}const i=[];t.forEach((t,e)=>{i.push({name:t,file:e})});const s=e.split("/").pop()||"";if(s){const t=s.toLowerCase();for(const{name:e,file:r}of i)if((e.split("/").pop()||"").toLowerCase()===t&&e.includes("media/"))return{file:r,path:e};for(const{name:e,file:r}of i)if((e.split("/").pop()||"").toLowerCase()===t)return{file:r,path:e}}const o=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp"];for(const{name:t,file:e}of i){const r=t.toLowerCase();for(const n of o)if(r.endsWith(n)&&(r.includes("image")||r.includes("img")))return{file:e,path:t}}M("info",`Could not find image file for target: ${e}`),M("info",`Available files in ZIP (${i.length} total):`);const a=i.filter(({name:t})=>t.includes("media/"));return a.length>0&&(M("info",`Media files (${a.length}):`),a.slice(0,20).forEach(({name:t})=>{M("info",`  - ${t}`)}),a.length>20&&M("info",`  ... and ${a.length-20} more`)),null}(t,i.target);if(!s)return M("warn",`Image file not found in zip after exhaustive search. Original target: ${i.target}`),null;const{file:o,path:a}=s;M("info",`Found image file at: ${a}`);const l=await o.async("base64"),c=function(t){const e=t.split(".").pop()?.toLowerCase();switch(e){case"png":return"image/png";case"jpg":case"jpeg":default:return"image/jpeg";case"gif":return"image/gif";case"bmp":return"image/bmp";case"svg":return"image/svg+xml";case"webp":return"image/webp"}}(a),d=`data:${c};base64,${l}`;return M("info",`Converted image to base64 URL, mimeType=${c}, length=${d.length}`),n.set(e,d),d}async function ct(t,e="ppt/theme/theme1.xml"){try{const r=await(t.file(e)?.async("string"));if(!r)return M("warn",`Theme file not found: ${e}`),null;const n=new DOMParser,i=n.parseFromString(r,"application/xml").documentElement,s=i.getAttribute("name")||e.split("/").pop()?.replace(".xml","")||"theme1",o=function(t){const e={},r=f(t,"themeElements","http://schemas.openxmlformats.org/drawingml/2006/main");if(!r)return e;const n=f(r,"clrScheme","http://schemas.openxmlformats.org/drawingml/2006/main");if(!n)return e;const i={bg1:"bg1",tx1:"tx1",bg2:"bg2",tx2:"tx2",accent1:"accent1",accent2:"accent2",accent3:"accent3",accent4:"accent4",accent5:"accent5",accent6:"accent6",hlink:"hlink",folHlink:"folHlink"};return Array.from(n.children).forEach(t=>{if(1!==t.nodeType)return;const r=t.localName||t.tagName.split(":").pop();r&&i[r]&&(e[i[r]]=function(t){const e=f(t,"srgbClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(e){const t=e.getAttribute("val");if(t)return`#${t}`}const r=f(t,"sysClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(r){const t=r.getAttribute("lastClr");if(t)return`#${t}`}return"#ffffff"}(t))}),e}(i);return M("info",`Parsed theme from ${e}: ${s}`),{colors:o,name:s}}catch(t){return M("error",`Failed to parse theme: ${e}`,t),null}}function dt(t,e,r={}){if(r[t]){const n=function(t){return{light:"lt1",dark:"dk1"}[t]||t}(r[t]);return e[n]||"#ffffff"}return e[t]||"#ffffff"}function pt(t,e,n){try{const i=new DOMParser,s=i.parseFromString(t,"application/xml").documentElement,o=function(t,e){const r=f(t,"bg","http://schemas.openxmlformats.org/presentationml/2006/main");if(!r)return{type:"color",value:"#ffffff"};const n=f(r,"bgRef","http://schemas.openxmlformats.org/presentationml/2006/main");if(n){n.getAttribute("idx");const t=f(n,"schemeClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(t){const e=t.getAttribute("val");if(e)return{type:"color",value:e,schemeRef:e}}}const i=f(r,"bgPr","http://schemas.openxmlformats.org/presentationml/2006/main");if(i){const t=f(i,"blipFill","http://schemas.openxmlformats.org/drawingml/2006/main");if(t){const r=f(t,"blip","http://schemas.openxmlformats.org/drawingml/2006/main");if(r){const t=r.getAttribute("r:embed")||r.getAttributeNS("http://schemas.openxmlformats.org/officeDocument/2006/relationships","embed");if(t&&e[t])return{type:"image",value:e[t].target,relId:t}}}const r=f(i,"solidFill","http://schemas.openxmlformats.org/drawingml/2006/main");if(r){const t=f(r,"srgbClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(t?.getAttribute("val"))return{type:"color",value:`#${t.getAttribute("val")}`};const e=f(r,"schemeClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(e){const t=e.getAttribute("val");if(t)return{type:"color",value:t||"#ffffff",schemeRef:t||void 0}}}}return{type:"color",value:"#ffffff"}}(s,e),a=function(t){const e=f(t,"clrMapOvr","http://schemas.openxmlformats.org/presentationml/2006/main"),r={};if(!e)return r;const n=f(e,"masterClrMapping","http://schemas.openxmlformats.org/drawingml/2006/main");n&&Array.from(n.attributes).forEach(t=>{r[t.name]=t.value});return r}(s),l=function(t){const e=f(t,"txStyles","http://schemas.openxmlformats.org/presentationml/2006/main");if(!e)return{};return{titleParaPr:f(e,"titleP","http://schemas.openxmlformats.org/presentationml/2006/main"),bodyPr:f(e,"body","http://schemas.openxmlformats.org/presentationml/2006/main"),otherPr:f(e,"other","http://schemas.openxmlformats.org/presentationml/2006/main")}}(s),c=function(t,e){const n=[],i=f(t,"cSld","http://schemas.openxmlformats.org/presentationml/2006/main");if(!i)return n;const s=f(i,"spTree","http://schemas.openxmlformats.org/presentationml/2006/main");return s?(Array.from(s.children).forEach(t=>{if(1!==t.nodeType)return;const i=t.localName||t.tagName.split(":").pop();if("sp"===i){const i=f(t,"nvSpPr",r.p),s=i?f(i,"nvPr",r.p):null,o=s?f(s,"ph",r.p):null;if(o){const e=o.getAttribute("type");if(["sldNum","ftr","dt"].includes(e||"")){const e=function(t){const e=f(t,"nvSpPr",r.p);if(!e)return null;const n=f(e,"cNvPr",r.p),i=n?.getAttribute("id"),s=n?.getAttribute("name"),o=f(e,"nvPr",r.p);if(!o)return null;const a=f(o,"ph",r.p);if(!a)return null;const l=a.getAttribute("type"),c=f(t,"spPr",r.a),d=f(c,"xfrm",r.a);let p={x:0,y:0,width:0,height:0};if(d){const t=f(d,"off",r.a),e=f(d,"ext",r.a);t&&(p.x=parseInt(t.getAttribute("x")||"0"),p.y=parseInt(t.getAttribute("y")||"0")),e&&(p.width=parseInt(e.getAttribute("cx")||"0"),p.height=parseInt(e.getAttribute("cy")||"0"))}return{id:i,name:s,type:"shape",placeholder:l,rect:p}}(t);e&&n.push(e)}}else{const r=F.fromNode(t,e);r&&n.push(r)}}else if("pic"===i){const r=j.fromNode(t,e);r&&n.push(r)}else if("grpSp"===i){const r=z.fromNode(t,e);r&&n.push(r)}else if("graphicFrame"===i){const i=function(t,e){try{const n=f(t,"graphic",r.a),i=n?f(n,"graphicData",r.a):null;if(!i)return null;const s=i.getAttribute("uri")||"";return s.includes("table")?D.fromNode(t,e):s.includes("chart")?R.fromNode(t,e):s.includes("diagram")?E.fromNode(t,e):null}catch(t){return M("warn","Failed to parse master graphicFrame element",t),null}}(t,e);i&&n.push(i)}}),n):n}(s,e),d=c.filter(t=>t.placeholder);let p;for(const t of Object.values(e))if(t.type.includes("theme")){const e=t.target.match(/theme(\d+)\.xml/);e&&(p=`theme${e[1]}`,M("info",`Master references theme: ${p}`))}return{id:`master-${n}`,masterId:`slideMaster${n}`,background:o,elements:c,placeholders:d,colorMap:a,textStyles:l,themeRef:p,relsMap:e}}catch(t){return M("error",`Failed to parse master slide ${n}`,t),{id:`master-${n}`,masterId:`slideMaster${n}`,elements:[],colorMap:{}}}}const ht={slideLayouts:c,slideLayoutsRels:"ppt/slideLayouts/_rels/"};function ut(t,e={}){try{const n=new DOMParser,i=n.parseFromString(t,"application/xml").documentElement;if("p:sldLayout"!==i.tagName&&!i.tagName.includes("sldLayout"))return M("warn","Invalid layout XML root element",i.tagName),null;const s=f(i,"cSld",r.p),o=s?.getAttribute("name")||void 0,a=it(i,e),l=f(i,"clrMapOvr",r.p),c=f(l,"masterClrMapping",r.a);let d={};if(c){Array.from(c.attributes).forEach(t=>{"xmlns:a"!==t.name&&(d[t.name]=t.value)})}const p=function(t){const e=f(t,"txStyles",r.p);if(!e)return{};return{titleParaPr:f(e,"titleP",r.p),bodyPr:f(e,"body",r.p),otherPr:f(e,"other",r.p)}}(i),h=function(t,e){const n=[],i=f(t,"cSld",r.p);if(!i)return n;const s=f(i,"spTree",r.p);return s?(Array.from(s.children).forEach(t=>{if(1!==t.nodeType)return;const i=t.localName||t.tagName.split(":").pop();if("sp"===i){const i=f(t,"nvPr",r.p);if(!(i?f(i,"ph",r.p):null)){const r=F.fromNode(t,e);r&&n.push(r)}}else if("pic"===i){const r=j.fromNode(t,e);r&&n.push(r)}else if("grpSp"===i){const r=z.fromNode(t,e);r&&n.push(r)}else if("graphicFrame"===i){const i=function(t,e){try{const n=f(t,"graphic",r.a),i=n?f(n,"graphicData",r.a):null;if(!i)return null;const s=i.getAttribute("uri")||"";return s.includes("table")?D.fromNode(t,e):s.includes("chart")?R.fromNode(t,e):s.includes("diagram")?E.fromNode(t,e):null}catch(t){return M("warn","Failed to parse layout graphicFrame element",t),null}}(t,e);i&&n.push(i)}}),n):n}(i,e),u=function(t){const e=[],n=f(t,"cSld",r.p);if(!n)return e;const i=f(n,"spTree",r.p);return i?(Array.from(i.children).forEach(t=>{if(1!==t.nodeType)return;if("sp"===(t.localName||t.tagName.split(":").pop())){const n=function(t){const e=f(t,"nvSpPr",r.p);if(!e)return null;const n=f(e,"cNvPr",r.p),i=n?.getAttribute("id")||"",s=n?.getAttribute("name")||"",o=f(e,"nvPr",r.p);if(!o)return null;const a=f(o,"ph",r.p);if(!a)return null;const l=a.getAttribute("type"),c={title:"title",ctrTitle:"title",body:"body",dt:"dateTime",sldNum:"slideNumber",ftr:"footer"}[l||""]||"other",d=a.getAttribute("idx"),p=f(t,"spPr",r.p),h=f(p,"xfrm",r.a);let u={x:0,y:0,width:0,height:0};if(h){const t=f(h,"off",r.a),e=f(h,"ext",r.a);t&&(u.x=parseInt(t.getAttribute("x")||"0"),u.y=parseInt(t.getAttribute("y")||"0")),e&&(u.width=parseInt(e.getAttribute("cx")||"0"),u.height=parseInt(e.getAttribute("cy")||"0"))}const g=f(t,"txBody",r.p);let m,y;if(g){const t=f(g,"bodyPr",r.a);if(t){const e=t.getAttribute("algn"),r=t.getAttribute("anchor");"l"===e?m="left":"ctr"===e?m="center":"r"===e&&(m="right"),"t"===r?y="top":"ctr"===r?y="middle":"b"===r&&(y="bottom")}}return{id:i,type:c,name:s,rect:u,hAlign:m,vAlign:y,idx:d?parseInt(d):void 0,rawNode:t}}(t);n&&e.push(n)}}),e):e}(i);let g;for(const t of Object.values(e))if(t.type.includes("slideMaster")){const e=t.target.match(/slideMaster(\d+)\.xml/);e&&(g=`slideMaster${e[1]}`,M("info",`Layout references master file: ${g}`))}return{id:P("layout"),name:o,background:a,elements:h,placeholders:u,relsMap:e,colorMap:d,textStyles:p,masterRef:g}}catch(t){return M("error","Failed to parse slide layout",t),null}}async function ft(t,e,n){try{const i=new DOMParser,s=i.parseFromString(n,"application/xml").documentElement,o=mt(s),a=bt(s),l=function(t){const e=[],n=f(t,"cSld",r.p);if(!n)return e;const i=f(n,"spTree",r.p);if(!i)return e;const s=Array.from(i.children).filter(t=>"p:sp"===t.tagName||t.tagName.includes(":sp"));for(const t of s){const n=f(t,"nvSpPr",r.p);if(!n)continue;const i=f(n,"nvPr",r.p);if(!i)continue;const s=f(i,"ph",r.p);if(!s)continue;const o=f(n,"cNvPr",r.p),a=g(o,"id",`placeholder_${Date.now()}`),l=g(o,"name",""),c=s.getAttribute("type")||"other",p=f(t,"spPr",r.p),h=p?f(p,"xfrm",r.a):null;let u={x:0,y:0,width:0,height:0};if(h){const t=f(h,"off",r.a),e=f(h,"ext",r.a);t&&(u.x=d(t.getAttribute("x")||"0"),u.y=d(t.getAttribute("y")||"0")),e&&(u.width=d(e.getAttribute("cx")||"0"),u.height=d(e.getAttribute("cy")||"0"))}e.push({id:a,type:c,name:l,rect:u})}return e}(s),c=e.match(/notesMaster(\d+)\.xml/)?.[1]||"1",p=await async function(t,e){try{const r=`ppt/notesMasters/_rels/${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?xt(n):(M("warn",`Notes master rels not found: ${r}`),{})}catch(t){return M("warn",`Failed to parse notes master rels for ${e}`,t),{}}}(t,`notesMaster${c}`);return M("info",`Parsed notes master: ${c}`),{id:`notesMaster_${c}`,elements:a,background:o,placeholders:l,relsMap:p}}catch(t){throw M("error",`Failed to parse notes master: ${e}`,t),t}}async function gt(t,e,n){try{const i=new DOMParser,s=i.parseFromString(n,"application/xml").documentElement,o=mt(s),a=function(t){const e=f(t,"cSld",r.p);if(!e)return"";const n=f(e,"spTree",r.p);if(!n)return"";const i=Array.from(n.children).filter(t=>"p:sp"===t.tagName||t.tagName.includes(":sp"));for(const t of i){const e=f(t,"nvSpPr",r.p);if(!e)continue;const n=f(e,"nvPr",r.p);if(!n)continue;const i=f(n,"ph",r.p);if("body"===i?.getAttribute("type")){const e=f(t,"txBody",r.p);if(!e)continue;const n=yt(e);if(n&&n.trim())return n.trim()}}return""}(s),l=bt(s),c=e.match(/notesSlide(\d+)\.xml/)?.[1]||"1",d=await async function(t,e){try{const r=`ppt/notesSlides/_rels/${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?xt(n):(M("warn",`Notes slide rels not found: ${r}`),{})}catch(t){return M("warn",`Failed to parse notes slide rels for ${e}`,t),{}}}(t,`notesSlide${c}`),p=d.rId1?.target||"";return M("info",`Parsed notes slide: ${c}`),{id:`notesSlide_${c}`,slideId:`slide${c}`,text:a,elements:l,background:o,relsMap:d,masterRef:p}}catch(t){throw M("error",`Failed to parse notes slide: ${e}`,t),t}}function mt(t){const e=f(t,"bg",r.p);if(!e)return{type:"color",value:"#ffffff"};const n=f(e,"bgPr",r.p);if(n){const t=f(n,"solidFill",r.a);if(t){const e=f(t,"srgbClr",r.a);if(e?.getAttribute("val"))return{type:"color",value:`#${e.getAttribute("val")}`}}}return{type:"color",value:"#ffffff"}}function yt(t){const e=Array.from(t.children).filter(t=>"a:p"===t.tagName||t.tagName.includes(":p")),r=[];for(const t of e){const e=Array.from(t.children).filter(t=>"a:r"===t.tagName||t.tagName.includes(":r"));for(const t of e){const e=f(t,"t","http://schemas.openxmlformats.org/drawingml/2006/main");e?.textContent&&r.push(e.textContent)}}return r.join("\n")}function bt(t){const e=[],n=f(t,"cSld",r.p);if(!n)return e;const i=f(n,"spTree",r.p);return i?(Array.from(i.children).forEach((t,n)=>{if(1!==t.nodeType)return;const i=t.tagName;i.includes("sp")?e.push(function(t){const e=f(t,"cNvPr",r.p),n=g(e,"id",`shape_${Date.now()}`),i=g(e,"name",""),s=f(t,"spPr",r.p),o=s?f(s,"xfrm",r.a):null;let a={x:0,y:0,width:0,height:0};if(o){const t=f(o,"off",r.a),e=f(o,"ext",r.a);t&&(a.x=d(t.getAttribute("x")||"0"),a.y=d(t.getAttribute("y")||"0")),e&&(a.width=d(e.getAttribute("cx")||"0"),a.height=d(e.getAttribute("cy")||"0"))}return{id:n,name:i,type:"shape",rect:a,content:{}}}(t)):i.includes("pic")&&e.push(function(t){const e=f(t,"cNvPr",r.p),n=g(e,"id",`image_${Date.now()}`),i=g(e,"name",""),s=f(t,"spPr",r.p),o=s?f(s,"xfrm",r.a):null;let a={x:0,y:0,width:0,height:0};if(o){const t=f(o,"off",r.a),e=f(o,"ext",r.a);t&&(a.x=d(t.getAttribute("x")||"0"),a.y=d(t.getAttribute("y")||"0")),e&&(a.width=d(e.getAttribute("cx")||"0"),a.height=d(e.getAttribute("cy")||"0"))}return{id:n,name:i,type:"image",rect:a,content:{}}}(t))}),e):e}function xt(t){const e={};try{const r=new DOMParser,n=r.parseFromString(t,"application/xml").documentElement,i=Array.from(n.children).filter(t=>"Relationship"===t.tagName||t.tagName.includes(":Relationship"));for(const t of i){const r=t.getAttribute("Id")||"",n=t.getAttribute("Type")||"",i=t.getAttribute("Target")||"";r&&(e[r.replace("rId","")]={id:r,type:n,target:i})}}catch(t){M("warn","Failed to parse relationships XML",t)}return e}function $t(t,e,n){try{const i=new DOMParser,s=i.parseFromString(t,"application/xml").documentElement,o=function(t){const e=f(t,"plotArea",r.c);if(!e)return"unknown";const n=Array.from(e.children);for(const t of n){const e=t.tagName;if(e.includes("lineChart"))return"lineChart";if(e.includes("barChart"))return"barChart";if(e.includes("pieChart"))return e.includes("3D")?"pie3DChart":"pieChart";if(e.includes("areaChart"))return"areaChart";if(e.includes("scatterChart"))return"scatterChart"}return"unknown"}(s),a=function(t){const e=f(t,"title",r.c);if(!e)return;const n=f(e,"tx",r.c);if(!n)return;f(n,"strRef",r.c);const i=f(n,"strCache",r.c);if(i){const t=f(i,"pt",r.c);if(t?.textContent)return t.textContent.trim()}const s=f(n,"rich",r.c);if(s){const t=f(s,"p",r.a);if(t){const e=kt(t);if(e)return e}}return}(s),l=function(t){const e=[],n=f(t,"plotArea",r.c);if(!n)return e;const i=wt(n);if(!i)return e;const s=Array.from(i.children).filter(t=>t.tagName.includes(":ser")||"ser"===t.localName);for(const t of s){const r=parseInt(g(t,"idx","0"),10),n=parseInt(g(t,"order","0"),10),i=vt(t),s=At(t);e.push({name:i,idx:r,order:n,points:s})}return e}(s),c=function(t){const e=[],n=f(t,"plotArea",r.c);if(!n)return e;const i=f(n,"catAx",r.c);if(!i)return e;const s=f(i,"tx",r.c);if(!s)return e;f(s,"strRef",r.c);const o=f(s,"strCache",r.c);if(o){const t=Array.from(o.children).filter(t=>t.tagName.includes(":pt")||"pt"===t.localName);for(const n of t){const t=f(n,"v",r.c);t?.textContent&&e.push(t.textContent.trim())}}return e}(s),d=St(s,"x"),p=St(s,"y"),h=function(t){const e=f(t,"legend",r.c);if(!e)return!1;return"1"!==e.getAttribute("deleted")}(s),u=function(t){const e=f(t,"plotArea",r.c);if(!e)return!1;const n=wt(e);if(!n)return!1;const i=f(n,"dLbls",r.c);if(!i)return!1;return"1"!==i.getAttribute("deleted")}(s);return M("info",`Parsed chart ${e}: type=${o}, series=${l.length}`),{id:`chart_${e}`,chartType:o,title:a,series:l,categories:c,xTitle:d,yTitle:p,showLegend:h,showDataLabels:u,relsMap:n}}catch(t){return M("error",`Failed to parse chart ${e}`,t),{id:`chart_${e}`,chartType:"unknown",relsMap:n}}}function wt(t){const e=Array.from(t.children);for(const t of e){const e=t.tagName;if(e.includes("lineChart")||e.includes("barChart")||e.includes("pieChart")||e.includes("areaChart")||e.includes("scatterChart"))return t}return null}function vt(t){const e=f(t,"tx",r.c);if(!e)return;f(e,"strRef",r.c);const n=f(e,"strCache",r.c);if(n){const t=f(n,"pt",r.c);if(t?.textContent)return t.textContent.trim()}const i=f(e,"v",r.c);return i?.textContent?i.textContent.trim():void 0}function At(t){const e=[];f(t,"val",r.c);const n=f(t,"numCache",r.c);if(n){const t=Array.from(n.children).filter(t=>t.tagName.includes(":pt")||"pt"===t.localName);for(const n of t){const t=parseInt(g(n,"idx","0"),10),i=f(n,"v",r.c),s=i?.textContent?parseFloat(i.textContent):void 0;e.push({idx:t,value:s})}}return e}function St(t,e){const n=f(t,"plotArea",r.c);if(!n)return;const i=f(n,"x"===e?"catAx":"valAx",r.c);if(!i)return;const s=f(i,"title",r.c);if(!s)return;const o=f(s,"tx",r.c);if(!o)return;const a=f(o,"rich",r.c);if(a){const t=f(a,"p",r.a);if(t){const e=kt(t);if(e)return e}}}function kt(t){const e=Array.from(t.children).filter(t=>t.tagName.includes(":r")||"r"===t.localName),n=[];for(const t of e){const e=f(t,"t",r.a);e?.textContent&&n.push(e.textContent)}return n.length>0?n.join(""):void 0}function Tt(t,e,n){try{const i=new DOMParser,s=i.parseFromString(t,"application/xml").documentElement,o=s.getAttribute("type")||"unknown",a=s.getAttribute("layout")||"",l=function(t){const e=[],n=f(t,"spTree",r.d);if(!n)return e;const i=Array.from(n.children).filter(t=>t.tagName.includes(":sp")||"sp"===t.localName);for(const t of i){const n=g(t,"id",`shape_${Date.now()}`),i=t.getAttribute("type")||"shape",s=f(t,"xfrm",r.a);let o,a;if(s){const t=f(s,"off",r.a),e=f(s,"ext",r.a);if(t){const e=parseInt(t.getAttribute("x")||"0"),r=parseInt(t.getAttribute("y")||"0");o={x:d(e),y:d(r)}}if(e){const t=parseInt(e.getAttribute("cx")||"0"),r=parseInt(e.getAttribute("cy")||"0");a={width:d(t),height:d(r)}}}const l=It(t);e.push({id:n,type:i,position:o,size:a,text:l})}return e}(s);return M("info",`Parsed diagram ${e}: type=${o}, shapes=${l.length}`),{id:`diagram_${e}`,diagramType:o,layout:a,shapes:l,relsMap:n}}catch(t){return M("error",`Failed to parse diagram ${e}`,t),{id:`diagram_${e}`,relsMap:n}}}function It(t){const e=f(t,"txBody",r.d);if(!e)return;const n=f(e,"p",r.a);if(!n)return;return kt(n)}async function Ct(t,e){try{const r=`ppt/charts/_rels/${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?Mt(n):(M("warn",`Chart rels not found: ${r}`),{})}catch(t){return M("warn",`Failed to parse chart rels for ${e}`,t),{}}}async function Pt(t,e){try{const r=`ppt/diagrams/_rels/data${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?Mt(n):(M("warn",`Diagram rels not found: ${r}`),{})}catch(t){return M("warn",`Failed to parse diagram rels for ${e}`,t),{}}}function Mt(t){const e={};try{const r=new DOMParser,n=r.parseFromString(t,"application/xml").documentElement,i=Array.from(n.children).filter(t=>"Relationship"===t.tagName||t.tagName.includes(":Relationship"));for(const t of i){const r=t.getAttribute("Id")||"",n=t.getAttribute("Type")||"",i=t.getAttribute("Target")||"";r&&(e[r.replace("rId","")]={id:r,type:n,target:i})}}catch(t){M("warn","Failed to parse relationships XML",t)}return e}async function Nt(t,e){try{const n=`ppt/slides/${e}.xml`,i=await(t.file(n)?.async("string"));if(!i)return M("warn",`Slide not found: ${n}`),Ft(e);const s=await async function(t,e){try{const r=`ppt/slides/_rels/${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?function(t){const e={};try{const r=new DOMParser,n=r.parseFromString(t,"application/xml").documentElement,i=Array.from(n.children).filter(t=>"Relationship"===t.tagName||t.tagName.includes(":Relationship"));for(const t of i){const r=t.getAttribute("Id")||"",n=t.getAttribute("Type")||"",i=t.getAttribute("Target")||"";r&&(e[r.replace("rId","")]={id:r,type:n,target:i})}}catch(t){M("warn","Failed to parse relationships XML",t)}return e}(n):(M("warn",`Slide rels not found: ${r}`),{})}catch(t){return M("warn",`Failed to parse slide rels for ${e}`,t),{}}}(t,e),o=function(t){const e=[];try{const n=(new DOMParser).parseFromString(t,"application/xml"),i=f(n.documentElement,"extLst",r.p);if(!i)return e;const s=Array.from(i.children).filter(t=>"p:ext"===t.tagName||t.tagName.includes(":ext"));for(const t of s){const r=t.getAttribute("uri")||"";if(r.includes("tags")||r.includes("ppt/tags")){const r=Array.from(t.children).filter(t=>"p:tag"===t.tagName||t.tagName.includes(":tag"));for(const t of r){const r=g(t,"name",""),n=g(t,"val","");r&&e.push({name:r,value:n})}}}}catch(t){M("warn","Failed to parse tags",t)}return e}(i),a=function(t){const e=[];try{const n=(new DOMParser).parseFromString(t,"application/xml"),i=f(n.documentElement,"extLst",r.p);if(!i)return e;const s=Array.from(i.children).filter(t=>"p:ext"===t.tagName||t.tagName.includes(":ext"));for(const t of s){const r=t.getAttribute("uri")||"",n=jt(Array.from(t.children));e.push({uri:r,data:n})}}catch(t){M("warn","Failed to parse extensions",t)}return e}(i),l=function(t){const e=[];try{const n=(new DOMParser).parseFromString(t,"application/xml"),i=f(n.documentElement,"extLst",r.p);if(!i)return e;const s=Array.from(i.children).filter(t=>"p:ext"===t.tagName||t.tagName.includes(":ext"));for(const t of s){const r=t.getAttribute("uri")||"";if(r.includes("customProps")||r.includes("ppt/customProperties")){const r=Array.from(t.children).filter(t=>"p:custData"===t.tagName||t.tagName.includes(":custData"));for(const t of r){const r=g(t,"name",""),n=t.textContent||"",i=Lt(n);r&&e.push({name:r,value:n,type:i})}}}}catch(t){M("warn","Failed to parse custom properties",t)}return e}(i);return{id:`tags_${e}`,slideId:e,tags:o,extensions:a,customProperties:l,relsMap:s}}catch(t){return M("error",`Failed to parse tags for slide ${e}`,t),Ft(e)}}function Ft(t){return{id:`tags_${t}`,slideId:t,tags:[],extensions:[],customProperties:[],relsMap:{}}}function jt(t){const e={};for(const r of t){if(1!==r.nodeType)continue;const t=r.localName||r.tagName.split(":").pop();if(r.children.length>0)e[t]=jt(Array.from(r.children));else if(r.textContent){const n=r.textContent.trim();e[t]=n}else e[t]=null}return e}function Lt(t){if(!t)return"string";if("true"===t.toLowerCase()||"false"===t.toLowerCase())return"boolean";if(!isNaN(parseFloat(t))&&isFinite(Number(t)))return"number";return/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2})?$/.test(t)?"date":"string"}const Rt={generateId:P,parseXmlText:t=>e(t||"").trim(),px2emu:p,emu2px:d,parseXmlToTree:t=>{const e=(new DOMParser).parseFromString(t,"application/xml").documentElement,r=t=>{const e=[];return Array.from(t.childNodes).forEach(t=>{1===t.nodeType&&e.push(r(t))}),{tag:t.tagName,attrs:Rt.parseXmlAttrs(t.attributes),children:e,text:Rt.parseXmlText(t.textContent||"")}};return r(e)},parseXmlAttrs:t=>{const e={};return Array.from(t).forEach(t=>{e[t.nodeName]=t.nodeValue||""}),e},parseXmlRect:t=>({x:d(t.x||"0"),y:d(t.y||"0"),width:d(t.cx||"0"),height:d(t.cy||"0")}),parseXmlStyle:t=>{const e={};t.fontSize?e.fontSize=parseInt(t.fontSize)/100:e.fontSize=14,t.fill?e.color=t.fill:e.color="#333333","1"===t.bold||"true"===t.bold?e.fontWeight="bold":e.fontWeight="normal";const r=t.align;return e.textAlign="left"===r||"center"===r||"right"===r||"justify"===r?r:"left",t.bgFill?e.backgroundColor=t.bgFill:e.backgroundColor="transparent",t.border?e.borderColor=t.border:e.borderColor="#000000",t.borderWidth?e.borderWidth=parseInt(t.borderWidth):e.borderWidth=1,e},hexToRgb:t=>{const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}},rgbToHex:(t,e,r)=>"#"+((1<<24)+(t<<16)+(e<<8)+r).toString(16).slice(1),parseColor:t=>(t.startsWith("#"),t)};async function Et(e,r){const n={parseImages:!0,keepRawXml:!1,verbose:!1,returnFormat:"enhanced",...r},i=await t.loadAsync(e);return"simple"===n.returnFormat?async function(t){const e=await async function(t){const e={width:1280,height:720,title:"未命名PPT"};try{const r=await(t.file("ppt/slideLayouts/slideLayout1.xml")?.async("string"));if(r){const t=Rt.parseXmlToTree(r).children.find(t=>"cSld"===t.tag),n=t?.children.find(t=>"sldSz"===t.tag);if(n){const t=Rt.parseXmlRect(n.attrs);e.width=t.width,e.height=t.height}}const n=await(t.file("docProps/core.xml")?.async("string"));if(n){const t=Rt.parseXmlToTree(n);e.title=t.children.find(t=>t.tag.includes("title"))?.text||"未命名PPT"}}catch(t){console.warn("PPT配置解析失败，使用默认配置",t)}return e}(t),r=await async function(t){const e=[],r=Object.keys(t.files).filter(t=>t.startsWith("ppt/slides/slide")&&t.endsWith(".xml"));for(const n of r){const r=await t.file(n).async("string");e.push({xml:r,slideId:Rt.generateId("slide"),rId:n.replace("ppt/slides/slide","").replace(".xml",""),layout:"normal"})}return e}(t),n=await Promise.all(r.map((t,e)=>async function(t,e,r){const{xml:n,layout:i}=e,s=Rt.parseXmlToTree(n),o=s.children.find(t=>"p:cSld"===t.tag||"cSld"===t.tag),a=o?.children.find(t=>"p:spTree"===t.tag||"spTree"===t.tag),l=[];a&&a.children.forEach(t=>{const e=function(t){const{tag:e}=t;if("p:sp"===e||"sp"===e)return function(t){const e=Rt.generateId("shape"),r=t.children,n=r.find(t=>"p:spPr"===t.tag||"spPr"===t.tag),i=r.find(t=>"p:txBody"===t.tag||"txBody"===t.tag);let s={x:0,y:0,width:0,height:0};if(n){const t=n.children.find(t=>"a:xfrm"===t.tag);if(t){const e=t.children.find(t=>"a:off"===t.tag),r=t.children.find(t=>"a:ext"===t.tag);e&&r&&(s=Rt.parseXmlRect({x:e.attrs.x||"0",y:e.attrs.y||"0",cx:r.attrs.cx||"0",cy:r.attrs.cy||"0"}))}}let o="";if(i){const t=i.children.filter(t=>"a:p"===t.tag||"p"===t.tag),e=[];t.forEach(t=>{const r=t.children.filter(t=>"a:r"===t.tag||"r"===t.tag);r.forEach(t=>{const r=t.children.find(t=>"a:t"===t.tag||"t"===t.tag);if(r&&r.text){const n=t.children.find(t=>"a:rPr"===t.tag||"rPr"===t.tag);e.push({text:r.text,fontSize:n?.attrs.sz?parseInt(n.attrs.sz)/100:14,fontColor:n?.attrs.fill||"#333333",bold:"1"===n?.attrs.b,italic:"1"===n?.attrs.i})}})}),o={paragraphs:[{runs:e}]}}return{id:e,type:"text",rect:s,style:{fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1},content:o}}(t);if("p:pic"===e||"pic"===e)return function(t){const e=Rt.generateId("image"),r=t.children,n=r.find(t=>"p:spPr"===t.tag||"spPr"===t.tag),i=r.find(t=>"p:blipFill"===t.tag||"blipFill"===t.tag);let s={x:0,y:0,width:0,height:0};if(n){const t=n.children.find(t=>"a:xfrm"===t.tag);if(t){const e=t.children.find(t=>"a:off"===t.tag),r=t.children.find(t=>"a:ext"===t.tag);e&&r&&(s=Rt.parseXmlRect({x:e.attrs.x||"0",y:e.attrs.y||"0",cx:r.attrs.cx||"0",cy:r.attrs.cy||"0"}))}}let o="";if(i){const t=i.children.find(t=>"a:blip"===t.tag||"blip"===t.tag);o=t?.attrs["r:embed"]||t?.attrs.embed||""}return{id:e,type:"image",rect:s,style:{fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1},content:{url:"",imgId:o},props:{imgId:o,alt:"图片"}}}(t);if("p:graphicFrame"===e||"graphicFrame"===e)return function(t){const e=Rt.generateId("graphic"),r=t.children,n=r.find(t=>"p:xfrm"===t.tag||"xfrm"===t.tag);let i={x:0,y:0,width:0,height:0};if(n){const t=n.children.find(t=>"a:off"===t.tag),e=n.children.find(t=>"a:ext"===t.tag);t&&e&&(i=Rt.parseXmlRect({x:t.attrs.x||"0",y:t.attrs.y||"0",cx:e.attrs.cx||"0",cy:e.attrs.cy||"0"}))}const s=r.find(t=>"a:graphic"===t.tag||"graphic"===t.tag),o=s?.children.find(t=>"a:graphicData"===t.tag||"graphicData"===t.tag);if(!o)return null;const a=o.attrs.uri||"";if(a.includes("table"))return{id:e,type:"table",rect:i,style:{fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#cccccc",borderWidth:1},content:{rows:[]},props:{rowCount:0,colCount:0}};if(a.includes("chart"))return{id:e,type:"chart",rect:i,style:{fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1},content:{type:"unknown",data:[]},props:{legend:!0,grid:!0}};return null}(t);return null}(t);e&&l.push(e)});const c=function(t){const e=t.children.find(t=>"bg"===t.tag);if(!e)return"#ffffff";const r=e.children.find(t=>"fill"===t.tag);return r?.attrs.color||"#ffffff"}(s),d=function(t,e){const r=t.children.find(t=>"p:cSld"===t.tag||"cSld"===t.tag),n=r?.children.find(t=>"p:spTree"===t.tag||"spTree"===t.tag);if(!n)return`幻灯片${e}`;for(const t of n.children)if("p:sp"===t.tag||"sp"===t.tag){const e=t.children.find(t=>"p:nvSpPr"===t.tag||"nvSpPr"===t.tag),r=e?.children.find(t=>"p:nvPr"===t.tag||"nvPr"===t.tag),n=r?.children.find(t=>"p:ph"===t.tag||"ph"===t.tag);if("title"===n?.attrs.type){const e=t.children.find(t=>"p:txBody"===t.tag||"txBody"===t.tag),r=e?.children.find(t=>"a:p"===t.tag||"p"===t.tag),n=r?.children.find(t=>"a:r"===t.tag||"r"===t.tag),i=n?.children.find(t=>"a:t"===t.tag||"t"===t.tag);if(i?.text)return i.text}}return`幻灯片${e}`}(s,r+1);return{id:e.slideId,title:d,bgColor:c,elements:l,props:{width:1280,height:720,slideLayout:i}}}(0,t,e)));return{id:Rt.generateId("ppt-doc"),title:e.title||"未命名PPT",slides:n,props:{width:e.width||1280,height:e.height||720,ratio:(e.width||1280)/(e.height||720)}}}(i):async function(t,e){try{M("info","Starting PPTX parsing...");const r=await async function(t){try{const e=await(t.file(`${l}core.xml`)?.async("string"));return e?$(e):(M("warn","core.xml not found"),{})}catch(t){return M("warn","Failed to parse core properties",t),{}}}(t),n=await async function(t){try{const e=await(t.file("ppt/presentation.xml")?.async("string"));if(e){const t=(new DOMParser).parseFromString(e,"application/xml"),r=t.documentElement.namespaceURI||"http://schemas.openxmlformats.org/presentationml/2006/main",n=t.getElementsByTagNameNS(r,"sldSz")[0];if(n){const t=n.getAttribute("cx"),e=n.getAttribute("cy");if(t&&e)return{width:d(t),height:d(e)}}}return{width:1280,height:720}}catch(t){return M("warn","Failed to parse slide size",t),{width:1280,height:720}}}(t),i=await ct(t);M("info",i?"Theme parsed successfully":"Theme not found");const s=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/slideMasters/")&&t.endsWith(".xml")).sort();M("info",`Found ${e.length} master slide files`);const r=[];for(const n of e){const e=n.match(/slideMaster(\d+)\.xml/)?.[1];if(!e)continue;const i=await(t.file(n)?.async("string"));if(!i)continue;const s=n.replace("slideMasters/","slideMasters/_rels/").replace(".xml",".xml.rels");let o={};try{const r=await(t.file(s)?.async("string"));r&&(o=x(r,s),M("info",`Loaded ${Object.keys(o).length} relationships for master ${e}`),Object.entries(o).forEach(([t,e])=>{M("info",`  - ${t}: type=${e.type}, target=${e.target}`)}))}catch(t){M("warn",`Failed to read master rels: ${s}`,t)}const a=pt(i,o,e);r.push(a)}return r}catch(t){return M("error","Failed to parse master slides",t),[]}}(t);M("info",`Parsed ${s.length} master slides`);const a=new Map;s.forEach(t=>{t.masterId&&(a.set(t.masterId,t),M("info",`Master map: ${t.masterId} -> ${t.id}`))});const c=await async function(t){try{const e={},r=Object.keys(t.files).filter(t=>t.startsWith(ht.slideLayouts)&&t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort((t,e)=>parseInt(t.match(/slideLayout(\d+)\.xml/)?.[1]||"0",10)-parseInt(e.match(/slideLayout(\d+)\.xml/)?.[1]||"0",10));M("info",`Found ${r.length} layout files`);for(let n=0;n<r.length;n++){const i=r[n];M("info",`Parsing layout ${n+1}: ${i}`);const s=await(t.file(i)?.async("string"));if(!s){M("warn",`Failed to read layout: ${i}`);continue}const o=i.match(/slideLayout(\d+)\.xml/)?.[1];let a={};if(o){const e=`ppt/slideLayouts/_rels/slideLayout${o}.xml.rels`;try{const r=await(t.file(e)?.async("string"));r&&(a=x(r,e),M("info",`Loaded ${Object.keys(a).length} relationships for layout ${o}`),Object.entries(a).forEach(([t,e])=>{M("info",`  - ${t}: type=${e.type}, target=${e.target}`)}))}catch(t){M("warn",`Failed to read layout rels: ${e}`,t)}}const l=ut(s,a);l&&(e[`slideLayout${o}`]=l)}return e}catch(t){return M("error","Failed to parse slide layouts",t),{}}}(t);M("info",`Parsed ${Object.keys(c).length} slide layouts`),Object.entries(c).forEach(([t,e])=>{if(e.masterRef&&a.has(e.masterRef)){e.masterRefIndex=e.masterRef,M("info",`Layout ${t} references master: ${e.masterRef}`)}});const p=await async function(t,e){try{const r=Object.keys(t.files).filter(t=>t.startsWith(o)).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort((t,e)=>parseInt(t.match(/slide(\d+)\.xml/)?.[1]||"0",10)-parseInt(e.match(/slide(\d+)\.xml/)?.[1]||"0",10));M("info",`Found ${r.length} slide files`);const n=[];for(let i=0;i<r.length;i++){const s=r[i];M("info",`Parsing slide ${i+1}: ${s}`);const o=await(t.file(s)?.async("string"));if(!o){M("warn",`Failed to read slide: ${s}`);continue}const a=s.match(/slide(\d+)\.xml/)?.[1];let l={};if(a){const e=`slide${a}`;l=await rt(t,e),M("info",`Loaded ${Object.keys(l).length} relationships for slide ${e}`)}const c=nt(o,l,i);e.keepRawXml&&(c.rawXml=o),n.push(c)}return n}catch(t){return M("error","Failed to parse slides",t),[]}}(t,e);p.forEach(t=>{const e=function(t){for(const[e,r]of Object.entries(t))if(r.type.includes("slideLayout")){const t=r.target.match(/slideLayout(\d+)\.xml/);if(t)return`slideLayout${t[1]}`}}(t.relsMap||{});if(e&&c[e]){const a=c[e],l=a,d=(r=t.background,n=a.background,o=l.masterRefIndex?s.find(t=>t.masterId===l.masterRefIndex)?.background:void 0,r&&"none"!==r.type?r:n&&"none"!==n.type?n:o||{type:"color",value:"#ffffff"});t.background=d,t.layoutId=e,t.masterRefIndex=l.masterRefIndex;B(t,a,l.masterRefIndex?s.find(t=>t.masterId===l.masterRefIndex):void 0,i);M("info",`Slide relationship chain: slide -> layout (${e}) -> master (${a.masterRef})`)}else e&&M("warn",`Layout ${e} referenced by slide not found in parsed layouts`);var r,n,o});const h=await async function(t){try{const e=await(t.file("_rels/.rels")?.async("string"));return e?x(e,"_rels/.rels"):{}}catch(t){return M("warn","Failed to parse global relationships",t),{}}}(t);M("info",`Parsed ${p.length} slides successfully`);const u=n.width/n.height,f=function(t){const e=.01;return Math.abs(t-1.33333)<e?"4:3":Math.abs(t-1.77778)<e?"16:9":Math.abs(t-1.6)<e?"16:10":"custom"}(u);i&&i.colors&&(s.forEach(t=>{if(t.background&&"object"==typeof t.background){const e=t.background;if(e.schemeRef){const r=dt(e.schemeRef,i.colors,t.colorMap||{});e.value=r,delete e.schemeRef}}}),Object.values(c).forEach(t=>{if(t.background&&"object"==typeof t.background){const e=t.background;if(e.schemeRef){const r=dt(e.schemeRef,i.colors,t.colorMap||{});e.value=r,delete e.schemeRef}}}),p.forEach((t,e)=>{if(t.background&&"object"==typeof t.background){const e=t.background;if(e.schemeRef){const t=dt(e.schemeRef,i.colors,{});e.value=t,delete e.schemeRef}}}));const g=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/notesMasters/")).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort((t,e)=>parseInt(t.match(/notesMaster(\d+)\.xml/)?.[1]||"0",10)-parseInt(e.match(/notesMaster(\d+)\.xml/)?.[1]||"0",10));M("info",`Found ${e.length} notes master files`);const r=[];for(const n of e){const e=await(t.file(n)?.async("string"));if(!e){M("warn",`Failed to read notes master: ${n}`);continue}const i=await ft(t,n,e);r.push(i)}return r}catch(t){return M("error","Failed to parse notes masters",t),[]}}(t),m=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/notesSlides/")).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort((t,e)=>parseInt(t.match(/notesSlide(\d+)\.xml/)?.[1]||"0",10)-parseInt(e.match(/notesSlide(\d+)\.xml/)?.[1]||"0",10));M("info",`Found ${e.length} notes slide files`);const r=[];for(const n of e){const e=await(t.file(n)?.async("string"));if(!e){M("warn",`Failed to read notes slide: ${n}`);continue}const i=await gt(t,n,e);r.push(i)}return r}catch(t){return M("error","Failed to parse notes slides",t),[]}}(t);!function(t,e){const r=new Map;e.forEach(t=>{const e=t.id.replace("notesMaster_","");r.set(e,t)}),t.forEach(t=>{if(t.masterRef){const e=t.masterRef.split("/").pop()?.replace(".xml","")||"";r.has(e)&&(t.master=r.get(e))}})}(m,g);const y=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/charts/")).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort();M("info",`Found ${e.length} chart files`);const r=[];for(const n of e){const e=await(t.file(n)?.async("string"));if(!e){M("warn",`Failed to read chart: ${n}`);continue}const i=n.match(/chart(\d+)\.xml/)?.[1]||"1",s=$t(e,i,await Ct(t,`chart${i}`));r.push(s)}return r}catch(t){return M("error","Failed to parse charts",t),[]}}(t),b=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/diagrams/")).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort();M("info",`Found ${e.length} diagram files`);const r=[];for(const n of e){const e=await(t.file(n)?.async("string"));if(!e){M("warn",`Failed to read diagram: ${n}`);continue}const i=n.match(/data(\d+)\.xml/)?.[1]||"1",s=Tt(e,i,await Pt(t,i));r.push(s)}return r}catch(t){return M("error","Failed to parse diagrams",t),[]}}(t),w=await async function(t,e){try{const r=[];for(let n=1;n<=e;n++){const e=`slide${n}`,i=await Nt(t,e);r.push(i)}return M("info",`Parsed tags for ${e} slides`),r}catch(t){return M("error","Failed to parse slide tags",t),[]}}(t,p.length),v={id:P("ppt-doc"),title:r.title||"未命名PPT",author:r.author,subject:r.subject,keywords:r.keywords,description:r.description,created:r.created,modified:r.modified,slides:p,props:{width:n.width,height:n.height,ratio:u,pageSize:f},globalRelsMap:h,theme:i||void 0,masterSlides:s,slideLayouts:c,notesMasters:g.length>0?g:void 0,notesSlides:m.length>0?m:void 0,charts:y.length>0?y:void 0,diagrams:b.length>0?b:void 0,tags:w.length>0?w:void 0,mediaMap:void 0};return e.parseImages&&await async function(t,e){try{const r=new Map;for(const n of e.slides){if(n.background&&"string"!=typeof n.background){const e=n.background;if("image"===e.type&&e.relId){const i=await lt(t,e.relId,n.relsMap,r);i&&(e.value=i)}}let e=0;for(const i of n.elements)if("image"===i.type){e++;const s=i,o=s.relId;if(o){M("info",`Found image element in slide: relId=${o}, src=${s.src}`);const e=await lt(t,o,n.relsMap,r);e?(s.src=e,M("info",`Updated image src to base64 URL, length=${e.length}`)):M("warn",`Failed to resolve image relId=${o}`)}else M("warn","Image element missing relId")}e>0&&M("info",`Found ${e} image elements in slide ${n.id}`)}if(e.slideLayouts){M("info",`Processing ${Object.keys(e.slideLayouts).length} slide layouts`);for(const n in e.slideLayouts){const i=e.slideLayouts[n];M("info",`Processing layout: ${n}`),await at(t,i,i.relsMap,r)}}if(e.masterSlides){M("info",`Processing ${e.masterSlides.length} master slides`);for(const n of e.masterSlides)n.relsMap?(M("info",`Processing master: ${n.id}`),await at(t,n,n.relsMap,r)):M("warn",`Master ${n.id} missing relsMap`)}e.mediaMap=r,M("info",`Parsed ${r.size} images`)}catch(t){M("warn","Failed to parse images",t)}}(t,v),v}catch(t){throw M("error","PPTX parsing failed",t),new Error(`PPTX解析失败: ${t instanceof Error?t.message:String(t)}`)}}(i,n)}async function Dt(e){const r=new t;return function(t){t.folder("ppt")?.folder("slides"),t.folder("ppt")?.folder("slideLayouts"),t.folder("ppt")?.folder("_rels"),t.folder("docProps"),t.folder("_rels")}(r),await async function(t,e){const{width:r,height:n}=e.props,i=Rt.px2emu(r),s=Rt.px2emu(n),o=`<sldLayout xmlns="http://schemas.openxmlformats.org/presentationml/2006/main"><cSld><sldSz cx="${i}" cy="${s}" type="screen"/></cSld></sldLayout>`;t.file("ppt/slideLayouts/slideLayout1.xml",o);const a=`<cp:coreProperties xmlns:cp="http://schemas.openxmlformats.org/package/2006/metadata/core-properties"><dc:title>${e.title}</dc:title></cp:coreProperties>`;t.file("docProps/core.xml",a)}(r,e),await async function(t,e){e.forEach(async(e,r)=>{const n=function(t){const{elements:e,bgColor:r,props:n}=t,i=Rt.px2emu(n.width),s=Rt.px2emu(n.height),o=e.map(t=>function(t){const{type:e,rect:r,style:n,content:i}=t,{x:s,y:o,width:a,height:l}=r,c=Rt.px2emu(s),d=Rt.px2emu(o),p=Rt.px2emu(a),h=Rt.px2emu(l);switch(e){case"text":return`<p:txBody><a:bodyPr/><a:lstStyle/><a:p><a:r><a:rPr sz="${100*(n.fontSize||14)}" b="${"bold"===n.fontWeight?1:0}"/><a:t>${i}</a:t></a:r></a:p></p:txBody><p:spPr><a:xfrm><a:off x="${c}" y="${d}"/><a:ext cx="${p}" cy="${h}"/></a:xfrm></p:spPr>`;case"shape":return`<p:sp><p:spPr><a:xfrm><a:off x="${c}" y="${d}"/><a:ext cx="${p}" cy="${h}"/></a:xfrm><a:solidFill><a:srgbClr val="${n.backgroundColor?.replace("#","")||"ffffff"}"/></a:solidFill><a:ln><a:solidFill><a:srgbClr val="${n.borderColor?.replace("#","")||"000000"}"/></a:solidFill></a:ln></p:spPr></p:sp>`;case"image":return`<p:pic><p:blipFill><a:blip r:embed="rId1"/></p:blipFill><p:spPr><a:xfrm><a:off x="${c}" y="${d}"/><a:ext cx="${p}" cy="${h}"/></a:xfrm></p:spPr></p:pic>`;case"table":return`<p:tbl><p:tblPr><a:tblW w="${p}" type="dxa"/></p:tblPr>${i.map(t=>`<a:tr><a:tc><a:txBody><a:p><a:r><a:t>${t.join("")}</a:t></a:r></a:p></a:txBody></a:tc></a:tr>`).join("")}</p:tbl>`;default:return""}}(t)).join("\n");return`<p:sld xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main"><p:cSld><p:spTree><p:grpSp><p:spPr><a:xfrm><a:off x="0" y="0"/><a:ext cx="${i}" cy="${s}"/></a:xfrm></p:spPr>${o}</p:grpSp></p:spTree></p:cSld><p:bg><p:bgPr><a:solidFill><a:srgbClr val="${r.replace("#","")}"/></a:solidFill></p:bgPr></p:bg></p:sld>`.replace(/\s+/g," ").trim()}(e);t.file(`ppt/slides/slide${r+1}.xml`,n)})}(r,e.slides),await r.generateAsync({type:"blob",compression:"DEFLATE"})}const zt=(t,e)=>{const{createDocument:r}=require("./elements"),n=r({slides:[t],props:{width:960,height:540}});return n.getSlide(0)?.toHTML()||""},Ht=(t,e)=>{const{createDocument:r}=require("./elements");return r(t).slides.map(t=>t.toHTML())},Ot=(t,e)=>{const{createDocument:r}=require("./elements");return r(t).toHTML({...e,withNavigation:!1})},Wt={utils:Rt,parse:Et,serialize:Dt};export{N as BaseElement,R as ChartElement,E as DiagramElement,Q as DocumentElement,n as EMU_PER_INCH,z as GroupElement,j as ImageElement,U as LayoutElement,q as MasterElement,r as NS,Z as NotesMasterElement,K as NotesSlideElement,L as OleElement,i as PIXELS_PER_INCH,V as PlaceholderElement,Rt as PptParseUtils,X as PptxDocument,F as ShapeElement,_ as SlideElement,D as TableElement,J as TagsElement,tt as createDocument,G as createElementFromData,et as createElementFromNode,Wt as default,d as emu2px,h as getAttrs,$ as parseMetadata,Et as parsePptx,y as parseRels,Ht as ppt2HTML,Ot as ppt2HTMLDocument,p as px2emu,Dt as serializePptx,zt as slide2HTML};
//# sourceMappingURL=ppt-parser.esm.js.map
