import t from"jszip";import{unescape as e}from"html-escaper";const r={p:"http://schemas.openxmlformats.org/presentationml/2006/main",a:"http://schemas.openxmlformats.org/drawingml/2006/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",mc:"http://schemas.openxmlformats.org/markup-compatibility/2006",c:"http://schemas.openxmlformats.org/drawingml/2006/chart",d:"http://schemas.openxmlformats.org/drawingml/2006/diagram"},n=914400,i=96,s=96/n,o="ppt/slides/",a="ppt/slides/_rels/",l="docProps/",c="ppt/slideLayouts/";function d(t){const e="string"==typeof t?parseInt(t||"0",10):t;return Math.round(e*s*100)/100}function p(t){return Math.round(9525*t)}function h(t){const e={};return t?.attributes?(Array.from(t.attributes).forEach(t=>{e[t.name]=t.value}),e):e}function u(t,e,r){return t?Array.from(t.getElementsByTagNameNS(r,e)):[]}function f(t,e,r){return t&&t.getElementsByTagNameNS(r,e)[0]||null}function g(t,e,r=""){return t&&t.getAttribute(e)||r}function m(t,e){if(!t)return!1;const r=t.getAttribute(e);return"1"===r||"true"===r}function y(t){const e=(new DOMParser).parseFromString(t,"application/xml"),r=Array.from(e.documentElement.children),n={};return r.forEach(t=>{const e=t.getAttribute("Id"),r=t.getAttribute("Type"),i=t.getAttribute("Target");e&&(n[e]={id:e,type:r||"",target:i||""})}),n}function b(t,e){if(!e)return e;e.startsWith("/")&&(e=e.substring(1));const r=t.indexOf("_rels/");let n=t;-1!==r&&(n=t.substring(0,r));const i=(n+e).split("/"),s=[];for(const t of i)""!==t&&"."!==t&&(".."===t?s.length>0&&s.pop():s.push(t));return s.join("/")}function x(t,e){const r=y(t);for(const t in r){const n=r[t];n.target=b(e,n.target)}return r}function $(t){const e=(new DOMParser).parseFromString(t,"application/xml"),r="http://purl.org/dc/elements/1.1/",n="http://purl.org/dc/terms/",i=(t,r)=>{const n=e.getElementsByTagNameNS(r,t)[0];return n?.textContent||void 0};return{title:i("title",r),author:i("creator",r),subject:i("subject",r),keywords:i("keywords","http://schemas.openxmlformats.org/package/2006/metadata/core-properties"),created:i("created",n),modified:i("modified",n)}}const w="v-up",v="v-mid",S="v-down",A="h-left",F="h-mid",k="h-right";function T(t,e){const r=function(t){return t&&{left:A,center:F,right:k}[t]||""}(t),n=function(t){return t&&{top:w,middle:v,bottom:S}[t]||""}(e);return r&&n?`${n.replace("v-","")}_${r.replace("h-","")}`:`${n} ${r}`.trim()}function C(t,e,r){return t.find(t=>t.type===e)}function P(t="ppt-node"){return`${t}-${Date.now()}-${Math.floor(1e4*Math.random())}`}function I(t,e,r){{const n=`[pptx-parser ${t.toUpperCase()}]`;void 0!==r?console[t](n,e,r):console[t](n,e)}}class M{constructor(t,e,r,n={},i={},s={}){this.id=t,this.rect=r,this.style={fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1},this.content=n,this.props=i,this.relsMap=s,this.name="",this.hidden=!1}getContainerStyle(){const{x:t,y:e,width:r,height:n}=this.rect,i=["position: absolute",`top: ${e}px`,`left: ${t}px`,`width: ${r}px`,`height: ${n}px`];return void 0!==this.zIndex&&i.push(`z-index: ${this.zIndex}`),this.hidden&&i.push("display: none"),i.join("; ")}getDataAttributes(){const t={};return this.id&&(t["data-id"]=this.id),t["data-type"]=this.type,void 0!==this.idx&&(t["data-idx"]=String(this.idx)),this.name&&(t["data-name"]=this.name),t}formatDataAttributes(){const t=this.getDataAttributes();return Object.entries(t).map(([t,e])=>`${t}="${e}"`).join(" ")}parsePosition(t,e="spPr",n=r.p){const i=f(t,e,n);return i?function(t){const e=f(t,"xfrm",r.a);if(!e)return{x:0,y:0,width:0,height:0};const n=f(e,"off",r.a),i=f(e,"ext",r.a);return{x:n?d(n.getAttribute("x")||"0"):0,y:n?d(n.getAttribute("y")||"0"):0,width:i?d(i.getAttribute("cx")||"0"):0,height:i?d(i.getAttribute("cy")||"0"):0}}(i):{x:0,y:0,width:0,height:0}}parseIdAndName(t,e,n=r.p){const i=f(t,e,n),s=i?f(i,"cNvPr",n):null;return{id:g(s,"id",this.generateId()),name:g(s,"name",""),hidden:m(s,"hidden")}}generateId(){return`el_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getAttributes(t){return h(t)}}class N extends M{constructor(){super(...arguments),this.type="shape"}static fromNode(t,e){try{const n=new N("","shape",{x:0,y:0,width:0,height:0},{},{},e),i=f(t,"nvSpPr",r.p),s=i?f(i,"cNvPr",r.p):null;n.id=g(s,"id",n.generateId()),n.name=g(s,"name",""),n.hidden=m(s,"hidden"),n.idx=s?parseInt(s.getAttribute("idx")||"0"):void 0;const o=i?f(i,"nvPr",r.p):null,a=o?f(o,"ph",r.p):null;n.isPlaceholder=!!a;const l=a?.getAttribute("type");if(l){["title","body","dateTime","slideNumber","footer","other"].includes(l)?n.placeholderType=l:n.placeholderType="other"}const c=f(t,"spPr",r.p);n.parseShapeProperties(c,t);const d=f(t,"txBody",r.p);return d&&n.parseTextBody(d,t,e),n.shapeType=n.detectShapeType(c),n.type=n.text||n.textStyle?"text":"shape",n.rawNode=t,n}catch(t){return console.error("Failed to parse shape element:",t),null}}parseShapeProperties(t,e){if(!t)return;const n=f(t,"xfrm",r.a);if(n){const t=f(n,"off",r.a),e=f(n,"ext",r.a);t&&(this.rect.x=d(t.getAttribute("x")||"0"),this.rect.y=d(t.getAttribute("y")||"0")),e&&(this.rect.width=d(e.getAttribute("cx")||"0"),this.rect.height=d(e.getAttribute("cy")||"0"));const i=n.getAttribute("rot");null!==i&&(this.rotation=parseInt(i)/6e4),this.flipH="1"===n.getAttribute("flipH"),this.flipV="1"===n.getAttribute("flipV")}this.parseFill(t)}parseFill(t){const e=f(t,"solidFill",r.a);if(e){const t=f(e,"srgbClr",r.a);t?.getAttribute("val")&&(this.style.backgroundColor=`#${t.getAttribute("val")}`);const n=f(e,"schemeClr",r.a);n?.getAttribute("val")&&(this.style.backgroundColor=n.getAttribute("val")||"transparent")}const n=f(t,"gradFill",r.a);if(n){const t=this.parseGradientFill(n);t&&(this.style.background=this.generateGradientCSS(t))}}parseGradientFill(t){const e={type:"linear",stops:[]},n=f(t,"lin",r.a),i=f(t,"path",r.a);if(f(t,"tileRect",r.a),n){e.type="linear";const t=n.getAttribute("ang");e.angle=t?parseInt(t)/6e4%360:0}else if(i){e.type="path";const t=i.getAttribute("path");t&&(e.direction=t)}else e.type="radial";const s=f(t,"gsLst",r.a);if(s){const t=Array.from(s.children).filter(t=>"a:gs"===t.tagName||t.tagName.includes(":gs"));for(const r of t){const t=this.parseGradientStopColor(r),n=r.getAttribute("pos");t&&e.stops.push({color:t,position:n?parseInt(n)/1e5:0})}}return 0===e.stops.length&&e.stops.push({color:"#000000",position:0},{color:"#ffffff",position:100}),e}parseGradientStopColor(t){const e=f(t,"solidFill",r.a);if(!e)return null;const n=f(e,"srgbClr",r.a);if(n?.getAttribute("val"))return`#${n.getAttribute("val")}`;const i=f(e,"schemeClr",r.a);if(i?.getAttribute("val"))return i.getAttribute("val")||null;const s=f(e,"sysClr",r.a);return s?.getAttribute("val")&&s.getAttribute("val")||null}generateGradientCSS(t){const e=[...t.stops].sort((t,e)=>t.position-e.position).map(t=>`${t.color} ${t.position}%`).join(", ");switch(t.type){case"linear":return`linear-gradient(${void 0!==t.angle?t.angle:0}deg, ${e})`;case"radial":return`radial-gradient(circle, ${e})`;case"path":return`radial-gradient(${t.direction||"circle"}, ${e})`;default:return`linear-gradient(${e})`}}parseTextBody(t,e,n){const i=u(t,"p",r.a);this.textStyle=i.flatMap(t=>this.parseParagraph(t,e,n)),this.text=this.textStyle.map(t=>t.text).join("");const s=t.querySelector("a\\:p, p\\:p a\\:p"),o=s?f(s,"pPr",r.a):null;if(o){const t=f(o,"spcBef",r.a),e=t?parseInt(g(t,"spcPts","0"))/100:0,n=f(o,"spcAft",r.a),i=n?parseInt(g(n,"spcPts","0"))/100:0,s=f(o,"lnSpc",r.a),a=s?parseInt(g(s,"spcPts","0"))/100:0,l=f(o,"marL",r.a),c=l?parseInt(l.getAttribute("val")||"0")/100:0,d=f(o,"marR",r.a),p=d?parseInt(d.getAttribute("val")||"0")/100:0,h=f(o,"insT",r.a),u=h?parseInt(h.getAttribute("val")||"0")/100:0,m=f(o,"insB",r.a),y=m?parseInt(m.getAttribute("val")||"0")/100:0,b=o.getAttribute("indent"),x=b?parseInt(b)/100:0;this.paragraphStyle={align:o.getAttribute("algn")||void 0,indent:x,lineSpacing:a,spaceBefore:e,spaceAfter:i,marginLeft:c,marginRight:p,paddingTop:u,paddingBottom:y,rtl:"1"===o.getAttribute("rtl")},this.style.spaceBefore=e,this.style.spaceAfter=i,this.style.paddingTop=u,this.style.paddingBottom=y,this.style.marginLeft=c,this.style.marginRight=p}}parseParagraph(t,e,n){const i=[];this.bulletStyle=this.parseBulletStyle(t);const s=f(t,"pPr",r.a),o=s?f(s,"defRPr",r.a):null,a=o?this.parseRunProperties(o):{},l=u(t,"r",r.a);for(const t of l){const e=this.parseTextRun(t,n,a);e&&i.push(e)}const c=f(t,"endParaRPr",r.a);if(c){const t=this.parseRunProperties(c);i.forEach(e=>{!e.fontSize&&t.fontSize&&(e.fontSize=t.fontSize),!e.fontFamily&&t.fontFamily&&(e.fontFamily=t.fontFamily),!e.color&&t.color&&(e.color=t.color)})}const d=f(t,"hlinkClick",r.a);if(d){const t=d.getAttributeNS(r.r,"id")||d.getAttribute("r:id")||"";t&&n[t]&&(this.hyperlink={id:t,url:n[t].target,tooltip:d.getAttribute("tooltip")||void 0})}return i}parseBulletStyle(t){const e=f(t,"pPr",r.a);if(!e)return{};if(f(e,"buNone",r.a))return{type:"none"};const n=f(e,"buChar",r.a);if(n){return{type:"char",char:n.getAttribute("char")||"•",font:n.getAttribute("font")||void 0,color:this.parseColor(n),size:parseInt(n.getAttribute("sz")||"100")/100}}const i=f(e,"buBlip",r.a);if(i){return{type:"blip",imageSrc:i.getAttributeNS(r.r,"embed")||i.getAttribute("r:embed")||""}}const s=f(e,"buAutoNum",r.a);return s?{type:"autoNum",autoNumType:s.getAttribute("type")||"arabic",level:parseInt(s.getAttribute("startAt")||"1")}:{type:"none"}}parseTextRun(t,e,n={}){const i=f(t,"rPr",r.a),s=f(t,"t",r.a);if(!s)return null;const o={text:s.textContent||"",...n};if(i){const t=this.parseRunProperties(i);Object.assign(o,t)}return o}parseRunProperties(t){const e={};let n;const i=t.getAttribute("sz");if(i)n=parseInt(i)/100;else{const e=f(t,"sz",r.a);if(e){const t=e.getAttribute("val");t&&(n=parseInt(t)/100)}}void 0!==n&&(e.fontSize=n*(4/3));const s=f(t,"latin",r.a),o=f(t,"ea",r.a),a=f(t,"cs",r.a),l=s?.getAttribute("typeface"),c=o?.getAttribute("typeface"),d=a?.getAttribute("typeface");l?e.fontFamily=l:c?e.fontFamily=c:d&&(e.fontFamily=d),"1"===t.getAttribute("b")&&(e.bold=!0),"1"===t.getAttribute("i")&&(e.italic=!0);const p=t.getAttribute("u");p&&(e.underline="none"===p?"none":"underline"),"1"===t.getAttribute("strike")&&(e.strike=!0);const h=f(t,"solidFill",r.a);if(h){const t=f(h,"srgbClr",r.a);if(t?.getAttribute("val")){const r=`#${t.getAttribute("val")}`;e.color=r,this.style.color=r}}const u=f(t,"highlight",r.a);if(u){const t=f(u,"srgbClr",r.a);t?.getAttribute("val")&&(e.backgroundColor=`#${t.getAttribute("val")}`)}const g=f(t,"kern",r.a);if(g){const t=g.getAttribute("val");t&&(e.letterSpacing=parseInt(t)/100)}return e}parseColor(t){const e=f(t,"solidFill",r.a);if(e){const t=f(e,"srgbClr",r.a);if(t?.getAttribute("val"))return`#${t.getAttribute("val")}`}}detectShapeType(t){if(!t)return"rectangle";const e=f(t,"prstGeom",r.a);if(e){const t=e.getAttribute("prst")||"";return{rect:"rectangle",ellipse:"ellipse",roundRect:"roundedRectangle",triangle:"triangle",diamond:"diamond",pentagon:"pentagon",hexagon:"hexagon",octagon:"octagon",star4:"star",star5:"5-point star",star6:"6-point star",star8:"8-point star",star10:"10-point star",star12:"12-point star",star16:"16-point star",star24:"24-point star",star32:"32-point star",heart:"heart",lightning:"lightning",sun:"sun",moon:"moon",cloud:"cloud",arrow:"arrow",bentArrow:"bent arrow",chevron:"chevron",home:"home",cube:"cube",bevel:"bevel",donut:"donut",noSmoking:"noSmoking",blockArc:"blockArc",foldedCorner:"foldedCorner",smileyFace:"smileyFace"}[t]||t}return f(t,"custGeom",r.a)?"custom":"rectangle"}toHTML(){const t=this.formatDataAttributes(),e=this.generateBlockStyle(),r=this.generateBlockClasses(),n=this.generateInnerHTML();return`<div class="${r.join(" ")}" ${t} style="${e}">\n      ${n}\n    </div>`}generateBlockStyle(){const{x:t,y:e,width:r,height:n}=this.rect,i=["position: absolute",`top: ${e}px`,`left: ${t}px`,`width: ${r}px`,`height: ${n}px`];return this.style.borderWidth&&parseFloat(this.style.borderWidth)>0&&this.style.borderColor?i.push(`border: ${this.style.borderWidth}px solid ${this.style.borderColor}`):i.push("border: none"),this.style.backgroundColor&&"transparent"!==this.style.backgroundColor?i.push(`background-color: ${this.style.backgroundColor}`):i.push("background-color: transparent"),void 0!==this.zIndex?i.push(`z-index: ${this.zIndex}`):i.push("z-index: 1"),this.rotation?i.push(`transform: rotate(${this.rotation}deg)`):i.push("transform: rotate(0deg)"),i.join("; ")}generateBlockClasses(){const t=["block"];return this.rect.y<100&&t.push("v-up"),("text"===this.type||this.isPlaceholder)&&t.push("content"),t}generateInnerHTML(){if("text"===this.type&&this.text){const{width:t,height:e}=this.rect;return`<div style="display: flex; width: ${t}px;" class="slide-prgrph ${this.getAlignClass()} pregraph-ltr">\n        <div style="${["height: 100%","direction: "+(this.paragraphStyle?.rtl?"rtl":"initial"),"overflow-wrap: break-word","word-wrap: break-word",`width: ${t}px`].join("; ")}; background: transparent;">\n          ${this.renderTextContentPPTXjs()}\n        </div>\n      </div>`}return""}renderTextContentPPTXjs(){return this.textStyle&&0!==this.textStyle.length?this.textStyle.map(t=>`<span class="text-block" style="${this.generateTextRunStyle(t).join("; ")}">${this.escapeHtml(t.text)}</span>`).join(""):`<span class="text-block" style="${this.generateTextSpanStyle()}">${this.escapeHtml(this.text||"")}</span>`}generateTextSpanStyle(){const t=[`font-size: ${this.style.fontSize||14}px`,`font-family: ${this.style.fontFamily||"inherit"}`,`font-weight: ${this.style.fontWeight||"inherit"}`,`font-style: ${this.style.fontStyle||"inherit"}`,`text-decoration: ${this.style.textDecoration||"inherit"}`,`text-align: ${this.paragraphStyle?.align||"left"}`,"vertical-align: baseline"];return this.style.color&&t.push(`color: ${this.style.color}`),t.join("; ")}generateTextRunStyle(t){const e=[];return t.fontSize&&t.fontSize>0&&e.push(`font-size: ${t.fontSize}px`),t.fontFamily&&e.push(`font-family: ${t.fontFamily}`),void 0!==t.bold?e.push("font-weight: "+(t.bold?"bold":"normal")):t.fontWeight&&e.push(`font-weight: ${t.fontWeight}`),void 0!==t.italic?e.push("font-style: "+(t.italic?"italic":"normal")):t.fontStyle&&e.push(`font-style: ${t.fontStyle}`),t.underline&&"none"!==t.underline?e.push("text-decoration: underline"):t.textDecoration&&e.push(`text-decoration: ${t.textDecoration}`),t.color&&e.push(`color: ${t.color}`),e.push(`text-align: ${this.paragraphStyle?.align||"left"}`),e.push("vertical-align: baseline"),e}renderTextContent(){return this.textStyle&&0!==this.textStyle.length?this.textStyle.map(t=>{const e=[];t.fontSize&&t.fontSize>0&&e.push(`font-size: ${t.fontSize}px`),t.fontFamily&&e.push(`font-family: ${t.fontFamily}`),void 0!==t.bold?e.push("font-weight: "+(t.bold?"bold":"normal")):e.push("font-weight: inherit"),void 0!==t.italic?e.push("font-style: "+(t.italic?"italic":"normal")):e.push("font-style: inherit"),t.underline&&"none"!==t.underline?e.push("text-decoration: underline"):e.push("text-decoration: inherit"),t.color&&e.push(`color: ${t.color}`),e.push(`text-align: ${this.paragraphStyle?.align||"left"}`),e.push("vertical-align: baseline");return`<span class="text-block" style="${e.join(";")}">${this.escapeHtml(t.text)}</span>`}).join(""):`<span class="text-block" style="font-size:${this.style.fontSize||14}px;">${this.escapeHtml(this.text||"")}</span>`}getTextStyle(){const t=["display: flex","align-items: center",`justify-content: ${this.textStyleFromAlign(this.paragraphStyle?.align)}`,"width: 100%","height: 100%","box-sizing: border-box"];if(this.style.spaceBefore&&t.push(`padding-top: ${this.style.spaceBefore}px`),this.style.spaceAfter&&t.push(`padding-bottom: ${this.style.spaceAfter}px`),this.style.paddingTop&&t.push(`margin-top: ${this.style.paddingTop}px`),this.style.paddingBottom&&t.push(`margin-bottom: ${this.style.paddingBottom}px`),this.style.padding)t.push(`padding-left: ${this.style.padding}`),t.push(`padding-right: ${this.style.padding}`);else{const e=this.style.marginLeft||10,r=this.style.marginRight||10;t.push(`padding-left: ${e}px`),t.push(`padding-right: ${r}px`)}return this.text,this.textStyle&&this.textStyle.length>0&&this.textStyle.map(t=>{const e=[];t.fontSize&&t.fontSize>0&&e.push(`font-size: ${t.fontSize}px`),t.color&&e.push(`color: ${t.color}`),t.fontFamily&&e.push(`font-family: ${t.fontFamily}`),t.bold&&e.push("font-weight: bold"),t.italic&&e.push("font-style: italic"),t.underline&&"none"!==t.underline&&e.push("text-decoration: underline"),t.strike&&e.push("text-decoration: line-through"),t.backgroundColor&&e.push(`background-color: ${t.backgroundColor}`),t.letterSpacing&&e.push(`letter-spacing: ${t.letterSpacing}px`);return`<span${e.length>0?` style="${e.join("; ")}"`:""}>${this.escapeHtml(t.text)}</span>`}).join(""),t.join("; ")+";>CONTENT"}getRotationStyle(){return void 0===this.rotation||0===this.rotation?"":`transform: rotate(${this.rotation}deg); transform-origin: center;`}getShapeStyle(){return[`background-color: ${this.style.backgroundColor||"#ffffff"}`,`border: ${this.style.borderWidth}px solid ${this.style.borderColor}`].join("; ")}textStyleFromAlign(t){switch(t){case"right":return"flex-end";case"center":case"justify":return"center";default:return"flex-start"}}getAlignClass(){switch(this.paragraphStyle?.align||"left"){case"center":return"h-mid";case"right":return"h-right";default:return"h-left"}}textStyleFromFontSize(){return this.textStyle?.[0]?.fontSize?this.textStyle[0].fontSize:this.style.fontSize||14}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}parseStyleString(t){return t.split(";").filter(t=>t.trim())}toParsedElement(){return{id:this.id,type:"shape",rect:this.rect,style:this.style,content:this.content,props:{isPlaceholder:this.isPlaceholder,placeholderType:this.placeholderType,shapeType:this.shapeType,textStyle:this.textStyle,paragraphStyle:this.paragraphStyle,bulletStyle:this.bulletStyle,hyperlink:this.hyperlink,rotation:this.rotation},name:this.name,hidden:this.hidden,text:this.text,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class D extends M{constructor(){super(...arguments),this.type="image",this.mediaType="image",this.src="",this.relId=""}static fromNode(t,e){try{const n=new D("","image",{x:0,y:0,width:0,height:0},"",{},e),i=f(t,"nvPicPr",r.p),s=i?f(i,"cNvPr",r.p):null;n.id=g(s,"id",n.generateId()),n.name=g(s,"name",""),n.hidden=m(s,"hidden"),n.altText=g(s,"descr","");f(t,"spPr",r.p);n.rect=n.parsePosition(t);const o=f(t,"blipFill",r.p);let a="";if(o){const t=f(o,"blip",r.a);a=t?.getAttributeNS(r.r,"embed")||t?.getAttribute("r:embed")||""}const l=i?f(i,"nvPr",r.p):null,c=l?f(l,"videoFile",r.a):null,d=l?f(l,"audioFile",r.a):null;return c?(n.mediaType="video",n.videoInfo=n.parseVideoInfo(c,a,e),n.src=n.videoInfo.src,n.relId=a):d?(n.mediaType="audio",n.audioInfo=n.parseAudioInfo(d,a,e),n.src=n.audioInfo.src,n.relId=a):(n.mediaType="image",n.src=n.parseImageSrc(a,e,t),n.relId=a,n.src.endsWith(".png")?n.mimeType="image/png":n.src.endsWith(".jpg")||n.src.endsWith(".jpeg")?n.mimeType="image/jpeg":n.src.endsWith(".gif")?n.mimeType="image/gif":n.src.endsWith(".svg")&&(n.mimeType="image/svg+xml")),n.content={src:n.src,alt:n.altText,mediaType:n.mediaType,videoInfo:n.videoInfo,audioInfo:n.audioInfo},n.props={imgId:a,mimeType:n.mimeType,mediaType:n.mediaType},n.rawNode=t,n}catch(t){return console.error("Failed to parse image element:",t),null}}parseVideoInfo(t,e,n){const i=t.getAttribute("link"),s=t.getAttributeNS(r.r,"link")||"";if(i)return{src:i,type:"link",autoplay:!0,muted:!1,controls:!0,loop:!1};{const t=n[s]?.target||"";return{src:t,type:"blob",format:this.detectVideoFormat(t),autoplay:!1,muted:!1,controls:!0,loop:!1}}}parseAudioInfo(t,e,n){const i=t.getAttribute("link"),s=t.getAttributeNS(r.r,"link")||"";if(i)return{src:i,type:"link",autoplay:!0,muted:!1,controls:!0,loop:!1};{const t=n[s]?.target||"";return{src:t,type:"blob",format:this.detectAudioFormat(t),autoplay:!1,muted:!1,controls:!0,loop:!1}}}parseImageSrc(t,e,r){if(!t||!e[t])return"";return e[t].target}detectVideoFormat(t){return t.endsWith(".mp4")?"mp4":t.endsWith(".webm")?"webm":t.endsWith(".ogg")?"ogg":void 0}detectAudioFormat(t){return t.endsWith(".mp3")?"mp3":t.endsWith(".wav")?"wav":t.endsWith(".ogg")?"ogg":void 0}getFilePath(){return"image"===this.mediaType&&this.relId&&this.relsMap[this.relId]?this.relsMap[this.relId].target:"video"===this.mediaType&&this.videoInfo&&"blob"===this.videoInfo.type?this.videoInfo.src:"audio"===this.mediaType&&this.audioInfo&&"blob"===this.audioInfo.type?this.audioInfo.src:""}getDataAttributes(){const t=super.getDataAttributes(),e=this.getFilePath();return e&&(t["data-file"]=e),this.relId&&(t["data-rel-id"]=this.relId),t}toHTML(){const t=this.getContainerStyle();return"video"===this.mediaType&&this.videoInfo?this.toVideoHTML(t):"audio"===this.mediaType&&this.audioInfo?this.toAudioHTML(t):this.toImageHTML(t)}toImageHTML(t){const e=["width: 100%","height: 100%","object-fit: contain"].join("; ");return`<div ${this.formatDataAttributes()} style="${t}">\n      <img src="${this.src}" alt="${this.altText||""}" style="${e}" />\n    </div>`}toVideoHTML(t){const e=this.videoInfo,r=["width: 100%","height: 100%","object-fit: contain"].join("; "),n=this.formatDataAttributes();return"link"===e.type?`<div ${n} style="${t}">\n        <iframe\n          src="${e.src}"\n          style="${r}"\n          frameborder="0"\n          allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"\n          allowfullscreen>\n        </iframe>\n      </div>`:`<div ${n} style="${t}">\n        <video\n          src="${e.src}"\n          style="${r}"\n          ${e.autoplay?"autoplay":""}\n          ${e.muted?"muted":""}\n          ${e.loop?"loop":""}\n          ${e.controls?"controls":""}>\n          ${this.getVideoSourceTag(e.format)}\n        </video>\n      </div>`}getVideoSourceTag(t){if(!t)return"";const e={mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg"}[t];return e?`<source src="${this.videoInfo?.src}" type="${e}" />`:""}toAudioHTML(t){const e=this.audioInfo,r=["width: 100%","display: block"].join("; "),n=this.formatDataAttributes();return"link"===e.type?`<div ${n} style="${t}">\n        <audio\n          src="${e.src}"\n          style="${r}"\n          ${e.autoplay?"autoplay":""}\n          ${e.muted?"muted":""}\n          ${e.loop?"loop":""}\n          ${e.controls?"controls":""}>\n        </audio>\n      </div>`:`<div ${n} style="${t}">\n        <audio id="audio_${this.id}" style="${r}" ${e.controls?"controls":""}>\n          ${this.getAudioSourceTag(e.format)}\n        </audio>\n      </div>`}getAudioSourceTag(t){if(!t)return"";const e={mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg"}[t];return e?`<source src="${this.audioInfo?.src}" type="${e}" />`:""}toParsedElement(){return{id:this.id,type:"image",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,relId:this.relId,src:this.src,altText:this.altText,mimeType:this.mimeType,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class E extends M{static fromNode(t,e){try{const n=f(t,"oleObj",r.p);if(!n){const n=f(t,"Fallback",r.mc);if(n){const t=f(n,"pic",r.p);if(t){const r=D.fromNode(t,e);if(r)return new E(r.id,r.rect,"",r.relId,{...r.props,isOle:!0,hasFallback:!0},e)}}return null}const i=n.getAttribute("progId")||"",s=n.getAttributeNS(r.r,"id")||n.getAttribute("r:id")||"",o=new E("",{x:0,y:0,width:0,height:0},i,s,{},e),a=f(t,"nvGraphicFramePr",r.p),l=a?f(a,"cNvPr",r.p):null;o.id=g(l,"id",o.generateId()),o.name=g(l,"name",""),o.hidden=m(l,"hidden"),o.oleName=o.name;const c=f(t,"xfrm",r.p);if(c){const t=f(c,"off",r.a),e=f(c,"ext",r.a);t&&e&&(o.rect.x=d(t.getAttribute("x")||"0"),o.rect.y=d(t.getAttribute("y")||"0"),o.rect.width=d(e.getAttribute("cx")||"0"),o.rect.height=d(e.getAttribute("cy")||"0"))}return o.content={},o.props={progId:i,relId:s,hasFallback:!1},o.rawNode=t,o}catch(t){return console.error("Failed to parse OLE element:",t),null}}constructor(t,e,r,n,i={},s={}){super(t,"ole",e,i,s),this.type="ole",this.progId=r,this.relId=n,this.oleName=""}toHTML(){const t=this.getContainerStyle();return`<div ${this.formatDataAttributes()} style="${t}">\n      <div style="${["width: 100%","height: 100%","display: flex","align-items: center","justify-content: center","background-color: #f5f5f5","border: 1px dashed #ccc","color: #666","font-size: 12px","text-align: center","padding: 10px"].join("; ")}">\n        ${this.progId||this.oleName||"OLE Object"}\n      </div>\n    </div>`}toParsedElement(){return{id:this.id,type:"ole",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,relId:this.relId,progId:this.progId,hasFallback:this.hasFallback,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class j extends M{constructor(){super(...arguments),this.type="chart",this.relId=""}static fromNode(t,e){try{const n=f(t,"nvGraphicFramePr",r.p),i=n?f(n,"cNvPr",r.p):null,s=g(i,"id",`chart_${Date.now()}`),o=g(i,"name",""),a=m(i,"hidden"),l=f(t,"xfrm",r.p);let c={x:0,y:0,width:0,height:0};if(l){const t=f(l,"off",r.a),e=f(l,"ext",r.a);t&&(c.x=d(t.getAttribute("x")||"0"),c.y=d(t.getAttribute("y")||"0")),e&&(c.width=d(e.getAttribute("cx")||"0"),c.height=d(e.getAttribute("cy")||"0"))}const p=new j(s,"chart",c,"",{},e);p.name=o,p.hidden=a;const h=f(t,"graphic",r.a),u=h?f(h,"graphicData",r.a):null;if(!u)return null;if(!(u.getAttribute("uri")||"").includes("chart"))return null;const y=f(u,"chart",r.c);if(!y)return null;const b=y.getAttribute("type")||"unknown",x=y.getAttributeNS(r.r,"id")||y.getAttribute("r:id")||"";if(p.chartType=p.detectChartType(y),p.relId=x,p.content={chartType:"unknown",data:[]},p.props={relId:x,chartType:b},p.rawNode=t,x&&e[x]){const t=e[x].target;console.log(`Chart file path: ${t}`)}return p}catch(t){return console.error("Failed to parse chart element:",t),null}}detectChartType(t){const e=Array.from(t.children);for(const t of e){const e=t.tagName;if(e.includes("lineChart"))return"lineChart";if(e.includes("barChart"))return"barChart";if(e.includes("pieChart"))return e.includes("3D")?"pie3DChart":"pieChart";if(e.includes("areaChart"))return"areaChart";if(e.includes("scatterChart"))return"scatterChart"}return"unknown"}toHTML(){const t=this.getContainerStyle(),e=this.formatDataAttributes(),r=["width: 100%","height: 100%","display: flex","align-items: center","justify-content: center","background-color: #fafafa","border: 1px solid #ddd","color: #333","font-size: 14px","text-align: center","border-radius: 4px","padding: 20px"].join("; "),n=this.getChartLabel();return this.chartData&&Array.isArray(this.chartData.series)&&this.chartData.series.length>0?`<div ${e} style="${t}">\n        <div style="width: 100%;">\n          <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">\n            ${this.chartData?.title||"Chart"}\n          </div>\n          ${this.renderChartData()}\n        </div>\n      </div>`:`<div ${e} style="${t}">\n      <div style="${r}">\n        ${n}\n      </div>\n    </div>`}getChartLabel(){const t={lineChart:"折线图",barChart:"柱状图",pieChart:"饼图",pie3DChart:"3D饼图",areaChart:"面积图",scatterChart:"散点图",unknown:"图表"};return this.chartType&&t[this.chartType]||"Chart"}renderChartData(){if(!this.chartData||!this.chartData.series)return"";const t=this.chartData;let e='<div style="margin: 10px 0;">';return t.xTitle&&(e+=`<div style="font-size: 12px; color: #666; margin-bottom: 5px;">X轴: ${t.xTitle}</div>`),t.yTitle&&(e+=`<div style="font-size: 12px; color: #666; margin-bottom: 10px;">Y轴: ${t.yTitle}</div>`),e+='<div style="display: flex; flex-wrap: wrap; gap: 10px;">',t.series&&t.series.forEach((t,r)=>{e+=`\n          <div style="\n            background: ${t.color||"#4285f4"};\n            color: white;\n            padding: 10px;\n            border-radius: 4px;\n            min-width: 150px;\n          ">\n            <div style="font-weight: bold;">${t.name||`系列 ${r+1}`}</div>\n            <div style="font-size: 12px; margin-top: 5px;">\n              数据点: ${t.points?.length||0}\n            </div>\n          </div>\n        `}),e+="</div>",e+="</div>",e}toParsedElement(){return{id:this.id,type:"chart",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,relId:this.relId,chartType:this.chartType,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class L extends M{constructor(t,e,r={},n={},i={}){super(t,"diagram",e,r,n,i),this.type="diagram",this.relId=""}static fromNode(t,e){try{const n=f(t,"nvGraphicFramePr",r.p),i=n?f(n,"cNvPr",r.p):null,s=g(i,"id",`diagram_${Date.now()}`),o=g(i,"name",""),a=m(i,"hidden"),l=f(t,"xfrm",r.p);let c={x:0,y:0,width:0,height:0};if(l){const t=f(l,"off",r.a),e=f(l,"ext",r.a);t&&(c.x=d(t.getAttribute("x")||"0"),c.y=d(t.getAttribute("y")||"0")),e&&(c.width=d(e.getAttribute("cx")||"0"),c.height=d(e.getAttribute("cy")||"0"))}const p=new L(s,c,"",{},e);p.name=o,p.hidden=a;const h=f(t,"graphic",r.a),u=h?f(h,"graphicData",r.a):null;if(!u)return null;const y=u.getAttribute("uri")||"";if(!y.includes("diagram"))return null;const b=f(u,"dgm",r.d);if(!b)return null;const x=b.getAttributeNS(r.r,"rel")||b.getAttribute("r:rel")||"";return p.relId=x,p.diagramData=p.parseDiagramData(b,e),p.content={diagramData:p.diagramData},p.props={relId:x,diagramType:y},p.rawNode=t,p}catch(t){return console.error("Failed to parse diagram element:",t),null}}parseDiagramData(t,e){const n={},i=t.getAttributeNS(r.d,"relIds")||"",s=this.parseRelIds(i);s.colors&&this.relsMap[s.colors]&&(n.colors=this.fetchColorData(this.relsMap[s.colors].target)),s.data&&this.relsMap[s.data]&&(n.data=this.fetchLayoutData(this.relsMap[s.data].target)),s.layout&&this.relsMap[s.layout]&&(n.layout=this.relsMap[s.layout].target);const o=f(t,"spTree",r.d);return o&&(n.shapes=this.parseShapes(o)),n}parseRelIds(t){const e={};if(!t)return e;const r=t.split(",").map(t=>t.trim());return r.length>=1&&(e.colors=r[0]),r.length>=2&&(e.data=r[1]),r.length>=3&&(e.layout=r[2]),r.length>=4&&(e.quickStyle=r[3]),e}async fetchColorData(t){try{t.startsWith("../")&&t.substring(3);return{}}catch(t){return void console.warn("Failed to fetch color data:",t)}}async fetchLayoutData(t){try{t.startsWith("../")&&t.substring(3);return{}}catch(t){return void console.warn("Failed to fetch layout data:",t)}}fetchColorDataSync(t){return{_needsAsyncLoad:!0,target:t}}fetchLayoutDataSync(t){return{_needsAsyncLoad:!0,target:t}}parseShapes(t){const e=[],n=Array.from(t.children);for(const t of n){const n=t.getAttribute("id")||"",i=t.tagName||"shape",s=f(t,"xfrm",r.d);let o;if(s){const t=f(s,"off",r.a),a=f(s,"ext",r.d);if(t){const e=parseInt(t.getAttribute("x")||"0"),r=parseInt(t.getAttribute("y")||"0");o={x:d(e),y:d(r)}}if(a){const t=parseInt(a.getAttribute("cx")||"0"),r=parseInt(a.getAttribute("cy")||"0");e.push({id:n,type:i,position:o,size:{width:d(t),height:d(r)}})}}else e.push({id:n,type:i})}return e}toHTML(){const t=this.getContainerStyle();return`<div ${this.formatDataAttributes()} style="${t}">\n      <div style="${["width: 100%","height: 100%","display: flex","align-items: center","justify-content: center","background-color: #f0f0f0","border: 1px dashed #ccc","color: #666","font-size: 14px","text-align: center","padding: 20px","border-radius: 4px"].join("; ")}">\n        ${this.getDiagramInfo()}\n      </div>\n    </div>`}getDiagramInfo(){const t=this.diagramData?.shapes?.length||0;let e='<div style="text-align: left;">';return e+='<div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">SmartArt / Diagram</div>',e+=`<div style="margin-bottom: 10px;">形状数量: ${t}</div>`,this.diagramData?.shapes&&t>0&&(e+='<div style="margin-top: 10px;">',this.diagramData.shapes.slice(0,10).forEach((t,r)=>{e+=`<div style="\n          display: inline-block;\n          width: 60px;\n          height: 40px;\n          background: #e0e0e0;\n          border: 1px solid #ccc;\n          border-radius: 4px;\n          margin: 5px;\n          font-size: 12px;\n        ">\n          ${t.type}\n        </div>`}),t>10&&(e+=`<div style="display: inline-block; padding: 10px;">...还有 ${t-10} 个形状</div>`),e+="</div>"),e+="</div>",e}toParsedElement(){return{id:this.id,type:"diagram",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class B extends M{constructor(){super(...arguments),this.type="table",this.rows=[],this.colWidths=[]}static fromNode(t,e){try{const n=new B("","table",{x:0,y:0,width:0,height:0},{},{},e),i=f(t,"nvGraphicFramePr",r.p),s=i?f(i,"cNvPr",r.p):null;n.id=g(s,"id",n.generateId()),n.name=g(s,"name",""),n.hidden=!1;const o=f(t,"xfrm",r.p);if(o){const t=f(o,"off",r.a),e=f(o,"ext",r.a);t&&(n.rect.x=d(t.getAttribute("x")||"0"),n.rect.y=d(t.getAttribute("y")||"0")),e&&(n.rect.width=d(e.getAttribute("cx")||"0"),n.rect.height=d(e.getAttribute("cy")||"0"))}const a=f(t,"graphic",r.a),l=a?f(a,"graphicData",r.a):null;if(!l)return null;if(!(l.getAttribute("uri")||"").includes("table"))return null;const c=f(l,"tbl",r.a);return c?(n.parseTable(c),n.tableStyle=n.parseTableStyle(c),n.rtl="1"===c.getAttribute("rtl"),n.content={rows:n.rows,colWidths:n.colWidths,tableStyle:n.tableStyle},n.props={rowCount:n.rows.length,colCount:n.colWidths.length},n.rawNode=t,n):null}catch(t){return console.error("Failed to parse table element:",t),null}}parseTable(t){const e=u(t,"tr",r.a);this.rows=e.map(t=>this.parseTableRow(t));const n=u(t,"gridCol",r.a);this.colWidths=n.map(t=>d(t.getAttribute("w")||"0"))}parseTableRow(t){const e={cells:[],style:{}},n=t.getAttribute("h");n&&(e.height=d(n));const i=u(t,"tc",r.a);return e.cells=i.map(t=>this.parseTableCell(t)),e}parseTableCell(t){const e={style:{}},n=t.getAttribute("rowSpan");n&&(e.rowSpan=parseInt(n));const i=t.getAttribute("gridSpan");i&&(e.colSpan=parseInt(i));const s=f(t,"txBody",r.a);s&&(e.text=function(t){const e=u(t,"p",r.a),n=[];return e.forEach(t=>{u(t,"r",r.a).forEach(t=>{const e=f(t,"t",r.a);e?.textContent&&n.push(e.textContent)})}),n.join("")}(s));const o=f(t,"tcPr",r.a);return o&&this.parseCellStyle(o,e),e}parseCellStyle(t,e){const n=f(t,"tcBdr",r.a);if(n){const t=this.parseBorder(n,"left"),r=this.parseBorder(n,"top");this.parseBorder(n,"right"),this.parseBorder(n,"bottom"),e.style&&(e.style.borderColor=t?.color||r?.color,e.style.borderWidth=r?.width||"1px")}const i=f(t,"fill",r.a);if(i){const t=f(i,"solidFill",r.a);if(t){const n=f(t,"srgbClr",r.a);n?.getAttribute("val")&&(e.style.backgroundColor=`#${n.getAttribute("val")}`)}}const s=t.getAttribute("vAlign");s&&e.style&&(e.style.verticalAlign=s);const o=t.getAttribute("marL"),a=t.getAttribute("marR"),l=t.getAttribute("marT"),c=t.getAttribute("marB");if(e.style){const t=parseInt(o||"0"),r=parseInt(a||"0"),n=parseInt(l||"0"),i=parseInt(c||"0"),s=[];n&&s.push(`${d(n)}px`),r&&s.push(`${d(r)}px`),i&&s.push(`${d(i)}px`),t&&s.push(`${d(t)}px`),s.length>0&&(e.style.padding=s.join(" "))}}parseBorder(t,e){const n=f(t,e,r.a);if(!n)return;const i=n.getAttribute("color");return{color:i?`#${i}`:void 0,width:parseInt(n.getAttribute("sz")||"0")/100+"px"}}parseTableStyle(t){const e={},n=f(t,"wholeTbl",r.a),i=this.parseTableWholeStyle(n);i&&(i.backgroundColor&&(this.style.backgroundColor=i.backgroundColor),i.borderColor&&i.borderWidth&&(this.style.border=`${i.borderWidth} solid ${i.borderColor}`),i.shadow&&(this.style.boxShadow=this.generateBoxShadow(i.shadow)));const s=f(t,"tblBg",r.a);if(s){const t=f(s,"fill",r.a),n=f(t,"solidFill",r.a),i=f(n,"srgbClr",r.a);i?.getAttribute("val")&&(e.firstRow={backgroundColor:`#${i.getAttribute("val")}`})}const o=f(t,"firstRow",r.a);o&&(e.firstRow=this.parseRowStyle(o));const a=f(t,"lastRow",r.a);a&&(e.lastRow={backgroundColor:this.parseRowBackgroundColor(a)});const l=f(t,"firstCol",r.a);l&&(e.firstCol={backgroundColor:this.parseRowBackgroundColor(l)});const c=f(t,"lastCol",r.a);c&&(e.lastCol={backgroundColor:this.parseRowBackgroundColor(c)});const d=f(t,"band1H",r.a);d&&(e.bandRow={odd:{backgroundColor:this.parseRowBackgroundColor(d)}});const p=f(t,"band2H",r.a);return p&&(e.bandRow||(e.bandRow={}),e.bandRow.even={backgroundColor:this.parseRowBackgroundColor(p)}),e}parseRowStyle(t){const e=f(t,"fill",r.a);if(e){const t=f(e,"solidFill",r.a),n=f(t,"srgbClr",r.a);if(n?.getAttribute("val")){return{backgroundColor:`#${n.getAttribute("val")}`}}}return{}}parseRowBackgroundColor(t){const e=f(t,"fill",r.a);if(e){const t=f(e,"solidFill",r.a),n=f(t,"srgbClr",r.a);if(n?.getAttribute("val"))return`#${n.getAttribute("val")}`}}parseTableWholeStyle(t){if(!t)return null;const e={},n=f(t,"fill",r.a);if(n){const t=f(n,"solidFill",r.a);if(t){const n=f(t,"srgbClr",r.a);n?.getAttribute("val")&&(e.backgroundColor=`#${n.getAttribute("val")}`);const i=f(t,"schemeClr",r.a);i?.getAttribute("val")&&(e.backgroundColor=i.getAttribute("val")||void 0)}f(n,"gradFill",r.a)}const i=f(t,"ln",r.a);if(i){const t=i.getAttribute("w"),n=f(i,"solidFill",r.a);if(n){const t=f(n,"srgbClr",r.a);t?.getAttribute("val")&&(e.borderColor=`#${t.getAttribute("val")}`)}if(t){const r=parseInt(t),n=Math.round(r/9525);e.borderWidth=`${n}px`}else e.borderWidth="1px"}const s=f(t,"effectLst",r.a);if(s){const t=f(s,"outerShdw",r.a);if(t){e.shadow={};const n=f(t,"solidFill",r.a);if(n){const t=f(n,"srgbClr",r.a);t?.getAttribute("val")&&(e.shadow.color=`#${t.getAttribute("val")}`)}const i=t.getAttribute("blur");i&&(e.shadow.blur=Math.round(parseInt(i)/9525));const s=t.getAttribute("dist"),o=t.getAttribute("dir");if(s&&o){const t=parseInt(s)/9525,r=parseInt(o)/6e4*Math.PI/180;e.shadow.offsetX=Math.round(t*Math.cos(r)),e.shadow.offsetY=Math.round(t*Math.sin(r))}}}return Object.keys(e).length>0?e:null}generateBoxShadow(t){if(!t)return"";const e=[];return void 0!==t.offsetX?e.push(`${t.offsetX}px`):e.push("0"),void 0!==t.offsetY?e.push(`${t.offsetY}px`):e.push("0"),void 0!==t.blur?e.push(`${t.blur}px`):e.push("0"),t.color?e.push(t.color):e.push("#000000"),e.join(" ")}toHTML(){const t=this.getContainerStyle();return`<div ${this.formatDataAttributes()} style="${t}">\n      <table style="${this.getTableStyle()}">\n        <tbody>\n${this.rows.map(t=>this.rowToHTML(t)).join("\n")}\n        </tbody>\n      </table>\n    </div>`}getTableStyle(){return["width: 100%","height: 100%","border-collapse: collapse","border-spacing: 0"].join("; ")}rowToHTML(t){return`      <tr style="${this.getRowStyle(t)}">\n${t.cells.map(t=>this.cellToHTML(t)).join("\n        ")}\n      </tr>`}getRowStyle(t){const e=[];return t.height&&e.push(`height: ${t.height}px`),t.style?.isHeader&&this.tableStyle?.firstRow?.backgroundColor?e.push(`background-color: ${this.tableStyle.firstRow.backgroundColor}`):t.style?.isFooter&&this.tableStyle?.lastRow?.backgroundColor&&e.push(`background-color: ${this.tableStyle.lastRow.backgroundColor}`),e.join("; ")}cellToHTML(t){const e=this.getCellStyle(t),r=[];t.rowSpan&&t.rowSpan>1&&r.push(`rowspan="${t.rowSpan}"`),t.colSpan&&t.colSpan>1&&r.push(`colspan="${t.colSpan}"`);return`<td${r.length>0?" "+r.join(" "):""} style="${e}">${t.text||""}</td>`}getCellStyle(t){const e=[];return t.style?.backgroundColor&&e.push(`background-color: ${t.style.backgroundColor}`),t.style?.borderColor&&t.style?.borderWidth&&e.push(`border: ${t.style.borderWidth} solid ${t.style.borderColor}`),t.style?.padding&&e.push(`padding: ${t.style.padding}`),t.style?.verticalAlign&&e.push(`vertical-align: ${t.style.verticalAlign}`),e.join("; ")}toParsedElement(){return{id:this.id,type:"table",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class R extends M{constructor(){super(...arguments),this.type="group",this.children=[]}static fromNode(t,e){try{const n=new R(`group_${Date.now()}`,"group",{x:0,y:0,width:0,height:0},[],{},e),i=f(t,"grpSpPr",r.p);return n.parseGroupProperties(i,t),Array.from(t.children).forEach(t=>{if(1!==t.nodeType)return;const r=t.tagName;let i=null;"p:sp"===r||"sp"===r?i=N.fromNode(t,e):"p:pic"===r||"pic"===r?i=D.fromNode(t,e):"p:graphicFrame"===r||"graphicFrame"===r?i=n.parseGraphicFrame(t,e):"p:grpSp"!==r&&"grpSp"!==r||(i=R.fromNode(t,e)),i&&n.children.push(i)}),n.content={},n.props={},n.name="分组",n.rawNode=t,n}catch(t){return console.error("Failed to parse group element:",t),null}}parseGraphicFrame(t,e){const n=f(t,"graphic",r.a),i=n?f(n,"graphicData",r.a):null;if(!i)return null;const s=i.getAttribute("uri")||"";return s.includes("oleObject")?E.fromNode(t,e):s.includes("chart")?j.fromNode(t,e):s.includes("diagram")?L.fromNode(t,e):s.includes("table")?B.fromNode(t,e):null}parseGroupProperties(t,e){if(!t)return;const n=f(t,"xfrm",r.a);if(n){const t=f(n,"off",r.a),e=f(n,"ext",r.a),i=f(n,"chOff",r.a),s=f(n,"chExt",r.a);if(i){const t=parseInt(i.getAttribute("x")||"0"),e=parseInt(i.getAttribute("y")||"0");this.childOffset={x:d(t),y:d(e)}}if(e&&s){const r=parseInt(e.getAttribute("cx")||"0"),n=parseInt(e.getAttribute("cy")||"0"),o=parseInt(s.getAttribute("cx")||"0"),a=parseInt(s.getAttribute("cy")||"0");this.childOffset||(this.childOffset={x:0,y:0});let l=0,c=0;i&&(l=parseInt(i.getAttribute("x")||"0"),c=parseInt(i.getAttribute("y")||"0")),t&&(this.childOffset.x+=d(parseInt(t.getAttribute("x")||"0")-l),this.childOffset.y+=d(parseInt(t.getAttribute("y")||"0")-c)),this.rect.x=d(o),this.rect.y=d(a),this.rect.width=d(r-o),this.rect.height=d(n-a)}const o=n.getAttribute("rot");null!==o&&(this.rotation=parseInt(o)/6e4),this.flipH="1"===n.getAttribute("flipH"),this.flipV="1"===n.getAttribute("flipV")}}toHTML(){const t=this.getGroupStyle();return`<div class="ppt-group" ${this.formatDataAttributes()} style="${t}">\n${this.children.map(t=>t.toHTML()).join("\n")}\n    </div>`}getGroupStyle(){const t=["position: absolute",`left: ${this.rect.x}px`,`top: ${this.rect.y}px`,`width: ${this.rect.width}px`,`height: ${this.rect.height}px`];return void 0!==this.rotation&&0!==this.rotation&&(t.push(`transform: rotate(${this.rotation}deg)`),t.push("transform-origin: center center")),this.flipH&&this.flipV?(t.push(`transform: rotate(${this.rotation||0}deg) scale(-1, -1)`),t.push("transform-origin: center center")):this.flipH?(t.push(`transform: rotate(${this.rotation||0}deg) scale(-1, 1)`),t.push("transform-origin: center center")):this.flipV&&(t.push(`transform: rotate(${this.rotation||0}deg) scale(1, -1)`),t.push("transform-origin: center center")),this.childOffset&&(t.push(`margin-left: ${this.childOffset.x}px`),t.push(`margin-top: ${this.childOffset.y}px`)),this.hidden&&t.push("display: none"),t.join("; ")}toParsedElement(){return{id:this.id,type:"group",rect:this.rect,style:this.style,content:this.content,props:{rotation:this.rotation,flipH:this.flipH,flipV:this.flipV,childOffset:this.childOffset},name:this.name,hidden:this.hidden,children:this.children.map(t=>t instanceof N||t instanceof D||t instanceof E||t instanceof j||t instanceof L||t instanceof R?t.toParsedElement():t),attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}function z(t,e){if(t.textStyle||t.style)return t.textStyle||t.style;if(!t.isPlaceholder||!t.placeholderType)return W();const r=t.phSize||t.getAttribute?.("sz"),n=function(t,e){if(e.layout?.textStyles){const r=O(e.layout.textStyles,t);if(r)return r}if(e.master?.textStyles){const r=O(e.master.textStyles,t);if(r)return r}return W()}(t.placeholderType,e);return n||W(t.placeholderType,r)}function O(t,e){switch(e){case"title":case"ctrTitle":case"subTitle":return H(t.titleParaPr);case"body":case"obj":case"chart":case"table":case"dgm":return H(t.bodyPr);default:return H(t.otherPr)}}function H(t){if(!t)return null;const e={},n=f(t,"defRPr",r.a);if(n){const t=f(n,"sz",r.a);if(t){const r=parseInt(t.getAttribute("val")||"0",10)/100;e.fontSize=r*(4/3)}const i=f(n,"solidFill",r.a);if(i){const t=f(i,"srgbClr",r.a);t?.getAttribute("val")&&(e.color=`#${t.getAttribute("val")}`);const n=f(i,"schemeClr",r.a);n?.getAttribute("val")&&(e.color=n.getAttribute("val"))}const s=f(n,"latin",r.a);s?.getAttribute("typeface")&&(e.fontFamily=s.getAttribute("typeface"));const o=f(n,"b",r.a);o&&(e.fontWeight="1"===o.getAttribute("val")||"true"===o.getAttribute("val")?"bold":"normal");const a=f(n,"i",r.a);a&&(e.italic="1"===a.getAttribute("val")||"true"===a.getAttribute("val"));const l=f(n,"u",r.a);l&&(e.underline=l.getAttribute("val")||"sng");const c=f(n,"strike",r.a);c&&(e.strike="1"===c.getAttribute("val")||"true"===c.getAttribute("val"))}const i=t.getAttribute("algn");return i&&(e.align=i),Object.keys(e).length>0?e:null}function W(t,e){let r=14;if(e)switch(e.toLowerCase()){case"quarter":r=40;break;case"half":r=32;break;case"full":r=24;break;default:r=14}else"title"===t?r=44:"body"===t&&(r=18);return{fontSize:r,color:"#333333",fontWeight:"normal",fontFamily:"Arial",align:"left"}}function G(t,e,r,n){if(!t.elements||!Array.isArray(t.elements))return;const i=function(t,e,r,n){return{slide:t,layout:e,master:r,theme:n}}(t,e,r,n);t.elements.forEach(t=>{"shape"!==t.type&&"text"!==t.type||function(t,e){if(t.isPlaceholder&&t.rawNode){const e=t.rawNode.querySelector("p\\:ph, ph");e&&(t.phSize=e.getAttribute("sz"))}if(t.textStyle&&t.textStyle.length>0){const r=z(t,e);return void(r&&t.textStyle.forEach(t=>{!t.fontSize&&r.fontSize&&(t.fontSize=r.fontSize),!t.color&&r.color&&(t.color=r.color),!t.fontFamily&&r.fontFamily&&(t.fontFamily=r.fontFamily),t.bold||"bold"!==r.fontWeight||(t.bold=!0),!t.italic&&r.italic&&(t.italic=r.italic)}))}if(t.isPlaceholder&&t.placeholderType){const r=z(t,e);r&&(t.style={...t.style,...r})}}(t,i)})}class X{constructor(t,e,r,n,i,s,o){this.id=t.id,this.title=t.title,this.background="string"==typeof t.background?t.background:"",this.elements=e,this.rawResult=t,this.layoutElement=r,this.masterElement=n,this.layout=i,this.master=s,this.mediaMap=o}toHTML(){!this.rawResult.styleApplied&&this.layout&&(G(this.rawResult,this.layout,this.master),this.rawResult.styleApplied=!0);const t=function(t,e,r){const n=["position: relative","overflow: hidden","margin: 0 auto",`width: ${d(t)}px`,`height: ${d(e)}px`];return r?"color"===r.type&&r.value?n.push(`background: ${r.value}`):"image"===r.type&&r.value&&n.push(`background: url('${r.value}') no-repeat center/cover`):n.push("background: #ffffff"),n.join("; ")}(9144e3,6858e3,this.rawResult.background),e=this.renderMasterElements(),r=this.renderLayoutElements(),n=this.renderSlideElementsWithLayout();return`<div class="slide" style="${t}" data-slide-id="${this.id}" data-slide-title="${this.escapeHtml(this.title)}">\n${e}\n${r}\n${n}\n    </div>`}renderMasterElements(){return this.masterElement?this.masterElement.toHTML():""}renderLayoutElements(){return this.layoutElement?this.layoutElement.toHTML():""}renderSlideElementsWithLayout(){if(!this.layout)return this.elements.forEach((t,e)=>{t.zIndex=e+1,t.idx=e}),this.elements.map(t=>t.toHTML()).join("\n");const t=[];this.elements.forEach((t,e)=>{t.zIndex=e+1,t.idx=e}),this.elements.forEach(e=>{const r=C(this.layout?.placeholders||[],"shape"===e.type?"body":e.type),n=C(this.master?.placeholders||[],"shape"===e.type?"body":e.type);e.style,!r||function(t){const{rect:e,hAlign:r,vAlign:n}=t,i=d(e.x),s=["position: absolute",`top: ${d(e.y)}px`,`left: ${i}px`,`width: ${d(e.width)}px`,`height: ${d(e.height)}px`],o=T(r,n);s.join("; ")}(r);let i={};const s=function(t,e,r){let n={fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1,...r};return n={...n,...e},n={...n,...t},n}(e.style,r?r.style:void 0,n?n.style:void 0);s&&(i=s),e.style&&Object.assign(e.style,i);const o=e.toHTML();t.push(o)});const e=new Set;return this.elements.forEach(t=>{const r=C(this.layout?.placeholders||[],"shape"===t.type?"body":t.type);if(r){const t=`${r.type||""}_${r.idx??""}`;e.add(t)}}),t.join("")}getTextContentStyle(t,e){const r=[];if(t.fontSize&&r.push(`font-size: ${t.fontSize}px`),t.color&&r.push(`color: ${t.color}`),t.fontWeight&&r.push(`font-weight: ${t.fontWeight}`),t.textAlign&&r.push(`text-align: ${t.textAlign}`),t.backgroundColor&&"transparent"!==t.backgroundColor&&r.push(`background-color: ${t.backgroundColor}`),e){const[t,n]=e.split("_");"mid"!==t&&"center"!==t||(r.push("display: flex"),r.push("align-items: center")),"mid"!==n&&"center"!==n||r.push("justify-content: center")}return r.join("; ")}getSlideBackground(){const t=this.rawResult.background;if(!t)return"background-color: #ffffff;";if("string"==typeof t)return`background-color: ${t};`;if("color"===t.type&&t.value)return`background-color: ${t.value};`;if("image"===t.type){const e=t.value||t.relId;if(e)return`background-image: url('${e}'); background-size: cover; background-position: center;`}return"background-color: #ffffff;"}toHTMLString(){const t=["width: 960px","height: 540px","margin: 20px auto","border: 1px solid #ccc","box-shadow: 0 2px 8px rgba(0,0,0,0.1)",`background-color: ${this.background}`,"position: relative","overflow: hidden"].join("; "),e=this.toHTML();return`<div class="ppt-slide-container" style="${t}">\n      <div class="ppt-slide-header" style="padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd; font-size: 14px; font-weight: bold;">\n        ${this.escapeHtml(this.title)}\n      </div>\n      ${e}\n    </div>`}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}class _{constructor(t,e,r,n=960,i=540,s){this.id=t,this.title=e,this.slides=r,this.width=n,this.height=i,this.ratio=n/i,this.author=s}static fromParseResult(t){const e=t.slides.map(t=>{const{createElementFromData:e}=require("../elements"),r=(t.elements||[]).map(r=>r instanceof M?r:e(r,t.relsMap||{})).filter(t=>null!==t);return new X(t,r,t.layout,t.master)});return new _(t.id,t.title,e,t.props.width||960,t.props.height||540,t.author)}toHTML(){const t=[`width: ${this.width}px`,`min-height: ${this.height}px`,"margin: 20px auto","padding: 20px","background: #f9f9f9","border: 1px solid #ddd"].join("; "),e=this.slides.map(t=>t.toHTMLString()).join("\n\n");return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${this.escapeHtml(this.title)}</title>\n  <style>\n    .ppt-slide-container {\n      page-break-after: always;\n    }\n    .ppt-slide-container:last-child {\n      page-break-after: auto;\n    }\n  </style>\n</head>\n<body>\n  <div style="${t}">\n    <h1 style="text-align: center; margin-bottom: 30px;">${this.escapeHtml(this.title)}</h1>\n${e}\n  </div>\n</body>\n</html>`}toHTMLWithNavigation(){const t=this.slides.map((t,e)=>`\n        <div class="ppt-slide-page" data-index="${e}" style="display: ${0===e?"block":"none"};">\n          ${t.toHTML()}\n        </div>\n      `).join("\n"),e=`\n      <div style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000;">\n        <button onclick="prevSlide()" style="padding: 10px 20px; margin-right: 10px; cursor: pointer;">上一页</button>\n        <span id="slideCounter" style="padding: 10px;">1 / ${this.slides.length}</span>\n        <button onclick="nextSlide()" style="padding: 10px 20px; margin-left: 10px; cursor: pointer;">下一页</button>\n      </div>\n    `,r=`\n      <script>\n        let currentSlide = 0;\n        const slides = document.querySelectorAll('.ppt-slide-page');\n\n        function showSlide(index) {\n          slides.forEach((slide, i) => {\n            slide.style.display = i === index ? 'block' : 'none';\n          });\n          document.getElementById('slideCounter').textContent = (index + 1) + ' / ${this.slides.length}';\n          currentSlide = index;\n        }\n\n        function prevSlide() {\n          showSlide(Math.max(0, currentSlide - 1));\n        }\n\n        function nextSlide() {\n          showSlide(Math.min(${this.slides.length} - 1, currentSlide + 1));\n        }\n\n        document.addEventListener('keydown', (e) => {\n          if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') prevSlide();\n          if (e.key === 'ArrowRight' || e.key === 'ArrowDown') nextSlide();\n        });\n      <\/script>\n    `;return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${this.escapeHtml(this.title)}</title>\n  <style>\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      min-height: 100vh;\n      background: #333;\n    }\n    .ppt-wrapper {\n      width: ${this.width}px;\n      height: ${this.height}px;\n      background: #fff;\n      box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n    }\n  </style>\n</head>\n<body>\n  <div class="ppt-wrapper">\n${t}\n  </div>\n${e}\n${r}\n</body>\n</html>`}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}function V(t,e={},r){if(!t||!t.type)return null;switch(t.type){case"shape":case"text":{const r=new N(t.id,t.type,t.rect,t.content,t.props,e);return Object.assign(r,t),r}case"image":{let n=t.src||"";r&&t.relId&&r.has(t.relId)&&(n=r.get(t.relId)||n);const i=new D(t.id,t.rect,n,t.relId||"",t.props||{},e);return Object.assign(i,t),i.src=n,i}case"ole":{const r=new E(t.id,t.rect,t.progId,t.relId,t.props,e);return Object.assign(r,t),r}case"chart":{const r=new j(t.id,"chart",t.rect,t.content,t.props,e);return Object.assign(r,t),r}case"table":{const r=new B(t.id,t.rect,t.content,t.props,e);return Object.assign(r,t),r}case"diagram":{const r=new L(t.id,t.rect,t.content,t.props,e);return Object.assign(r,t),r}case"group":{const r=new R(t.id,t.rect,t.props,e);return Object.assign(r,t),r}default:return null}}class q extends M{constructor(t,e,r,n={}){super(t,"placeholder",r,{},n,{}),this.type="placeholder",this.placeholderType=e,this.isPlaceholder=!0,this.idx=n.idx,this.name=n.name,this.text=n.text,this.textStyle=n.textStyle}toHTML(){const t=[this.getContainerStyle(),"pointer-events: none","user-select: none"].join("; "),e=this.getPlaceholderContent();return`<div class="ppt-placeholder" data-placeholder-type="${this.placeholderType}" style="${t}">\n${e}\n</div>`}getPlaceholderContent(){switch(this.placeholderType){case"title":return this.isContentSet?this.renderTextContent():'<span class="placeholder-label">点击添加标题</span>';case"body":return this.isContentSet?this.renderTextContent():'<span class="placeholder-label">点击添加文本</span>';case"slideNumber":return'<span class="slide-number"></span>';case"footer":return this.text||'<span class="footer-text"></span>';case"dateTime":return this.text||'<span class="date-time"></span>';default:return this.text||""}}renderTextContent(){return this.text?this.textStyle&&this.textStyle.length>0?this.textStyle.map(t=>`<span style="${this.getTextRunStyle(t)}">${t.text}</span>`).join(""):`<span style="color: inherit;">${this.text}</span>`:""}get isContentSet(){return!(!this.text||!this.text.trim())}getTextRunStyle(t){const e=[];return t.fontSize&&e.push(`font-size: ${t.fontSize}px`),t.fontFamily&&e.push(`font-family: ${t.fontFamily}`),t.color&&e.push(`color: ${t.color}`),t.bold&&e.push("font-weight: bold"),t.italic&&e.push("font-style: italic"),t.underline&&e.push("text-decoration: underline"),e.join("; ")}}class U extends M{constructor(t,e,r=[],n=[],i={}){super(t,"layout",{x:0,y:0,width:960,height:540},{},i,{}),this.type="layout",this.name=e,this.placeholders=r,this.elements=n,this.textStyles=i.textStyles,this.background=i.background,this.relsMap=i.relsMap||{},this.mediaMap=i.mediaMap}static fromResult(t,e){const r=(t.placeholders||[]).map(t=>new q(t.id,t.type,t.rect,{idx:t.idx,name:t.name,rawNode:t.rawNode})),n=(t.elements||[]).map(r=>r instanceof M?r:V(r,t.relsMap||{},e)).filter(t=>null!==t);return new U(t.id,t.name,r,n,{textStyles:t.textStyles,background:t.background,relsMap:t.relsMap,colorMap:t.colorMap,mediaMap:e})}toHTML(){const t=["position: absolute","left: 0","top: 0","width: 100%","height: 100%","pointer-events: none","z-index: 1",this.getBackgroundStyle()].join("; "),e=this.placeholders.map(t=>t.toHTML()).join("\n"),r=this.elements.map(t=>t.toHTML()).join("\n");return`<div class="ppt-layout" style="${t}" data-layout-id="${this.id}" data-layout-name="${this.name||""}">\n${e}\n${r}\n</div>`}getBackgroundStyle(){if(!this.background)return"background-color: transparent;";if("color"===this.background.type&&this.background.value)return`background-color: ${this.background.value};`;if("image"===this.background.type&&this.background.relId){const t=this.mediaMap?this.mediaMap.get(this.background.relId):this.background.relId;if(t)return`background-image: url('${t}'); background-size: cover;`}return"background-color: transparent;"}}class Y extends M{constructor(t,e=[],r=[],n={}){super(t,"master",{x:0,y:0,width:960,height:540},{},n,{}),this.type="master",this.masterId=n.masterId,this.elements=e,this.placeholders=r,this.textStyles=n.textStyles,this.background=n.background,this.colorMap=n.colorMap||{},this.mediaMap=n.mediaMap}static fromResult(t,e){const r=(t.placeholders||[]).map(t=>new q(t.id,t.type||"other",t.rect||{x:0,y:0,width:100,height:50},{idx:t.idx,name:t.name})),n=(t.elements||[]).map(r=>V(r,t.relsMap,e)).filter(t=>null!==t);return new Y(t.id,n,r,{masterId:t.masterId,textStyles:t.textStyles,background:t.background,colorMap:t.colorMap,relsMap:t.relsMap,mediaMap:e})}toHTML(){const t=["width: 100%","height: 100%","position: absolute","top: 0","left: 0","pointer-events: none","z-index: 0",this.getBackgroundStyle()].join("; "),e=this.elements.map(t=>t.toHTML()).join("\n"),r=this.placeholders.map(t=>t.toHTML()).join("\n");return`<div class="ppt-master" style="${t}" data-master-id="${this.id}">\n${r}\n${e}\n</div>`}getBackgroundStyle(){if(!this.background)return"background-color: transparent;";if("color"===this.background.type&&this.background.value)return`background-color: ${this.background.value};`;if("image"===this.background.type&&this.background.relId){const t=this.mediaMap?this.mediaMap.get(this.background.relId):this.background.relId;if(t)return`background-image: url('${t}'); background-size: cover;`}return"background-color: transparent;"}getPlaceholderStyle(t){if(!this.textStyles)return null;switch(t){case"title":return this.parseParagraphProperties(this.textStyles.titleParaPr);case"body":return this.parseParagraphProperties(this.textStyles.bodyPr);default:return this.parseParagraphProperties(this.textStyles.otherPr)}}parseParagraphProperties(t){return t?{}:null}}class J extends M{constructor(t,e,r,n,i,s){super(t,"theme",{x:0,y:0,width:0,height:0},{},{},{}),this.type="theme",this.name=e,this.colors=r,this.fonts=i,this.effects=s,this.themeId=n||this.sanitizeThemeName(e)}static fromResult(t,e="theme1"){return new J(`theme_${e}`,e,t.colors,e)}getThemeClassPrefix(){return`theme-${this.themeId}`}getThemeClass(t){return`${this.getThemeClassPrefix()}-${t}`}sanitizeThemeName(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}generateThemeCSS(){const t=this.getThemeClassPrefix(),e=[];e.push(`/* ===== ${this.name} 主题样式 ===== */`),e.push(`.${t} {`),this.colors.bg1&&e.push(`  --${t}-bg1: ${this.colors.bg1};`),this.colors.tx1&&e.push(`  --${t}-tx1: ${this.colors.tx1};`),this.colors.bg2&&e.push(`  --${t}-bg2: ${this.colors.bg2};`),this.colors.tx2&&e.push(`  --${t}-tx2: ${this.colors.tx2};`),this.colors.accent1&&e.push(`  --${t}-accent1: ${this.colors.accent1};`),this.colors.accent2&&e.push(`  --${t}-accent2: ${this.colors.accent2};`),this.colors.accent3&&e.push(`  --${t}-accent3: ${this.colors.accent3};`),this.colors.accent4&&e.push(`  --${t}-accent4: ${this.colors.accent4};`),this.colors.accent5&&e.push(`  --${t}-accent5: ${this.colors.accent5};`),this.colors.accent6&&e.push(`  --${t}-accent6: ${this.colors.accent6};`),this.colors.hlink&&e.push(`  --${t}-hlink: ${this.colors.hlink};`),this.colors.folHlink&&e.push(`  --${t}-fol-hlink: ${this.colors.folHlink};`),e.push("}"),e.push("");return["bg1","tx1","bg2","tx2","accent1","accent2","accent3","accent4","accent5","accent6","hlink","fol-hlink"].forEach(r=>{const n="fol-hlink"===r?"folHlink":r;this.colors[n]&&(e.push(`.${t}-bg-${r} {`),e.push(`  background-color: var(--${t}-${r});`),e.push("}"),e.push(`.${t}-text-${r} {`),e.push(`  color: var(--${t}-${r});`),e.push("}"),e.push(`.${t}-border-${r} {`),e.push(`  border-color: var(--${t}-${r});`),e.push("}"))}),e.push(""),this.fonts&&(e.push(`/* ${this.name} 字体方案 */`),this.fonts.majorFont&&(e.push(`.${t}-font-major {`),this.fonts.majorFont.latin&&e.push(`  font-family: "${this.fonts.majorFont.latin}", sans-serif;`),this.fonts.majorFont.ea&&e.push(`  font-family: "${this.fonts.majorFont.ea}", sans-serif;`),e.push("}")),this.fonts.minorFont&&(e.push(`.${t}-font-minor {`),this.fonts.minorFont.latin&&e.push(`  font-family: "${this.fonts.minorFont.latin}", sans-serif;`),this.fonts.minorFont.ea&&e.push(`  font-family: "${this.fonts.minorFont.ea}", sans-serif;`),e.push("}")),e.push("")),e.push(`/* ${this.name} 预设样式类 */`),e.push(`.${t}-title {`),e.push(`  color: var(--${t}-tx1);`),this.fonts?.majorFont?.latin&&e.push(`  font-family: "${this.fonts.majorFont.latin}", sans-serif;`),e.push("}"),e.push(`.${t}-body {`),e.push(`  color: var(--${t}-tx2);`),this.fonts?.minorFont?.latin&&e.push(`  font-family: "${this.fonts.minorFont.latin}", sans-serif;`),e.push("}"),this.colors.hlink&&(e.push(`.${t}-link {`),e.push(`  color: var(--${t}-hlink);`),e.push("  text-decoration: none;"),e.push("}")),this.colors.folHlink&&(e.push(`.${t}-link:visited {`),e.push(`  color: var(--${t}-fol-hlink);`),e.push("}")),["accent1","accent2","accent3","accent4","accent5","accent6"].forEach((r,n)=>{this.colors[r]&&(e.push(`.${t}-accent-${n+1} {`),e.push(`  color: var(--${t}-${r});`),e.push("}"))}),e.join("\n")}getColor(t){return this.colors[t]}getMajorFont(){return this.fonts?.majorFont?.latin||this.fonts?.majorFont?.ea}getMinorFont(){return this.fonts?.minorFont?.latin||this.fonts?.minorFont?.ea}toHTML(){return""}}class K extends M{constructor(t,e=[],r=[],n=[],i={}){super(t,"tags",{x:0,y:0,width:0,height:0},{},i,{}),this.type="tags",this.tags=e,this.customProperties=r,this.extensions=n,this.slideId=i.slideId}static fromResult(t){return new K(t.id,t.tags,t.customProperties,t.extensions,{slideId:t.slideId})}toHTML(){if(!(this.tags.length>0||this.customProperties.length>0))return"";return`<div class="ppt-tags" style="${["display: none",`data-tags-id="${this.id}"`,`data-slide-id="${this.slideId||""}"`].join("; ")}" ${this.tags.length>0?`data-tags='${JSON.stringify(this.tags)}'`:""} ${this.customProperties.length>0?`data-custom-props='${JSON.stringify(this.customProperties)}'`:""} ${this.extensions.length>0?`data-extensions='${JSON.stringify(this.extensions)}'`:""}>\n</div>`}toHTMLDebug(){const t=["position: absolute","top: 10px","right: 10px","background: rgba(0, 0, 0, 0.8)","color: white","padding: 10px","border-radius: 4px","font-size: 12px","max-width: 300px","z-index: 1000","pointer-events: none"].join("; ");let e=`<strong>Tags (${this.tags.length}):</strong>`;return this.tags.length>0&&(e+="<ul>",this.tags.forEach(t=>{e+=`<li>${t.name}: ${t.value}</li>`}),e+="</ul>"),this.customProperties.length>0&&(e+=`<strong>Properties (${this.customProperties.length}):</strong><ul>`,this.customProperties.forEach(t=>{e+=`<li>${t.name}: ${t.value} (${t.type})</li>`}),e+="</ul>"),`<div class="ppt-tags-debug" style="${t}">\n${e}\n</div>`}getTag(t){return this.tags.find(e=>e.name===t)?.value}getProperty(t){return this.customProperties.find(e=>e.name===t)?.value}setTag(t,e){const r=this.tags.find(e=>e.name===t);r?r.value=e:this.tags.push({name:t,value:e})}setProperty(t,e,r){const n=this.customProperties.find(e=>e.name===t);n?(n.value=e,r&&(n.type=r)):this.customProperties.push({name:t,value:e,type:r})}}class Z extends M{constructor(t,e=[],r=[],n={}){super(t,"notesMaster",{x:0,y:0,width:800,height:600},{},n,{}),this.type="notesMaster",this.elements=e,this.placeholders=r,this.background=n.background,this.mediaMap=n.mediaMap}static fromResult(t,e){const r=(t.elements||[]).map(r=>V(r,t.relsMap,e)).filter(t=>null!==t);return new Z(t.id,r,t.placeholders||[],{background:t.background,relsMap:t.relsMap,mediaMap:e})}toHTML(){const t=this.getBackgroundStyle(),e=[this.getContainerStyle(),t].join("; "),r=this.elements.map(t=>t.toHTML()).join("\n");return`<div class="ppt-notes-master" style="${e}" data-notes-master-id="${this.id}">\n${r}\n</div>`}getBackgroundStyle(){if(!this.background)return"background-color: #ffffff;";if("color"===this.background.type&&this.background.value)return`background-color: ${this.background.value};`;if("image"===this.background.type&&this.background.relId){const t=this.mediaMap?this.mediaMap.get(this.background.relId):this.background.relId;if(t)return`background-image: url('${t}'); background-size: cover;`}return"background-color: #ffffff;"}}class Q extends M{constructor(t,e,r={}){super(t,"notesSlide",e,{},r,{}),this.type="notesSlide",this.text=r.text,this.masterRef=r.masterRef,this.slideId=r.slideId}static fromResult(t){return new Q(t.id,{x:0,y:0,width:800,height:600},{text:t.text,masterRef:t.masterRef,slideId:t.slideId,elements:t.elements,background:t.background,relsMap:t.relsMap})}toHTML(){const t=[this.getContainerStyle(),"background: #fff","padding: 20px","border: 1px solid #ddd","border-radius: 4px"].join("; ");let e="";return this.slideId&&(e+=`<div style="font-weight: bold; margin-bottom: 10px;">幻灯片 ${this.slideId} 备注</div>`),this.text?e+=`<div style="font-size: 14px; line-height: 1.6;">${this.text}</div>`:e+='<div style="color: #999; font-style: italic;">无备注内容</div>',`<div class="ppt-notes-slide" style="${t}" data-notes-id="${this.id}" data-slide-id="${this.slideId||""}">\n${e}\n</div>`}setMaster(t){this.master=t}}class tt extends M{constructor(t,e,r=960,n=540,i={}){super(t,"document",{x:0,y:0,width:r,height:n},{},i,{}),this.type="document",this.title=e,this.width=r,this.height=n,this.ratio=r/n,this.pageSize=i.pageSize||"16:9",this.author=i.author,this.subject=i.subject,this.keywords=i.keywords,this.description=i.description,this.created=i.created,this.modified=i.modified,this.slides=[],this.layouts={},this.masters=[],this.tags=[],this.notesMasters=[],this.notesSlides=[],this.globalRelsMap=i.globalRelsMap||{},this.mediaMap=i.mediaMap,this.theme=void 0}static fromParseResult(t){const e=new tt(t.id,t.title,t.props.width||960,t.props.height||540,{pageSize:t.props.pageSize,author:t.author,subject:t.subject,keywords:t.keywords,description:t.description,created:t.created,modified:t.modified,globalRelsMap:t.globalRelsMap,mediaMap:t.mediaMap});return t.theme&&(e.theme=J.fromResult(t.theme,t.theme.name||"theme1")),t.masterSlides&&t.masterSlides.length>0&&(e.masters=t.masterSlides.map(t=>Y.fromResult(t,e.mediaMap))),t.slideLayouts&&Object.entries(t.slideLayouts).forEach(([t,r])=>{e.layouts[t]=U.fromResult(r,e.mediaMap)}),t.notesMasters&&t.notesMasters.length>0&&(e.notesMasters=t.notesMasters.map(t=>Z.fromResult(t,e.mediaMap))),t.notesSlides&&t.notesSlides.length>0&&(e.notesSlides=t.notesSlides.map(t=>{const r=Q.fromResult(t);if(t.masterRef){const n=e.notesMasters.find(e=>e.id===t.masterRef);n&&r.setMaster(n)}return r})),t.tags&&t.tags.length>0&&(e.tags=t.tags.map(t=>K.fromResult(t))),t.slides&&t.slides.length>0&&(e.slides=t.slides.map(r=>{const n=(r.elements||[]).map(t=>t instanceof M?t:V(t,r.relsMap||{},e.mediaMap)).filter(t=>null!==t);let i,s,o,a;return r.layoutId&&e.layouts[r.layoutId]&&(i=e.layouts[r.layoutId],o=t.slideLayouts?.[r.layoutId]),r.masterRefIndex&&(s=e.masters.find(t=>t.masterId===r.masterRefIndex),a=t.masterSlides?.find(t=>t.masterId===r.masterRefIndex)),new X(r,n,i,s,o,a,e.mediaMap)})),e}toHTML(t={}){return!1!==t.withNavigation?this.toHTMLWithNavigation(t):this.toHTMLDocument(t)}toHTMLDocument(t={}){const e=this.slides.map(t=>t.toHTML()).join("\n\n"),r=!1!==t.includeStyles?this.generateStyles(t):"";return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${this.escapeHtml(this.title)}</title>\n  ${r?"<style>\n"+r+"\n</style>":""}\n</head>\n<body>\n  <div class="ppt-wrapper">\n${e}\n  </div>\n</body>\n</html>`}toHTMLWithNavigation(t={}){const e=this.slides.map((t,e)=>`\n        <div class="ppt-slide-page" data-index="${e}" style="display: ${0===e?"block":"none"};">\n          ${t.toHTML()}\n        </div>\n      `).join("\n"),r=`\n      <div class="ppt-navigation" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; align-items: center; gap: 15px; background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 25px;">\n        <button onclick="prevSlide()" style="padding: 8px 16px; cursor: pointer; background: #fff; border: none; border-radius: 4px; font-size: 14px;">上一页</button>\n        <span id="slideCounter" style="color: #fff; font-size: 14px; min-width: 60px; text-align: center;">1 / ${this.slides.length}</span>\n        <button onclick="nextSlide()" style="padding: 8px 16px; cursor: pointer; background: #fff; border: none; border-radius: 4px; font-size: 14px;">下一页</button>\n      </div>\n    `,n=`\n      <script>\n        let currentSlide = 0;\n        const slides = document.querySelectorAll('.ppt-slide-page');\n\n        function showSlide(index) {\n          slides.forEach((slide, i) => {\n            slide.style.display = i === index ? 'block' : 'none';\n          });\n          document.getElementById('slideCounter').textContent = (index + 1) + ' / ${this.slides.length}';\n          currentSlide = index;\n        }\n\n        function prevSlide() {\n          showSlide(Math.max(0, currentSlide - 1));\n        }\n\n        function nextSlide() {\n          showSlide(Math.min(${this.slides.length} - 1, currentSlide + 1));\n        }\n\n        document.addEventListener('keydown', (e) => {\n          if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') prevSlide();\n          if (e.key === 'ArrowRight' || e.key === 'ArrowDown') nextSlide();\n        });\n\n        // 触摸滑动支持\n        let touchStartX = 0;\n        let touchEndX = 0;\n        document.addEventListener('touchstart', e => {\n          touchStartX = e.changedTouches[0].screenX;\n        });\n        document.addEventListener('touchend', e => {\n          touchEndX = e.changedTouches[0].screenX;\n          if (touchStartX - touchEndX > 50) nextSlide();\n          if (touchEndX - touchStartX > 50) prevSlide();\n        });\n      <\/script>\n    `,i=!1!==t.includeStyles?this.generateStyles(t):this.generateNavigationStyles();return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${this.escapeHtml(this.title)}</title>\n  ${i?"<style>\n"+i+"\n</style>":""}\n</head>\n<body>\n  <div class="ppt-wrapper">\n${e}\n  </div>\n${r}\n${!1!==t.includeScripts?n:""}\n</body>\n</html>`}generateStyles(t){const e=["/* PPTX 文档基础样式 */","* { box-sizing: border-box; margin: 0; padding: 0; }","","body {",'  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;',"  background: #333;","  min-height: 100vh;","}","",".ppt-wrapper {","  display: flex;","  justify-content: center;","  align-items: center;","  min-height: 100vh;","  padding: 20px;","}","",".ppt-container {","  background: #fff;","  box-shadow: 0 2px 8px rgba(0,0,0,0.1);","}","","/* ===== PPTXjs 核心布局类系统 ===== */","","/* 幻灯片容器基础样式 */",".slide {","  position: relative;","  overflow: hidden;","  margin: 0 auto;","  box-sizing: border-box;","}","","/* 占位符基础样式（对应版式占位符） */",".slide div.block {","  position: absolute;","  top: 0;","  left: 0;","  width: 100%;","  line-height: 1;","  box-sizing: border-box;","  display: flex;","  flex-direction: column;","}","","/* 垂直对齐类（映射版式垂直规则） */",".slide div.v-up { justify-content: flex-start; }",".slide div.v-mid { justify-content: center; }",".slide div.v-down { justify-content: flex-end; }","","/* 水平对齐类（映射版式水平规则） */",".slide div.h-left { align-items: flex-start; text-align: left; }",".slide div.h-mid { align-items: center; text-align: center; }",".slide div.h-right { align-items: flex-end; text-align: right; }","","/* 复合对齐类（高频组合） */",".slide div.up-left { justify-content: flex-start; align-items: flex-start; }",".slide div.up-center { justify-content: flex-start; align-items: center; text-align: center; }",".slide div.up-right { justify-content: flex-start; align-items: flex-end; text-align: right; }",".slide div.center-left { justify-content: center; align-items: flex-start; }",".slide div.center-center { justify-content: center; align-items: center; text-align: center; }",".slide div.center-right { justify-content: center; align-items: flex-end; text-align: right; }",".slide div.down-left { justify-content: flex-end; align-items: flex-start; }",".slide div.down-center { justify-content: flex-end; align-items: center; text-align: center; }",".slide div.down-right { justify-content: flex-end; align-items: flex-end; text-align: right; }","","/* 内容容器 */",".content {","  width: 100%;","  height: 100%;","  box-sizing: border-box;","}","","/* 文本样式（全局字体） */",".slide-prgrph {","  font-family: Arial, sans-serif;","  font-size: 14px;","  color: #333333;","  line-height: 1.4;","}","","/* ===== 原有样式 ===== */","","/* 幻灯片样式 */",".ppt-slide {","  position: relative;","  margin: 20px auto;","  border: 1px solid #ddd;","  background: #fff;","}","",".ppt-slide-page {",`  width: ${this.width}px;`,`  height: ${this.height}px;`,"  background: #fff;","  box-shadow: 0 4px 20px rgba(0,0,0,0.3);","}","","/* 布局和母版元素 */",".ppt-master-element,",".ppt-layout-element {","  pointer-events: none;","}","","/* 元素通用样式 */",".ppt-element {","  position: absolute;","}","","/* 文本元素 */",".ppt-text {","  overflow: hidden;","}","","/* 占位符样式 */",".ppt-placeholder {","  pointer-events: none;","  user-select: none;","}",""];return this.theme&&(e.push("/* ===== 主题样式 ===== */"),e.push(this.theme.generateThemeCSS()),e.push("")),t.customCss&&(e.push("/* 自定义样式 */"),e.push(t.customCss)),e.join("\n")}generateNavigationStyles(){return`* { margin: 0; padding: 0; box-sizing: border-box; }\nbody {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 100vh;\n  background: #333;\n}\n.ppt-wrapper {\n  width: ${this.width}px;\n  height: ${this.height}px;\n  background: #fff;\n  box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n}`}getSlide(t){return this.slides[t]}getLayout(t){return this.layouts[t]}getMaster(t){return this.masters.find(e=>e.id===t)}escapeHtml(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,t=>e[t])}}function et(t){return tt.fromParseResult(t)}function rt(t,e){const n=t.tagName;if("p:sp"===n||"sp"===n)return N.fromNode(t,e);if("p:pic"===n||"pic"===n)return D.fromNode(t,e);if("p:graphicFrame"===n||"graphicFrame"===n){const n=f(t,"graphic",r.a),i=n?f(n,"graphicData",r.a):null;if(!i)return null;const s=i.getAttribute("uri")||"";return s.includes("oleObject")?E.fromNode(t,e):s.includes("chart")?j.fromNode(t,e):s.includes("diagram")?L.fromNode(t,e):s.includes("table")?B.fromNode(t,e):null}return"p:grpSp"===n||"grpSp"===n?R.fromNode(t,e):null}async function nt(t,e,r=a){try{const n=`${r}${e}.xml.rels`,i=await(t.file(n)?.async("string"));return i?x(i,"_rels/.rels"):{}}catch(t){return I("warn",`Failed to parse ${r}${e} relationships`,t),{}}}function it(t,e={},n=0){try{const i=new DOMParser,s=i.parseFromString(t,"application/xml").documentElement;if("p:sld"!==s.tagName&&!s.tagName.includes("sld"))return I("warn","Invalid slide XML root element",s.tagName),at(n);const o=st(s,e),a=function(t,e){const n=f(t,"cSld",r.p);if(!n)return`幻灯片 ${e+1}`;const i=f(n,"spTree",r.p);if(!i)return`幻灯片 ${e+1}`;const s=u(i,"sp",r.p);for(const t of s){const e=f(t,"nvSpPr",r.p);if(!e)continue;const n=f(e,"nvPr",r.p);if(!n)continue;const i=f(n,"ph",r.p);if(!i)continue;const s=i.getAttribute("type");if("title"===s||"ctrTitle"===s){const e=f(t,"txBody",r.p);if(!e)continue;const n=ot(e);if(n&&n.trim())return n.trim()}}return`幻灯片 ${e+1}`}(s,n),l=function(t,e){const n=[],i=f(t,"cSld",r.p);if(!i)return I("warn","cSld element not found"),n;const s=f(i,"spTree",r.p);if(!s)return I("warn","spTree element not found"),n;return I("info","Processing spTree children..."),Array.from(s.children).forEach((t,i)=>{if(1!==t.nodeType)return;const s=t.tagName,o=t.localName||s.split(":").pop()||s;I("info",`Processing element ${i}: tagName=${s}, localName=${o}`);let a=null;"sp"===o?a=N.fromNode(t,e):"pic"===o?a=D.fromNode(t,e):"graphicFrame"===o?a=function(t,e){try{const n=f(t,"graphic",r.a),i=n?f(n,"graphicData",r.a):null;if(!i)return I("warn","graphicData not found in graphicFrame"),null;const s=i.getAttribute("uri")||"";return s.includes("oleObject")?E.fromNode(t,e):s.includes("chart")?j.fromNode(t,e):s.includes("diagram")?L.fromNode(t,e):s.includes("table")?B.fromNode(t,e):(I("info",`Unknown graphicFrame type: ${s}`),null)}catch(t){return I("error","Failed to parse graphicFrame element",t),null}}(t,e):"grpSp"===o?a=R.fromNode(t,e):I("info",`Skipping unknown element type: tagName=${s}, localName=${o}`),a&&n.push(a)}),I("info",`Total elements parsed: ${n.length}`),n}(s,e);return I("info",`Parsed slide ${n+1}: ${l.length} elements`),{id:P("slide"),title:a,background:o,elements:l.map(t=>t),relsMap:e}}catch(t){return I("error",`Failed to parse slide ${n}`,t),at(n)}}function st(t,e={}){const n=f(t,"bg",r.p);if(!n)return{type:"color",value:"#ffffff"};const i=f(n,"bgRef",r.p);if(i)return function(t){t.getAttribute("idx");const e=f(t,"schemeClr",r.a);if(e){const t=e.getAttribute("val");if(t)return{type:"color",value:t,schemeRef:t}}return{type:"color",value:"#ffffff"}}(i);const s=f(n,"bgPr",r.p);if(s){const t=f(s,"blipFill",r.a);if(t){const n=f(t,"blip",r.a);if(n){const t=n.getAttribute("r:embed")||n.getAttributeNS(r.r,"embed");if(t&&e[t])return{type:"image",value:e[t].target,relId:t}}}const n=f(s,"solidFill",r.a);if(n){const t=f(n,"srgbClr",r.a);if(t?.getAttribute("val"))return{type:"color",value:`#${t.getAttribute("val")}`};const e=f(n,"schemeClr",r.a);if(e){const t=e.getAttribute("val");if(t)return{type:"color",value:t||"#ffffff",schemeRef:t||void 0}}}if(f(s,"gradFill",r.a))return{type:"color",value:"#ffffff"}}return{type:"color",value:"#ffffff"}}function ot(t){const e=Array.from(t.children).filter(t=>"a:p"===t.tagName||t.tagName.includes(":p")),r=[];for(const t of e){const e=Array.from(t.children).filter(t=>"a:r"===t.tagName||t.tagName.includes(":r"));for(const t of e){const e=f(t,"t","http://schemas.openxmlformats.org/drawingml/2006/main");e?.textContent&&r.push(e.textContent)}}return r.join("")}function at(t){return{id:P("slide"),title:`幻灯片 ${t+1}`,background:"#ffffff",elements:[],relsMap:{}}}async function lt(t,e,r,n){if(e.background&&"string"!=typeof e.background){const i=e.background;if("image"===i.type&&i.relId){const e=await ct(t,i.relId,r,n);e&&(i.value=e)}}let i=0;for(const s of e.elements)if("image"===s.type){i++;const o=s,a=o.relId;if(a){I("info",`Found image element in ${e.id}: relId=${a}, src=${o.src}`);const i=await ct(t,a,r,n);i?(o.src=i,I("info",`Updated image src to base64 URL, length=${i.length}`)):I("warn",`Failed to resolve image relId=${a} in ${e.id}`)}else I("warn",`Image element missing relId in ${e.id}`)}i>0&&I("info",`Found ${i} image elements in ${e.id}`)}async function ct(t,e,r,n){if(n.has(e))return I("info",`Cache hit for relId=${e}`),n.get(e);const i=r[e];if(!i)return I("warn",`No relationship found for relId=${e} in relsMap`),null;I("info",`Resolving image relId=${e}, target=${i.target}`);const s=await async function(t,e){I("info",`findImageFileInZip: targetPath=${e}`);let r=await t.file(e);if(r)return{file:r,path:e};if(e.startsWith("..")){const n=`ppt/${e.substring(3)}`;if(r=await t.file(n),r)return{file:r,path:n}}if(e.includes("media/")&&!e.startsWith("ppt/")){const n=`ppt/${e}`;if(r=await t.file(n),r)return{file:r,path:n}}if(e.startsWith("media/")){const n=`ppt/${e}`;if(r=await t.file(n),r)return{file:r,path:n}}const n=["ppt/slideLayouts/","ppt/slideMasters/","ppt/slides/","ppt/notesMasters/","ppt/notesSlides/","ppt/",""];for(const i of n){const n=i+e;if(r=await t.file(n),r)return{file:r,path:n}}const i=[];t.forEach((t,e)=>{i.push({name:t,file:e})});const s=e.split("/").pop()||"";if(s){const t=s.toLowerCase();for(const{name:e,file:r}of i)if((e.split("/").pop()||"").toLowerCase()===t&&e.includes("media/"))return{file:r,path:e};for(const{name:e,file:r}of i)if((e.split("/").pop()||"").toLowerCase()===t)return{file:r,path:e}}const o=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp"];for(const{name:t,file:e}of i){const r=t.toLowerCase();for(const n of o)if(r.endsWith(n)&&(r.includes("image")||r.includes("img")))return{file:e,path:t}}I("info",`Could not find image file for target: ${e}`),I("info",`Available files in ZIP (${i.length} total):`);const a=i.filter(({name:t})=>t.includes("media/"));return a.length>0&&(I("info",`Media files (${a.length}):`),a.slice(0,20).forEach(({name:t})=>{I("info",`  - ${t}`)}),a.length>20&&I("info",`  ... and ${a.length-20} more`)),null}(t,i.target);if(!s)return I("warn",`Image file not found in zip after exhaustive search. Original target: ${i.target}`),null;const{file:o,path:a}=s;I("info",`Found image file at: ${a}`);const l=await o.async("base64"),c=function(t){const e=t.split(".").pop()?.toLowerCase();switch(e){case"png":return"image/png";case"jpg":case"jpeg":default:return"image/jpeg";case"gif":return"image/gif";case"bmp":return"image/bmp";case"svg":return"image/svg+xml";case"webp":return"image/webp"}}(a),d=`data:${c};base64,${l}`;return I("info",`Converted image to base64 URL, mimeType=${c}, length=${d.length}`),n.set(e,d),d}async function dt(t,e="ppt/theme/theme1.xml"){try{const r=await(t.file(e)?.async("string"));if(!r)return I("warn",`Theme file not found: ${e}`),null;const n=new DOMParser,i=n.parseFromString(r,"application/xml").documentElement,s=i.getAttribute("name")||e.split("/").pop()?.replace(".xml","")||"theme1",o=function(t){const e={},r=f(t,"themeElements","http://schemas.openxmlformats.org/drawingml/2006/main");if(!r)return e;const n=f(r,"clrScheme","http://schemas.openxmlformats.org/drawingml/2006/main");if(!n)return e;const i={bg1:"bg1",tx1:"tx1",bg2:"bg2",tx2:"tx2",accent1:"accent1",accent2:"accent2",accent3:"accent3",accent4:"accent4",accent5:"accent5",accent6:"accent6",hlink:"hlink",folHlink:"folHlink"};return Array.from(n.children).forEach(t=>{if(1!==t.nodeType)return;const r=t.localName||t.tagName.split(":").pop();r&&i[r]&&(e[i[r]]=function(t){const e=f(t,"srgbClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(e){const t=e.getAttribute("val");if(t)return`#${t}`}const r=f(t,"sysClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(r){const t=r.getAttribute("lastClr");if(t)return`#${t}`}return"#ffffff"}(t))}),e}(i);return I("info",`Parsed theme from ${e}: ${s}`),{colors:o,name:s}}catch(t){return I("error",`Failed to parse theme: ${e}`,t),null}}function pt(t,e,r={}){if(r[t]){const n=function(t){return{light:"lt1",dark:"dk1"}[t]||t}(r[t]);return e[n]||"#ffffff"}return e[t]||"#ffffff"}function ht(t,e,n){try{const i=new DOMParser,s=i.parseFromString(t,"application/xml").documentElement,o=function(t,e){const r=f(t,"bg","http://schemas.openxmlformats.org/presentationml/2006/main");if(!r)return{type:"color",value:"#ffffff"};const n=f(r,"bgRef","http://schemas.openxmlformats.org/presentationml/2006/main");if(n){n.getAttribute("idx");const t=f(n,"schemeClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(t){const e=t.getAttribute("val");if(e)return{type:"color",value:e,schemeRef:e}}}const i=f(r,"bgPr","http://schemas.openxmlformats.org/presentationml/2006/main");if(i){const t=f(i,"blipFill","http://schemas.openxmlformats.org/drawingml/2006/main");if(t){const r=f(t,"blip","http://schemas.openxmlformats.org/drawingml/2006/main");if(r){const t=r.getAttribute("r:embed")||r.getAttributeNS("http://schemas.openxmlformats.org/officeDocument/2006/relationships","embed");if(t&&e[t])return{type:"image",value:e[t].target,relId:t}}}const r=f(i,"solidFill","http://schemas.openxmlformats.org/drawingml/2006/main");if(r){const t=f(r,"srgbClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(t?.getAttribute("val"))return{type:"color",value:`#${t.getAttribute("val")}`};const e=f(r,"schemeClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(e){const t=e.getAttribute("val");if(t)return{type:"color",value:t||"#ffffff",schemeRef:t||void 0}}}}return{type:"color",value:"#ffffff"}}(s,e),a=function(t){const e=f(t,"clrMapOvr","http://schemas.openxmlformats.org/presentationml/2006/main"),r={};if(!e)return r;const n=f(e,"masterClrMapping","http://schemas.openxmlformats.org/drawingml/2006/main");n&&Array.from(n.attributes).forEach(t=>{r[t.name]=t.value});return r}(s),l=function(t){const e=f(t,"txStyles","http://schemas.openxmlformats.org/presentationml/2006/main");if(!e)return{};return{titleParaPr:f(e,"titleP","http://schemas.openxmlformats.org/presentationml/2006/main"),bodyPr:f(e,"body","http://schemas.openxmlformats.org/presentationml/2006/main"),otherPr:f(e,"other","http://schemas.openxmlformats.org/presentationml/2006/main")}}(s),c=function(t,e){const n=[],i=f(t,"cSld","http://schemas.openxmlformats.org/presentationml/2006/main");if(!i)return n;const s=f(i,"spTree","http://schemas.openxmlformats.org/presentationml/2006/main");return s?(Array.from(s.children).forEach(t=>{if(1!==t.nodeType)return;const i=t.localName||t.tagName.split(":").pop();if("sp"===i){const i=f(t,"nvSpPr",r.p),s=i?f(i,"nvPr",r.p):null,o=s?f(s,"ph",r.p):null;if(o){const e=o.getAttribute("type");if(["sldNum","ftr","dt"].includes(e||"")){const e=function(t){const e=f(t,"nvSpPr",r.p);if(!e)return null;const n=f(e,"cNvPr",r.p),i=n?.getAttribute("id"),s=n?.getAttribute("name"),o=f(e,"nvPr",r.p);if(!o)return null;const a=f(o,"ph",r.p);if(!a)return null;const l=a.getAttribute("type"),c=f(t,"spPr",r.a),d=f(c,"xfrm",r.a);let p={x:0,y:0,width:0,height:0};if(d){const t=f(d,"off",r.a),e=f(d,"ext",r.a);t&&(p.x=parseInt(t.getAttribute("x")||"0"),p.y=parseInt(t.getAttribute("y")||"0")),e&&(p.width=parseInt(e.getAttribute("cx")||"0"),p.height=parseInt(e.getAttribute("cy")||"0"))}return{id:i,name:s,type:"shape",placeholder:l,rect:p}}(t);e&&n.push(e)}}else{const r=N.fromNode(t,e);r&&n.push(r)}}else if("pic"===i){const r=D.fromNode(t,e);r&&n.push(r)}else if("grpSp"===i){const r=R.fromNode(t,e);r&&n.push(r)}else if("graphicFrame"===i){const i=function(t,e){try{const n=f(t,"graphic",r.a),i=n?f(n,"graphicData",r.a):null;if(!i)return null;const s=i.getAttribute("uri")||"";return s.includes("table")?B.fromNode(t,e):s.includes("chart")?j.fromNode(t,e):s.includes("diagram")?L.fromNode(t,e):null}catch(t){return I("warn","Failed to parse master graphicFrame element",t),null}}(t,e);i&&n.push(i)}}),n):n}(s,e),d=c.filter(t=>t.placeholder);let p;for(const t of Object.values(e))if(t.type.includes("theme")){const e=t.target.match(/theme(\d+)\.xml/);e&&(p=`theme${e[1]}`,I("info",`Master references theme: ${p}`))}return{id:`master-${n}`,masterId:`slideMaster${n}`,background:o,elements:c,placeholders:d,colorMap:a,textStyles:l,themeRef:p,relsMap:e}}catch(t){return I("error",`Failed to parse master slide ${n}`,t),{id:`master-${n}`,masterId:`slideMaster${n}`,elements:[],colorMap:{}}}}const ut={slideLayouts:c,slideLayoutsRels:"ppt/slideLayouts/_rels/"};function ft(t,e={}){try{const n=new DOMParser,i=n.parseFromString(t,"application/xml").documentElement;if("p:sldLayout"!==i.tagName&&!i.tagName.includes("sldLayout"))return I("warn","Invalid layout XML root element",i.tagName),null;const s=f(i,"cSld",r.p),o=s?.getAttribute("name")||void 0,a=st(i,e),l=f(i,"clrMapOvr",r.p),c=f(l,"masterClrMapping",r.a);let d={};if(c){Array.from(c.attributes).forEach(t=>{"xmlns:a"!==t.name&&(d[t.name]=t.value)})}const p=function(t){const e=f(t,"txStyles",r.p);if(!e)return{};return{titleParaPr:f(e,"titleP",r.p),bodyPr:f(e,"body",r.p),otherPr:f(e,"other",r.p)}}(i),h=function(t,e){const n=[],i=f(t,"cSld",r.p);if(!i)return n;const s=f(i,"spTree",r.p);return s?(Array.from(s.children).forEach(t=>{if(1!==t.nodeType)return;const i=t.localName||t.tagName.split(":").pop();if("sp"===i){const i=f(t,"nvPr",r.p);if(!(i?f(i,"ph",r.p):null)){const r=N.fromNode(t,e);r&&n.push(r)}}else if("pic"===i){const r=D.fromNode(t,e);r&&n.push(r)}else if("grpSp"===i){const r=R.fromNode(t,e);r&&n.push(r)}else if("graphicFrame"===i){const i=function(t,e){try{const n=f(t,"graphic",r.a),i=n?f(n,"graphicData",r.a):null;if(!i)return null;const s=i.getAttribute("uri")||"";return s.includes("table")?B.fromNode(t,e):s.includes("chart")?j.fromNode(t,e):s.includes("diagram")?L.fromNode(t,e):null}catch(t){return I("warn","Failed to parse layout graphicFrame element",t),null}}(t,e);i&&n.push(i)}}),n):n}(i,e),u=function(t){const e=[],n=f(t,"cSld",r.p);if(!n)return e;const i=f(n,"spTree",r.p);return i?(Array.from(i.children).forEach(t=>{if(1!==t.nodeType)return;if("sp"===(t.localName||t.tagName.split(":").pop())){const n=function(t){const e=f(t,"nvSpPr",r.p);if(!e)return null;const n=f(e,"cNvPr",r.p),i=n?.getAttribute("id")||"",s=n?.getAttribute("name")||"",o=f(e,"nvPr",r.p);if(!o)return null;const a=f(o,"ph",r.p);if(!a)return null;const l=a.getAttribute("type"),c={title:"title",ctrTitle:"title",body:"body",dt:"dateTime",sldNum:"slideNumber",ftr:"footer"}[l||""]||"other",d=a.getAttribute("idx"),p=f(t,"spPr",r.p),h=f(p,"xfrm",r.a);let u={x:0,y:0,width:0,height:0};if(h){const t=f(h,"off",r.a),e=f(h,"ext",r.a);t&&(u.x=parseInt(t.getAttribute("x")||"0"),u.y=parseInt(t.getAttribute("y")||"0")),e&&(u.width=parseInt(e.getAttribute("cx")||"0"),u.height=parseInt(e.getAttribute("cy")||"0"))}const g=f(t,"txBody",r.p);let m,y;if(g){const t=f(g,"bodyPr",r.a);if(t){const e=t.getAttribute("algn"),r=t.getAttribute("anchor");"l"===e?m="left":"ctr"===e?m="center":"r"===e&&(m="right"),"t"===r?y="top":"ctr"===r?y="middle":"b"===r&&(y="bottom")}}return{id:i,type:c,name:s,rect:u,hAlign:m,vAlign:y,idx:d?parseInt(d):void 0,rawNode:t}}(t);n&&e.push(n)}}),e):e}(i);let g;for(const t of Object.values(e))if(t.type.includes("slideMaster")){const e=t.target.match(/slideMaster(\d+)\.xml/);e&&(g=`slideMaster${e[1]}`,I("info",`Layout references master file: ${g}`))}return{id:P("layout"),name:o,background:a,elements:h,placeholders:u,relsMap:e,colorMap:d,textStyles:p,masterRef:g}}catch(t){return I("error","Failed to parse slide layout",t),null}}async function gt(t,e,n){try{const i=new DOMParser,s=i.parseFromString(n,"application/xml").documentElement,o=yt(s),a=xt(s),l=function(t){const e=[],n=f(t,"cSld",r.p);if(!n)return e;const i=f(n,"spTree",r.p);if(!i)return e;const s=Array.from(i.children).filter(t=>"p:sp"===t.tagName||t.tagName.includes(":sp"));for(const t of s){const n=f(t,"nvSpPr",r.p);if(!n)continue;const i=f(n,"nvPr",r.p);if(!i)continue;const s=f(i,"ph",r.p);if(!s)continue;const o=f(n,"cNvPr",r.p),a=g(o,"id",`placeholder_${Date.now()}`),l=g(o,"name",""),c=s.getAttribute("type")||"other",p=f(t,"spPr",r.p),h=p?f(p,"xfrm",r.a):null;let u={x:0,y:0,width:0,height:0};if(h){const t=f(h,"off",r.a),e=f(h,"ext",r.a);t&&(u.x=d(t.getAttribute("x")||"0"),u.y=d(t.getAttribute("y")||"0")),e&&(u.width=d(e.getAttribute("cx")||"0"),u.height=d(e.getAttribute("cy")||"0"))}e.push({id:a,type:c,name:l,rect:u})}return e}(s),c=e.match(/notesMaster(\d+)\.xml/)?.[1]||"1",p=await async function(t,e){try{const r=`ppt/notesMasters/_rels/${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?$t(n):(I("warn",`Notes master rels not found: ${r}`),{})}catch(t){return I("warn",`Failed to parse notes master rels for ${e}`,t),{}}}(t,`notesMaster${c}`);return I("info",`Parsed notes master: ${c}`),{id:`notesMaster_${c}`,elements:a,background:o,placeholders:l,relsMap:p}}catch(t){throw I("error",`Failed to parse notes master: ${e}`,t),t}}async function mt(t,e,n){try{const i=new DOMParser,s=i.parseFromString(n,"application/xml").documentElement,o=yt(s),a=function(t){const e=f(t,"cSld",r.p);if(!e)return"";const n=f(e,"spTree",r.p);if(!n)return"";const i=Array.from(n.children).filter(t=>"p:sp"===t.tagName||t.tagName.includes(":sp"));for(const t of i){const e=f(t,"nvSpPr",r.p);if(!e)continue;const n=f(e,"nvPr",r.p);if(!n)continue;const i=f(n,"ph",r.p);if("body"===i?.getAttribute("type")){const e=f(t,"txBody",r.p);if(!e)continue;const n=bt(e);if(n&&n.trim())return n.trim()}}return""}(s),l=xt(s),c=e.match(/notesSlide(\d+)\.xml/)?.[1]||"1",d=await async function(t,e){try{const r=`ppt/notesSlides/_rels/${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?$t(n):(I("warn",`Notes slide rels not found: ${r}`),{})}catch(t){return I("warn",`Failed to parse notes slide rels for ${e}`,t),{}}}(t,`notesSlide${c}`),p=d.rId1?.target||"";return I("info",`Parsed notes slide: ${c}`),{id:`notesSlide_${c}`,slideId:`slide${c}`,text:a,elements:l,background:o,relsMap:d,masterRef:p}}catch(t){throw I("error",`Failed to parse notes slide: ${e}`,t),t}}function yt(t){const e=f(t,"bg",r.p);if(!e)return{type:"color",value:"#ffffff"};const n=f(e,"bgPr",r.p);if(n){const t=f(n,"solidFill",r.a);if(t){const e=f(t,"srgbClr",r.a);if(e?.getAttribute("val"))return{type:"color",value:`#${e.getAttribute("val")}`}}}return{type:"color",value:"#ffffff"}}function bt(t){const e=Array.from(t.children).filter(t=>"a:p"===t.tagName||t.tagName.includes(":p")),r=[];for(const t of e){const e=Array.from(t.children).filter(t=>"a:r"===t.tagName||t.tagName.includes(":r"));for(const t of e){const e=f(t,"t","http://schemas.openxmlformats.org/drawingml/2006/main");e?.textContent&&r.push(e.textContent)}}return r.join("\n")}function xt(t){const e=[],n=f(t,"cSld",r.p);if(!n)return e;const i=f(n,"spTree",r.p);return i?(Array.from(i.children).forEach((t,n)=>{if(1!==t.nodeType)return;const i=t.tagName;i.includes("sp")?e.push(function(t){const e=f(t,"cNvPr",r.p),n=g(e,"id",`shape_${Date.now()}`),i=g(e,"name",""),s=f(t,"spPr",r.p),o=s?f(s,"xfrm",r.a):null;let a={x:0,y:0,width:0,height:0};if(o){const t=f(o,"off",r.a),e=f(o,"ext",r.a);t&&(a.x=d(t.getAttribute("x")||"0"),a.y=d(t.getAttribute("y")||"0")),e&&(a.width=d(e.getAttribute("cx")||"0"),a.height=d(e.getAttribute("cy")||"0"))}return{id:n,name:i,type:"shape",rect:a,content:{}}}(t)):i.includes("pic")&&e.push(function(t){const e=f(t,"cNvPr",r.p),n=g(e,"id",`image_${Date.now()}`),i=g(e,"name",""),s=f(t,"spPr",r.p),o=s?f(s,"xfrm",r.a):null;let a={x:0,y:0,width:0,height:0};if(o){const t=f(o,"off",r.a),e=f(o,"ext",r.a);t&&(a.x=d(t.getAttribute("x")||"0"),a.y=d(t.getAttribute("y")||"0")),e&&(a.width=d(e.getAttribute("cx")||"0"),a.height=d(e.getAttribute("cy")||"0"))}return{id:n,name:i,type:"image",rect:a,content:{}}}(t))}),e):e}function $t(t){const e={};try{const r=new DOMParser,n=r.parseFromString(t,"application/xml").documentElement,i=Array.from(n.children).filter(t=>"Relationship"===t.tagName||t.tagName.includes(":Relationship"));for(const t of i){const r=t.getAttribute("Id")||"",n=t.getAttribute("Type")||"",i=t.getAttribute("Target")||"";r&&(e[r.replace("rId","")]={id:r,type:n,target:i})}}catch(t){I("warn","Failed to parse relationships XML",t)}return e}function wt(t,e,n){try{const i=new DOMParser,s=i.parseFromString(t,"application/xml").documentElement,o=function(t){const e=f(t,"plotArea",r.c);if(!e)return"unknown";const n=Array.from(e.children);for(const t of n){const e=t.tagName;if(e.includes("lineChart"))return"lineChart";if(e.includes("barChart"))return"barChart";if(e.includes("pieChart"))return e.includes("3D")?"pie3DChart":"pieChart";if(e.includes("areaChart"))return"areaChart";if(e.includes("scatterChart"))return"scatterChart"}return"unknown"}(s),a=function(t){const e=f(t,"title",r.c);if(!e)return;const n=f(e,"tx",r.c);if(!n)return;f(n,"strRef",r.c);const i=f(n,"strCache",r.c);if(i){const t=f(i,"pt",r.c);if(t?.textContent)return t.textContent.trim()}const s=f(n,"rich",r.c);if(s){const t=f(s,"p",r.a);if(t){const e=kt(t);if(e)return e}}return}(s),l=function(t){const e=[],n=f(t,"plotArea",r.c);if(!n)return e;const i=vt(n);if(!i)return e;const s=Array.from(i.children).filter(t=>t.tagName.includes(":ser")||"ser"===t.localName);for(const t of s){const r=parseInt(g(t,"idx","0"),10),n=parseInt(g(t,"order","0"),10),i=St(t),s=At(t);e.push({name:i,idx:r,order:n,points:s})}return e}(s),c=function(t){const e=[],n=f(t,"plotArea",r.c);if(!n)return e;const i=f(n,"catAx",r.c);if(!i)return e;const s=f(i,"tx",r.c);if(!s)return e;f(s,"strRef",r.c);const o=f(s,"strCache",r.c);if(o){const t=Array.from(o.children).filter(t=>t.tagName.includes(":pt")||"pt"===t.localName);for(const n of t){const t=f(n,"v",r.c);t?.textContent&&e.push(t.textContent.trim())}}return e}(s),d=Ft(s,"x"),p=Ft(s,"y"),h=function(t){const e=f(t,"legend",r.c);if(!e)return!1;return"1"!==e.getAttribute("deleted")}(s),u=function(t){const e=f(t,"plotArea",r.c);if(!e)return!1;const n=vt(e);if(!n)return!1;const i=f(n,"dLbls",r.c);if(!i)return!1;return"1"!==i.getAttribute("deleted")}(s);return I("info",`Parsed chart ${e}: type=${o}, series=${l.length}`),{id:`chart_${e}`,chartType:o,title:a,series:l,categories:c,xTitle:d,yTitle:p,showLegend:h,showDataLabels:u,relsMap:n}}catch(t){return I("error",`Failed to parse chart ${e}`,t),{id:`chart_${e}`,chartType:"unknown",relsMap:n}}}function vt(t){const e=Array.from(t.children);for(const t of e){const e=t.tagName;if(e.includes("lineChart")||e.includes("barChart")||e.includes("pieChart")||e.includes("areaChart")||e.includes("scatterChart"))return t}return null}function St(t){const e=f(t,"tx",r.c);if(!e)return;f(e,"strRef",r.c);const n=f(e,"strCache",r.c);if(n){const t=f(n,"pt",r.c);if(t?.textContent)return t.textContent.trim()}const i=f(e,"v",r.c);return i?.textContent?i.textContent.trim():void 0}function At(t){const e=[];f(t,"val",r.c);const n=f(t,"numCache",r.c);if(n){const t=Array.from(n.children).filter(t=>t.tagName.includes(":pt")||"pt"===t.localName);for(const n of t){const t=parseInt(g(n,"idx","0"),10),i=f(n,"v",r.c),s=i?.textContent?parseFloat(i.textContent):void 0;e.push({idx:t,value:s})}}return e}function Ft(t,e){const n=f(t,"plotArea",r.c);if(!n)return;const i=f(n,"x"===e?"catAx":"valAx",r.c);if(!i)return;const s=f(i,"title",r.c);if(!s)return;const o=f(s,"tx",r.c);if(!o)return;const a=f(o,"rich",r.c);if(a){const t=f(a,"p",r.a);if(t){const e=kt(t);if(e)return e}}}function kt(t){const e=Array.from(t.children).filter(t=>t.tagName.includes(":r")||"r"===t.localName),n=[];for(const t of e){const e=f(t,"t",r.a);e?.textContent&&n.push(e.textContent)}return n.length>0?n.join(""):void 0}function Tt(t,e,n){try{const i=new DOMParser,s=i.parseFromString(t,"application/xml").documentElement,o=s.getAttribute("type")||"unknown",a=s.getAttribute("layout")||"",l=function(t){const e=[],n=f(t,"spTree",r.d);if(!n)return e;const i=Array.from(n.children).filter(t=>t.tagName.includes(":sp")||"sp"===t.localName);for(const t of i){const n=g(t,"id",`shape_${Date.now()}`),i=t.getAttribute("type")||"shape",s=f(t,"xfrm",r.a);let o,a;if(s){const t=f(s,"off",r.a),e=f(s,"ext",r.a);if(t){const e=parseInt(t.getAttribute("x")||"0"),r=parseInt(t.getAttribute("y")||"0");o={x:d(e),y:d(r)}}if(e){const t=parseInt(e.getAttribute("cx")||"0"),r=parseInt(e.getAttribute("cy")||"0");a={width:d(t),height:d(r)}}}const l=Ct(t);e.push({id:n,type:i,position:o,size:a,text:l})}return e}(s);return I("info",`Parsed diagram ${e}: type=${o}, shapes=${l.length}`),{id:`diagram_${e}`,diagramType:o,layout:a,shapes:l,relsMap:n}}catch(t){return I("error",`Failed to parse diagram ${e}`,t),{id:`diagram_${e}`,relsMap:n}}}function Ct(t){const e=f(t,"txBody",r.d);if(!e)return;const n=f(e,"p",r.a);if(!n)return;return kt(n)}async function Pt(t,e){try{const r=`ppt/charts/_rels/${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?Mt(n):(I("warn",`Chart rels not found: ${r}`),{})}catch(t){return I("warn",`Failed to parse chart rels for ${e}`,t),{}}}async function It(t,e){try{const r=`ppt/diagrams/_rels/data${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?Mt(n):(I("warn",`Diagram rels not found: ${r}`),{})}catch(t){return I("warn",`Failed to parse diagram rels for ${e}`,t),{}}}function Mt(t){const e={};try{const r=new DOMParser,n=r.parseFromString(t,"application/xml").documentElement,i=Array.from(n.children).filter(t=>"Relationship"===t.tagName||t.tagName.includes(":Relationship"));for(const t of i){const r=t.getAttribute("Id")||"",n=t.getAttribute("Type")||"",i=t.getAttribute("Target")||"";r&&(e[r.replace("rId","")]={id:r,type:n,target:i})}}catch(t){I("warn","Failed to parse relationships XML",t)}return e}async function Nt(t,e){try{const n=`ppt/slides/${e}.xml`,i=await(t.file(n)?.async("string"));if(!i)return I("warn",`Slide not found: ${n}`),Dt(e);const s=await async function(t,e){try{const r=`ppt/slides/_rels/${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?function(t){const e={};try{const r=new DOMParser,n=r.parseFromString(t,"application/xml").documentElement,i=Array.from(n.children).filter(t=>"Relationship"===t.tagName||t.tagName.includes(":Relationship"));for(const t of i){const r=t.getAttribute("Id")||"",n=t.getAttribute("Type")||"",i=t.getAttribute("Target")||"";r&&(e[r.replace("rId","")]={id:r,type:n,target:i})}}catch(t){I("warn","Failed to parse relationships XML",t)}return e}(n):(I("warn",`Slide rels not found: ${r}`),{})}catch(t){return I("warn",`Failed to parse slide rels for ${e}`,t),{}}}(t,e),o=function(t){const e=[];try{const n=(new DOMParser).parseFromString(t,"application/xml"),i=f(n.documentElement,"extLst",r.p);if(!i)return e;const s=Array.from(i.children).filter(t=>"p:ext"===t.tagName||t.tagName.includes(":ext"));for(const t of s){const r=t.getAttribute("uri")||"";if(r.includes("tags")||r.includes("ppt/tags")){const r=Array.from(t.children).filter(t=>"p:tag"===t.tagName||t.tagName.includes(":tag"));for(const t of r){const r=g(t,"name",""),n=g(t,"val","");r&&e.push({name:r,value:n})}}}}catch(t){I("warn","Failed to parse tags",t)}return e}(i),a=function(t){const e=[];try{const n=(new DOMParser).parseFromString(t,"application/xml"),i=f(n.documentElement,"extLst",r.p);if(!i)return e;const s=Array.from(i.children).filter(t=>"p:ext"===t.tagName||t.tagName.includes(":ext"));for(const t of s){const r=t.getAttribute("uri")||"",n=Et(Array.from(t.children));e.push({uri:r,data:n})}}catch(t){I("warn","Failed to parse extensions",t)}return e}(i),l=function(t){const e=[];try{const n=(new DOMParser).parseFromString(t,"application/xml"),i=f(n.documentElement,"extLst",r.p);if(!i)return e;const s=Array.from(i.children).filter(t=>"p:ext"===t.tagName||t.tagName.includes(":ext"));for(const t of s){const r=t.getAttribute("uri")||"";if(r.includes("customProps")||r.includes("ppt/customProperties")){const r=Array.from(t.children).filter(t=>"p:custData"===t.tagName||t.tagName.includes(":custData"));for(const t of r){const r=g(t,"name",""),n=t.textContent||"",i=jt(n);r&&e.push({name:r,value:n,type:i})}}}}catch(t){I("warn","Failed to parse custom properties",t)}return e}(i);return{id:`tags_${e}`,slideId:e,tags:o,extensions:a,customProperties:l,relsMap:s}}catch(t){return I("error",`Failed to parse tags for slide ${e}`,t),Dt(e)}}function Dt(t){return{id:`tags_${t}`,slideId:t,tags:[],extensions:[],customProperties:[],relsMap:{}}}function Et(t){const e={};for(const r of t){if(1!==r.nodeType)continue;const t=r.localName||r.tagName.split(":").pop();if(r.children.length>0)e[t]=Et(Array.from(r.children));else if(r.textContent){const n=r.textContent.trim();e[t]=n}else e[t]=null}return e}function jt(t){if(!t)return"string";if("true"===t.toLowerCase()||"false"===t.toLowerCase())return"boolean";if(!isNaN(parseFloat(t))&&isFinite(Number(t)))return"number";return/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2})?$/.test(t)?"date":"string"}const Lt={generateId:P,parseXmlText:t=>e(t||"").trim(),px2emu:p,emu2px:d,parseXmlToTree:t=>{const e=(new DOMParser).parseFromString(t,"application/xml").documentElement,r=t=>{const e=[];return Array.from(t.childNodes).forEach(t=>{1===t.nodeType&&e.push(r(t))}),{tag:t.tagName,attrs:Lt.parseXmlAttrs(t.attributes),children:e,text:Lt.parseXmlText(t.textContent||"")}};return r(e)},parseXmlAttrs:t=>{const e={};return Array.from(t).forEach(t=>{e[t.nodeName]=t.nodeValue||""}),e},parseXmlRect:t=>({x:d(t.x||"0"),y:d(t.y||"0"),width:d(t.cx||"0"),height:d(t.cy||"0")}),parseXmlStyle:t=>{const e={};t.fontSize?e.fontSize=parseInt(t.fontSize)/100:e.fontSize=14,t.fill?e.color=t.fill:e.color="#333333","1"===t.bold||"true"===t.bold?e.fontWeight="bold":e.fontWeight="normal";const r=t.align;return e.textAlign="left"===r||"center"===r||"right"===r||"justify"===r?r:"left",t.bgFill?e.backgroundColor=t.bgFill:e.backgroundColor="transparent",t.border?e.borderColor=t.border:e.borderColor="#000000",t.borderWidth?e.borderWidth=parseInt(t.borderWidth):e.borderWidth=1,e},hexToRgb:t=>{const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}},rgbToHex:(t,e,r)=>"#"+((1<<24)+(t<<16)+(e<<8)+r).toString(16).slice(1),parseColor:t=>(t.startsWith("#"),t)};async function Bt(e,r){const n={parseImages:!0,keepRawXml:!1,verbose:!1,returnFormat:"enhanced",...r},i=await t.loadAsync(e);return"simple"===n.returnFormat?async function(t){const e=await async function(t){const e={width:1280,height:720,title:"未命名PPT"};try{const r=await(t.file("ppt/slideLayouts/slideLayout1.xml")?.async("string"));if(r){const t=Lt.parseXmlToTree(r).children.find(t=>"cSld"===t.tag),n=t?.children.find(t=>"sldSz"===t.tag);if(n){const t=Lt.parseXmlRect(n.attrs);e.width=t.width,e.height=t.height}}const n=await(t.file("docProps/core.xml")?.async("string"));if(n){const t=Lt.parseXmlToTree(n);e.title=t.children.find(t=>t.tag.includes("title"))?.text||"未命名PPT"}}catch(t){console.warn("PPT配置解析失败，使用默认配置",t)}return e}(t),r=await async function(t){const e=[],r=Object.keys(t.files).filter(t=>t.startsWith("ppt/slides/slide")&&t.endsWith(".xml"));for(const n of r){const r=await t.file(n).async("string");e.push({xml:r,slideId:Lt.generateId("slide"),rId:n.replace("ppt/slides/slide","").replace(".xml",""),layout:"normal"})}return e}(t),n=await Promise.all(r.map((t,e)=>async function(t,e,r){const{xml:n,layout:i}=e,s=Lt.parseXmlToTree(n),o=s.children.find(t=>"p:cSld"===t.tag||"cSld"===t.tag),a=o?.children.find(t=>"p:spTree"===t.tag||"spTree"===t.tag),l=[];a&&a.children.forEach(t=>{const e=function(t){const{tag:e}=t;if("p:sp"===e||"sp"===e)return function(t){const e=Lt.generateId("shape"),r=t.children,n=r.find(t=>"p:spPr"===t.tag||"spPr"===t.tag),i=r.find(t=>"p:txBody"===t.tag||"txBody"===t.tag);let s={x:0,y:0,width:0,height:0};if(n){const t=n.children.find(t=>"a:xfrm"===t.tag);if(t){const e=t.children.find(t=>"a:off"===t.tag),r=t.children.find(t=>"a:ext"===t.tag);e&&r&&(s=Lt.parseXmlRect({x:e.attrs.x||"0",y:e.attrs.y||"0",cx:r.attrs.cx||"0",cy:r.attrs.cy||"0"}))}}let o="";if(i){const t=i.children.filter(t=>"a:p"===t.tag||"p"===t.tag),e=[];t.forEach(t=>{const r=t.children.filter(t=>"a:r"===t.tag||"r"===t.tag);r.forEach(t=>{const r=t.children.find(t=>"a:t"===t.tag||"t"===t.tag);if(r&&r.text){const n=t.children.find(t=>"a:rPr"===t.tag||"rPr"===t.tag);e.push({text:r.text,fontSize:n?.attrs.sz?parseInt(n.attrs.sz)/100:14,fontColor:n?.attrs.fill||"#333333",bold:"1"===n?.attrs.b,italic:"1"===n?.attrs.i})}})}),o={paragraphs:[{runs:e}]}}return{id:e,type:"text",rect:s,style:{fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1},content:o}}(t);if("p:pic"===e||"pic"===e)return function(t){const e=Lt.generateId("image"),r=t.children,n=r.find(t=>"p:spPr"===t.tag||"spPr"===t.tag),i=r.find(t=>"p:blipFill"===t.tag||"blipFill"===t.tag);let s={x:0,y:0,width:0,height:0};if(n){const t=n.children.find(t=>"a:xfrm"===t.tag);if(t){const e=t.children.find(t=>"a:off"===t.tag),r=t.children.find(t=>"a:ext"===t.tag);e&&r&&(s=Lt.parseXmlRect({x:e.attrs.x||"0",y:e.attrs.y||"0",cx:r.attrs.cx||"0",cy:r.attrs.cy||"0"}))}}let o="";if(i){const t=i.children.find(t=>"a:blip"===t.tag||"blip"===t.tag);o=t?.attrs["r:embed"]||t?.attrs.embed||""}return{id:e,type:"image",rect:s,style:{fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1},content:{url:"",imgId:o},props:{imgId:o,alt:"图片"}}}(t);if("p:graphicFrame"===e||"graphicFrame"===e)return function(t){const e=Lt.generateId("graphic"),r=t.children,n=r.find(t=>"p:xfrm"===t.tag||"xfrm"===t.tag);let i={x:0,y:0,width:0,height:0};if(n){const t=n.children.find(t=>"a:off"===t.tag),e=n.children.find(t=>"a:ext"===t.tag);t&&e&&(i=Lt.parseXmlRect({x:t.attrs.x||"0",y:t.attrs.y||"0",cx:e.attrs.cx||"0",cy:e.attrs.cy||"0"}))}const s=r.find(t=>"a:graphic"===t.tag||"graphic"===t.tag),o=s?.children.find(t=>"a:graphicData"===t.tag||"graphicData"===t.tag);if(!o)return null;const a=o.attrs.uri||"";if(a.includes("table"))return{id:e,type:"table",rect:i,style:{fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#cccccc",borderWidth:1},content:{rows:[]},props:{rowCount:0,colCount:0}};if(a.includes("chart"))return{id:e,type:"chart",rect:i,style:{fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1},content:{type:"unknown",data:[]},props:{legend:!0,grid:!0}};return null}(t);return null}(t);e&&l.push(e)});const c=function(t){const e=t.children.find(t=>"bg"===t.tag);if(!e)return"#ffffff";const r=e.children.find(t=>"fill"===t.tag);return r?.attrs.color||"#ffffff"}(s),d=function(t,e){const r=t.children.find(t=>"p:cSld"===t.tag||"cSld"===t.tag),n=r?.children.find(t=>"p:spTree"===t.tag||"spTree"===t.tag);if(!n)return`幻灯片${e}`;for(const t of n.children)if("p:sp"===t.tag||"sp"===t.tag){const e=t.children.find(t=>"p:nvSpPr"===t.tag||"nvSpPr"===t.tag),r=e?.children.find(t=>"p:nvPr"===t.tag||"nvPr"===t.tag),n=r?.children.find(t=>"p:ph"===t.tag||"ph"===t.tag);if("title"===n?.attrs.type){const e=t.children.find(t=>"p:txBody"===t.tag||"txBody"===t.tag),r=e?.children.find(t=>"a:p"===t.tag||"p"===t.tag),n=r?.children.find(t=>"a:r"===t.tag||"r"===t.tag),i=n?.children.find(t=>"a:t"===t.tag||"t"===t.tag);if(i?.text)return i.text}}return`幻灯片${e}`}(s,r+1);return{id:e.slideId,title:d,bgColor:c,elements:l,props:{width:1280,height:720,slideLayout:i}}}(0,t,e)));return{id:Lt.generateId("ppt-doc"),title:e.title||"未命名PPT",slides:n,props:{width:e.width||1280,height:e.height||720,ratio:(e.width||1280)/(e.height||720)}}}(i):async function(t,e){try{I("info","Starting PPTX parsing...");const r=await async function(t){try{const e=await(t.file(`${l}core.xml`)?.async("string"));return e?$(e):(I("warn","core.xml not found"),{})}catch(t){return I("warn","Failed to parse core properties",t),{}}}(t),n=await async function(t){try{const e=await(t.file("ppt/presentation.xml")?.async("string"));if(e){const t=(new DOMParser).parseFromString(e,"application/xml"),r=t.documentElement.namespaceURI||"http://schemas.openxmlformats.org/presentationml/2006/main",n=t.getElementsByTagNameNS(r,"sldSz")[0];if(n){const t=n.getAttribute("cx"),e=n.getAttribute("cy");if(t&&e)return{width:d(t),height:d(e)}}}return{width:1280,height:720}}catch(t){return I("warn","Failed to parse slide size",t),{width:1280,height:720}}}(t),i=await dt(t);I("info",i?"Theme parsed successfully":"Theme not found");const s=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/slideMasters/")&&t.endsWith(".xml")).sort();I("info",`Found ${e.length} master slide files`);const r=[];for(const n of e){const e=n.match(/slideMaster(\d+)\.xml/)?.[1];if(!e)continue;const i=await(t.file(n)?.async("string"));if(!i)continue;const s=n.replace("slideMasters/","slideMasters/_rels/").replace(".xml",".xml.rels");let o={};try{const r=await(t.file(s)?.async("string"));r&&(o=x(r,s),I("info",`Loaded ${Object.keys(o).length} relationships for master ${e}`),Object.entries(o).forEach(([t,e])=>{I("info",`  - ${t}: type=${e.type}, target=${e.target}`)}))}catch(t){I("warn",`Failed to read master rels: ${s}`,t)}const a=ht(i,o,e);r.push(a)}return r}catch(t){return I("error","Failed to parse master slides",t),[]}}(t);I("info",`Parsed ${s.length} master slides`);const a=new Map;s.forEach(t=>{t.masterId&&(a.set(t.masterId,t),I("info",`Master map: ${t.masterId} -> ${t.id}`))});const c=await async function(t){try{const e={},r=Object.keys(t.files).filter(t=>t.startsWith(ut.slideLayouts)&&t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort((t,e)=>parseInt(t.match(/slideLayout(\d+)\.xml/)?.[1]||"0",10)-parseInt(e.match(/slideLayout(\d+)\.xml/)?.[1]||"0",10));I("info",`Found ${r.length} layout files`);for(let n=0;n<r.length;n++){const i=r[n];I("info",`Parsing layout ${n+1}: ${i}`);const s=await(t.file(i)?.async("string"));if(!s){I("warn",`Failed to read layout: ${i}`);continue}const o=i.match(/slideLayout(\d+)\.xml/)?.[1];let a={};if(o){const e=`ppt/slideLayouts/_rels/slideLayout${o}.xml.rels`;try{const r=await(t.file(e)?.async("string"));r&&(a=x(r,e),I("info",`Loaded ${Object.keys(a).length} relationships for layout ${o}`),Object.entries(a).forEach(([t,e])=>{I("info",`  - ${t}: type=${e.type}, target=${e.target}`)}))}catch(t){I("warn",`Failed to read layout rels: ${e}`,t)}}const l=ft(s,a);l&&(e[`slideLayout${o}`]=l)}return e}catch(t){return I("error","Failed to parse slide layouts",t),{}}}(t);I("info",`Parsed ${Object.keys(c).length} slide layouts`),Object.entries(c).forEach(([t,e])=>{if(e.masterRef&&a.has(e.masterRef)){e.masterRefIndex=e.masterRef,I("info",`Layout ${t} references master: ${e.masterRef}`)}});const p=await async function(t,e){try{const r=Object.keys(t.files).filter(t=>t.startsWith(o)).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort((t,e)=>parseInt(t.match(/slide(\d+)\.xml/)?.[1]||"0",10)-parseInt(e.match(/slide(\d+)\.xml/)?.[1]||"0",10));I("info",`Found ${r.length} slide files`);const n=[];for(let i=0;i<r.length;i++){const s=r[i];I("info",`Parsing slide ${i+1}: ${s}`);const o=await(t.file(s)?.async("string"));if(!o){I("warn",`Failed to read slide: ${s}`);continue}const a=s.match(/slide(\d+)\.xml/)?.[1];let l={};if(a){const e=`slide${a}`;l=await nt(t,e),I("info",`Loaded ${Object.keys(l).length} relationships for slide ${e}`)}const c=it(o,l,i);e.keepRawXml&&(c.rawXml=o),n.push(c)}return n}catch(t){return I("error","Failed to parse slides",t),[]}}(t,e);p.forEach(t=>{const e=function(t){for(const[e,r]of Object.entries(t))if(r.type.includes("slideLayout")){const t=r.target.match(/slideLayout(\d+)\.xml/);if(t)return`slideLayout${t[1]}`}}(t.relsMap||{});if(e&&c[e]){const a=c[e],l=a,d=(r=t.background,n=a.background,o=l.masterRefIndex?s.find(t=>t.masterId===l.masterRefIndex)?.background:void 0,r&&"none"!==r.type?r:n&&"none"!==n.type?n:o||{type:"color",value:"#ffffff"});t.background=d,t.layoutId=e,t.masterRefIndex=l.masterRefIndex;G(t,a,l.masterRefIndex?s.find(t=>t.masterId===l.masterRefIndex):void 0,i);I("info",`Slide relationship chain: slide -> layout (${e}) -> master (${a.masterRef})`)}else e&&I("warn",`Layout ${e} referenced by slide not found in parsed layouts`);var r,n,o});const h=await async function(t){try{const e=await(t.file("_rels/.rels")?.async("string"));return e?x(e,"_rels/.rels"):{}}catch(t){return I("warn","Failed to parse global relationships",t),{}}}(t);I("info",`Parsed ${p.length} slides successfully`);const u=n.width/n.height,f=function(t){const e=.01;return Math.abs(t-1.33333)<e?"4:3":Math.abs(t-1.77778)<e?"16:9":Math.abs(t-1.6)<e?"16:10":"custom"}(u);i&&i.colors&&(s.forEach(t=>{if(t.background&&"object"==typeof t.background){const e=t.background;if(e.schemeRef){const r=pt(e.schemeRef,i.colors,t.colorMap||{});e.value=r,delete e.schemeRef}}}),Object.values(c).forEach(t=>{if(t.background&&"object"==typeof t.background){const e=t.background;if(e.schemeRef){const r=pt(e.schemeRef,i.colors,t.colorMap||{});e.value=r,delete e.schemeRef}}}),p.forEach((t,e)=>{if(t.background&&"object"==typeof t.background){const e=t.background;if(e.schemeRef){const t=pt(e.schemeRef,i.colors,{});e.value=t,delete e.schemeRef}}}));const g=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/notesMasters/")).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort((t,e)=>parseInt(t.match(/notesMaster(\d+)\.xml/)?.[1]||"0",10)-parseInt(e.match(/notesMaster(\d+)\.xml/)?.[1]||"0",10));I("info",`Found ${e.length} notes master files`);const r=[];for(const n of e){const e=await(t.file(n)?.async("string"));if(!e){I("warn",`Failed to read notes master: ${n}`);continue}const i=await gt(t,n,e);r.push(i)}return r}catch(t){return I("error","Failed to parse notes masters",t),[]}}(t),m=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/notesSlides/")).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort((t,e)=>parseInt(t.match(/notesSlide(\d+)\.xml/)?.[1]||"0",10)-parseInt(e.match(/notesSlide(\d+)\.xml/)?.[1]||"0",10));I("info",`Found ${e.length} notes slide files`);const r=[];for(const n of e){const e=await(t.file(n)?.async("string"));if(!e){I("warn",`Failed to read notes slide: ${n}`);continue}const i=await mt(t,n,e);r.push(i)}return r}catch(t){return I("error","Failed to parse notes slides",t),[]}}(t);!function(t,e){const r=new Map;e.forEach(t=>{const e=t.id.replace("notesMaster_","");r.set(e,t)}),t.forEach(t=>{if(t.masterRef){const e=t.masterRef.split("/").pop()?.replace(".xml","")||"";r.has(e)&&(t.master=r.get(e))}})}(m,g);const y=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/charts/")).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort();I("info",`Found ${e.length} chart files`);const r=[];for(const n of e){const e=await(t.file(n)?.async("string"));if(!e){I("warn",`Failed to read chart: ${n}`);continue}const i=n.match(/chart(\d+)\.xml/)?.[1]||"1",s=wt(e,i,await Pt(t,`chart${i}`));r.push(s)}return r}catch(t){return I("error","Failed to parse charts",t),[]}}(t),b=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/diagrams/")).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort();I("info",`Found ${e.length} diagram files`);const r=[];for(const n of e){const e=await(t.file(n)?.async("string"));if(!e){I("warn",`Failed to read diagram: ${n}`);continue}const i=n.match(/data(\d+)\.xml/)?.[1]||"1",s=Tt(e,i,await It(t,i));r.push(s)}return r}catch(t){return I("error","Failed to parse diagrams",t),[]}}(t),w=await async function(t,e){try{const r=[];for(let n=1;n<=e;n++){const e=`slide${n}`,i=await Nt(t,e);r.push(i)}return I("info",`Parsed tags for ${e} slides`),r}catch(t){return I("error","Failed to parse slide tags",t),[]}}(t,p.length),v={id:P("ppt-doc"),title:r.title||"未命名PPT",author:r.author,subject:r.subject,keywords:r.keywords,description:r.description,created:r.created,modified:r.modified,slides:p,props:{width:n.width,height:n.height,ratio:u,pageSize:f},globalRelsMap:h,theme:i||void 0,masterSlides:s,slideLayouts:c,notesMasters:g.length>0?g:void 0,notesSlides:m.length>0?m:void 0,charts:y.length>0?y:void 0,diagrams:b.length>0?b:void 0,tags:w.length>0?w:void 0,mediaMap:void 0};return e.parseImages&&await async function(t,e){try{const r=new Map;for(const n of e.slides){if(n.background&&"string"!=typeof n.background){const e=n.background;if("image"===e.type&&e.relId){const i=await ct(t,e.relId,n.relsMap,r);i&&(e.value=i)}}let e=0;for(const i of n.elements)if("image"===i.type){e++;const s=i,o=s.relId;if(o){I("info",`Found image element in slide: relId=${o}, src=${s.src}`);const e=await ct(t,o,n.relsMap,r);e?(s.src=e,I("info",`Updated image src to base64 URL, length=${e.length}`)):I("warn",`Failed to resolve image relId=${o}`)}else I("warn","Image element missing relId")}e>0&&I("info",`Found ${e} image elements in slide ${n.id}`)}if(e.slideLayouts){I("info",`Processing ${Object.keys(e.slideLayouts).length} slide layouts`);for(const n in e.slideLayouts){const i=e.slideLayouts[n];I("info",`Processing layout: ${n}`),await lt(t,i,i.relsMap,r)}}if(e.masterSlides){I("info",`Processing ${e.masterSlides.length} master slides`);for(const n of e.masterSlides)n.relsMap?(I("info",`Processing master: ${n.id}`),await lt(t,n,n.relsMap,r)):I("warn",`Master ${n.id} missing relsMap`)}e.mediaMap=r,I("info",`Parsed ${r.size} images`)}catch(t){I("warn","Failed to parse images",t)}}(t,v),v}catch(t){throw I("error","PPTX parsing failed",t),new Error(`PPTX解析失败: ${t instanceof Error?t.message:String(t)}`)}}(i,n)}async function Rt(e){const r=new t;return function(t){t.folder("ppt")?.folder("slides"),t.folder("ppt")?.folder("slideLayouts"),t.folder("ppt")?.folder("_rels"),t.folder("docProps"),t.folder("_rels")}(r),await async function(t,e){const{width:r,height:n}=e.props,i=Lt.px2emu(r),s=Lt.px2emu(n),o=`<sldLayout xmlns="http://schemas.openxmlformats.org/presentationml/2006/main"><cSld><sldSz cx="${i}" cy="${s}" type="screen"/></cSld></sldLayout>`;t.file("ppt/slideLayouts/slideLayout1.xml",o);const a=`<cp:coreProperties xmlns:cp="http://schemas.openxmlformats.org/package/2006/metadata/core-properties"><dc:title>${e.title}</dc:title></cp:coreProperties>`;t.file("docProps/core.xml",a)}(r,e),await async function(t,e){e.forEach(async(e,r)=>{const n=function(t){const{elements:e,bgColor:r,props:n}=t,i=Lt.px2emu(n.width),s=Lt.px2emu(n.height),o=e.map(t=>function(t){const{type:e,rect:r,style:n,content:i}=t,{x:s,y:o,width:a,height:l}=r,c=Lt.px2emu(s),d=Lt.px2emu(o),p=Lt.px2emu(a),h=Lt.px2emu(l);switch(e){case"text":return`<p:txBody><a:bodyPr/><a:lstStyle/><a:p><a:r><a:rPr sz="${100*(n.fontSize||14)}" b="${"bold"===n.fontWeight?1:0}"/><a:t>${i}</a:t></a:r></a:p></p:txBody><p:spPr><a:xfrm><a:off x="${c}" y="${d}"/><a:ext cx="${p}" cy="${h}"/></a:xfrm></p:spPr>`;case"shape":return`<p:sp><p:spPr><a:xfrm><a:off x="${c}" y="${d}"/><a:ext cx="${p}" cy="${h}"/></a:xfrm><a:solidFill><a:srgbClr val="${n.backgroundColor?.replace("#","")||"ffffff"}"/></a:solidFill><a:ln><a:solidFill><a:srgbClr val="${n.borderColor?.replace("#","")||"000000"}"/></a:solidFill></a:ln></p:spPr></p:sp>`;case"image":return`<p:pic><p:blipFill><a:blip r:embed="rId1"/></p:blipFill><p:spPr><a:xfrm><a:off x="${c}" y="${d}"/><a:ext cx="${p}" cy="${h}"/></a:xfrm></p:spPr></p:pic>`;case"table":return`<p:tbl><p:tblPr><a:tblW w="${p}" type="dxa"/></p:tblPr>${i.map(t=>`<a:tr><a:tc><a:txBody><a:p><a:r><a:t>${t.join("")}</a:t></a:r></a:p></a:txBody></a:tc></a:tr>`).join("")}</p:tbl>`;default:return""}}(t)).join("\n");return`<p:sld xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main"><p:cSld><p:spTree><p:grpSp><p:spPr><a:xfrm><a:off x="0" y="0"/><a:ext cx="${i}" cy="${s}"/></a:xfrm></p:spPr>${o}</p:grpSp></p:spTree></p:cSld><p:bg><p:bgPr><a:solidFill><a:srgbClr val="${r.replace("#","")}"/></a:solidFill></p:bgPr></p:bg></p:sld>`.replace(/\s+/g," ").trim()}(e);t.file(`ppt/slides/slide${r+1}.xml`,n)})}(r,e.slides),await r.generateAsync({type:"blob",compression:"DEFLATE"})}function zt(t){return"number"!=typeof t||isNaN(t)?0:Math.round(t*(96/914400))}class Ot{constructor(t={}){this.options=t,this.styleTable=new Map,this.styleCounter=0}generate(t){let e=`<div class="${this.options.containerClass||"pptxjs-container"}">`;for(const r of t.slides)e+=this.generateSlide(r,t.props.width,t.props.height);return e+="</div>",!1!==this.options.includeGlobalCSS&&(e+=`<style>\n${this.generateGlobalCSS()}\n</style>`),e}generateSlide(t,e,r){const n="section"===this.options.slideType?"section":"div",i=t.width||e,s=t.height||r;let o=`<${n} class="slide" data-slide-id="${t.id}" style="width:${i}px;height:${s}px;position:relative;overflow:hidden;">`;if(t.bgFill?o+=this.generateBackground(t.bgFill):t.bgColor&&"transparent"!==t.bgColor&&(o+=`<div class="slide-background" style="width:100%;height:100%;position:absolute;top:0;left:0;background-color:${t.bgColor};"></div>`),t.elements)for(const e of t.elements)o+=this.generateElement(e);return o+=`</${n}>`,o}generateElement(t){switch(t.type){case"text":return this.generateTextElement(t);case"image":return this.generateImageElement(t);case"shape":return this.generateShapeElement(t);case"table":return this.generateTableElement(t);default:return""}}generateTextElement(t){const e=t.style||{},r=t.position||{x:0,y:0,width:100,height:50};let n=this.generateTextStyle(e,r);let i=`<div class="text-element ${this.getStyleClass(n)}" style="position:absolute;left:${zt(r.x||0)}px;top:${zt(r.y||0)}px;width:${zt(r.width||100)}px;height:${zt(r.height||50)}px;${n}">`;return t.text&&(i+=this.escapeHtml(t.text)),i+="</div>",i}generateTextStyle(t,e){const r=[];if(t.fontSize){const e="number"!=typeof(n=t.fontSize)||isNaN(n)?0:n/100*1.25;r.push(`font-size:${e}px`)}var n;return t.color&&r.push(`color:${t.color}`),t.fontFamily&&r.push(`font-family:${t.fontFamily}`),"bold"===t.fontWeight&&r.push("font-weight:bold"),"italic"===t.fontStyle&&r.push("font-style:italic"),t.textDecoration&&r.push(`text-decoration:${t.textDecoration}`),t.textAlign&&r.push(`text-align:${t.textAlign}`),t.textVerticalAlign&&r.push(`vertical-align:${t.textVerticalAlign}`),t.lineHeight&&r.push(`line-height:${t.lineHeight}`),t.backgroundColor&&"transparent"!==t.backgroundColor&&r.push(`background-color:${t.backgroundColor}`),t.padding&&r.push(`padding:${t.padding}`),r.join(";")}generateImageElement(t){const e=t.position||{x:0,y:0},r=t.size||{width:100,height:100},n=zt(e.x),i=zt(e.y),s=zt(r.width),o=zt(r.height);let a=t.src;if(t.data)if(t.data.startsWith("data:"))a=t.data;else{a=`data:${t.mimeType||"image/png"};base64,${t.data}`}return`<img class="slide-image" style="position:absolute;left:${n}px;top:${i}px;width:${s}px;height:${o}px;" src="${a}" alt="slide image" />`}generateBackground(t){const e=["width:100%","height:100%","position:absolute","top:0","left:0"];switch(t.type){case"solid":default:t.color&&e.push(`background-color:${t.color}`);break;case"gradient":if(t.colors&&t.colors.length>=2){const r=`linear-gradient(${t.direction||"to bottom"}, ${t.colors.join(", ")})`;e.push(`background:${r}`)}break;case"image":t.src&&(e.push("background-size:cover"),e.push("background-position:center"),e.push("background-repeat:no-repeat"),t.src.startsWith("data:"),e.push(`background-image:url('${t.src}')`))}return`<div class="slide-background" style="${e.join(";")}"></div>`}generateShapeElement(t){const e=t.style||{},r=t.position||{x:0,y:0},n=t.size||{width:100,height:100},i=zt(r.x),s=zt(r.y),o=zt(n.width),a=zt(n.height);let l="";return e.backgroundColor&&(l+=`background-color:${e.backgroundColor};`),e.borderColor&&(l+=`border:${e.borderWidth||1}px solid ${e.borderColor};`),`<div class="slide-shape" style="position:absolute;left:${i}px;top:${s}px;width:${o}px;height:${a}px;${l}"></div>`}generateTableElement(t){const e=t.position||{x:0,y:0};let r=`<table class="slide-table" style="position:absolute;left:${zt(e.x)}px;top:${zt(e.y)}px;">`;return t.rows&&t.rows.forEach(t=>{r+="<tr>",t.cells&&t.cells.forEach(t=>{r+="<td>",t.text&&(r+=this.escapeHtml(t.text)),r+="</td>"}),r+="</tr>"}),r+="</table>",r}generateGlobalCSS(){let t="";t+="\n.pptxjs-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow: auto;\n  background-color: #f0f0f0;\n  padding: 20px;\n  box-sizing: border-box;\n}\n",t+="\n.slide {\n  position: relative;\n  margin-bottom: 20px;\n  background-color: #ffffff;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  overflow: hidden;\n}\n",t+="\n.text-element {\n  display: flex;\n  align-items: center;\n  word-wrap: break-word;\n  overflow-wrap: break-word;\n  box-sizing: border-box;\n}\n",t+="\n.slide-image {\n  display: block;\n  object-fit: contain;\n}\n",t+="\n.slide-shape {\n  box-sizing: border-box;\n}\n",t+="\n.slide-table {\n  border-collapse: collapse;\n}\n.slide-table td {\n  border: 1px solid #cccccc;\n  padding: 8px;\n  text-align: left;\n}\n";for(const[,e]of this.styleTable)t+=`.${e.name} { ${e.css} }\n`;return t}getStyleClass(t){for(const[e,r]of this.styleTable.entries())if(e===t)return r.name;const e="_pptx_style_"+this.styleCounter++;return this.styleTable.set(t,{name:e,css:t}),e}escapeHtml(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}function Ht(t,e){return new Ot(e).generate(t)}function Wt(t){let e="";const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(t),i=n.byteLength,s=i%3,o=i-s;let a,l,c,d,p;for(let t=0;t<o;t+=3)p=n[t]<<16|n[t+1]<<8|n[t+2],a=(16515072&p)>>18,l=(258048&p)>>12,c=(4032&p)>>6,d=63&p,e+=r[a]+r[l]+r[c]+r[d];return 1===s?(p=n[o],a=(252&p)>>2,l=(3&p)<<4,e+=r[a]+r[l]+"=="):2===s&&(p=n[o]<<8|n[o+1],a=(64512&p)>>10,l=(1008&p)>>4,c=(15&p)<<2,e+=r[a]+r[l]+r[c]+"="),e}function Gt(t,e){try{const r=t.file(e);if(!r)return null;return Wt(r.asArrayBuffer())}catch(t){return console.error(`Error reading image ${e}:`,t),null}}function Xt(t){return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",bmp:"image/bmp",tiff:"image/tiff",webp:"image/webp",svg:"image/svg+xml"}[t.split(".").pop()?.toLowerCase()||""]||"image/png"}function _t(t,e){return`data:${e};base64,${t}`}function Vt(t,e=0){if(null==t||""===t)return e;const r=parseInt(String(t),10);return isNaN(r)?e:r}function qt(t,e=0){if(null==t||""===t)return e;const r=parseFloat(String(t));return isNaN(r)?e:r}function Ut(t){if(null===t||"object"!=typeof t)return t;if(Array.isArray(t))return t.map(t=>Ut(t));const e={};for(const r in t)t.hasOwnProperty(r)&&(e[r]=Ut(t[r]));return e}function Yt(t){return["he-IL","ar-AE","ar-SA","dv-MV","fa-IR","ur-PK"].includes(t)}function Jt(t){if(!t)return"";let e=t.replace("#","");return(3===e.length||4===e.length)&&(e=e.split("").map(t=>t+t).join("")),e=e.toUpperCase(),e}function Kt(t){if(!t)return!1;const e=t.replace("#","");return/^[0-9A-Fa-f]{3}$|^[0-9A-Fa-f]{6}$|^[0-9A-Fa-f]{8}$/.test(e)}function Zt(t="id"){return`${t}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function Qt(t){return new Promise(e=>setTimeout(e,t))}async function te(t,e=3,r=1e3){let n;for(let i=0;i<e;i++)try{return await t()}catch(t){n=t,i<e-1&&await Qt(r*(i+1))}throw n||new Error("Retry failed")}function ee(t){return Array.from(new Set(t))}function re(t,...e){if(!e.length)return t;const r=e.shift();if(ne(t)&&ne(r))for(const e in r)ne(r[e])?(t[e]||Object.assign(t,{[e]:{}}),re(t[e],r[e])):Object.assign(t,{[e]:r[e]});return re(t,...e)}function ne(t){return t&&"object"==typeof t&&!Array.isArray(t)}function ie(t){if(0===t)return"0 Bytes";const e=Math.floor(Math.log(t)/Math.log(1024));return Math.round(t/Math.pow(1024,e)*100)/100+" "+["Bytes","KB","MB","GB"][e]}function se(t,e,r="..."){return t.length<=e?t:t.substring(0,e-r.length)+r}function oe(t){const e=new Map;return(...r)=>{const n=JSON.stringify(r);if(e.has(n))return e.get(n);const i=t(...r);return e.set(n,i),i}}const ae={slideFactor:96/914400,fontSizeFactor:1.25,rtlLangs:["he-IL","ar-AE","ar-SA","dv-MV","fa-IR","ur-PK"],standardHeight:6858e3,standardWidth:9144e3};class le{constructor(t,e={}){this.slideWidth=0,this.slideHeight=0,this.slideFactor=ae.slideFactor,this.fontSizeFactor=ae.fontSizeFactor,this.defaultTextStyle=null,this.appVersion=0,this.processFullTheme=!0,this.incSlide={width:0,height:0},this.zip=t,this.processFullTheme=!1!==e.processFullTheme,this.incSlide={width:e.incSlideWidth||0,height:e.incSlideHeight||0}}readXmlFile(t,e=!1){try{const r=this.zip.file(t);if(!r)return null;let n=r.asText();e&&this.appVersion<=12&&(n=n.replace(/<!\[CDATA\[(.*?)\]\]>/g,"$1"));const i=this.parseXml(n);return i&&void 0!==i["?xml"]?i["?xml"]:i}catch(e){return console.error(`Error reading XML file '${t}':`,e),null}}parseXml(t){try{const e=(new DOMParser).parseFromString(t,"text/xml");return this.domToJson(e)}catch(t){return console.error("XML parsing error:",t),null}}domToJson(t){if(t.nodeType===Node.TEXT_NODE)return t.textContent;const e={};if(t.nodeType===Node.ELEMENT_NODE&&t instanceof Element){const r={};for(let e=0;e<t.attributes.length;e++)r[t.attributes[e].name]=t.attributes[e].value;Object.keys(r).length>0&&(e.attrs=r)}const r=t.childNodes,n={};for(let t=0;t<r.length;t++){const i=r[t];if(i.nodeType===Node.TEXT_NODE){const t=i.textContent?.trim();t&&(e["#text"]=t);continue}if(i.nodeType===Node.ELEMENT_NODE){const t=this.domToJson(i),e=i.nodeName;n[e]||(n[e]=[]),n[e].push(t)}}for(const[t,r]of Object.entries(n))1===r.length?e[t]=r[0]:e[t]=r;return e}getContentTypes(){const t=this.readXmlFile("[Content_Types].xml");if(!t||!t.Types)return{slides:[],slideLayouts:[]};const e=t.Types.Override,r=[],n=[],i=Array.isArray(e)?e:[e];for(const t of i){const e=t.attrs;if(e)switch(e.ContentType){case"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":r.push(e.PartName.substring(1));break;case"application/vnd.openxmlformats-officedocument.presentationml.slideLayout+xml":n.push(e.PartName.substring(1))}}return{slides:r,slideLayouts:n}}getSlideSizeAndSetDefaultTextStyle(){const t=this.readXmlFile("docProps/app.xml");t&&t.Properties&&t.Properties.AppVersion&&(this.appVersion=parseInt(t.Properties.AppVersion),console.log(`Created by Office PowerPoint app version: ${t.Properties.AppVersion}`));const e=this.readXmlFile("ppt/presentation.xml");if(!e||!e["p:presentation"])return{width:960,height:720};const r=e["p:presentation"]["p:sldSz"]?.attrs;if(!r)return{width:960,height:720};const n=parseInt(r.cx),i=parseInt(r.cy),s=r.type;return console.log(`Presentation size type: ${s}`),this.defaultTextStyle=e["p:presentation"]["p:defaultTextStyle"],this.slideWidth=Math.floor(n*this.slideFactor+this.incSlide.width),this.slideHeight=Math.floor(i*this.slideFactor+this.incSlide.height),{width:this.slideWidth,height:this.slideHeight}}indexNodes(t){if(!t)return{idTable:{},idxTable:{},typeTable:{}};const e=Object.keys(t)[0];if(!t[e])return{idTable:{},idxTable:{},typeTable:{}};const r=t[e]["p:cSld"];if(!r)return{idTable:{},idxTable:{},typeTable:{}};const n=r["p:spTree"];if(!n)return{idTable:{},idxTable:{},typeTable:{}};const i={},s={},o={};for(const t in n){if("p:nvGrpSpPr"===t||"p:grpSpPr"===t)continue;const e=n[t],r=Array.isArray(e)?e:[e];for(const t of r){const e=t["p:nvSpPr"];if(!e)continue;const r=e["p:cNvPr"],n=e["p:nvPr"],a=n?.["p:ph"],l=r?.attrs?.id,c=a?.attrs?.idx,d=a?.attrs?.type;void 0!==l&&(i[l]=t),void 0!==c&&(s[c]=t),void 0!==d&&(o[d]=t)}}return{idTable:i,idxTable:s,typeTable:o}}getTextByPathList(t,e){if(!t||!e||0===e.length)return;let r=t;for(const t of e){if(null==r)return;r=r[t]}return r}getSlideWidth(){return this.slideWidth}getSlideHeight(){return this.slideHeight}getSlideFactor(){return this.slideFactor}getFontSizeFactor(){return this.fontSizeFactor}getDefaultTextStyle(){return this.defaultTextStyle}getAppVersion(){return this.appVersion}getProcessFullTheme(){return this.processFullTheme}}function ce(t){return null==t?0:t/6e4}function de(t){return t*(Math.PI/180)}var pe;!function(t){t.SOLID="solid",t.GRADIENT="gradient",t.PATTERN="pattern",t.NONE="none"}(pe||(pe={}));const he={dk1:"000000",lt1:"FFFFFF",dk2:"1F497D",lt2:"EEECE1",accent1:"4F81BD",accent2:"C0504D",accent3:"9BBB59",accent4:"8064A2",accent5:"4BACC6",accent6:"F79646",hlink:"0000FF",folHlink:"800080"};function ue(t){if(!t)return null;const e=Se(t,["a:srgbClr","attrs","val"]);if(e)return"#"+e;const r=Se(t,["a:schemeClr","attrs","val"]);if(r)return fe(r);const n=Se(t,["a:sysClr","attrs","lastClr"]);if(n)return"#"+n;const i=Se(t,["a:prstClr","attrs","val"]);return i?ge(i):null}function fe(t){const e=he[t];return e?"#"+e:"#000000"}function ge(t){const e={aliceBlue:"F0F8FF",antiqueWhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedAlmond:"FFEBCD",blue:"0000FF",blueViolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetBlue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerBlue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkBlue:"00008B",darkCyan:"008B8B",darkGoldenrod:"B8860B",darkGray:"A9A9A9",darkGreen:"006400",darkGrey:"A9A9A9",darkKhaki:"BDB76B",darkMagenta:"8B008B",darkOliveGreen:"556B2F",darkOrange:"FF8C00",darkOrchid:"9932CC",darkRed:"8B0000",darkSalmon:"E9967A",darkSeaGreen:"8FBC8F",darkSlateBlue:"483D8B",darkSlateGray:"2F4F4F",darkSlateGrey:"2F4F4F",darkTurquoise:"00CED1",darkViolet:"9400D3",deepPink:"FF1493",deepSkyBlue:"00BFFF",dimGray:"696969",dimGrey:"696969",dkBlue:"00008B",dkCyan:"008B8B",dkGoldenrod:"B8860B",dkGray:"A9A9A9",dkGreen:"006400",dkKhaki:"BDB76B",dkMagenta:"8B008B",dkOliveGreen:"556B2F",dkOrange:"FF8C00",dkOrchid:"9932CC",dkRed:"8B0000",dkSalmon:"E9967A",dkSeaGreen:"8FBC8F",dkSlateBlue:"483D8B",dkSlateGray:"2F4F4F",dkSlateGrey:"2F4F4F",dkTurquoise:"00CED1",dkViolet:"9400D3",dodgerBlue:"1E90FF",firebrick:"B22222",floralWhite:"FFFAF0",forestGreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostWhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",green:"008000",greenYellow:"ADFF2F",grey:"808080",honeydew:"F0FFF0",hotPink:"FF69B4",indianRed:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderBlush:"FFF0F5",lawnGreen:"7CFC00",lemonChiffon:"FFFACD",lightBlue:"ADD8E6",lightCoral:"F08080",lightCyan:"E0FFFF",lightGoldenrodYellow:"FAFAD2",lightGray:"D3D3D3",lightGreen:"90EE90",lightGrey:"D3D3D3",lightPink:"FFB6C1",lightSalmon:"FFA07A",lightSeaGreen:"20B2AA",lightSkyBlue:"87CEFA",lightSlateGray:"778899",lightSlateGrey:"778899",lightSteelBlue:"B0C4DE",lightYellow:"FFFFE0",lime:"00FF00",limeGreen:"32CD32",linen:"FAF0E6",ltBlue:"ADD8E6",ltCoral:"F08080",ltCyan:"E0FFFF",ltGoldenrodYellow:"FAFAD2",ltGray:"D3D3D3",ltGreen:"90EE90",ltGrey:"D3D3D3",ltPink:"FFB6C1",ltSalmon:"FFA07A",ltSeaGreen:"20B2AA",ltSkyBlue:"87CEFA",ltSlateGray:"778899",ltSlateGrey:"778899",ltSteelBlue:"B0C4DE",ltYellow:"FFFFE0",magenta:"FF00FF",maroon:"800000",mediumAquamarine:"66CDAA",mediumBlue:"0000CD",mediumOrchid:"BA55D3",mediumPurple:"9370DB",mediumSeaGreen:"3CB371",mediumSlateBlue:"7B68EE",mediumSpringGreen:"00FA9A",mediumTurquoise:"48D1CC",mediumVioletRed:"C71585",midnightBlue:"191970",mintCream:"F5FFFA",mistyRose:"FFE4E1",moccasin:"FFE4B5",navajoWhite:"FFDEAD",navy:"000080",oldLace:"FDF5E6",olive:"808000",oliveDrab:"6B8E23",orange:"FFA500",orangeRed:"FF4500",orchid:"DA70D6",paleGoldenrod:"EEE8AA",paleGreen:"98FB98",paleTurquoise:"AFEEEE",paleVioletRed:"DB7093",papayaWhip:"FFEFD5",peachPuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderBlue:"B0E0E6",purple:"800080",red:"FF0000",rosyBrown:"BC8F8F",royalBlue:"4169E1",saddleBrown:"8B4513",salmon:"FA8072",sandyBrown:"F4A460",seaGreen:"2E8B57",seaShell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyBlue:"87CEEB",slateBlue:"6A5ACD",slateGray:"708090",slateGrey:"708090",snow:"FFFAFA",springGreen:"00FF7F",steelBlue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whiteSmoke:"F5F5F5",yellow:"FFFF00",yellowGreen:"9ACD32"}[t];return e?"#"+e:"#000000"}function me(t){if(!t)return 1;const e=Se(t,["a:alpha","attrs","val"]);if(e)return parseInt(e)/1e5;const r=Se(t,["a:lumMod","attrs","val"]);return r?parseInt(r)/1e5:1}function ye(t,e){if(!e)return t;const r=t.replace("#","").toLowerCase();for(const[t,n]of Object.entries(e))if(n&&n.replace("#","").toLowerCase()===r){const e=he[t];if(e)return"#"+e}return t}function be(t){if(!t)return null;if(t["a:solidFill"]){const e=ue(t["a:solidFill"]),r=me(t["a:solidFill"]);if(e)return{type:pe.SOLID,color:e,alpha:r}}if(t["a:gradFill"]){const e=[],r=t["a:gradFill"]["a:gsLst"];if(r){const t=Array.isArray(r["a:gs"])?r["a:gs"]:[r["a:gs"]];for(const r of t){const t=parseInt(r.attrs.pos)/1e5,n=ue(r),i=me(r);n&&e.push({position:t,color:n,alpha:i})}}if(e.length>0)return{type:pe.GRADIENT,stops:e.sort((t,e)=>t.position-e.position)}}if(t["a:pattFill"]){const e=ue(t["a:pattFill"]["a:fgClr"]);if(ue(t["a:pattFill"]["a:bgClr"]),e)return{type:pe.PATTERN,color:e}}return null}function xe(t){if(!t||t.type===pe.NONE)return"transparent";if(t.type===pe.SOLID){let e=t.color||"#000000";return void 0!==t.alpha&&t.alpha<1&&(e=$e(e,t.alpha)),e}if(t.type===pe.GRADIENT&&t.stops){return`linear-gradient(to bottom, ${t.stops.map(t=>{let e=t.color;return void 0!==t.alpha&&t.alpha<1&&(e=$e(e,t.alpha)),`${e} ${Math.round(100*t.position)}%`}).join(", ")})`}return t.color||"#000000"}function $e(t,e){return`rgba(${parseInt(t.slice(1,3),16)}, ${parseInt(t.slice(3,5),16)}, ${parseInt(t.slice(5,7),16)}, ${e})`}function we(t,e,r){const n={},i=Se(t,["p:sld","p:clrMapOvr","a:overrideClrMapping","attrs"]);i&&(n.slide=ve(i));const s=Se(e,["p:sldLayout","p:clrMapOvr","a:overrideClrMapping","attrs"]);s&&(n.layout=ve(s));const o=Se(r,["p:sldMaster","p:clrMapOvr","a:overrideClrMapping","attrs"]);return o&&(n.master=ve(o)),n}function ve(t){const e={},r=["bg1","tx1","bg2","tx2","accent1","accent2","accent3","accent4","accent5","accent6","hlink","folHlink"];for(const n of r){const r=t[n];r&&(e[n]=fe(r))}return e}function Se(t,e){if(!t||!e||0===e.length)return;let r=t;for(const t of e){if(null==r)return;r=r[t]}return r}var Ae,Fe;function ke(t){const e={},r=De(t,["a:latin","attrs","typeface"]),n=De(t,["a:ea","attrs","typeface"]),i=De(t,["a:cs","attrs","typeface"]);r?e.fontFace=r:n?e.fontFace=n:i&&(e.fontFace=i);const s=De(t,["a:sz","attrs","val"]);s&&(e.fontSize=parseInt(s)/100);const o=t["a:solidFill"];if(o){const{getColorValue:t}=require("./pptxjs-color-utils"),r=t(o);r&&(e.color=r)}const a=De(t,["a:b","attrs","val"]);e.bold="0"!==a;const l=De(t,["a:i","attrs","val"]);e.italic="0"!==l;const c=De(t,["a:u","attrs","val"]);e.underline="none"!==c;const d=De(t,["a:strike","attrs","val"]);e.strike="noStrike"!==d;const p=De(t,["a:baseline","attrs","val"]);return p&&(e.baseline=parseInt(p)),e}function Te(t){const e={},r=De(t,["a:lnSpc","attrs","algn"]);r&&(e.textAlign=r);const n=t["a:lnSpc"];if(n){const t=De(n,["a:spcPct","attrs","val"]),r=De(n,["a:spcPts","attrs","val"]);t?e.lineSpacing=parseInt(t)/1e3:r&&(e.lineSpacing=parseInt(r)/100)}const i=t["a:spcBef"];if(i){const t=De(i,["a:spcPct","attrs","val"]),r=De(i,["a:spcPts","attrs","val"]);t?e.spacingBefore=parseInt(t)/1e3:r&&(e.spacingBefore=parseInt(r)/100)}const s=t["a:spcAft"];if(s){const t=De(s,["a:spcPct","attrs","val"]),r=De(s,["a:spcPts","attrs","val"]);t?e.spacingAfter=parseInt(t)/1e3:r&&(e.spacingAfter=parseInt(r)/100)}const o=De(t,["a:marL","attrs","val"]);o&&(e.indent=parseInt(o)/914400);const a=De(t,["a:marL","attrs","val"]);a&&(e.marginLeft=parseInt(a)/914400);const l=De(t,["a:marR","attrs","val"]);return l&&(e.marginRight=parseInt(l)/914400),e}function Ce(t){const e=[];if(!t)return e;const r=t["a:p"],n=Array.isArray(r)?r:[r];for(const t of n){const r={text:"",styles:[]},n=t["a:pPr"];if(n){const t=Te(n);Object.assign(r,t)}const i=t["a:r"],s=Array.isArray(i)?i:[i],o=[],a=[];for(const t of s){if(!t)continue;const e=De(t,["a:t"]);e&&o.push(e);const r=t["a:rPr"];if(r){const t=ke(r);a.push(t)}}r.text=o.join(""),a.length>0&&(r.styles=a),e.push(r)}return e}function Pe(t,...e){const r={...t};for(const t of e)t&&Object.assign(r,t);return r}function Ie(t){const e=[];return t.fontFace&&e.push(`font-family: "${t.fontFace}", Arial, sans-serif`),t.fontSize&&e.push(`font-size: ${t.fontSize}pt`),t.color&&e.push(`color: ${t.color}`),t.bold&&e.push("font-weight: bold"),t.italic&&e.push("font-style: italic"),t.underline&&e.push("text-decoration: underline"),t.strike&&(e.includes("text-decoration: underline")?e.push("text-decoration: underline line-through"):e.push("text-decoration: line-through")),t.baseline&&(t.baseline>0?(e.push("vertical-align: super"),e.push("font-size: smaller")):t.baseline<0&&(e.push("vertical-align: sub"),e.push("font-size: smaller"))),t.textAlign&&e.push(`text-align: ${t.textAlign}`),t.textVerticalAlign&&e.push(`vertical-align: ${t.textVerticalAlign}`),t.lineSpacing&&(t.lineSpacing<1?e.push(`line-height: ${Math.round(100*t.lineSpacing)}%`):e.push(`line-height: ${t.lineSpacing}pt`)),t.spacingBefore&&e.push(`margin-top: ${t.spacingBefore}pt`),t.spacingAfter&&e.push(`margin-bottom: ${t.spacingAfter}pt`),t.indent&&e.push(`text-indent: ${t.indent}in`),t.marginLeft&&e.push(`margin-left: ${t.marginLeft}in`),t.marginRight&&e.push(`margin-right: ${t.marginRight}in`),e.join("; ")}function Me(t){return t&&0!==t.length?t.map(t=>function(t){const e=Ie({textAlign:t.textAlign,textVerticalAlign:t.textVerticalAlign,lineSpacing:t.lineSpacing,spacingBefore:t.spacingBefore,spacingAfter:t.spacingAfter,indent:t.indent,marginLeft:t.marginLeft,marginRight:t.marginRight});if(!t.styles||0===t.styles.length)return`<p${e?` style="${e}"`:""}>${t.text}</p>`;let r="";if(r+=e?`<p style="${e}">`:"<p>",1===t.styles.length){const e=Ie(t.styles[0]);r+=e?`<span style="${e}">${t.text}</span>`:t.text}else{const e=Ie(t.styles[0]);r+=e?`<span style="${e}">${t.text}</span>`:t.text}return r+="</p>",r}(t)).join(""):""}function Ne(){return{fontFace:"Arial",fontSize:18,color:"#000000",bold:!1,italic:!1,underline:!1,strike:!1,baseline:0,textAlign:Ae.LEFT,textVerticalAlign:Fe.TOP,lineSpacing:1,spacingBefore:0,spacingAfter:0,indent:0,marginLeft:0,marginRight:0}}function De(t,e){if(!t||!e||0===e.length)return;let r=t;for(const t of e){if(null==r)return;r=r[t]}return r}!function(t){t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.JUSTIFY="justify",t.DISTRIBUTED="distributed"}(Ae||(Ae={})),function(t){t.TOP="top",t.MIDDLE="middle",t.BOTTOM="bottom",t.JUSTIFY="justify",t.DISTRIBUTED="distributed"}(Fe||(Fe={}));const Ee=Se;class je{constructor(t,e={}){this.tableStyles=null,this.zip=t,this.options={processFullTheme:!1!==e.processFullTheme,incSlideWidth:e.incSlideWidth||0,incSlideHeight:e.incSlideHeight||0,slideMode:e.slideMode||!1,slideType:e.slideType||"div",slidesScale:e.slidesScale||""},this.coreParser=new le(t,{processFullTheme:this.options.processFullTheme,incSlideWidth:this.options.incSlideWidth,incSlideHeight:this.options.incSlideHeight})}async parse(){const t=new Date;let e;const r=this.zip.file("docProps/thumbnail.jpeg");if(r){e=Wt(r.asArrayBuffer())}const n=this.coreParser.getContentTypes(),i=this.coreParser.getSlideSizeAndSetDefaultTextStyle();this.tableStyles=this.coreParser.readXmlFile("ppt/tableStyles.xml");const s=[],o=n.slides;for(let t=0;t<o.length;t++){const e=o[t],r=t+1,n=await this.processSingleSlide(e,r,i);s.push(n)}const a=this.generateGlobalCSS(),l=(new Date).getTime()-t.getTime();return console.log(`PPTX parsing completed in ${l}ms`),{slides:s,size:i,thumb:e,globalCSS:a}}async processSingleSlide(t,e,r){const n=t.replace("slides/slide","slides/_rels/slide")+".rels",i=this.coreParser.readXmlFile(n);let s="",o="";const a={},l=i?.Relationships?.Relationship,c=Array.isArray(l)?l:[l];for(const t of c){const e=t?.attrs;if(e)switch(e.Type){case"http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideLayout":s=e.Target.replace("../","ppt/");break;case"http://schemas.microsoft.com/office/2007/relationships/diagramDrawing":o=e.Target.replace("../","ppt/");default:a[e.Id]={type:e.Type.replace("http://schemas.openxmlformats.org/officeDocument/2006/relationships/",""),target:e.Target.replace("../","ppt/")}}}const d=this.coreParser.readXmlFile(s),p=this.coreParser.indexNodes(d),h=s.replace("slideLayouts/slideLayout","slideLayouts/_rels/slideLayout")+".rels",u=this.coreParser.readXmlFile(h);let f="";const g={},m=u?.Relationships?.Relationship,y=Array.isArray(m)?m:[m];for(const t of y){const e=t?.attrs;if(e)if("http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideMaster"===e.Type)f=e.Target.replace("../","ppt/");else g[e.Id]={type:e.Type.replace("http://schemas.openxmlformats.org/officeDocument/2006/relationships/",""),target:e.Target.replace("../","ppt/")}}const b=this.coreParser.readXmlFile(f),x=Se(b,["p:sldMaster","p:txStyles"]),$=this.coreParser.indexNodes(b),w=f.replace("slideMasters/slideMaster","slideMasters/_rels/slideMaster")+".rels",v=this.coreParser.readXmlFile(w);let S="";const A={},F=v?.Relationships?.Relationship,k=Array.isArray(F)?F:[F];for(const t of k){const e=t?.attrs;if(e)if("http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme"===e.Type)S=e.Target.replace("../","ppt/");else A[e.Id]={type:e.Type.replace("http://schemas.openxmlformats.org/officeDocument/2006/relationships/",""),target:e.Target.replace("../","ppt/")}}const T=this.coreParser.readXmlFile(S),C={};if(S){const t=S.split("/").pop(),e=S.replace(t,"_rels/"+t)+".rels",r=this.coreParser.readXmlFile(e),n=r?.Relationships?.Relationship,i=Array.isArray(n)?n:[n];for(const t of i){const e=t?.attrs;e&&(C[e.Id]={type:e.Type.replace("http://schemas.openxmlformats.org/officeDocument/2006/relationships/",""),target:e.Target.replace("../","ppt/")})}}let P=null;const I={};if(o&&(P=this.coreParser.readXmlFile(o),P)){const t=JSON.stringify(P);P=JSON.parse(t.replace(/dsp:/g,"p:"));const e=o.split("/").pop(),r=o.replace(e,"_rels/"+e)+".rels",n=this.coreParser.readXmlFile(r),i=n?.Relationships?.Relationship,s=Array.isArray(i)?i:[i];for(const t of s){const e=t?.attrs;e&&(I[e.Id]={type:e.Type.replace("http://schemas.openxmlformats.org/officeDocument/2006/relationships/",""),target:e.Target.replace("../","ppt/")})}}const M=this.coreParser.readXmlFile(t,!0),N=Ee(M,["p:sld","p:cSld","p:spTree"]),D={zip:this.zip,slideLayoutContent:d,slideLayoutTables:p,slideMasterContent:b,slideMasterTables:$,slideContent:M,slideResObj:a,slideMasterTextStyles:x,layoutResObj:g,masterResObj:A,themeContent:T,themeResObj:C,diagramFileContent:P,diagramResObj:I,defaultTextStyle:this.coreParser.getDefaultTextStyle()};let E="",j="";this.options.processFullTheme?E=this.getBackground(D,e):"colorsAndImageOnly"===this.options.processFullTheme&&(j=this.getSlideBackgroundFill(D,e));const L=[],B=[],R=[],z=[];if(N)for(const t in N){const e=Array.isArray(N[t])?N[t]:[N[t]];for(const r of e){const e=this.processNodesInSlide(t,r,N,D,"slide");e&&("shape"===e.type?L.push(e):"image"===e.type?B.push(e):"table"===e.type?R.push(e):"chart"===e.type&&z.push(e))}}const O=we(M,d,b);return{id:e,fileName:t,width:r.width,height:r.height,bgColor:j,bgFill:E,shapes:L,images:B,tables:R,charts:z,layout:{fileName:s,content:d,tables:p,colorMapOvr:O.layout},master:{fileName:f,content:b,tables:$,colorMapOvr:O.master},theme:{fileName:S,content:T},warpObj:D}}processNodesInSlide(t,e,r,n,i,s){switch(t){case"p:sp":return this.processSpNode(e,r,n,i,s);case"p:cxnSp":return this.processCxnSpNode(e,r,n,i,s);case"p:pic":return this.processPicNode(e,n,i,s);case"p:graphicFrame":return this.processGraphicFrameNode(e,n,i,s);case"p:grpSp":return this.processGroupSpNode(e,n,i);case"mc:AlternateContent":const t=Ee(e,["mc:Fallback"]);return this.processGroupSpNode(t,n,i);default:return null}}processSpNode(t,e,r,n,i){const s=Ee(t,["p:nvSpPr","p:cNvPr","attrs","id"]),o=Ee(t,["p:nvSpPr","p:cNvPr","attrs","name"]),a=Ee(t,["p:nvSpPr","p:nvPr","p:ph","attrs","idx"]),l=Ee(t,["p:nvSpPr","p:nvPr","p:ph","attrs","type"]),c=Ee(t,["attrs","order"]);let d;void 0!==a?(d=r.slideLayoutTables.idxTable[a],void 0!==l?r.slideMasterTables.typeTable[l]:r.slideMasterTables.idxTable[a]):void 0!==l&&(d=r.slideLayoutTables.typeTable[l],r.slideMasterTables.typeTable[l]);let p=l;if(void 0===p){"1"===Ee(t,["p:nvSpPr","p:cNvSpPr","attrs","txBox"])&&(p="textBox")}return void 0===p&&(p=Ee(d,["p:nvSpPr","p:nvPr","p:ph","attrs","type"]),void 0===p&&(p="diagramBg"===n?"diagram":"obj")),{type:"shape",id:s,name:o,idx:a,shapeType:p,order:c}}processCxnSpNode(t,e,r,n,i){return{type:"shape",id:Ee(t,["p:nvCxnSpPr","p:cNvPr","attrs","id"]),name:Ee(t,["p:nvCxnSpPr","p:cNvPr","attrs","name"]),idx:Ee(t,["p:nvCxnSpPr","p:nvPr","p:ph","attrs","idx"]),shapeType:Ee(t,["p:nvCxnSpPr","p:nvPr","p:ph","attrs","type"]),order:Ee(t,["attrs","order"]),isConnector:!0}}processPicNode(t,e,r,n){const i=Ee(t,["p:nvPicPr","p:cNvPr","attrs","id"]),s=Ee(t,["p:nvPicPr","p:cNvPr","attrs","name"]),o=Ee(t,["attrs","order"]),a=Ee(t,["p:blipFill","a:blip","attrs","r:embed"]);let l="";a&&e.slideResObj[a]&&(l=e.slideResObj[a].target);const c=Se(t,["p:spPr","a:xfrm"]);let d={x:0,y:0},p={width:0,height:0};if(c){const t=c["a:off"]?.attrs,e=c["a:ext"]?.attrs;t&&(d={x:parseInt(t.x),y:parseInt(t.y)}),e&&(p={width:parseInt(e.cx),height:parseInt(e.cy)})}let h="";l&&(h=Gt(e.zip,l)||"");const u=Xt(l);return{type:"image",id:i,name:s,order:o,position:d,size:p,imagePath:l,data:h,mimeType:u,src:h?_t(h,u):""}}processGraphicFrameNode(t,e,r,n){const i=t["a:graphic"];if(!i)return null;const s=i["a:graphicData"]["a:tbl"];if(s)return this.processTableNode(t,s,e,r,n);const o=i["a:graphicData"]["c:chart"];return o?this.processChartNode(t,o,e,r,n):null}processTableNode(t,e,r,n,i){const s=Ee(t,["p:nvGraphicFramePr","p:cNvPr","attrs","id"]),o=Ee(t,["p:nvGraphicFramePr","p:cNvPr","attrs","name"]),a=Ee(t,["attrs","order"]),l=Se(t,["p:xfrm","a:xfrm"]);let c={x:0,y:0},d={width:0,height:0};if(l){const t=l["a:off"]?.attrs,e=l["a:ext"]?.attrs;t&&(c={x:parseInt(t.x),y:parseInt(t.y)}),e&&(d={width:parseInt(e.cx),height:parseInt(e.cy)})}const p=[],h=e["a:tr"],u=Array.isArray(h)?h:[h];for(const t of u){const e={cells:[]},r=t["a:tc"],n=Array.isArray(r)?r:[r];for(const t of n){const r={},n=t["a:txBody"];if(n){const t=Ce(n);r.content=t}e.cells.push(r)}p.push(e)}return{type:"table",id:s,name:o,order:a,position:c,size:d,rows:p}}processChartNode(t,e,r,n,i){const s=Ee(t,["p:nvGraphicFramePr","p:cNvPr","attrs","id"]),o=Ee(t,["p:nvGraphicFramePr","p:cNvPr","attrs","name"]),a=Ee(t,["attrs","order"]),l=Se(t,["p:xfrm","a:xfrm"]);let c={x:0,y:0},d={width:0,height:0};if(l){const t=l["a:off"]?.attrs,e=l["a:ext"]?.attrs;t&&(c={x:parseInt(t.x),y:parseInt(t.y)}),e&&(d={width:parseInt(e.cx),height:parseInt(e.cy)})}return{type:"chart",id:s,name:o,order:a,position:c,size:d,chartData:e}}processGroupSpNode(t,e,r){const n=Ee(t,["p:grpSpPr","a:xfrm"]);if(!n)return null;const i=parseInt(n["a:off"]?.attrs.x||"0"),s=parseInt(n["a:off"]?.attrs.y||"0"),o=parseInt(n["a:chOff"]?.attrs.x||"0"),a=parseInt(n["a:chOff"]?.attrs.y||"0"),l=parseInt(n["a:ext"]?.attrs.cx||"0"),c=parseInt(n["a:ext"]?.attrs.cy||"0"),d=parseInt(n["a:chExt"]?.attrs.cx||"0"),p=parseInt(n["a:chExt"]?.attrs.cy||"0");let h=parseInt(n.attrs?.rot||"0");h=ce(h);let u=s-a,f=i-o,g=l-d,m=c-p,y="group";0!==h&&(u=s,f=i,g=l,m=c,y="group-rotate");const b=t.attrs?.order,x={type:"group",order:b,position:{x:f,y:u},size:{width:g,height:m},rotate:h,sType:y,children:[]};for(const n in t){if("p:nvGrpSpPr"===n||"p:grpSpPr"===n)continue;const i=Array.isArray(t[n])?t[n]:[t[n]];for(const s of i){const i=this.processNodesInSlide(n,s,t,e,r,y);i&&x.children.push(i)}}return x}getBackground(t,e){return""}getSlideBackgroundFill(t,e){return""}generateGlobalCSS(){return"\n.slide {\n  position: relative;\n  overflow: hidden;\n  margin: 0;\n  padding: 0;\n}\n\n.block {\n  position: absolute;\n}\n\n.text-content {\n  display: flex;\n  word-wrap: break-word;\n}\n    ".trim()}}class Le{constructor(t,e={}){this.parser=null,this.parsedData=null,this.parser=new je({},e)}static async create(t,e={}){const r=new Le(t,e);return await r.parse(),r}async parse(){if(!this.parser)throw new Error("Parser not initialized");this.parsedData=await this.parser.parse()}getResult(){return this.parsedData}getSlides(){return this.parsedData?.slides||[]}getSize(){return this.parsedData?.size||{width:960,height:720}}getThumb(){return this.parsedData?.thumb}getGlobalCSS(){return this.parsedData?.globalCSS||""}generateHtml(){if(!this.parsedData)throw new Error("Data not parsed. Call parse() first.");const{slides:t,size:e,globalCSS:r}=this.parsedData;let n=`\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>PPTX Presentation</title>\n  <style>\n    ${r}\n    \n    .slides-container {\n      position: relative;\n      width: ${e.width}px;\n      height: ${e.height*t.length}px;\n    }\n  </style>\n</head>\n<body>\n  <div class="slides-container">\n`;for(const e of t)n+=this.generateSlideHtml(e);return n+="\n  </div>\n</body>\n</html>\n",n}generateSlideHtml(t){const{id:e,width:r,height:n,bgColor:i,bgFill:s,shapes:o,images:a,tables:l,charts:c}=t;let d=`<div class="slide" id="slide-${e}" style="width:${r}px;height:${n}px;`;i?d+=`background-color:${i};`:s&&(d+=`background:${s};`),d+='">',s&&(d+=s);for(const t of o)d+=this.generateShapeHtml(t);for(const t of a)d+=this.generateImageHtml(t);for(const t of l)d+=this.generateTableHtml(t);for(const t of c)d+=this.generateChartHtml(t);return d+="</div>",d}generateShapeHtml(t){return`<div class="shape" id="shape-${t.id}">Shape: ${t.name}</div>`}generateImageHtml(t){const e=96/914400,r=Math.round(t.position.x*e),n=Math.round(t.position.y*e),i=Math.round(t.size.width*e),s=Math.round(t.size.height*e);return`<img \n      class="slide-image" \n      id="image-${t.id}" \n      style="position:absolute;left:${r}px;top:${n}px;width:${i}px;height:${s}px;" \n      src="${t.src}" \n      alt="${t.name}" \n    />`}generateTableHtml(t){const e=96/914400,r=Math.round(t.position.x*e),n=Math.round(t.position.y*e),i=Math.round(t.size.width*e),s=Math.round(t.size.height*e);let o=`<div \n      class="slide-table" \n      id="table-${t.id}" \n      style="position:absolute;left:${r}px;top:${n}px;width:${i}px;height:${s}px;overflow:auto;"\n    >`;o+='<table style="width:100%;height:100%;border-collapse:collapse;">';for(const e of t.rows){o+="<tr>";for(const t of e.cells){if(o+='<td style="border:1px solid #ccc;padding:4px;">',t.content){const{generateTextBoxHtml:e}=require("./pptxjs-text-utils");o+=e(t.content)}o+="</td>"}o+="</tr>"}return o+="</table>",o+="</div>",o}generateChartHtml(t){const e=96/914400,r=Math.round(t.position.x*e),n=Math.round(t.position.y*e),i=Math.round(t.size.width*e),s=Math.round(t.size.height*e);return`<div \n      class="slide-chart" \n      id="chart-${t.id}" \n      style="position:absolute;left:${r}px;top:${n}px;width:${i}px;height:${s}px;"\n    >Chart: ${t.name}</div>`}}const Be=(t,e)=>{const{createDocument:r}=require("./elements"),n=r({slides:[t],props:{width:960,height:540}});return n.getSlide(0)?.toHTML()||""},Re=(t,e)=>{const{createDocument:r}=require("./elements");return r(t).slides.map(t=>t.toHTML())},ze=(t,e)=>{const{createDocument:r}=require("./elements");return r(t).toHTML({...e,withNavigation:!1})},Oe={utils:Lt,parse:Bt,serialize:Rt};export{M as BaseElement,j as ChartElement,pe as ColorType,L as DiagramElement,tt as DocumentElement,n as EMU_PER_INCH,R as GroupElement,Ot as HtmlGenerator,D as ImageElement,U as LayoutElement,Y as MasterElement,r as NS,Z as NotesMasterElement,Q as NotesSlideElement,E as OleElement,i as PIXELS_PER_INCH,ae as PPTXJS_CONSTANTS,q as PlaceholderElement,Lt as PptParseUtils,_ as PptxDocument,Le as Pptxjs,le as PptxjsCoreParser,je as PptxjsParser,N as ShapeElement,X as SlideElement,he as THEME_COLORS,B as TableElement,K as TagsElement,ce as angleToDegrees,ye as applyColorMap,Wt as base64ArrayBuffer,et as createDocument,V as createElementFromData,rt as createElementFromNode,Ut as deepClone,re as deepMerge,Oe as default,de as degreesToRadians,Qt as delay,d as emu2px,ie as formatFileSize,xe as generateCssColor,_t as generateDataUrl,Ht as generateHtml,Me as generateTextBoxHtml,Zt as generateUniqueId,me as getAlphaValue,h as getAttrs,ue as getColorValue,Ne as getDefaultTextStyle,Gt as getImageBase64,Xt as getImageMimeType,ge as getPresetColor,Se as getTextByPathList,fe as getThemeColor,$e as hexToRgba,Yt as isRtlLanguage,Kt as isValidHexColor,oe as memoize,Pe as mergeTextStyles,Jt as normalizeHexColor,be as parseColorFill,we as parseColorMapOverride,$ as parseMetadata,Bt as parsePptx,y as parseRels,Ce as parseTextBoxContent,Re as ppt2HTML,ze as ppt2HTMLDocument,p as px2emu,te as retry,qt as safeParseFloat,Vt as safeParseInt,Rt as serializePptx,Be as slide2HTML,se as truncateString,ee as unique};
//# sourceMappingURL=ppt-parser.esm.js.map
