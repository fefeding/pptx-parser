"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("jszip"),e=require("html-escaper");const r={p:"http://schemas.openxmlformats.org/presentationml/2006/main",a:"http://schemas.openxmlformats.org/drawingml/2006/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",mc:"http://schemas.openxmlformats.org/markup-compatibility/2006",c:"http://schemas.openxmlformats.org/drawingml/2006/chart",d:"http://schemas.openxmlformats.org/drawingml/2006/diagram"},n=914400,s=96/n,i="ppt/slides/",o="ppt/slides/_rels/",a="docProps/",l="ppt/slideLayouts/";function c(t){const e="string"==typeof t?parseInt(t||"0",10):t;return Math.round(e*s*100)/100}function p(t){return Math.round(9525*t)}function d(t){const e={};return t?.attributes?(Array.from(t.attributes).forEach(t=>{e[t.name]=t.value}),e):e}function h(t,e,r){return t?Array.from(t.getElementsByTagNameNS(r,e)):[]}function u(t,e,r){return t&&t.getElementsByTagNameNS(r,e)[0]||null}function f(t,e,r=""){return t&&t.getAttribute(e)||r}function g(t,e){if(!t)return!1;const r=t.getAttribute(e);return"1"===r||"true"===r}function m(t){const e=(new DOMParser).parseFromString(t,"application/xml"),r=Array.from(e.documentElement.children),n={};return r.forEach(t=>{const e=t.getAttribute("Id"),r=t.getAttribute("Type"),s=t.getAttribute("Target");e&&(n[e]={id:e,type:r||"",target:s||""})}),n}function y(t,e){if(!e)return e;e.startsWith("/")&&(e=e.substring(1));const r=t.indexOf("_rels/");let n=t;-1!==r&&(n=t.substring(0,r));const s=(n+e).split("/"),i=[];for(const t of s)""!==t&&"."!==t&&(".."===t?i.length>0&&i.pop():i.push(t));return i.join("/")}function b(t,e){const r=m(t);for(const t in r){const n=r[t];n.target=y(e,n.target)}return r}function x(t){const e=(new DOMParser).parseFromString(t,"application/xml"),r="http://purl.org/dc/elements/1.1/",n="http://purl.org/dc/terms/",s=(t,r)=>{const n=e.getElementsByTagNameNS(r,t)[0];return n?.textContent||void 0};return{title:s("title",r),author:s("creator",r),subject:s("subject",r),keywords:s("keywords","http://schemas.openxmlformats.org/package/2006/metadata/core-properties"),created:s("created",n),modified:s("modified",n)}}const $="v-up",w="v-mid",v="v-down",S="h-left",A="h-mid",F="h-right";function T(t,e){const r=function(t){return t&&{left:S,center:A,right:F}[t]||""}(t),n=function(t){return t&&{top:$,middle:w,bottom:v}[t]||""}(e);return r&&n?`${n.replace("v-","")}_${r.replace("h-","")}`:`${n} ${r}`.trim()}function C(t,e,r){return t.find(t=>t.type===e)}function k(t="ppt-node"){return`${t}-${Date.now()}-${Math.floor(1e4*Math.random())}`}function P(t,e,r){{const n=`[pptx-parser ${t.toUpperCase()}]`;void 0!==r?console[t](n,e,r):console[t](n,e)}}class I{constructor(t,e,r,n={},s={},i={}){this.id=t,this.rect=r,this.style={fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1},this.content=n,this.props=s,this.relsMap=i,this.name="",this.hidden=!1}getContainerStyle(){const{x:t,y:e,width:r,height:n}=this.rect,s=["position: absolute",`top: ${e}px`,`left: ${t}px`,`width: ${r}px`,`height: ${n}px`];return void 0!==this.zIndex&&s.push(`z-index: ${this.zIndex}`),this.hidden&&s.push("display: none"),s.join("; ")}getDataAttributes(){const t={};return this.id&&(t["data-id"]=this.id),t["data-type"]=this.type,void 0!==this.idx&&(t["data-idx"]=String(this.idx)),this.name&&(t["data-name"]=this.name),t}formatDataAttributes(){const t=this.getDataAttributes();return Object.entries(t).map(([t,e])=>`${t}="${e}"`).join(" ")}parsePosition(t,e="spPr",n=r.p){const s=u(t,e,n);return s?function(t){const e=u(t,"xfrm",r.a);if(!e)return{x:0,y:0,width:0,height:0};const n=u(e,"off",r.a),s=u(e,"ext",r.a);return{x:n?c(n.getAttribute("x")||"0"):0,y:n?c(n.getAttribute("y")||"0"):0,width:s?c(s.getAttribute("cx")||"0"):0,height:s?c(s.getAttribute("cy")||"0"):0}}(s):{x:0,y:0,width:0,height:0}}parseIdAndName(t,e,n=r.p){const s=u(t,e,n),i=s?u(s,"cNvPr",n):null;return{id:f(i,"id",this.generateId()),name:f(i,"name",""),hidden:g(i,"hidden")}}generateId(){return`el_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getAttributes(t){return d(t)}}class M extends I{constructor(){super(...arguments),this.type="shape"}static fromNode(t,e){try{const n=new M("","shape",{x:0,y:0,width:0,height:0},{},{},e),s=u(t,"nvSpPr",r.p),i=s?u(s,"cNvPr",r.p):null;n.id=f(i,"id",n.generateId()),n.name=f(i,"name",""),n.hidden=g(i,"hidden"),n.idx=i?parseInt(i.getAttribute("idx")||"0"):void 0;const o=s?u(s,"nvPr",r.p):null,a=o?u(o,"ph",r.p):null;n.isPlaceholder=!!a;const l=a?.getAttribute("type");if(l){["title","body","dateTime","slideNumber","footer","other"].includes(l)?n.placeholderType=l:n.placeholderType="other"}const c=u(t,"spPr",r.p);n.parseShapeProperties(c,t);const p=u(t,"txBody",r.p);return p&&n.parseTextBody(p,t,e),n.shapeType=n.detectShapeType(c),n.type=n.text||n.textStyle?"text":"shape",n.rawNode=t,n}catch(t){return console.error("Failed to parse shape element:",t),null}}parseShapeProperties(t,e){if(!t)return;const n=u(t,"xfrm",r.a);if(n){const t=u(n,"off",r.a),e=u(n,"ext",r.a);t&&(this.rect.x=c(t.getAttribute("x")||"0"),this.rect.y=c(t.getAttribute("y")||"0")),e&&(this.rect.width=c(e.getAttribute("cx")||"0"),this.rect.height=c(e.getAttribute("cy")||"0"));const s=n.getAttribute("rot");null!==s&&(this.rotation=parseInt(s)/6e4),this.flipH="1"===n.getAttribute("flipH"),this.flipV="1"===n.getAttribute("flipV")}this.parseFill(t)}parseFill(t){const e=u(t,"solidFill",r.a);if(e){const t=u(e,"srgbClr",r.a);t?.getAttribute("val")&&(this.style.backgroundColor=`#${t.getAttribute("val")}`);const n=u(e,"schemeClr",r.a);n?.getAttribute("val")&&(this.style.backgroundColor=n.getAttribute("val")||"transparent")}const n=u(t,"gradFill",r.a);if(n){const t=this.parseGradientFill(n);t&&(this.style.background=this.generateGradientCSS(t))}}parseGradientFill(t){const e={type:"linear",stops:[]},n=u(t,"lin",r.a),s=u(t,"path",r.a);if(u(t,"tileRect",r.a),n){e.type="linear";const t=n.getAttribute("ang");e.angle=t?parseInt(t)/6e4%360:0}else if(s){e.type="path";const t=s.getAttribute("path");t&&(e.direction=t)}else e.type="radial";const i=u(t,"gsLst",r.a);if(i){const t=Array.from(i.children).filter(t=>"a:gs"===t.tagName||t.tagName.includes(":gs"));for(const r of t){const t=this.parseGradientStopColor(r),n=r.getAttribute("pos");t&&e.stops.push({color:t,position:n?parseInt(n)/1e5:0})}}return 0===e.stops.length&&e.stops.push({color:"#000000",position:0},{color:"#ffffff",position:100}),e}parseGradientStopColor(t){const e=u(t,"solidFill",r.a);if(!e)return null;const n=u(e,"srgbClr",r.a);if(n?.getAttribute("val"))return`#${n.getAttribute("val")}`;const s=u(e,"schemeClr",r.a);if(s?.getAttribute("val"))return s.getAttribute("val")||null;const i=u(e,"sysClr",r.a);return i?.getAttribute("val")&&i.getAttribute("val")||null}generateGradientCSS(t){const e=[...t.stops].sort((t,e)=>t.position-e.position).map(t=>`${t.color} ${t.position}%`).join(", ");switch(t.type){case"linear":return`linear-gradient(${void 0!==t.angle?t.angle:0}deg, ${e})`;case"radial":return`radial-gradient(circle, ${e})`;case"path":return`radial-gradient(${t.direction||"circle"}, ${e})`;default:return`linear-gradient(${e})`}}parseTextBody(t,e,n){const s=h(t,"p",r.a);this.textStyle=s.flatMap(t=>this.parseParagraph(t,e,n)),this.text=this.textStyle.map(t=>t.text).join("");const i=t.querySelector("a\\:p, p\\:p a\\:p"),o=i?u(i,"pPr",r.a):null;if(o){const t=u(o,"spcBef",r.a),e=t?parseInt(f(t,"spcPts","0"))/100:0,n=u(o,"spcAft",r.a),s=n?parseInt(f(n,"spcPts","0"))/100:0,i=u(o,"lnSpc",r.a),a=i?parseInt(f(i,"spcPts","0"))/100:0,l=u(o,"marL",r.a),c=l?parseInt(l.getAttribute("val")||"0")/100:0,p=u(o,"marR",r.a),d=p?parseInt(p.getAttribute("val")||"0")/100:0,h=u(o,"insT",r.a),g=h?parseInt(h.getAttribute("val")||"0")/100:0,m=u(o,"insB",r.a),y=m?parseInt(m.getAttribute("val")||"0")/100:0,b=o.getAttribute("indent"),x=b?parseInt(b)/100:0;this.paragraphStyle={align:o.getAttribute("algn")||void 0,indent:x,lineSpacing:a,spaceBefore:e,spaceAfter:s,marginLeft:c,marginRight:d,paddingTop:g,paddingBottom:y,rtl:"1"===o.getAttribute("rtl")},this.style.spaceBefore=e,this.style.spaceAfter=s,this.style.paddingTop=g,this.style.paddingBottom=y,this.style.marginLeft=c,this.style.marginRight=d}}parseParagraph(t,e,n){const s=[];this.bulletStyle=this.parseBulletStyle(t);const i=u(t,"pPr",r.a),o=i?u(i,"defRPr",r.a):null,a=o?this.parseRunProperties(o):{},l=h(t,"r",r.a);for(const t of l){const e=this.parseTextRun(t,n,a);e&&s.push(e)}const c=u(t,"endParaRPr",r.a);if(c){const t=this.parseRunProperties(c);s.forEach(e=>{!e.fontSize&&t.fontSize&&(e.fontSize=t.fontSize),!e.fontFamily&&t.fontFamily&&(e.fontFamily=t.fontFamily),!e.color&&t.color&&(e.color=t.color)})}const p=u(t,"hlinkClick",r.a);if(p){const t=p.getAttributeNS(r.r,"id")||p.getAttribute("r:id")||"";t&&n[t]&&(this.hyperlink={id:t,url:n[t].target,tooltip:p.getAttribute("tooltip")||void 0})}return s}parseBulletStyle(t){const e=u(t,"pPr",r.a);if(!e)return{};if(u(e,"buNone",r.a))return{type:"none"};const n=u(e,"buChar",r.a);if(n){return{type:"char",char:n.getAttribute("char")||"•",font:n.getAttribute("font")||void 0,color:this.parseColor(n),size:parseInt(n.getAttribute("sz")||"100")/100}}const s=u(e,"buBlip",r.a);if(s){return{type:"blip",imageSrc:s.getAttributeNS(r.r,"embed")||s.getAttribute("r:embed")||""}}const i=u(e,"buAutoNum",r.a);return i?{type:"autoNum",autoNumType:i.getAttribute("type")||"arabic",level:parseInt(i.getAttribute("startAt")||"1")}:{type:"none"}}parseTextRun(t,e,n={}){const s=u(t,"rPr",r.a),i=u(t,"t",r.a);if(!i)return null;const o={text:i.textContent||"",...n};if(s){const t=this.parseRunProperties(s);Object.assign(o,t)}return o}parseRunProperties(t){const e={};let n;const s=t.getAttribute("sz");if(s)n=parseInt(s)/100;else{const e=u(t,"sz",r.a);if(e){const t=e.getAttribute("val");t&&(n=parseInt(t)/100)}}void 0!==n&&(e.fontSize=n*(4/3));const i=u(t,"latin",r.a),o=u(t,"ea",r.a),a=u(t,"cs",r.a),l=i?.getAttribute("typeface"),c=o?.getAttribute("typeface"),p=a?.getAttribute("typeface");l?e.fontFamily=l:c?e.fontFamily=c:p&&(e.fontFamily=p),"1"===t.getAttribute("b")&&(e.bold=!0),"1"===t.getAttribute("i")&&(e.italic=!0);const d=t.getAttribute("u");d&&(e.underline="none"===d?"none":"underline"),"1"===t.getAttribute("strike")&&(e.strike=!0);const h=u(t,"solidFill",r.a);if(h){const t=u(h,"srgbClr",r.a);if(t?.getAttribute("val")){const r=`#${t.getAttribute("val")}`;e.color=r,this.style.color=r}}const f=u(t,"highlight",r.a);if(f){const t=u(f,"srgbClr",r.a);t?.getAttribute("val")&&(e.backgroundColor=`#${t.getAttribute("val")}`)}const g=u(t,"kern",r.a);if(g){const t=g.getAttribute("val");t&&(e.letterSpacing=parseInt(t)/100)}return e}parseColor(t){const e=u(t,"solidFill",r.a);if(e){const t=u(e,"srgbClr",r.a);if(t?.getAttribute("val"))return`#${t.getAttribute("val")}`}}detectShapeType(t){if(!t)return"rectangle";const e=u(t,"prstGeom",r.a);if(e){const t=e.getAttribute("prst")||"";return{rect:"rectangle",ellipse:"ellipse",roundRect:"roundedRectangle",triangle:"triangle",diamond:"diamond",pentagon:"pentagon",hexagon:"hexagon",octagon:"octagon",star4:"star",star5:"5-point star",star6:"6-point star",star8:"8-point star",star10:"10-point star",star12:"12-point star",star16:"16-point star",star24:"24-point star",star32:"32-point star",heart:"heart",lightning:"lightning",sun:"sun",moon:"moon",cloud:"cloud",arrow:"arrow",bentArrow:"bent arrow",chevron:"chevron",home:"home",cube:"cube",bevel:"bevel",donut:"donut",noSmoking:"noSmoking",blockArc:"blockArc",foldedCorner:"foldedCorner",smileyFace:"smileyFace"}[t]||t}return u(t,"custGeom",r.a)?"custom":"rectangle"}toHTML(){const t=this.formatDataAttributes(),e=this.generateBlockStyle(),r=this.generateBlockClasses(),n=this.generateInnerHTML();return`<div class="${r.join(" ")}" ${t} style="${e}">\n      ${n}\n    </div>`}generateBlockStyle(){const{x:t,y:e,width:r,height:n}=this.rect,s=["position: absolute",`top: ${e}px`,`left: ${t}px`,`width: ${r}px`,`height: ${n}px`];return this.style.borderWidth&&parseFloat(this.style.borderWidth)>0&&this.style.borderColor?s.push(`border: ${this.style.borderWidth}px solid ${this.style.borderColor}`):s.push("border: none"),this.style.backgroundColor&&"transparent"!==this.style.backgroundColor?s.push(`background-color: ${this.style.backgroundColor}`):s.push("background-color: transparent"),void 0!==this.zIndex?s.push(`z-index: ${this.zIndex}`):s.push("z-index: 1"),this.rotation?s.push(`transform: rotate(${this.rotation}deg)`):s.push("transform: rotate(0deg)"),s.join("; ")}generateBlockClasses(){const t=["block"];return this.rect.y<100&&t.push("v-up"),("text"===this.type||this.isPlaceholder)&&t.push("content"),t}generateInnerHTML(){if("text"===this.type&&this.text){const{width:t,height:e}=this.rect;return`<div style="display: flex; width: ${t}px;" class="slide-prgrph ${this.getAlignClass()} pregraph-ltr">\n        <div style="${["height: 100%","direction: "+(this.paragraphStyle?.rtl?"rtl":"initial"),"overflow-wrap: break-word","word-wrap: break-word",`width: ${t}px`].join("; ")}; background: transparent;">\n          ${this.renderTextContentPPTXjs()}\n        </div>\n      </div>`}return""}renderTextContentPPTXjs(){return this.textStyle&&0!==this.textStyle.length?this.textStyle.map(t=>`<span class="text-block" style="${this.generateTextRunStyle(t).join("; ")}">${this.escapeHtml(t.text)}</span>`).join(""):`<span class="text-block" style="${this.generateTextSpanStyle()}">${this.escapeHtml(this.text||"")}</span>`}generateTextSpanStyle(){const t=[`font-size: ${this.style.fontSize||14}px`,`font-family: ${this.style.fontFamily||"inherit"}`,`font-weight: ${this.style.fontWeight||"inherit"}`,`font-style: ${this.style.fontStyle||"inherit"}`,`text-decoration: ${this.style.textDecoration||"inherit"}`,`text-align: ${this.paragraphStyle?.align||"left"}`,"vertical-align: baseline"];return this.style.color&&t.push(`color: ${this.style.color}`),t.join("; ")}generateTextRunStyle(t){const e=[];return t.fontSize&&t.fontSize>0&&e.push(`font-size: ${t.fontSize}px`),t.fontFamily&&e.push(`font-family: ${t.fontFamily}`),void 0!==t.bold?e.push("font-weight: "+(t.bold?"bold":"normal")):t.fontWeight&&e.push(`font-weight: ${t.fontWeight}`),void 0!==t.italic?e.push("font-style: "+(t.italic?"italic":"normal")):t.fontStyle&&e.push(`font-style: ${t.fontStyle}`),t.underline&&"none"!==t.underline?e.push("text-decoration: underline"):t.textDecoration&&e.push(`text-decoration: ${t.textDecoration}`),t.color&&e.push(`color: ${t.color}`),e.push(`text-align: ${this.paragraphStyle?.align||"left"}`),e.push("vertical-align: baseline"),e}renderTextContent(){return this.textStyle&&0!==this.textStyle.length?this.textStyle.map(t=>{const e=[];t.fontSize&&t.fontSize>0&&e.push(`font-size: ${t.fontSize}px`),t.fontFamily&&e.push(`font-family: ${t.fontFamily}`),void 0!==t.bold?e.push("font-weight: "+(t.bold?"bold":"normal")):e.push("font-weight: inherit"),void 0!==t.italic?e.push("font-style: "+(t.italic?"italic":"normal")):e.push("font-style: inherit"),t.underline&&"none"!==t.underline?e.push("text-decoration: underline"):e.push("text-decoration: inherit"),t.color&&e.push(`color: ${t.color}`),e.push(`text-align: ${this.paragraphStyle?.align||"left"}`),e.push("vertical-align: baseline");return`<span class="text-block" style="${e.join(";")}">${this.escapeHtml(t.text)}</span>`}).join(""):`<span class="text-block" style="font-size:${this.style.fontSize||14}px;">${this.escapeHtml(this.text||"")}</span>`}getTextStyle(){const t=["display: flex","align-items: center",`justify-content: ${this.textStyleFromAlign(this.paragraphStyle?.align)}`,"width: 100%","height: 100%","box-sizing: border-box"];if(this.style.spaceBefore&&t.push(`padding-top: ${this.style.spaceBefore}px`),this.style.spaceAfter&&t.push(`padding-bottom: ${this.style.spaceAfter}px`),this.style.paddingTop&&t.push(`margin-top: ${this.style.paddingTop}px`),this.style.paddingBottom&&t.push(`margin-bottom: ${this.style.paddingBottom}px`),this.style.padding)t.push(`padding-left: ${this.style.padding}`),t.push(`padding-right: ${this.style.padding}`);else{const e=this.style.marginLeft||10,r=this.style.marginRight||10;t.push(`padding-left: ${e}px`),t.push(`padding-right: ${r}px`)}return this.text,this.textStyle&&this.textStyle.length>0&&this.textStyle.map(t=>{const e=[];t.fontSize&&t.fontSize>0&&e.push(`font-size: ${t.fontSize}px`),t.color&&e.push(`color: ${t.color}`),t.fontFamily&&e.push(`font-family: ${t.fontFamily}`),t.bold&&e.push("font-weight: bold"),t.italic&&e.push("font-style: italic"),t.underline&&"none"!==t.underline&&e.push("text-decoration: underline"),t.strike&&e.push("text-decoration: line-through"),t.backgroundColor&&e.push(`background-color: ${t.backgroundColor}`),t.letterSpacing&&e.push(`letter-spacing: ${t.letterSpacing}px`);return`<span${e.length>0?` style="${e.join("; ")}"`:""}>${this.escapeHtml(t.text)}</span>`}).join(""),t.join("; ")+";>CONTENT"}getRotationStyle(){return void 0===this.rotation||0===this.rotation?"":`transform: rotate(${this.rotation}deg); transform-origin: center;`}getShapeStyle(){return[`background-color: ${this.style.backgroundColor||"#ffffff"}`,`border: ${this.style.borderWidth}px solid ${this.style.borderColor}`].join("; ")}textStyleFromAlign(t){switch(t){case"right":return"flex-end";case"center":case"justify":return"center";default:return"flex-start"}}getAlignClass(){switch(this.paragraphStyle?.align||"left"){case"center":return"h-mid";case"right":return"h-right";default:return"h-left"}}textStyleFromFontSize(){return this.textStyle?.[0]?.fontSize?this.textStyle[0].fontSize:this.style.fontSize||14}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}parseStyleString(t){return t.split(";").filter(t=>t.trim())}toParsedElement(){return{id:this.id,type:"shape",rect:this.rect,style:this.style,content:this.content,props:{isPlaceholder:this.isPlaceholder,placeholderType:this.placeholderType,shapeType:this.shapeType,textStyle:this.textStyle,paragraphStyle:this.paragraphStyle,bulletStyle:this.bulletStyle,hyperlink:this.hyperlink,rotation:this.rotation},name:this.name,hidden:this.hidden,text:this.text,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class N extends I{constructor(){super(...arguments),this.type="image",this.mediaType="image",this.src="",this.relId=""}static fromNode(t,e){try{const n=new N("","image",{x:0,y:0,width:0,height:0},"",{},e),s=u(t,"nvPicPr",r.p),i=s?u(s,"cNvPr",r.p):null;n.id=f(i,"id",n.generateId()),n.name=f(i,"name",""),n.hidden=g(i,"hidden"),n.altText=f(i,"descr","");u(t,"spPr",r.p);n.rect=n.parsePosition(t);const o=u(t,"blipFill",r.p);let a="";if(o){const t=u(o,"blip",r.a);a=t?.getAttributeNS(r.r,"embed")||t?.getAttribute("r:embed")||""}const l=s?u(s,"nvPr",r.p):null,c=l?u(l,"videoFile",r.a):null,p=l?u(l,"audioFile",r.a):null;return c?(n.mediaType="video",n.videoInfo=n.parseVideoInfo(c,a,e),n.src=n.videoInfo.src,n.relId=a):p?(n.mediaType="audio",n.audioInfo=n.parseAudioInfo(p,a,e),n.src=n.audioInfo.src,n.relId=a):(n.mediaType="image",n.src=n.parseImageSrc(a,e,t),n.relId=a,n.src.endsWith(".png")?n.mimeType="image/png":n.src.endsWith(".jpg")||n.src.endsWith(".jpeg")?n.mimeType="image/jpeg":n.src.endsWith(".gif")?n.mimeType="image/gif":n.src.endsWith(".svg")&&(n.mimeType="image/svg+xml")),n.content={src:n.src,alt:n.altText,mediaType:n.mediaType,videoInfo:n.videoInfo,audioInfo:n.audioInfo},n.props={imgId:a,mimeType:n.mimeType,mediaType:n.mediaType},n.rawNode=t,n}catch(t){return console.error("Failed to parse image element:",t),null}}parseVideoInfo(t,e,n){const s=t.getAttribute("link"),i=t.getAttributeNS(r.r,"link")||"";if(s)return{src:s,type:"link",autoplay:!0,muted:!1,controls:!0,loop:!1};{const t=n[i]?.target||"";return{src:t,type:"blob",format:this.detectVideoFormat(t),autoplay:!1,muted:!1,controls:!0,loop:!1}}}parseAudioInfo(t,e,n){const s=t.getAttribute("link"),i=t.getAttributeNS(r.r,"link")||"";if(s)return{src:s,type:"link",autoplay:!0,muted:!1,controls:!0,loop:!1};{const t=n[i]?.target||"";return{src:t,type:"blob",format:this.detectAudioFormat(t),autoplay:!1,muted:!1,controls:!0,loop:!1}}}parseImageSrc(t,e,r){if(!t||!e[t])return"";return e[t].target}detectVideoFormat(t){return t.endsWith(".mp4")?"mp4":t.endsWith(".webm")?"webm":t.endsWith(".ogg")?"ogg":void 0}detectAudioFormat(t){return t.endsWith(".mp3")?"mp3":t.endsWith(".wav")?"wav":t.endsWith(".ogg")?"ogg":void 0}getFilePath(){return"image"===this.mediaType&&this.relId&&this.relsMap[this.relId]?this.relsMap[this.relId].target:"video"===this.mediaType&&this.videoInfo&&"blob"===this.videoInfo.type?this.videoInfo.src:"audio"===this.mediaType&&this.audioInfo&&"blob"===this.audioInfo.type?this.audioInfo.src:""}getDataAttributes(){const t=super.getDataAttributes(),e=this.getFilePath();return e&&(t["data-file"]=e),this.relId&&(t["data-rel-id"]=this.relId),t}toHTML(){const t=this.getContainerStyle();return"video"===this.mediaType&&this.videoInfo?this.toVideoHTML(t):"audio"===this.mediaType&&this.audioInfo?this.toAudioHTML(t):this.toImageHTML(t)}toImageHTML(t){const e=["width: 100%","height: 100%","object-fit: contain"].join("; ");return`<div ${this.formatDataAttributes()} style="${t}">\n      <img src="${this.src}" alt="${this.altText||""}" style="${e}" />\n    </div>`}toVideoHTML(t){const e=this.videoInfo,r=["width: 100%","height: 100%","object-fit: contain"].join("; "),n=this.formatDataAttributes();return"link"===e.type?`<div ${n} style="${t}">\n        <iframe\n          src="${e.src}"\n          style="${r}"\n          frameborder="0"\n          allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"\n          allowfullscreen>\n        </iframe>\n      </div>`:`<div ${n} style="${t}">\n        <video\n          src="${e.src}"\n          style="${r}"\n          ${e.autoplay?"autoplay":""}\n          ${e.muted?"muted":""}\n          ${e.loop?"loop":""}\n          ${e.controls?"controls":""}>\n          ${this.getVideoSourceTag(e.format)}\n        </video>\n      </div>`}getVideoSourceTag(t){if(!t)return"";const e={mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg"}[t];return e?`<source src="${this.videoInfo?.src}" type="${e}" />`:""}toAudioHTML(t){const e=this.audioInfo,r=["width: 100%","display: block"].join("; "),n=this.formatDataAttributes();return"link"===e.type?`<div ${n} style="${t}">\n        <audio\n          src="${e.src}"\n          style="${r}"\n          ${e.autoplay?"autoplay":""}\n          ${e.muted?"muted":""}\n          ${e.loop?"loop":""}\n          ${e.controls?"controls":""}>\n        </audio>\n      </div>`:`<div ${n} style="${t}">\n        <audio id="audio_${this.id}" style="${r}" ${e.controls?"controls":""}>\n          ${this.getAudioSourceTag(e.format)}\n        </audio>\n      </div>`}getAudioSourceTag(t){if(!t)return"";const e={mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg"}[t];return e?`<source src="${this.audioInfo?.src}" type="${e}" />`:""}toParsedElement(){return{id:this.id,type:"image",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,relId:this.relId,src:this.src,altText:this.altText,mimeType:this.mimeType,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class E extends I{static fromNode(t,e){try{const n=u(t,"oleObj",r.p);if(!n){const n=u(t,"Fallback",r.mc);if(n){const t=u(n,"pic",r.p);if(t){const r=N.fromNode(t,e);if(r)return new E(r.id,r.rect,"",r.relId,{...r.props,isOle:!0,hasFallback:!0},e)}}return null}const s=n.getAttribute("progId")||"",i=n.getAttributeNS(r.r,"id")||n.getAttribute("r:id")||"",o=new E("",{x:0,y:0,width:0,height:0},s,i,{},e),a=u(t,"nvGraphicFramePr",r.p),l=a?u(a,"cNvPr",r.p):null;o.id=f(l,"id",o.generateId()),o.name=f(l,"name",""),o.hidden=g(l,"hidden"),o.oleName=o.name;const p=u(t,"xfrm",r.p);if(p){const t=u(p,"off",r.a),e=u(p,"ext",r.a);t&&e&&(o.rect.x=c(t.getAttribute("x")||"0"),o.rect.y=c(t.getAttribute("y")||"0"),o.rect.width=c(e.getAttribute("cx")||"0"),o.rect.height=c(e.getAttribute("cy")||"0"))}return o.content={},o.props={progId:s,relId:i,hasFallback:!1},o.rawNode=t,o}catch(t){return console.error("Failed to parse OLE element:",t),null}}constructor(t,e,r,n,s={},i={}){super(t,"ole",e,s,i),this.type="ole",this.progId=r,this.relId=n,this.oleName=""}toHTML(){const t=this.getContainerStyle();return`<div ${this.formatDataAttributes()} style="${t}">\n      <div style="${["width: 100%","height: 100%","display: flex","align-items: center","justify-content: center","background-color: #f5f5f5","border: 1px dashed #ccc","color: #666","font-size: 12px","text-align: center","padding: 10px"].join("; ")}">\n        ${this.progId||this.oleName||"OLE Object"}\n      </div>\n    </div>`}toParsedElement(){return{id:this.id,type:"ole",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,relId:this.relId,progId:this.progId,hasFallback:this.hasFallback,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class D extends I{constructor(){super(...arguments),this.type="chart",this.relId=""}static fromNode(t,e){try{const n=u(t,"nvGraphicFramePr",r.p),s=n?u(n,"cNvPr",r.p):null,i=f(s,"id",`chart_${Date.now()}`),o=f(s,"name",""),a=g(s,"hidden"),l=u(t,"xfrm",r.p);let p={x:0,y:0,width:0,height:0};if(l){const t=u(l,"off",r.a),e=u(l,"ext",r.a);t&&(p.x=c(t.getAttribute("x")||"0"),p.y=c(t.getAttribute("y")||"0")),e&&(p.width=c(e.getAttribute("cx")||"0"),p.height=c(e.getAttribute("cy")||"0"))}const d=new D(i,"chart",p,"",{},e);d.name=o,d.hidden=a;const h=u(t,"graphic",r.a),m=h?u(h,"graphicData",r.a):null;if(!m)return null;if(!(m.getAttribute("uri")||"").includes("chart"))return null;const y=u(m,"chart",r.c);if(!y)return null;const b=y.getAttribute("type")||"unknown",x=y.getAttributeNS(r.r,"id")||y.getAttribute("r:id")||"";if(d.chartType=d.detectChartType(y),d.relId=x,d.content={chartType:"unknown",data:[]},d.props={relId:x,chartType:b},d.rawNode=t,x&&e[x]){const t=e[x].target;console.log(`Chart file path: ${t}`)}return d}catch(t){return console.error("Failed to parse chart element:",t),null}}detectChartType(t){const e=Array.from(t.children);for(const t of e){const e=t.tagName;if(e.includes("lineChart"))return"lineChart";if(e.includes("barChart"))return"barChart";if(e.includes("pieChart"))return e.includes("3D")?"pie3DChart":"pieChart";if(e.includes("areaChart"))return"areaChart";if(e.includes("scatterChart"))return"scatterChart"}return"unknown"}toHTML(){const t=this.getContainerStyle(),e=this.formatDataAttributes(),r=["width: 100%","height: 100%","display: flex","align-items: center","justify-content: center","background-color: #fafafa","border: 1px solid #ddd","color: #333","font-size: 14px","text-align: center","border-radius: 4px","padding: 20px"].join("; "),n=this.getChartLabel();return this.chartData&&Array.isArray(this.chartData.series)&&this.chartData.series.length>0?`<div ${e} style="${t}">\n        <div style="width: 100%;">\n          <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">\n            ${this.chartData?.title||"Chart"}\n          </div>\n          ${this.renderChartData()}\n        </div>\n      </div>`:`<div ${e} style="${t}">\n      <div style="${r}">\n        ${n}\n      </div>\n    </div>`}getChartLabel(){const t={lineChart:"折线图",barChart:"柱状图",pieChart:"饼图",pie3DChart:"3D饼图",areaChart:"面积图",scatterChart:"散点图",unknown:"图表"};return this.chartType&&t[this.chartType]||"Chart"}renderChartData(){if(!this.chartData||!this.chartData.series)return"";const t=this.chartData;let e='<div style="margin: 10px 0;">';return t.xTitle&&(e+=`<div style="font-size: 12px; color: #666; margin-bottom: 5px;">X轴: ${t.xTitle}</div>`),t.yTitle&&(e+=`<div style="font-size: 12px; color: #666; margin-bottom: 10px;">Y轴: ${t.yTitle}</div>`),e+='<div style="display: flex; flex-wrap: wrap; gap: 10px;">',t.series&&t.series.forEach((t,r)=>{e+=`\n          <div style="\n            background: ${t.color||"#4285f4"};\n            color: white;\n            padding: 10px;\n            border-radius: 4px;\n            min-width: 150px;\n          ">\n            <div style="font-weight: bold;">${t.name||`系列 ${r+1}`}</div>\n            <div style="font-size: 12px; margin-top: 5px;">\n              数据点: ${t.points?.length||0}\n            </div>\n          </div>\n        `}),e+="</div>",e+="</div>",e}toParsedElement(){return{id:this.id,type:"chart",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,relId:this.relId,chartType:this.chartType,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class j extends I{constructor(t,e,r={},n={},s={}){super(t,"diagram",e,r,n,s),this.type="diagram",this.relId=""}static fromNode(t,e){try{const n=u(t,"nvGraphicFramePr",r.p),s=n?u(n,"cNvPr",r.p):null,i=f(s,"id",`diagram_${Date.now()}`),o=f(s,"name",""),a=g(s,"hidden"),l=u(t,"xfrm",r.p);let p={x:0,y:0,width:0,height:0};if(l){const t=u(l,"off",r.a),e=u(l,"ext",r.a);t&&(p.x=c(t.getAttribute("x")||"0"),p.y=c(t.getAttribute("y")||"0")),e&&(p.width=c(e.getAttribute("cx")||"0"),p.height=c(e.getAttribute("cy")||"0"))}const d=new j(i,p,"",{},e);d.name=o,d.hidden=a;const h=u(t,"graphic",r.a),m=h?u(h,"graphicData",r.a):null;if(!m)return null;const y=m.getAttribute("uri")||"";if(!y.includes("diagram"))return null;const b=u(m,"dgm",r.d);if(!b)return null;const x=b.getAttributeNS(r.r,"rel")||b.getAttribute("r:rel")||"";return d.relId=x,d.diagramData=d.parseDiagramData(b,e),d.content={diagramData:d.diagramData},d.props={relId:x,diagramType:y},d.rawNode=t,d}catch(t){return console.error("Failed to parse diagram element:",t),null}}parseDiagramData(t,e){const n={},s=t.getAttributeNS(r.d,"relIds")||"",i=this.parseRelIds(s);i.colors&&this.relsMap[i.colors]&&(n.colors=this.fetchColorData(this.relsMap[i.colors].target)),i.data&&this.relsMap[i.data]&&(n.data=this.fetchLayoutData(this.relsMap[i.data].target)),i.layout&&this.relsMap[i.layout]&&(n.layout=this.relsMap[i.layout].target);const o=u(t,"spTree",r.d);return o&&(n.shapes=this.parseShapes(o)),n}parseRelIds(t){const e={};if(!t)return e;const r=t.split(",").map(t=>t.trim());return r.length>=1&&(e.colors=r[0]),r.length>=2&&(e.data=r[1]),r.length>=3&&(e.layout=r[2]),r.length>=4&&(e.quickStyle=r[3]),e}async fetchColorData(t){try{t.startsWith("../")&&t.substring(3);return{}}catch(t){return void console.warn("Failed to fetch color data:",t)}}async fetchLayoutData(t){try{t.startsWith("../")&&t.substring(3);return{}}catch(t){return void console.warn("Failed to fetch layout data:",t)}}fetchColorDataSync(t){return{_needsAsyncLoad:!0,target:t}}fetchLayoutDataSync(t){return{_needsAsyncLoad:!0,target:t}}parseShapes(t){const e=[],n=Array.from(t.children);for(const t of n){const n=t.getAttribute("id")||"",s=t.tagName||"shape",i=u(t,"xfrm",r.d);let o;if(i){const t=u(i,"off",r.a),a=u(i,"ext",r.d);if(t){const e=parseInt(t.getAttribute("x")||"0"),r=parseInt(t.getAttribute("y")||"0");o={x:c(e),y:c(r)}}if(a){const t=parseInt(a.getAttribute("cx")||"0"),r=parseInt(a.getAttribute("cy")||"0");e.push({id:n,type:s,position:o,size:{width:c(t),height:c(r)}})}}else e.push({id:n,type:s})}return e}toHTML(){const t=this.getContainerStyle();return`<div ${this.formatDataAttributes()} style="${t}">\n      <div style="${["width: 100%","height: 100%","display: flex","align-items: center","justify-content: center","background-color: #f0f0f0","border: 1px dashed #ccc","color: #666","font-size: 14px","text-align: center","padding: 20px","border-radius: 4px"].join("; ")}">\n        ${this.getDiagramInfo()}\n      </div>\n    </div>`}getDiagramInfo(){const t=this.diagramData?.shapes?.length||0;let e='<div style="text-align: left;">';return e+='<div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">SmartArt / Diagram</div>',e+=`<div style="margin-bottom: 10px;">形状数量: ${t}</div>`,this.diagramData?.shapes&&t>0&&(e+='<div style="margin-top: 10px;">',this.diagramData.shapes.slice(0,10).forEach((t,r)=>{e+=`<div style="\n          display: inline-block;\n          width: 60px;\n          height: 40px;\n          background: #e0e0e0;\n          border: 1px solid #ccc;\n          border-radius: 4px;\n          margin: 5px;\n          font-size: 12px;\n        ">\n          ${t.type}\n        </div>`}),t>10&&(e+=`<div style="display: inline-block; padding: 10px;">...还有 ${t-10} 个形状</div>`),e+="</div>"),e+="</div>",e}toParsedElement(){return{id:this.id,type:"diagram",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class L extends I{constructor(){super(...arguments),this.type="table",this.rows=[],this.colWidths=[]}static fromNode(t,e){try{const n=new L("","table",{x:0,y:0,width:0,height:0},{},{},e),s=u(t,"nvGraphicFramePr",r.p),i=s?u(s,"cNvPr",r.p):null;n.id=f(i,"id",n.generateId()),n.name=f(i,"name",""),n.hidden=!1;const o=u(t,"xfrm",r.p);if(o){const t=u(o,"off",r.a),e=u(o,"ext",r.a);t&&(n.rect.x=c(t.getAttribute("x")||"0"),n.rect.y=c(t.getAttribute("y")||"0")),e&&(n.rect.width=c(e.getAttribute("cx")||"0"),n.rect.height=c(e.getAttribute("cy")||"0"))}const a=u(t,"graphic",r.a),l=a?u(a,"graphicData",r.a):null;if(!l)return null;if(!(l.getAttribute("uri")||"").includes("table"))return null;const p=u(l,"tbl",r.a);return p?(n.parseTable(p),n.tableStyle=n.parseTableStyle(p),n.rtl="1"===p.getAttribute("rtl"),n.content={rows:n.rows,colWidths:n.colWidths,tableStyle:n.tableStyle},n.props={rowCount:n.rows.length,colCount:n.colWidths.length},n.rawNode=t,n):null}catch(t){return console.error("Failed to parse table element:",t),null}}parseTable(t){const e=h(t,"tr",r.a);this.rows=e.map(t=>this.parseTableRow(t));const n=h(t,"gridCol",r.a);this.colWidths=n.map(t=>c(t.getAttribute("w")||"0"))}parseTableRow(t){const e={cells:[],style:{}},n=t.getAttribute("h");n&&(e.height=c(n));const s=h(t,"tc",r.a);return e.cells=s.map(t=>this.parseTableCell(t)),e}parseTableCell(t){const e={style:{}},n=t.getAttribute("rowSpan");n&&(e.rowSpan=parseInt(n));const s=t.getAttribute("gridSpan");s&&(e.colSpan=parseInt(s));const i=u(t,"txBody",r.a);i&&(e.text=function(t){const e=h(t,"p",r.a),n=[];return e.forEach(t=>{h(t,"r",r.a).forEach(t=>{const e=u(t,"t",r.a);e?.textContent&&n.push(e.textContent)})}),n.join("")}(i));const o=u(t,"tcPr",r.a);return o&&this.parseCellStyle(o,e),e}parseCellStyle(t,e){const n=u(t,"tcBdr",r.a);if(n){const t=this.parseBorder(n,"left"),r=this.parseBorder(n,"top");this.parseBorder(n,"right"),this.parseBorder(n,"bottom"),e.style&&(e.style.borderColor=t?.color||r?.color,e.style.borderWidth=r?.width||"1px")}const s=u(t,"fill",r.a);if(s){const t=u(s,"solidFill",r.a);if(t){const n=u(t,"srgbClr",r.a);n?.getAttribute("val")&&(e.style.backgroundColor=`#${n.getAttribute("val")}`)}}const i=t.getAttribute("vAlign");i&&e.style&&(e.style.verticalAlign=i);const o=t.getAttribute("marL"),a=t.getAttribute("marR"),l=t.getAttribute("marT"),p=t.getAttribute("marB");if(e.style){const t=parseInt(o||"0"),r=parseInt(a||"0"),n=parseInt(l||"0"),s=parseInt(p||"0"),i=[];n&&i.push(`${c(n)}px`),r&&i.push(`${c(r)}px`),s&&i.push(`${c(s)}px`),t&&i.push(`${c(t)}px`),i.length>0&&(e.style.padding=i.join(" "))}}parseBorder(t,e){const n=u(t,e,r.a);if(!n)return;const s=n.getAttribute("color");return{color:s?`#${s}`:void 0,width:parseInt(n.getAttribute("sz")||"0")/100+"px"}}parseTableStyle(t){const e={},n=u(t,"wholeTbl",r.a),s=this.parseTableWholeStyle(n);s&&(s.backgroundColor&&(this.style.backgroundColor=s.backgroundColor),s.borderColor&&s.borderWidth&&(this.style.border=`${s.borderWidth} solid ${s.borderColor}`),s.shadow&&(this.style.boxShadow=this.generateBoxShadow(s.shadow)));const i=u(t,"tblBg",r.a);if(i){const t=u(i,"fill",r.a),n=u(t,"solidFill",r.a),s=u(n,"srgbClr",r.a);s?.getAttribute("val")&&(e.firstRow={backgroundColor:`#${s.getAttribute("val")}`})}const o=u(t,"firstRow",r.a);o&&(e.firstRow=this.parseRowStyle(o));const a=u(t,"lastRow",r.a);a&&(e.lastRow={backgroundColor:this.parseRowBackgroundColor(a)});const l=u(t,"firstCol",r.a);l&&(e.firstCol={backgroundColor:this.parseRowBackgroundColor(l)});const c=u(t,"lastCol",r.a);c&&(e.lastCol={backgroundColor:this.parseRowBackgroundColor(c)});const p=u(t,"band1H",r.a);p&&(e.bandRow={odd:{backgroundColor:this.parseRowBackgroundColor(p)}});const d=u(t,"band2H",r.a);return d&&(e.bandRow||(e.bandRow={}),e.bandRow.even={backgroundColor:this.parseRowBackgroundColor(d)}),e}parseRowStyle(t){const e=u(t,"fill",r.a);if(e){const t=u(e,"solidFill",r.a),n=u(t,"srgbClr",r.a);if(n?.getAttribute("val")){return{backgroundColor:`#${n.getAttribute("val")}`}}}return{}}parseRowBackgroundColor(t){const e=u(t,"fill",r.a);if(e){const t=u(e,"solidFill",r.a),n=u(t,"srgbClr",r.a);if(n?.getAttribute("val"))return`#${n.getAttribute("val")}`}}parseTableWholeStyle(t){if(!t)return null;const e={},n=u(t,"fill",r.a);if(n){const t=u(n,"solidFill",r.a);if(t){const n=u(t,"srgbClr",r.a);n?.getAttribute("val")&&(e.backgroundColor=`#${n.getAttribute("val")}`);const s=u(t,"schemeClr",r.a);s?.getAttribute("val")&&(e.backgroundColor=s.getAttribute("val")||void 0)}u(n,"gradFill",r.a)}const s=u(t,"ln",r.a);if(s){const t=s.getAttribute("w"),n=u(s,"solidFill",r.a);if(n){const t=u(n,"srgbClr",r.a);t?.getAttribute("val")&&(e.borderColor=`#${t.getAttribute("val")}`)}if(t){const r=parseInt(t),n=Math.round(r/9525);e.borderWidth=`${n}px`}else e.borderWidth="1px"}const i=u(t,"effectLst",r.a);if(i){const t=u(i,"outerShdw",r.a);if(t){e.shadow={};const n=u(t,"solidFill",r.a);if(n){const t=u(n,"srgbClr",r.a);t?.getAttribute("val")&&(e.shadow.color=`#${t.getAttribute("val")}`)}const s=t.getAttribute("blur");s&&(e.shadow.blur=Math.round(parseInt(s)/9525));const i=t.getAttribute("dist"),o=t.getAttribute("dir");if(i&&o){const t=parseInt(i)/9525,r=parseInt(o)/6e4*Math.PI/180;e.shadow.offsetX=Math.round(t*Math.cos(r)),e.shadow.offsetY=Math.round(t*Math.sin(r))}}}return Object.keys(e).length>0?e:null}generateBoxShadow(t){if(!t)return"";const e=[];return void 0!==t.offsetX?e.push(`${t.offsetX}px`):e.push("0"),void 0!==t.offsetY?e.push(`${t.offsetY}px`):e.push("0"),void 0!==t.blur?e.push(`${t.blur}px`):e.push("0"),t.color?e.push(t.color):e.push("#000000"),e.join(" ")}toHTML(){const t=this.getContainerStyle();return`<div ${this.formatDataAttributes()} style="${t}">\n      <table style="${this.getTableStyle()}">\n        <tbody>\n${this.rows.map(t=>this.rowToHTML(t)).join("\n")}\n        </tbody>\n      </table>\n    </div>`}getTableStyle(){return["width: 100%","height: 100%","border-collapse: collapse","border-spacing: 0"].join("; ")}rowToHTML(t){return`      <tr style="${this.getRowStyle(t)}">\n${t.cells.map(t=>this.cellToHTML(t)).join("\n        ")}\n      </tr>`}getRowStyle(t){const e=[];return t.height&&e.push(`height: ${t.height}px`),t.style?.isHeader&&this.tableStyle?.firstRow?.backgroundColor?e.push(`background-color: ${this.tableStyle.firstRow.backgroundColor}`):t.style?.isFooter&&this.tableStyle?.lastRow?.backgroundColor&&e.push(`background-color: ${this.tableStyle.lastRow.backgroundColor}`),e.join("; ")}cellToHTML(t){const e=this.getCellStyle(t),r=[];t.rowSpan&&t.rowSpan>1&&r.push(`rowspan="${t.rowSpan}"`),t.colSpan&&t.colSpan>1&&r.push(`colspan="${t.colSpan}"`);return`<td${r.length>0?" "+r.join(" "):""} style="${e}">${t.text||""}</td>`}getCellStyle(t){const e=[];return t.style?.backgroundColor&&e.push(`background-color: ${t.style.backgroundColor}`),t.style?.borderColor&&t.style?.borderWidth&&e.push(`border: ${t.style.borderWidth} solid ${t.style.borderColor}`),t.style?.padding&&e.push(`padding: ${t.style.padding}`),t.style?.verticalAlign&&e.push(`vertical-align: ${t.style.verticalAlign}`),e.join("; ")}toParsedElement(){return{id:this.id,type:"table",rect:this.rect,style:this.style,content:this.content,props:this.props,name:this.name,hidden:this.hidden,attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}class B extends I{constructor(){super(...arguments),this.type="group",this.children=[]}static fromNode(t,e){try{const n=new B(`group_${Date.now()}`,"group",{x:0,y:0,width:0,height:0},[],{},e),s=u(t,"grpSpPr",r.p);return n.parseGroupProperties(s,t),Array.from(t.children).forEach(t=>{if(1!==t.nodeType)return;const r=t.tagName;let s=null;"p:sp"===r||"sp"===r?s=M.fromNode(t,e):"p:pic"===r||"pic"===r?s=N.fromNode(t,e):"p:graphicFrame"===r||"graphicFrame"===r?s=n.parseGraphicFrame(t,e):"p:grpSp"!==r&&"grpSp"!==r||(s=B.fromNode(t,e)),s&&n.children.push(s)}),n.content={},n.props={},n.name="分组",n.rawNode=t,n}catch(t){return console.error("Failed to parse group element:",t),null}}parseGraphicFrame(t,e){const n=u(t,"graphic",r.a),s=n?u(n,"graphicData",r.a):null;if(!s)return null;const i=s.getAttribute("uri")||"";return i.includes("oleObject")?E.fromNode(t,e):i.includes("chart")?D.fromNode(t,e):i.includes("diagram")?j.fromNode(t,e):i.includes("table")?L.fromNode(t,e):null}parseGroupProperties(t,e){if(!t)return;const n=u(t,"xfrm",r.a);if(n){const t=u(n,"off",r.a),e=u(n,"ext",r.a),s=u(n,"chOff",r.a),i=u(n,"chExt",r.a);if(s){const t=parseInt(s.getAttribute("x")||"0"),e=parseInt(s.getAttribute("y")||"0");this.childOffset={x:c(t),y:c(e)}}if(e&&i){const r=parseInt(e.getAttribute("cx")||"0"),n=parseInt(e.getAttribute("cy")||"0"),o=parseInt(i.getAttribute("cx")||"0"),a=parseInt(i.getAttribute("cy")||"0");this.childOffset||(this.childOffset={x:0,y:0});let l=0,p=0;s&&(l=parseInt(s.getAttribute("x")||"0"),p=parseInt(s.getAttribute("y")||"0")),t&&(this.childOffset.x+=c(parseInt(t.getAttribute("x")||"0")-l),this.childOffset.y+=c(parseInt(t.getAttribute("y")||"0")-p)),this.rect.x=c(o),this.rect.y=c(a),this.rect.width=c(r-o),this.rect.height=c(n-a)}const o=n.getAttribute("rot");null!==o&&(this.rotation=parseInt(o)/6e4),this.flipH="1"===n.getAttribute("flipH"),this.flipV="1"===n.getAttribute("flipV")}}toHTML(){const t=this.getGroupStyle();return`<div class="ppt-group" ${this.formatDataAttributes()} style="${t}">\n${this.children.map(t=>t.toHTML()).join("\n")}\n    </div>`}getGroupStyle(){const t=["position: absolute",`left: ${this.rect.x}px`,`top: ${this.rect.y}px`,`width: ${this.rect.width}px`,`height: ${this.rect.height}px`];return void 0!==this.rotation&&0!==this.rotation&&(t.push(`transform: rotate(${this.rotation}deg)`),t.push("transform-origin: center center")),this.flipH&&this.flipV?(t.push(`transform: rotate(${this.rotation||0}deg) scale(-1, -1)`),t.push("transform-origin: center center")):this.flipH?(t.push(`transform: rotate(${this.rotation||0}deg) scale(-1, 1)`),t.push("transform-origin: center center")):this.flipV&&(t.push(`transform: rotate(${this.rotation||0}deg) scale(1, -1)`),t.push("transform-origin: center center")),this.childOffset&&(t.push(`margin-left: ${this.childOffset.x}px`),t.push(`margin-top: ${this.childOffset.y}px`)),this.hidden&&t.push("display: none"),t.join("; ")}toParsedElement(){return{id:this.id,type:"group",rect:this.rect,style:this.style,content:this.content,props:{rotation:this.rotation,flipH:this.flipH,flipV:this.flipV,childOffset:this.childOffset},name:this.name,hidden:this.hidden,children:this.children.map(t=>t instanceof M||t instanceof N||t instanceof E||t instanceof D||t instanceof j||t instanceof B?t.toParsedElement():t),attrs:this.getAttributes(this.rawNode),rawNode:this.rawNode}}}function R(t,e){if(t.textStyle||t.style)return t.textStyle||t.style;if(!t.isPlaceholder||!t.placeholderType)return H();const r=t.phSize||t.getAttribute?.("sz"),n=function(t,e){if(e.layout?.textStyles){const r=z(e.layout.textStyles,t);if(r)return r}if(e.master?.textStyles){const r=z(e.master.textStyles,t);if(r)return r}return H()}(t.placeholderType,e);return n||H(t.placeholderType,r)}function z(t,e){switch(e){case"title":case"ctrTitle":case"subTitle":return O(t.titleParaPr);case"body":case"obj":case"chart":case"table":case"dgm":return O(t.bodyPr);default:return O(t.otherPr)}}function O(t){if(!t)return null;const e={},n=u(t,"defRPr",r.a);if(n){const t=u(n,"sz",r.a);if(t){const r=parseInt(t.getAttribute("val")||"0",10)/100;e.fontSize=r*(4/3)}const s=u(n,"solidFill",r.a);if(s){const t=u(s,"srgbClr",r.a);t?.getAttribute("val")&&(e.color=`#${t.getAttribute("val")}`);const n=u(s,"schemeClr",r.a);n?.getAttribute("val")&&(e.color=n.getAttribute("val"))}const i=u(n,"latin",r.a);i?.getAttribute("typeface")&&(e.fontFamily=i.getAttribute("typeface"));const o=u(n,"b",r.a);o&&(e.fontWeight="1"===o.getAttribute("val")||"true"===o.getAttribute("val")?"bold":"normal");const a=u(n,"i",r.a);a&&(e.italic="1"===a.getAttribute("val")||"true"===a.getAttribute("val"));const l=u(n,"u",r.a);l&&(e.underline=l.getAttribute("val")||"sng");const c=u(n,"strike",r.a);c&&(e.strike="1"===c.getAttribute("val")||"true"===c.getAttribute("val"))}const s=t.getAttribute("algn");return s&&(e.align=s),Object.keys(e).length>0?e:null}function H(t,e){let r=14;if(e)switch(e.toLowerCase()){case"quarter":r=40;break;case"half":r=32;break;case"full":r=24;break;default:r=14}else"title"===t?r=44:"body"===t&&(r=18);return{fontSize:r,color:"#333333",fontWeight:"normal",fontFamily:"Arial",align:"left"}}function W(t,e,r,n){if(!t.elements||!Array.isArray(t.elements))return;const s=function(t,e,r,n){return{slide:t,layout:e,master:r,theme:n}}(t,e,r,n);t.elements.forEach(t=>{"shape"!==t.type&&"text"!==t.type||function(t,e){if(t.isPlaceholder&&t.rawNode){const e=t.rawNode.querySelector("p\\:ph, ph");e&&(t.phSize=e.getAttribute("sz"))}if(t.textStyle&&t.textStyle.length>0){const r=R(t,e);return void(r&&t.textStyle.forEach(t=>{!t.fontSize&&r.fontSize&&(t.fontSize=r.fontSize),!t.color&&r.color&&(t.color=r.color),!t.fontFamily&&r.fontFamily&&(t.fontFamily=r.fontFamily),t.bold||"bold"!==r.fontWeight||(t.bold=!0),!t.italic&&r.italic&&(t.italic=r.italic)}))}if(t.isPlaceholder&&t.placeholderType){const r=R(t,e);r&&(t.style={...t.style,...r})}}(t,s)})}class G{constructor(t,e,r,n,s,i,o){this.id=t.id,this.title=t.title,this.background="string"==typeof t.background?t.background:"",this.elements=e,this.rawResult=t,this.layoutElement=r,this.masterElement=n,this.layout=s,this.master=i,this.mediaMap=o}toHTML(){!this.rawResult.styleApplied&&this.layout&&(W(this.rawResult,this.layout,this.master),this.rawResult.styleApplied=!0);const t=function(t,e,r){const n=["position: relative","overflow: hidden","margin: 0 auto",`width: ${c(t)}px`,`height: ${c(e)}px`];return r?"color"===r.type&&r.value?n.push(`background: ${r.value}`):"image"===r.type&&r.value&&n.push(`background: url('${r.value}') no-repeat center/cover`):n.push("background: #ffffff"),n.join("; ")}(9144e3,6858e3,this.rawResult.background),e=this.renderMasterElements(),r=this.renderLayoutElements(),n=this.renderSlideElementsWithLayout();return`<div class="slide" style="${t}" data-slide-id="${this.id}" data-slide-title="${this.escapeHtml(this.title)}">\n${e}\n${r}\n${n}\n    </div>`}renderMasterElements(){return this.masterElement?this.masterElement.toHTML():""}renderLayoutElements(){return this.layoutElement?this.layoutElement.toHTML():""}renderSlideElementsWithLayout(){if(!this.layout)return this.elements.forEach((t,e)=>{t.zIndex=e+1,t.idx=e}),this.elements.map(t=>t.toHTML()).join("\n");const t=[];this.elements.forEach((t,e)=>{t.zIndex=e+1,t.idx=e}),this.elements.forEach(e=>{const r=C(this.layout?.placeholders||[],"shape"===e.type?"body":e.type),n=C(this.master?.placeholders||[],"shape"===e.type?"body":e.type);e.style,!r||function(t){const{rect:e,hAlign:r,vAlign:n}=t,s=c(e.x),i=["position: absolute",`top: ${c(e.y)}px`,`left: ${s}px`,`width: ${c(e.width)}px`,`height: ${c(e.height)}px`],o=T(r,n);i.join("; ")}(r);let s={};const i=function(t,e,r){let n={fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1,...r};return n={...n,...e},n={...n,...t},n}(e.style,r?r.style:void 0,n?n.style:void 0);i&&(s=i),e.style&&Object.assign(e.style,s);const o=e.toHTML();t.push(o)});const e=new Set;return this.elements.forEach(t=>{const r=C(this.layout?.placeholders||[],"shape"===t.type?"body":t.type);if(r){const t=`${r.type||""}_${r.idx??""}`;e.add(t)}}),t.join("")}getTextContentStyle(t,e){const r=[];if(t.fontSize&&r.push(`font-size: ${t.fontSize}px`),t.color&&r.push(`color: ${t.color}`),t.fontWeight&&r.push(`font-weight: ${t.fontWeight}`),t.textAlign&&r.push(`text-align: ${t.textAlign}`),t.backgroundColor&&"transparent"!==t.backgroundColor&&r.push(`background-color: ${t.backgroundColor}`),e){const[t,n]=e.split("_");"mid"!==t&&"center"!==t||(r.push("display: flex"),r.push("align-items: center")),"mid"!==n&&"center"!==n||r.push("justify-content: center")}return r.join("; ")}getSlideBackground(){const t=this.rawResult.background;if(!t)return"background-color: #ffffff;";if("string"==typeof t)return`background-color: ${t};`;if("color"===t.type&&t.value)return`background-color: ${t.value};`;if("image"===t.type){const e=t.value||t.relId;if(e)return`background-image: url('${e}'); background-size: cover; background-position: center;`}return"background-color: #ffffff;"}toHTMLString(){const t=["width: 960px","height: 540px","margin: 20px auto","border: 1px solid #ccc","box-shadow: 0 2px 8px rgba(0,0,0,0.1)",`background-color: ${this.background}`,"position: relative","overflow: hidden"].join("; "),e=this.toHTML();return`<div class="ppt-slide-container" style="${t}">\n      <div class="ppt-slide-header" style="padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd; font-size: 14px; font-weight: bold;">\n        ${this.escapeHtml(this.title)}\n      </div>\n      ${e}\n    </div>`}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}class X{constructor(t,e,r,n=960,s=540,i){this.id=t,this.title=e,this.slides=r,this.width=n,this.height=s,this.ratio=n/s,this.author=i}static fromParseResult(t){const e=t.slides.map(t=>{const{createElementFromData:e}=require("../elements"),r=(t.elements||[]).map(r=>r instanceof I?r:e(r,t.relsMap||{})).filter(t=>null!==t);return new G(t,r,t.layout,t.master)});return new X(t.id,t.title,e,t.props.width||960,t.props.height||540,t.author)}toHTML(){const t=[`width: ${this.width}px`,`min-height: ${this.height}px`,"margin: 20px auto","padding: 20px","background: #f9f9f9","border: 1px solid #ddd"].join("; "),e=this.slides.map(t=>t.toHTMLString()).join("\n\n");return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${this.escapeHtml(this.title)}</title>\n  <style>\n    .ppt-slide-container {\n      page-break-after: always;\n    }\n    .ppt-slide-container:last-child {\n      page-break-after: auto;\n    }\n  </style>\n</head>\n<body>\n  <div style="${t}">\n    <h1 style="text-align: center; margin-bottom: 30px;">${this.escapeHtml(this.title)}</h1>\n${e}\n  </div>\n</body>\n</html>`}toHTMLWithNavigation(){const t=this.slides.map((t,e)=>`\n        <div class="ppt-slide-page" data-index="${e}" style="display: ${0===e?"block":"none"};">\n          ${t.toHTML()}\n        </div>\n      `).join("\n"),e=`\n      <div style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000;">\n        <button onclick="prevSlide()" style="padding: 10px 20px; margin-right: 10px; cursor: pointer;">上一页</button>\n        <span id="slideCounter" style="padding: 10px;">1 / ${this.slides.length}</span>\n        <button onclick="nextSlide()" style="padding: 10px 20px; margin-left: 10px; cursor: pointer;">下一页</button>\n      </div>\n    `,r=`\n      <script>\n        let currentSlide = 0;\n        const slides = document.querySelectorAll('.ppt-slide-page');\n\n        function showSlide(index) {\n          slides.forEach((slide, i) => {\n            slide.style.display = i === index ? 'block' : 'none';\n          });\n          document.getElementById('slideCounter').textContent = (index + 1) + ' / ${this.slides.length}';\n          currentSlide = index;\n        }\n\n        function prevSlide() {\n          showSlide(Math.max(0, currentSlide - 1));\n        }\n\n        function nextSlide() {\n          showSlide(Math.min(${this.slides.length} - 1, currentSlide + 1));\n        }\n\n        document.addEventListener('keydown', (e) => {\n          if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') prevSlide();\n          if (e.key === 'ArrowRight' || e.key === 'ArrowDown') nextSlide();\n        });\n      <\/script>\n    `;return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${this.escapeHtml(this.title)}</title>\n  <style>\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      min-height: 100vh;\n      background: #333;\n    }\n    .ppt-wrapper {\n      width: ${this.width}px;\n      height: ${this.height}px;\n      background: #fff;\n      box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n    }\n  </style>\n</head>\n<body>\n  <div class="ppt-wrapper">\n${t}\n  </div>\n${e}\n${r}\n</body>\n</html>`}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}function _(t,e={},r){if(!t||!t.type)return null;switch(t.type){case"shape":case"text":{const r=new M(t.id,t.type,t.rect,t.content,t.props,e);return Object.assign(r,t),r}case"image":{let n=t.src||"";r&&t.relId&&r.has(t.relId)&&(n=r.get(t.relId)||n);const s=new N(t.id,t.rect,n,t.relId||"",t.props||{},e);return Object.assign(s,t),s.src=n,s}case"ole":{const r=new E(t.id,t.rect,t.progId,t.relId,t.props,e);return Object.assign(r,t),r}case"chart":{const r=new D(t.id,"chart",t.rect,t.content,t.props,e);return Object.assign(r,t),r}case"table":{const r=new L(t.id,t.rect,t.content,t.props,e);return Object.assign(r,t),r}case"diagram":{const r=new j(t.id,t.rect,t.content,t.props,e);return Object.assign(r,t),r}case"group":{const r=new B(t.id,t.rect,t.props,e);return Object.assign(r,t),r}default:return null}}class V extends I{constructor(t,e,r,n={}){super(t,"placeholder",r,{},n,{}),this.type="placeholder",this.placeholderType=e,this.isPlaceholder=!0,this.idx=n.idx,this.name=n.name,this.text=n.text,this.textStyle=n.textStyle}toHTML(){const t=[this.getContainerStyle(),"pointer-events: none","user-select: none"].join("; "),e=this.getPlaceholderContent();return`<div class="ppt-placeholder" data-placeholder-type="${this.placeholderType}" style="${t}">\n${e}\n</div>`}getPlaceholderContent(){switch(this.placeholderType){case"title":return this.isContentSet?this.renderTextContent():'<span class="placeholder-label">点击添加标题</span>';case"body":return this.isContentSet?this.renderTextContent():'<span class="placeholder-label">点击添加文本</span>';case"slideNumber":return'<span class="slide-number"></span>';case"footer":return this.text||'<span class="footer-text"></span>';case"dateTime":return this.text||'<span class="date-time"></span>';default:return this.text||""}}renderTextContent(){return this.text?this.textStyle&&this.textStyle.length>0?this.textStyle.map(t=>`<span style="${this.getTextRunStyle(t)}">${t.text}</span>`).join(""):`<span style="color: inherit;">${this.text}</span>`:""}get isContentSet(){return!(!this.text||!this.text.trim())}getTextRunStyle(t){const e=[];return t.fontSize&&e.push(`font-size: ${t.fontSize}px`),t.fontFamily&&e.push(`font-family: ${t.fontFamily}`),t.color&&e.push(`color: ${t.color}`),t.bold&&e.push("font-weight: bold"),t.italic&&e.push("font-style: italic"),t.underline&&e.push("text-decoration: underline"),e.join("; ")}}class q extends I{constructor(t,e,r=[],n=[],s={}){super(t,"layout",{x:0,y:0,width:960,height:540},{},s,{}),this.type="layout",this.name=e,this.placeholders=r,this.elements=n,this.textStyles=s.textStyles,this.background=s.background,this.relsMap=s.relsMap||{},this.mediaMap=s.mediaMap}static fromResult(t,e){const r=(t.placeholders||[]).map(t=>new V(t.id,t.type,t.rect,{idx:t.idx,name:t.name,rawNode:t.rawNode})),n=(t.elements||[]).map(r=>r instanceof I?r:_(r,t.relsMap||{},e)).filter(t=>null!==t);return new q(t.id,t.name,r,n,{textStyles:t.textStyles,background:t.background,relsMap:t.relsMap,colorMap:t.colorMap,mediaMap:e})}toHTML(){const t=["position: absolute","left: 0","top: 0","width: 100%","height: 100%","pointer-events: none","z-index: 1",this.getBackgroundStyle()].join("; "),e=this.placeholders.map(t=>t.toHTML()).join("\n"),r=this.elements.map(t=>t.toHTML()).join("\n");return`<div class="ppt-layout" style="${t}" data-layout-id="${this.id}" data-layout-name="${this.name||""}">\n${e}\n${r}\n</div>`}getBackgroundStyle(){if(!this.background)return"background-color: transparent;";if("color"===this.background.type&&this.background.value)return`background-color: ${this.background.value};`;if("image"===this.background.type&&this.background.relId){const t=this.mediaMap?this.mediaMap.get(this.background.relId):this.background.relId;if(t)return`background-image: url('${t}'); background-size: cover;`}return"background-color: transparent;"}}class U extends I{constructor(t,e=[],r=[],n={}){super(t,"master",{x:0,y:0,width:960,height:540},{},n,{}),this.type="master",this.masterId=n.masterId,this.elements=e,this.placeholders=r,this.textStyles=n.textStyles,this.background=n.background,this.colorMap=n.colorMap||{},this.mediaMap=n.mediaMap}static fromResult(t,e){const r=(t.placeholders||[]).map(t=>new V(t.id,t.type||"other",t.rect||{x:0,y:0,width:100,height:50},{idx:t.idx,name:t.name})),n=(t.elements||[]).map(r=>_(r,t.relsMap,e)).filter(t=>null!==t);return new U(t.id,n,r,{masterId:t.masterId,textStyles:t.textStyles,background:t.background,colorMap:t.colorMap,relsMap:t.relsMap,mediaMap:e})}toHTML(){const t=["width: 100%","height: 100%","position: absolute","top: 0","left: 0","pointer-events: none","z-index: 0",this.getBackgroundStyle()].join("; "),e=this.elements.map(t=>t.toHTML()).join("\n"),r=this.placeholders.map(t=>t.toHTML()).join("\n");return`<div class="ppt-master" style="${t}" data-master-id="${this.id}">\n${r}\n${e}\n</div>`}getBackgroundStyle(){if(!this.background)return"background-color: transparent;";if("color"===this.background.type&&this.background.value)return`background-color: ${this.background.value};`;if("image"===this.background.type&&this.background.relId){const t=this.mediaMap?this.mediaMap.get(this.background.relId):this.background.relId;if(t)return`background-image: url('${t}'); background-size: cover;`}return"background-color: transparent;"}getPlaceholderStyle(t){if(!this.textStyles)return null;switch(t){case"title":return this.parseParagraphProperties(this.textStyles.titleParaPr);case"body":return this.parseParagraphProperties(this.textStyles.bodyPr);default:return this.parseParagraphProperties(this.textStyles.otherPr)}}parseParagraphProperties(t){return t?{}:null}}class Y extends I{constructor(t,e,r,n,s,i){super(t,"theme",{x:0,y:0,width:0,height:0},{},{},{}),this.type="theme",this.name=e,this.colors=r,this.fonts=s,this.effects=i,this.themeId=n||this.sanitizeThemeName(e)}static fromResult(t,e="theme1"){return new Y(`theme_${e}`,e,t.colors,e)}getThemeClassPrefix(){return`theme-${this.themeId}`}getThemeClass(t){return`${this.getThemeClassPrefix()}-${t}`}sanitizeThemeName(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}generateThemeCSS(){const t=this.getThemeClassPrefix(),e=[];e.push(`/* ===== ${this.name} 主题样式 ===== */`),e.push(`.${t} {`),this.colors.bg1&&e.push(`  --${t}-bg1: ${this.colors.bg1};`),this.colors.tx1&&e.push(`  --${t}-tx1: ${this.colors.tx1};`),this.colors.bg2&&e.push(`  --${t}-bg2: ${this.colors.bg2};`),this.colors.tx2&&e.push(`  --${t}-tx2: ${this.colors.tx2};`),this.colors.accent1&&e.push(`  --${t}-accent1: ${this.colors.accent1};`),this.colors.accent2&&e.push(`  --${t}-accent2: ${this.colors.accent2};`),this.colors.accent3&&e.push(`  --${t}-accent3: ${this.colors.accent3};`),this.colors.accent4&&e.push(`  --${t}-accent4: ${this.colors.accent4};`),this.colors.accent5&&e.push(`  --${t}-accent5: ${this.colors.accent5};`),this.colors.accent6&&e.push(`  --${t}-accent6: ${this.colors.accent6};`),this.colors.hlink&&e.push(`  --${t}-hlink: ${this.colors.hlink};`),this.colors.folHlink&&e.push(`  --${t}-fol-hlink: ${this.colors.folHlink};`),e.push("}"),e.push("");return["bg1","tx1","bg2","tx2","accent1","accent2","accent3","accent4","accent5","accent6","hlink","fol-hlink"].forEach(r=>{const n="fol-hlink"===r?"folHlink":r;this.colors[n]&&(e.push(`.${t}-bg-${r} {`),e.push(`  background-color: var(--${t}-${r});`),e.push("}"),e.push(`.${t}-text-${r} {`),e.push(`  color: var(--${t}-${r});`),e.push("}"),e.push(`.${t}-border-${r} {`),e.push(`  border-color: var(--${t}-${r});`),e.push("}"))}),e.push(""),this.fonts&&(e.push(`/* ${this.name} 字体方案 */`),this.fonts.majorFont&&(e.push(`.${t}-font-major {`),this.fonts.majorFont.latin&&e.push(`  font-family: "${this.fonts.majorFont.latin}", sans-serif;`),this.fonts.majorFont.ea&&e.push(`  font-family: "${this.fonts.majorFont.ea}", sans-serif;`),e.push("}")),this.fonts.minorFont&&(e.push(`.${t}-font-minor {`),this.fonts.minorFont.latin&&e.push(`  font-family: "${this.fonts.minorFont.latin}", sans-serif;`),this.fonts.minorFont.ea&&e.push(`  font-family: "${this.fonts.minorFont.ea}", sans-serif;`),e.push("}")),e.push("")),e.push(`/* ${this.name} 预设样式类 */`),e.push(`.${t}-title {`),e.push(`  color: var(--${t}-tx1);`),this.fonts?.majorFont?.latin&&e.push(`  font-family: "${this.fonts.majorFont.latin}", sans-serif;`),e.push("}"),e.push(`.${t}-body {`),e.push(`  color: var(--${t}-tx2);`),this.fonts?.minorFont?.latin&&e.push(`  font-family: "${this.fonts.minorFont.latin}", sans-serif;`),e.push("}"),this.colors.hlink&&(e.push(`.${t}-link {`),e.push(`  color: var(--${t}-hlink);`),e.push("  text-decoration: none;"),e.push("}")),this.colors.folHlink&&(e.push(`.${t}-link:visited {`),e.push(`  color: var(--${t}-fol-hlink);`),e.push("}")),["accent1","accent2","accent3","accent4","accent5","accent6"].forEach((r,n)=>{this.colors[r]&&(e.push(`.${t}-accent-${n+1} {`),e.push(`  color: var(--${t}-${r});`),e.push("}"))}),e.join("\n")}getColor(t){return this.colors[t]}getMajorFont(){return this.fonts?.majorFont?.latin||this.fonts?.majorFont?.ea}getMinorFont(){return this.fonts?.minorFont?.latin||this.fonts?.minorFont?.ea}toHTML(){return""}}class J extends I{constructor(t,e=[],r=[],n=[],s={}){super(t,"tags",{x:0,y:0,width:0,height:0},{},s,{}),this.type="tags",this.tags=e,this.customProperties=r,this.extensions=n,this.slideId=s.slideId}static fromResult(t){return new J(t.id,t.tags,t.customProperties,t.extensions,{slideId:t.slideId})}toHTML(){if(!(this.tags.length>0||this.customProperties.length>0))return"";return`<div class="ppt-tags" style="${["display: none",`data-tags-id="${this.id}"`,`data-slide-id="${this.slideId||""}"`].join("; ")}" ${this.tags.length>0?`data-tags='${JSON.stringify(this.tags)}'`:""} ${this.customProperties.length>0?`data-custom-props='${JSON.stringify(this.customProperties)}'`:""} ${this.extensions.length>0?`data-extensions='${JSON.stringify(this.extensions)}'`:""}>\n</div>`}toHTMLDebug(){const t=["position: absolute","top: 10px","right: 10px","background: rgba(0, 0, 0, 0.8)","color: white","padding: 10px","border-radius: 4px","font-size: 12px","max-width: 300px","z-index: 1000","pointer-events: none"].join("; ");let e=`<strong>Tags (${this.tags.length}):</strong>`;return this.tags.length>0&&(e+="<ul>",this.tags.forEach(t=>{e+=`<li>${t.name}: ${t.value}</li>`}),e+="</ul>"),this.customProperties.length>0&&(e+=`<strong>Properties (${this.customProperties.length}):</strong><ul>`,this.customProperties.forEach(t=>{e+=`<li>${t.name}: ${t.value} (${t.type})</li>`}),e+="</ul>"),`<div class="ppt-tags-debug" style="${t}">\n${e}\n</div>`}getTag(t){return this.tags.find(e=>e.name===t)?.value}getProperty(t){return this.customProperties.find(e=>e.name===t)?.value}setTag(t,e){const r=this.tags.find(e=>e.name===t);r?r.value=e:this.tags.push({name:t,value:e})}setProperty(t,e,r){const n=this.customProperties.find(e=>e.name===t);n?(n.value=e,r&&(n.type=r)):this.customProperties.push({name:t,value:e,type:r})}}class K extends I{constructor(t,e=[],r=[],n={}){super(t,"notesMaster",{x:0,y:0,width:800,height:600},{},n,{}),this.type="notesMaster",this.elements=e,this.placeholders=r,this.background=n.background,this.mediaMap=n.mediaMap}static fromResult(t,e){const r=(t.elements||[]).map(r=>_(r,t.relsMap,e)).filter(t=>null!==t);return new K(t.id,r,t.placeholders||[],{background:t.background,relsMap:t.relsMap,mediaMap:e})}toHTML(){const t=this.getBackgroundStyle(),e=[this.getContainerStyle(),t].join("; "),r=this.elements.map(t=>t.toHTML()).join("\n");return`<div class="ppt-notes-master" style="${e}" data-notes-master-id="${this.id}">\n${r}\n</div>`}getBackgroundStyle(){if(!this.background)return"background-color: #ffffff;";if("color"===this.background.type&&this.background.value)return`background-color: ${this.background.value};`;if("image"===this.background.type&&this.background.relId){const t=this.mediaMap?this.mediaMap.get(this.background.relId):this.background.relId;if(t)return`background-image: url('${t}'); background-size: cover;`}return"background-color: #ffffff;"}}class Z extends I{constructor(t,e,r={}){super(t,"notesSlide",e,{},r,{}),this.type="notesSlide",this.text=r.text,this.masterRef=r.masterRef,this.slideId=r.slideId}static fromResult(t){return new Z(t.id,{x:0,y:0,width:800,height:600},{text:t.text,masterRef:t.masterRef,slideId:t.slideId,elements:t.elements,background:t.background,relsMap:t.relsMap})}toHTML(){const t=[this.getContainerStyle(),"background: #fff","padding: 20px","border: 1px solid #ddd","border-radius: 4px"].join("; ");let e="";return this.slideId&&(e+=`<div style="font-weight: bold; margin-bottom: 10px;">幻灯片 ${this.slideId} 备注</div>`),this.text?e+=`<div style="font-size: 14px; line-height: 1.6;">${this.text}</div>`:e+='<div style="color: #999; font-style: italic;">无备注内容</div>',`<div class="ppt-notes-slide" style="${t}" data-notes-id="${this.id}" data-slide-id="${this.slideId||""}">\n${e}\n</div>`}setMaster(t){this.master=t}}class Q extends I{constructor(t,e,r=960,n=540,s={}){super(t,"document",{x:0,y:0,width:r,height:n},{},s,{}),this.type="document",this.title=e,this.width=r,this.height=n,this.ratio=r/n,this.pageSize=s.pageSize||"16:9",this.author=s.author,this.subject=s.subject,this.keywords=s.keywords,this.description=s.description,this.created=s.created,this.modified=s.modified,this.slides=[],this.layouts={},this.masters=[],this.tags=[],this.notesMasters=[],this.notesSlides=[],this.globalRelsMap=s.globalRelsMap||{},this.mediaMap=s.mediaMap,this.theme=void 0}static fromParseResult(t){const e=new Q(t.id,t.title,t.props.width||960,t.props.height||540,{pageSize:t.props.pageSize,author:t.author,subject:t.subject,keywords:t.keywords,description:t.description,created:t.created,modified:t.modified,globalRelsMap:t.globalRelsMap,mediaMap:t.mediaMap});return t.theme&&(e.theme=Y.fromResult(t.theme,t.theme.name||"theme1")),t.masterSlides&&t.masterSlides.length>0&&(e.masters=t.masterSlides.map(t=>U.fromResult(t,e.mediaMap))),t.slideLayouts&&Object.entries(t.slideLayouts).forEach(([t,r])=>{e.layouts[t]=q.fromResult(r,e.mediaMap)}),t.notesMasters&&t.notesMasters.length>0&&(e.notesMasters=t.notesMasters.map(t=>K.fromResult(t,e.mediaMap))),t.notesSlides&&t.notesSlides.length>0&&(e.notesSlides=t.notesSlides.map(t=>{const r=Z.fromResult(t);if(t.masterRef){const n=e.notesMasters.find(e=>e.id===t.masterRef);n&&r.setMaster(n)}return r})),t.tags&&t.tags.length>0&&(e.tags=t.tags.map(t=>J.fromResult(t))),t.slides&&t.slides.length>0&&(e.slides=t.slides.map(r=>{const n=(r.elements||[]).map(t=>t instanceof I?t:_(t,r.relsMap||{},e.mediaMap)).filter(t=>null!==t);let s,i,o,a;return r.layoutId&&e.layouts[r.layoutId]&&(s=e.layouts[r.layoutId],o=t.slideLayouts?.[r.layoutId]),r.masterRefIndex&&(i=e.masters.find(t=>t.masterId===r.masterRefIndex),a=t.masterSlides?.find(t=>t.masterId===r.masterRefIndex)),new G(r,n,s,i,o,a,e.mediaMap)})),e}toHTML(t={}){return!1!==t.withNavigation?this.toHTMLWithNavigation(t):this.toHTMLDocument(t)}toHTMLDocument(t={}){const e=this.slides.map(t=>t.toHTML()).join("\n\n"),r=!1!==t.includeStyles?this.generateStyles(t):"";return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${this.escapeHtml(this.title)}</title>\n  ${r?"<style>\n"+r+"\n</style>":""}\n</head>\n<body>\n  <div class="ppt-wrapper">\n${e}\n  </div>\n</body>\n</html>`}toHTMLWithNavigation(t={}){const e=this.slides.map((t,e)=>`\n        <div class="ppt-slide-page" data-index="${e}" style="display: ${0===e?"block":"none"};">\n          ${t.toHTML()}\n        </div>\n      `).join("\n"),r=`\n      <div class="ppt-navigation" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; align-items: center; gap: 15px; background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 25px;">\n        <button onclick="prevSlide()" style="padding: 8px 16px; cursor: pointer; background: #fff; border: none; border-radius: 4px; font-size: 14px;">上一页</button>\n        <span id="slideCounter" style="color: #fff; font-size: 14px; min-width: 60px; text-align: center;">1 / ${this.slides.length}</span>\n        <button onclick="nextSlide()" style="padding: 8px 16px; cursor: pointer; background: #fff; border: none; border-radius: 4px; font-size: 14px;">下一页</button>\n      </div>\n    `,n=`\n      <script>\n        let currentSlide = 0;\n        const slides = document.querySelectorAll('.ppt-slide-page');\n\n        function showSlide(index) {\n          slides.forEach((slide, i) => {\n            slide.style.display = i === index ? 'block' : 'none';\n          });\n          document.getElementById('slideCounter').textContent = (index + 1) + ' / ${this.slides.length}';\n          currentSlide = index;\n        }\n\n        function prevSlide() {\n          showSlide(Math.max(0, currentSlide - 1));\n        }\n\n        function nextSlide() {\n          showSlide(Math.min(${this.slides.length} - 1, currentSlide + 1));\n        }\n\n        document.addEventListener('keydown', (e) => {\n          if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') prevSlide();\n          if (e.key === 'ArrowRight' || e.key === 'ArrowDown') nextSlide();\n        });\n\n        // 触摸滑动支持\n        let touchStartX = 0;\n        let touchEndX = 0;\n        document.addEventListener('touchstart', e => {\n          touchStartX = e.changedTouches[0].screenX;\n        });\n        document.addEventListener('touchend', e => {\n          touchEndX = e.changedTouches[0].screenX;\n          if (touchStartX - touchEndX > 50) nextSlide();\n          if (touchEndX - touchStartX > 50) prevSlide();\n        });\n      <\/script>\n    `,s=!1!==t.includeStyles?this.generateStyles(t):this.generateNavigationStyles();return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${this.escapeHtml(this.title)}</title>\n  ${s?"<style>\n"+s+"\n</style>":""}\n</head>\n<body>\n  <div class="ppt-wrapper">\n${e}\n  </div>\n${r}\n${!1!==t.includeScripts?n:""}\n</body>\n</html>`}generateStyles(t){const e=["/* PPTX 文档基础样式 */","* { box-sizing: border-box; margin: 0; padding: 0; }","","body {",'  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;',"  background: #333;","  min-height: 100vh;","}","",".ppt-wrapper {","  display: flex;","  justify-content: center;","  align-items: center;","  min-height: 100vh;","  padding: 20px;","}","",".ppt-container {","  background: #fff;","  box-shadow: 0 2px 8px rgba(0,0,0,0.1);","}","","/* ===== PPTXjs 核心布局类系统 ===== */","","/* 幻灯片容器基础样式 */",".slide {","  position: relative;","  overflow: hidden;","  margin: 0 auto;","  box-sizing: border-box;","}","","/* 占位符基础样式（对应版式占位符） */",".slide div.block {","  position: absolute;","  top: 0;","  left: 0;","  width: 100%;","  line-height: 1;","  box-sizing: border-box;","  display: flex;","  flex-direction: column;","}","","/* 垂直对齐类（映射版式垂直规则） */",".slide div.v-up { justify-content: flex-start; }",".slide div.v-mid { justify-content: center; }",".slide div.v-down { justify-content: flex-end; }","","/* 水平对齐类（映射版式水平规则） */",".slide div.h-left { align-items: flex-start; text-align: left; }",".slide div.h-mid { align-items: center; text-align: center; }",".slide div.h-right { align-items: flex-end; text-align: right; }","","/* 复合对齐类（高频组合） */",".slide div.up-left { justify-content: flex-start; align-items: flex-start; }",".slide div.up-center { justify-content: flex-start; align-items: center; text-align: center; }",".slide div.up-right { justify-content: flex-start; align-items: flex-end; text-align: right; }",".slide div.center-left { justify-content: center; align-items: flex-start; }",".slide div.center-center { justify-content: center; align-items: center; text-align: center; }",".slide div.center-right { justify-content: center; align-items: flex-end; text-align: right; }",".slide div.down-left { justify-content: flex-end; align-items: flex-start; }",".slide div.down-center { justify-content: flex-end; align-items: center; text-align: center; }",".slide div.down-right { justify-content: flex-end; align-items: flex-end; text-align: right; }","","/* 内容容器 */",".content {","  width: 100%;","  height: 100%;","  box-sizing: border-box;","}","","/* 文本样式（全局字体） */",".slide-prgrph {","  font-family: Arial, sans-serif;","  font-size: 14px;","  color: #333333;","  line-height: 1.4;","}","","/* ===== 原有样式 ===== */","","/* 幻灯片样式 */",".ppt-slide {","  position: relative;","  margin: 20px auto;","  border: 1px solid #ddd;","  background: #fff;","}","",".ppt-slide-page {",`  width: ${this.width}px;`,`  height: ${this.height}px;`,"  background: #fff;","  box-shadow: 0 4px 20px rgba(0,0,0,0.3);","}","","/* 布局和母版元素 */",".ppt-master-element,",".ppt-layout-element {","  pointer-events: none;","}","","/* 元素通用样式 */",".ppt-element {","  position: absolute;","}","","/* 文本元素 */",".ppt-text {","  overflow: hidden;","}","","/* 占位符样式 */",".ppt-placeholder {","  pointer-events: none;","  user-select: none;","}",""];return this.theme&&(e.push("/* ===== 主题样式 ===== */"),e.push(this.theme.generateThemeCSS()),e.push("")),t.customCss&&(e.push("/* 自定义样式 */"),e.push(t.customCss)),e.join("\n")}generateNavigationStyles(){return`* { margin: 0; padding: 0; box-sizing: border-box; }\nbody {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 100vh;\n  background: #333;\n}\n.ppt-wrapper {\n  width: ${this.width}px;\n  height: ${this.height}px;\n  background: #fff;\n  box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n}`}getSlide(t){return this.slides[t]}getLayout(t){return this.layouts[t]}getMaster(t){return this.masters.find(e=>e.id===t)}escapeHtml(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,t=>e[t])}}async function tt(t,e,r=o){try{const n=`${r}${e}.xml.rels`,s=await(t.file(n)?.async("string"));return s?b(s,"_rels/.rels"):{}}catch(t){return P("warn",`Failed to parse ${r}${e} relationships`,t),{}}}function et(t,e={},n=0){try{const s=new DOMParser,i=s.parseFromString(t,"application/xml").documentElement;if("p:sld"!==i.tagName&&!i.tagName.includes("sld"))return P("warn","Invalid slide XML root element",i.tagName),st(n);const o=rt(i,e),a=function(t,e){const n=u(t,"cSld",r.p);if(!n)return`幻灯片 ${e+1}`;const s=u(n,"spTree",r.p);if(!s)return`幻灯片 ${e+1}`;const i=h(s,"sp",r.p);for(const t of i){const e=u(t,"nvSpPr",r.p);if(!e)continue;const n=u(e,"nvPr",r.p);if(!n)continue;const s=u(n,"ph",r.p);if(!s)continue;const i=s.getAttribute("type");if("title"===i||"ctrTitle"===i){const e=u(t,"txBody",r.p);if(!e)continue;const n=nt(e);if(n&&n.trim())return n.trim()}}return`幻灯片 ${e+1}`}(i,n),l=function(t,e){const n=[],s=u(t,"cSld",r.p);if(!s)return P("warn","cSld element not found"),n;const i=u(s,"spTree",r.p);if(!i)return P("warn","spTree element not found"),n;return P("info","Processing spTree children..."),Array.from(i.children).forEach((t,s)=>{if(1!==t.nodeType)return;const i=t.tagName,o=t.localName||i.split(":").pop()||i;P("info",`Processing element ${s}: tagName=${i}, localName=${o}`);let a=null;"sp"===o?a=M.fromNode(t,e):"pic"===o?a=N.fromNode(t,e):"graphicFrame"===o?a=function(t,e){try{const n=u(t,"graphic",r.a),s=n?u(n,"graphicData",r.a):null;if(!s)return P("warn","graphicData not found in graphicFrame"),null;const i=s.getAttribute("uri")||"";return i.includes("oleObject")?E.fromNode(t,e):i.includes("chart")?D.fromNode(t,e):i.includes("diagram")?j.fromNode(t,e):i.includes("table")?L.fromNode(t,e):(P("info",`Unknown graphicFrame type: ${i}`),null)}catch(t){return P("error","Failed to parse graphicFrame element",t),null}}(t,e):"grpSp"===o?a=B.fromNode(t,e):P("info",`Skipping unknown element type: tagName=${i}, localName=${o}`),a&&n.push(a)}),P("info",`Total elements parsed: ${n.length}`),n}(i,e);return P("info",`Parsed slide ${n+1}: ${l.length} elements`),{id:k("slide"),title:a,background:o,elements:l.map(t=>t),relsMap:e}}catch(t){return P("error",`Failed to parse slide ${n}`,t),st(n)}}function rt(t,e={}){const n=u(t,"bg",r.p);if(!n)return{type:"color",value:"#ffffff"};const s=u(n,"bgRef",r.p);if(s)return function(t){t.getAttribute("idx");const e=u(t,"schemeClr",r.a);if(e){const t=e.getAttribute("val");if(t)return{type:"color",value:t,schemeRef:t}}return{type:"color",value:"#ffffff"}}(s);const i=u(n,"bgPr",r.p);if(i){const t=u(i,"blipFill",r.a);if(t){const n=u(t,"blip",r.a);if(n){const t=n.getAttribute("r:embed")||n.getAttributeNS(r.r,"embed");if(t&&e[t])return{type:"image",value:e[t].target,relId:t}}}const n=u(i,"solidFill",r.a);if(n){const t=u(n,"srgbClr",r.a);if(t?.getAttribute("val"))return{type:"color",value:`#${t.getAttribute("val")}`};const e=u(n,"schemeClr",r.a);if(e){const t=e.getAttribute("val");if(t)return{type:"color",value:t||"#ffffff",schemeRef:t||void 0}}}if(u(i,"gradFill",r.a))return{type:"color",value:"#ffffff"}}return{type:"color",value:"#ffffff"}}function nt(t){const e=Array.from(t.children).filter(t=>"a:p"===t.tagName||t.tagName.includes(":p")),r=[];for(const t of e){const e=Array.from(t.children).filter(t=>"a:r"===t.tagName||t.tagName.includes(":r"));for(const t of e){const e=u(t,"t","http://schemas.openxmlformats.org/drawingml/2006/main");e?.textContent&&r.push(e.textContent)}}return r.join("")}function st(t){return{id:k("slide"),title:`幻灯片 ${t+1}`,background:"#ffffff",elements:[],relsMap:{}}}async function it(t,e,r,n){if(e.background&&"string"!=typeof e.background){const s=e.background;if("image"===s.type&&s.relId){const e=await ot(t,s.relId,r,n);e&&(s.value=e)}}let s=0;for(const i of e.elements)if("image"===i.type){s++;const o=i,a=o.relId;if(a){P("info",`Found image element in ${e.id}: relId=${a}, src=${o.src}`);const s=await ot(t,a,r,n);s?(o.src=s,P("info",`Updated image src to base64 URL, length=${s.length}`)):P("warn",`Failed to resolve image relId=${a} in ${e.id}`)}else P("warn",`Image element missing relId in ${e.id}`)}s>0&&P("info",`Found ${s} image elements in ${e.id}`)}async function ot(t,e,r,n){if(n.has(e))return P("info",`Cache hit for relId=${e}`),n.get(e);const s=r[e];if(!s)return P("warn",`No relationship found for relId=${e} in relsMap`),null;P("info",`Resolving image relId=${e}, target=${s.target}`);const i=await async function(t,e){P("info",`findImageFileInZip: targetPath=${e}`);let r=await t.file(e);if(r)return{file:r,path:e};if(e.startsWith("..")){const n=`ppt/${e.substring(3)}`;if(r=await t.file(n),r)return{file:r,path:n}}if(e.includes("media/")&&!e.startsWith("ppt/")){const n=`ppt/${e}`;if(r=await t.file(n),r)return{file:r,path:n}}if(e.startsWith("media/")){const n=`ppt/${e}`;if(r=await t.file(n),r)return{file:r,path:n}}const n=["ppt/slideLayouts/","ppt/slideMasters/","ppt/slides/","ppt/notesMasters/","ppt/notesSlides/","ppt/",""];for(const s of n){const n=s+e;if(r=await t.file(n),r)return{file:r,path:n}}const s=[];t.forEach((t,e)=>{s.push({name:t,file:e})});const i=e.split("/").pop()||"";if(i){const t=i.toLowerCase();for(const{name:e,file:r}of s)if((e.split("/").pop()||"").toLowerCase()===t&&e.includes("media/"))return{file:r,path:e};for(const{name:e,file:r}of s)if((e.split("/").pop()||"").toLowerCase()===t)return{file:r,path:e}}const o=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp"];for(const{name:t,file:e}of s){const r=t.toLowerCase();for(const n of o)if(r.endsWith(n)&&(r.includes("image")||r.includes("img")))return{file:e,path:t}}P("info",`Could not find image file for target: ${e}`),P("info",`Available files in ZIP (${s.length} total):`);const a=s.filter(({name:t})=>t.includes("media/"));return a.length>0&&(P("info",`Media files (${a.length}):`),a.slice(0,20).forEach(({name:t})=>{P("info",`  - ${t}`)}),a.length>20&&P("info",`  ... and ${a.length-20} more`)),null}(t,s.target);if(!i)return P("warn",`Image file not found in zip after exhaustive search. Original target: ${s.target}`),null;const{file:o,path:a}=i;P("info",`Found image file at: ${a}`);const l=await o.async("base64"),c=function(t){const e=t.split(".").pop()?.toLowerCase();switch(e){case"png":return"image/png";case"jpg":case"jpeg":default:return"image/jpeg";case"gif":return"image/gif";case"bmp":return"image/bmp";case"svg":return"image/svg+xml";case"webp":return"image/webp"}}(a),p=`data:${c};base64,${l}`;return P("info",`Converted image to base64 URL, mimeType=${c}, length=${p.length}`),n.set(e,p),p}async function at(t,e="ppt/theme/theme1.xml"){try{const r=await(t.file(e)?.async("string"));if(!r)return P("warn",`Theme file not found: ${e}`),null;const n=new DOMParser,s=n.parseFromString(r,"application/xml").documentElement,i=s.getAttribute("name")||e.split("/").pop()?.replace(".xml","")||"theme1",o=function(t){const e={},r=u(t,"themeElements","http://schemas.openxmlformats.org/drawingml/2006/main");if(!r)return e;const n=u(r,"clrScheme","http://schemas.openxmlformats.org/drawingml/2006/main");if(!n)return e;const s={bg1:"bg1",tx1:"tx1",bg2:"bg2",tx2:"tx2",accent1:"accent1",accent2:"accent2",accent3:"accent3",accent4:"accent4",accent5:"accent5",accent6:"accent6",hlink:"hlink",folHlink:"folHlink"};return Array.from(n.children).forEach(t=>{if(1!==t.nodeType)return;const r=t.localName||t.tagName.split(":").pop();r&&s[r]&&(e[s[r]]=function(t){const e=u(t,"srgbClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(e){const t=e.getAttribute("val");if(t)return`#${t}`}const r=u(t,"sysClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(r){const t=r.getAttribute("lastClr");if(t)return`#${t}`}return"#ffffff"}(t))}),e}(s);return P("info",`Parsed theme from ${e}: ${i}`),{colors:o,name:i}}catch(t){return P("error",`Failed to parse theme: ${e}`,t),null}}function lt(t,e,r={}){if(r[t]){const n=function(t){return{light:"lt1",dark:"dk1"}[t]||t}(r[t]);return e[n]||"#ffffff"}return e[t]||"#ffffff"}function ct(t,e,n){try{const s=new DOMParser,i=s.parseFromString(t,"application/xml").documentElement,o=function(t,e){const r=u(t,"bg","http://schemas.openxmlformats.org/presentationml/2006/main");if(!r)return{type:"color",value:"#ffffff"};const n=u(r,"bgRef","http://schemas.openxmlformats.org/presentationml/2006/main");if(n){n.getAttribute("idx");const t=u(n,"schemeClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(t){const e=t.getAttribute("val");if(e)return{type:"color",value:e,schemeRef:e}}}const s=u(r,"bgPr","http://schemas.openxmlformats.org/presentationml/2006/main");if(s){const t=u(s,"blipFill","http://schemas.openxmlformats.org/drawingml/2006/main");if(t){const r=u(t,"blip","http://schemas.openxmlformats.org/drawingml/2006/main");if(r){const t=r.getAttribute("r:embed")||r.getAttributeNS("http://schemas.openxmlformats.org/officeDocument/2006/relationships","embed");if(t&&e[t])return{type:"image",value:e[t].target,relId:t}}}const r=u(s,"solidFill","http://schemas.openxmlformats.org/drawingml/2006/main");if(r){const t=u(r,"srgbClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(t?.getAttribute("val"))return{type:"color",value:`#${t.getAttribute("val")}`};const e=u(r,"schemeClr","http://schemas.openxmlformats.org/drawingml/2006/main");if(e){const t=e.getAttribute("val");if(t)return{type:"color",value:t||"#ffffff",schemeRef:t||void 0}}}}return{type:"color",value:"#ffffff"}}(i,e),a=function(t){const e=u(t,"clrMapOvr","http://schemas.openxmlformats.org/presentationml/2006/main"),r={};if(!e)return r;const n=u(e,"masterClrMapping","http://schemas.openxmlformats.org/drawingml/2006/main");n&&Array.from(n.attributes).forEach(t=>{r[t.name]=t.value});return r}(i),l=function(t){const e=u(t,"txStyles","http://schemas.openxmlformats.org/presentationml/2006/main");if(!e)return{};return{titleParaPr:u(e,"titleP","http://schemas.openxmlformats.org/presentationml/2006/main"),bodyPr:u(e,"body","http://schemas.openxmlformats.org/presentationml/2006/main"),otherPr:u(e,"other","http://schemas.openxmlformats.org/presentationml/2006/main")}}(i),c=function(t,e){const n=[],s=u(t,"cSld","http://schemas.openxmlformats.org/presentationml/2006/main");if(!s)return n;const i=u(s,"spTree","http://schemas.openxmlformats.org/presentationml/2006/main");return i?(Array.from(i.children).forEach(t=>{if(1!==t.nodeType)return;const s=t.localName||t.tagName.split(":").pop();if("sp"===s){const s=u(t,"nvSpPr",r.p),i=s?u(s,"nvPr",r.p):null,o=i?u(i,"ph",r.p):null;if(o){const e=o.getAttribute("type");if(["sldNum","ftr","dt"].includes(e||"")){const e=function(t){const e=u(t,"nvSpPr",r.p);if(!e)return null;const n=u(e,"cNvPr",r.p),s=n?.getAttribute("id"),i=n?.getAttribute("name"),o=u(e,"nvPr",r.p);if(!o)return null;const a=u(o,"ph",r.p);if(!a)return null;const l=a.getAttribute("type"),c=u(t,"spPr",r.a),p=u(c,"xfrm",r.a);let d={x:0,y:0,width:0,height:0};if(p){const t=u(p,"off",r.a),e=u(p,"ext",r.a);t&&(d.x=parseInt(t.getAttribute("x")||"0"),d.y=parseInt(t.getAttribute("y")||"0")),e&&(d.width=parseInt(e.getAttribute("cx")||"0"),d.height=parseInt(e.getAttribute("cy")||"0"))}return{id:s,name:i,type:"shape",placeholder:l,rect:d}}(t);e&&n.push(e)}}else{const r=M.fromNode(t,e);r&&n.push(r)}}else if("pic"===s){const r=N.fromNode(t,e);r&&n.push(r)}else if("grpSp"===s){const r=B.fromNode(t,e);r&&n.push(r)}else if("graphicFrame"===s){const s=function(t,e){try{const n=u(t,"graphic",r.a),s=n?u(n,"graphicData",r.a):null;if(!s)return null;const i=s.getAttribute("uri")||"";return i.includes("table")?L.fromNode(t,e):i.includes("chart")?D.fromNode(t,e):i.includes("diagram")?j.fromNode(t,e):null}catch(t){return P("warn","Failed to parse master graphicFrame element",t),null}}(t,e);s&&n.push(s)}}),n):n}(i,e),p=c.filter(t=>t.placeholder);let d;for(const t of Object.values(e))if(t.type.includes("theme")){const e=t.target.match(/theme(\d+)\.xml/);e&&(d=`theme${e[1]}`,P("info",`Master references theme: ${d}`))}return{id:`master-${n}`,masterId:`slideMaster${n}`,background:o,elements:c,placeholders:p,colorMap:a,textStyles:l,themeRef:d,relsMap:e}}catch(t){return P("error",`Failed to parse master slide ${n}`,t),{id:`master-${n}`,masterId:`slideMaster${n}`,elements:[],colorMap:{}}}}const pt={slideLayouts:l,slideLayoutsRels:"ppt/slideLayouts/_rels/"};function dt(t,e={}){try{const n=new DOMParser,s=n.parseFromString(t,"application/xml").documentElement;if("p:sldLayout"!==s.tagName&&!s.tagName.includes("sldLayout"))return P("warn","Invalid layout XML root element",s.tagName),null;const i=u(s,"cSld",r.p),o=i?.getAttribute("name")||void 0,a=rt(s,e),l=u(s,"clrMapOvr",r.p),c=u(l,"masterClrMapping",r.a);let p={};if(c){Array.from(c.attributes).forEach(t=>{"xmlns:a"!==t.name&&(p[t.name]=t.value)})}const d=function(t){const e=u(t,"txStyles",r.p);if(!e)return{};return{titleParaPr:u(e,"titleP",r.p),bodyPr:u(e,"body",r.p),otherPr:u(e,"other",r.p)}}(s),h=function(t,e){const n=[],s=u(t,"cSld",r.p);if(!s)return n;const i=u(s,"spTree",r.p);return i?(Array.from(i.children).forEach(t=>{if(1!==t.nodeType)return;const s=t.localName||t.tagName.split(":").pop();if("sp"===s){const s=u(t,"nvPr",r.p);if(!(s?u(s,"ph",r.p):null)){const r=M.fromNode(t,e);r&&n.push(r)}}else if("pic"===s){const r=N.fromNode(t,e);r&&n.push(r)}else if("grpSp"===s){const r=B.fromNode(t,e);r&&n.push(r)}else if("graphicFrame"===s){const s=function(t,e){try{const n=u(t,"graphic",r.a),s=n?u(n,"graphicData",r.a):null;if(!s)return null;const i=s.getAttribute("uri")||"";return i.includes("table")?L.fromNode(t,e):i.includes("chart")?D.fromNode(t,e):i.includes("diagram")?j.fromNode(t,e):null}catch(t){return P("warn","Failed to parse layout graphicFrame element",t),null}}(t,e);s&&n.push(s)}}),n):n}(s,e),f=function(t){const e=[],n=u(t,"cSld",r.p);if(!n)return e;const s=u(n,"spTree",r.p);return s?(Array.from(s.children).forEach(t=>{if(1!==t.nodeType)return;if("sp"===(t.localName||t.tagName.split(":").pop())){const n=function(t){const e=u(t,"nvSpPr",r.p);if(!e)return null;const n=u(e,"cNvPr",r.p),s=n?.getAttribute("id")||"",i=n?.getAttribute("name")||"",o=u(e,"nvPr",r.p);if(!o)return null;const a=u(o,"ph",r.p);if(!a)return null;const l=a.getAttribute("type"),c={title:"title",ctrTitle:"title",body:"body",dt:"dateTime",sldNum:"slideNumber",ftr:"footer"}[l||""]||"other",p=a.getAttribute("idx"),d=u(t,"spPr",r.p),h=u(d,"xfrm",r.a);let f={x:0,y:0,width:0,height:0};if(h){const t=u(h,"off",r.a),e=u(h,"ext",r.a);t&&(f.x=parseInt(t.getAttribute("x")||"0"),f.y=parseInt(t.getAttribute("y")||"0")),e&&(f.width=parseInt(e.getAttribute("cx")||"0"),f.height=parseInt(e.getAttribute("cy")||"0"))}const g=u(t,"txBody",r.p);let m,y;if(g){const t=u(g,"bodyPr",r.a);if(t){const e=t.getAttribute("algn"),r=t.getAttribute("anchor");"l"===e?m="left":"ctr"===e?m="center":"r"===e&&(m="right"),"t"===r?y="top":"ctr"===r?y="middle":"b"===r&&(y="bottom")}}return{id:s,type:c,name:i,rect:f,hAlign:m,vAlign:y,idx:p?parseInt(p):void 0,rawNode:t}}(t);n&&e.push(n)}}),e):e}(s);let g;for(const t of Object.values(e))if(t.type.includes("slideMaster")){const e=t.target.match(/slideMaster(\d+)\.xml/);e&&(g=`slideMaster${e[1]}`,P("info",`Layout references master file: ${g}`))}return{id:k("layout"),name:o,background:a,elements:h,placeholders:f,relsMap:e,colorMap:p,textStyles:d,masterRef:g}}catch(t){return P("error","Failed to parse slide layout",t),null}}async function ht(t,e,n){try{const s=new DOMParser,i=s.parseFromString(n,"application/xml").documentElement,o=ft(i),a=mt(i),l=function(t){const e=[],n=u(t,"cSld",r.p);if(!n)return e;const s=u(n,"spTree",r.p);if(!s)return e;const i=Array.from(s.children).filter(t=>"p:sp"===t.tagName||t.tagName.includes(":sp"));for(const t of i){const n=u(t,"nvSpPr",r.p);if(!n)continue;const s=u(n,"nvPr",r.p);if(!s)continue;const i=u(s,"ph",r.p);if(!i)continue;const o=u(n,"cNvPr",r.p),a=f(o,"id",`placeholder_${Date.now()}`),l=f(o,"name",""),p=i.getAttribute("type")||"other",d=u(t,"spPr",r.p),h=d?u(d,"xfrm",r.a):null;let g={x:0,y:0,width:0,height:0};if(h){const t=u(h,"off",r.a),e=u(h,"ext",r.a);t&&(g.x=c(t.getAttribute("x")||"0"),g.y=c(t.getAttribute("y")||"0")),e&&(g.width=c(e.getAttribute("cx")||"0"),g.height=c(e.getAttribute("cy")||"0"))}e.push({id:a,type:p,name:l,rect:g})}return e}(i),p=e.match(/notesMaster(\d+)\.xml/)?.[1]||"1",d=await async function(t,e){try{const r=`ppt/notesMasters/_rels/${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?yt(n):(P("warn",`Notes master rels not found: ${r}`),{})}catch(t){return P("warn",`Failed to parse notes master rels for ${e}`,t),{}}}(t,`notesMaster${p}`);return P("info",`Parsed notes master: ${p}`),{id:`notesMaster_${p}`,elements:a,background:o,placeholders:l,relsMap:d}}catch(t){throw P("error",`Failed to parse notes master: ${e}`,t),t}}async function ut(t,e,n){try{const s=new DOMParser,i=s.parseFromString(n,"application/xml").documentElement,o=ft(i),a=function(t){const e=u(t,"cSld",r.p);if(!e)return"";const n=u(e,"spTree",r.p);if(!n)return"";const s=Array.from(n.children).filter(t=>"p:sp"===t.tagName||t.tagName.includes(":sp"));for(const t of s){const e=u(t,"nvSpPr",r.p);if(!e)continue;const n=u(e,"nvPr",r.p);if(!n)continue;const s=u(n,"ph",r.p);if("body"===s?.getAttribute("type")){const e=u(t,"txBody",r.p);if(!e)continue;const n=gt(e);if(n&&n.trim())return n.trim()}}return""}(i),l=mt(i),c=e.match(/notesSlide(\d+)\.xml/)?.[1]||"1",p=await async function(t,e){try{const r=`ppt/notesSlides/_rels/${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?yt(n):(P("warn",`Notes slide rels not found: ${r}`),{})}catch(t){return P("warn",`Failed to parse notes slide rels for ${e}`,t),{}}}(t,`notesSlide${c}`),d=p.rId1?.target||"";return P("info",`Parsed notes slide: ${c}`),{id:`notesSlide_${c}`,slideId:`slide${c}`,text:a,elements:l,background:o,relsMap:p,masterRef:d}}catch(t){throw P("error",`Failed to parse notes slide: ${e}`,t),t}}function ft(t){const e=u(t,"bg",r.p);if(!e)return{type:"color",value:"#ffffff"};const n=u(e,"bgPr",r.p);if(n){const t=u(n,"solidFill",r.a);if(t){const e=u(t,"srgbClr",r.a);if(e?.getAttribute("val"))return{type:"color",value:`#${e.getAttribute("val")}`}}}return{type:"color",value:"#ffffff"}}function gt(t){const e=Array.from(t.children).filter(t=>"a:p"===t.tagName||t.tagName.includes(":p")),r=[];for(const t of e){const e=Array.from(t.children).filter(t=>"a:r"===t.tagName||t.tagName.includes(":r"));for(const t of e){const e=u(t,"t","http://schemas.openxmlformats.org/drawingml/2006/main");e?.textContent&&r.push(e.textContent)}}return r.join("\n")}function mt(t){const e=[],n=u(t,"cSld",r.p);if(!n)return e;const s=u(n,"spTree",r.p);return s?(Array.from(s.children).forEach((t,n)=>{if(1!==t.nodeType)return;const s=t.tagName;s.includes("sp")?e.push(function(t){const e=u(t,"cNvPr",r.p),n=f(e,"id",`shape_${Date.now()}`),s=f(e,"name",""),i=u(t,"spPr",r.p),o=i?u(i,"xfrm",r.a):null;let a={x:0,y:0,width:0,height:0};if(o){const t=u(o,"off",r.a),e=u(o,"ext",r.a);t&&(a.x=c(t.getAttribute("x")||"0"),a.y=c(t.getAttribute("y")||"0")),e&&(a.width=c(e.getAttribute("cx")||"0"),a.height=c(e.getAttribute("cy")||"0"))}return{id:n,name:s,type:"shape",rect:a,content:{}}}(t)):s.includes("pic")&&e.push(function(t){const e=u(t,"cNvPr",r.p),n=f(e,"id",`image_${Date.now()}`),s=f(e,"name",""),i=u(t,"spPr",r.p),o=i?u(i,"xfrm",r.a):null;let a={x:0,y:0,width:0,height:0};if(o){const t=u(o,"off",r.a),e=u(o,"ext",r.a);t&&(a.x=c(t.getAttribute("x")||"0"),a.y=c(t.getAttribute("y")||"0")),e&&(a.width=c(e.getAttribute("cx")||"0"),a.height=c(e.getAttribute("cy")||"0"))}return{id:n,name:s,type:"image",rect:a,content:{}}}(t))}),e):e}function yt(t){const e={};try{const r=new DOMParser,n=r.parseFromString(t,"application/xml").documentElement,s=Array.from(n.children).filter(t=>"Relationship"===t.tagName||t.tagName.includes(":Relationship"));for(const t of s){const r=t.getAttribute("Id")||"",n=t.getAttribute("Type")||"",s=t.getAttribute("Target")||"";r&&(e[r.replace("rId","")]={id:r,type:n,target:s})}}catch(t){P("warn","Failed to parse relationships XML",t)}return e}function bt(t,e,n){try{const s=new DOMParser,i=s.parseFromString(t,"application/xml").documentElement,o=function(t){const e=u(t,"plotArea",r.c);if(!e)return"unknown";const n=Array.from(e.children);for(const t of n){const e=t.tagName;if(e.includes("lineChart"))return"lineChart";if(e.includes("barChart"))return"barChart";if(e.includes("pieChart"))return e.includes("3D")?"pie3DChart":"pieChart";if(e.includes("areaChart"))return"areaChart";if(e.includes("scatterChart"))return"scatterChart"}return"unknown"}(i),a=function(t){const e=u(t,"title",r.c);if(!e)return;const n=u(e,"tx",r.c);if(!n)return;u(n,"strRef",r.c);const s=u(n,"strCache",r.c);if(s){const t=u(s,"pt",r.c);if(t?.textContent)return t.textContent.trim()}const i=u(n,"rich",r.c);if(i){const t=u(i,"p",r.a);if(t){const e=St(t);if(e)return e}}return}(i),l=function(t){const e=[],n=u(t,"plotArea",r.c);if(!n)return e;const s=xt(n);if(!s)return e;const i=Array.from(s.children).filter(t=>t.tagName.includes(":ser")||"ser"===t.localName);for(const t of i){const r=parseInt(f(t,"idx","0"),10),n=parseInt(f(t,"order","0"),10),s=$t(t),i=wt(t);e.push({name:s,idx:r,order:n,points:i})}return e}(i),c=function(t){const e=[],n=u(t,"plotArea",r.c);if(!n)return e;const s=u(n,"catAx",r.c);if(!s)return e;const i=u(s,"tx",r.c);if(!i)return e;u(i,"strRef",r.c);const o=u(i,"strCache",r.c);if(o){const t=Array.from(o.children).filter(t=>t.tagName.includes(":pt")||"pt"===t.localName);for(const n of t){const t=u(n,"v",r.c);t?.textContent&&e.push(t.textContent.trim())}}return e}(i),p=vt(i,"x"),d=vt(i,"y"),h=function(t){const e=u(t,"legend",r.c);if(!e)return!1;return"1"!==e.getAttribute("deleted")}(i),g=function(t){const e=u(t,"plotArea",r.c);if(!e)return!1;const n=xt(e);if(!n)return!1;const s=u(n,"dLbls",r.c);if(!s)return!1;return"1"!==s.getAttribute("deleted")}(i);return P("info",`Parsed chart ${e}: type=${o}, series=${l.length}`),{id:`chart_${e}`,chartType:o,title:a,series:l,categories:c,xTitle:p,yTitle:d,showLegend:h,showDataLabels:g,relsMap:n}}catch(t){return P("error",`Failed to parse chart ${e}`,t),{id:`chart_${e}`,chartType:"unknown",relsMap:n}}}function xt(t){const e=Array.from(t.children);for(const t of e){const e=t.tagName;if(e.includes("lineChart")||e.includes("barChart")||e.includes("pieChart")||e.includes("areaChart")||e.includes("scatterChart"))return t}return null}function $t(t){const e=u(t,"tx",r.c);if(!e)return;u(e,"strRef",r.c);const n=u(e,"strCache",r.c);if(n){const t=u(n,"pt",r.c);if(t?.textContent)return t.textContent.trim()}const s=u(e,"v",r.c);return s?.textContent?s.textContent.trim():void 0}function wt(t){const e=[];u(t,"val",r.c);const n=u(t,"numCache",r.c);if(n){const t=Array.from(n.children).filter(t=>t.tagName.includes(":pt")||"pt"===t.localName);for(const n of t){const t=parseInt(f(n,"idx","0"),10),s=u(n,"v",r.c),i=s?.textContent?parseFloat(s.textContent):void 0;e.push({idx:t,value:i})}}return e}function vt(t,e){const n=u(t,"plotArea",r.c);if(!n)return;const s=u(n,"x"===e?"catAx":"valAx",r.c);if(!s)return;const i=u(s,"title",r.c);if(!i)return;const o=u(i,"tx",r.c);if(!o)return;const a=u(o,"rich",r.c);if(a){const t=u(a,"p",r.a);if(t){const e=St(t);if(e)return e}}}function St(t){const e=Array.from(t.children).filter(t=>t.tagName.includes(":r")||"r"===t.localName),n=[];for(const t of e){const e=u(t,"t",r.a);e?.textContent&&n.push(e.textContent)}return n.length>0?n.join(""):void 0}function At(t,e,n){try{const s=new DOMParser,i=s.parseFromString(t,"application/xml").documentElement,o=i.getAttribute("type")||"unknown",a=i.getAttribute("layout")||"",l=function(t){const e=[],n=u(t,"spTree",r.d);if(!n)return e;const s=Array.from(n.children).filter(t=>t.tagName.includes(":sp")||"sp"===t.localName);for(const t of s){const n=f(t,"id",`shape_${Date.now()}`),s=t.getAttribute("type")||"shape",i=u(t,"xfrm",r.a);let o,a;if(i){const t=u(i,"off",r.a),e=u(i,"ext",r.a);if(t){const e=parseInt(t.getAttribute("x")||"0"),r=parseInt(t.getAttribute("y")||"0");o={x:c(e),y:c(r)}}if(e){const t=parseInt(e.getAttribute("cx")||"0"),r=parseInt(e.getAttribute("cy")||"0");a={width:c(t),height:c(r)}}}const l=Ft(t);e.push({id:n,type:s,position:o,size:a,text:l})}return e}(i);return P("info",`Parsed diagram ${e}: type=${o}, shapes=${l.length}`),{id:`diagram_${e}`,diagramType:o,layout:a,shapes:l,relsMap:n}}catch(t){return P("error",`Failed to parse diagram ${e}`,t),{id:`diagram_${e}`,relsMap:n}}}function Ft(t){const e=u(t,"txBody",r.d);if(!e)return;const n=u(e,"p",r.a);if(!n)return;return St(n)}async function Tt(t,e){try{const r=`ppt/charts/_rels/${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?kt(n):(P("warn",`Chart rels not found: ${r}`),{})}catch(t){return P("warn",`Failed to parse chart rels for ${e}`,t),{}}}async function Ct(t,e){try{const r=`ppt/diagrams/_rels/data${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?kt(n):(P("warn",`Diagram rels not found: ${r}`),{})}catch(t){return P("warn",`Failed to parse diagram rels for ${e}`,t),{}}}function kt(t){const e={};try{const r=new DOMParser,n=r.parseFromString(t,"application/xml").documentElement,s=Array.from(n.children).filter(t=>"Relationship"===t.tagName||t.tagName.includes(":Relationship"));for(const t of s){const r=t.getAttribute("Id")||"",n=t.getAttribute("Type")||"",s=t.getAttribute("Target")||"";r&&(e[r.replace("rId","")]={id:r,type:n,target:s})}}catch(t){P("warn","Failed to parse relationships XML",t)}return e}async function Pt(t,e){try{const n=`ppt/slides/${e}.xml`,s=await(t.file(n)?.async("string"));if(!s)return P("warn",`Slide not found: ${n}`),It(e);const i=await async function(t,e){try{const r=`ppt/slides/_rels/${e}.xml.rels`,n=await(t.file(r)?.async("string"));return n?function(t){const e={};try{const r=new DOMParser,n=r.parseFromString(t,"application/xml").documentElement,s=Array.from(n.children).filter(t=>"Relationship"===t.tagName||t.tagName.includes(":Relationship"));for(const t of s){const r=t.getAttribute("Id")||"",n=t.getAttribute("Type")||"",s=t.getAttribute("Target")||"";r&&(e[r.replace("rId","")]={id:r,type:n,target:s})}}catch(t){P("warn","Failed to parse relationships XML",t)}return e}(n):(P("warn",`Slide rels not found: ${r}`),{})}catch(t){return P("warn",`Failed to parse slide rels for ${e}`,t),{}}}(t,e),o=function(t){const e=[];try{const n=(new DOMParser).parseFromString(t,"application/xml"),s=u(n.documentElement,"extLst",r.p);if(!s)return e;const i=Array.from(s.children).filter(t=>"p:ext"===t.tagName||t.tagName.includes(":ext"));for(const t of i){const r=t.getAttribute("uri")||"";if(r.includes("tags")||r.includes("ppt/tags")){const r=Array.from(t.children).filter(t=>"p:tag"===t.tagName||t.tagName.includes(":tag"));for(const t of r){const r=f(t,"name",""),n=f(t,"val","");r&&e.push({name:r,value:n})}}}}catch(t){P("warn","Failed to parse tags",t)}return e}(s),a=function(t){const e=[];try{const n=(new DOMParser).parseFromString(t,"application/xml"),s=u(n.documentElement,"extLst",r.p);if(!s)return e;const i=Array.from(s.children).filter(t=>"p:ext"===t.tagName||t.tagName.includes(":ext"));for(const t of i){const r=t.getAttribute("uri")||"",n=Mt(Array.from(t.children));e.push({uri:r,data:n})}}catch(t){P("warn","Failed to parse extensions",t)}return e}(s),l=function(t){const e=[];try{const n=(new DOMParser).parseFromString(t,"application/xml"),s=u(n.documentElement,"extLst",r.p);if(!s)return e;const i=Array.from(s.children).filter(t=>"p:ext"===t.tagName||t.tagName.includes(":ext"));for(const t of i){const r=t.getAttribute("uri")||"";if(r.includes("customProps")||r.includes("ppt/customProperties")){const r=Array.from(t.children).filter(t=>"p:custData"===t.tagName||t.tagName.includes(":custData"));for(const t of r){const r=f(t,"name",""),n=t.textContent||"",s=Nt(n);r&&e.push({name:r,value:n,type:s})}}}}catch(t){P("warn","Failed to parse custom properties",t)}return e}(s);return{id:`tags_${e}`,slideId:e,tags:o,extensions:a,customProperties:l,relsMap:i}}catch(t){return P("error",`Failed to parse tags for slide ${e}`,t),It(e)}}function It(t){return{id:`tags_${t}`,slideId:t,tags:[],extensions:[],customProperties:[],relsMap:{}}}function Mt(t){const e={};for(const r of t){if(1!==r.nodeType)continue;const t=r.localName||r.tagName.split(":").pop();if(r.children.length>0)e[t]=Mt(Array.from(r.children));else if(r.textContent){const n=r.textContent.trim();e[t]=n}else e[t]=null}return e}function Nt(t){if(!t)return"string";if("true"===t.toLowerCase()||"false"===t.toLowerCase())return"boolean";if(!isNaN(parseFloat(t))&&isFinite(Number(t)))return"number";return/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2})?$/.test(t)?"date":"string"}const Et={generateId:k,parseXmlText:t=>e.unescape(t||"").trim(),px2emu:p,emu2px:c,parseXmlToTree:t=>{const e=(new DOMParser).parseFromString(t,"application/xml").documentElement,r=t=>{const e=[];return Array.from(t.childNodes).forEach(t=>{1===t.nodeType&&e.push(r(t))}),{tag:t.tagName,attrs:Et.parseXmlAttrs(t.attributes),children:e,text:Et.parseXmlText(t.textContent||"")}};return r(e)},parseXmlAttrs:t=>{const e={};return Array.from(t).forEach(t=>{e[t.nodeName]=t.nodeValue||""}),e},parseXmlRect:t=>({x:c(t.x||"0"),y:c(t.y||"0"),width:c(t.cx||"0"),height:c(t.cy||"0")}),parseXmlStyle:t=>{const e={};t.fontSize?e.fontSize=parseInt(t.fontSize)/100:e.fontSize=14,t.fill?e.color=t.fill:e.color="#333333","1"===t.bold||"true"===t.bold?e.fontWeight="bold":e.fontWeight="normal";const r=t.align;return e.textAlign="left"===r||"center"===r||"right"===r||"justify"===r?r:"left",t.bgFill?e.backgroundColor=t.bgFill:e.backgroundColor="transparent",t.border?e.borderColor=t.border:e.borderColor="#000000",t.borderWidth?e.borderWidth=parseInt(t.borderWidth):e.borderWidth=1,e},hexToRgb:t=>{const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}},rgbToHex:(t,e,r)=>"#"+((1<<24)+(t<<16)+(e<<8)+r).toString(16).slice(1),parseColor:t=>(t.startsWith("#"),t)};async function Dt(e,r){const n={parseImages:!0,keepRawXml:!1,verbose:!1,returnFormat:"enhanced",...r},s=await t.loadAsync(e);return"simple"===n.returnFormat?async function(t){const e=await async function(t){const e={width:1280,height:720,title:"未命名PPT"};try{const r=await(t.file("ppt/slideLayouts/slideLayout1.xml")?.async("string"));if(r){const t=Et.parseXmlToTree(r).children.find(t=>"cSld"===t.tag),n=t?.children.find(t=>"sldSz"===t.tag);if(n){const t=Et.parseXmlRect(n.attrs);e.width=t.width,e.height=t.height}}const n=await(t.file("docProps/core.xml")?.async("string"));if(n){const t=Et.parseXmlToTree(n);e.title=t.children.find(t=>t.tag.includes("title"))?.text||"未命名PPT"}}catch(t){console.warn("PPT配置解析失败，使用默认配置",t)}return e}(t),r=await async function(t){const e=[],r=Object.keys(t.files).filter(t=>t.startsWith("ppt/slides/slide")&&t.endsWith(".xml"));for(const n of r){const r=await t.file(n).async("string");e.push({xml:r,slideId:Et.generateId("slide"),rId:n.replace("ppt/slides/slide","").replace(".xml",""),layout:"normal"})}return e}(t),n=await Promise.all(r.map((t,e)=>async function(t,e,r){const{xml:n,layout:s}=e,i=Et.parseXmlToTree(n),o=i.children.find(t=>"p:cSld"===t.tag||"cSld"===t.tag),a=o?.children.find(t=>"p:spTree"===t.tag||"spTree"===t.tag),l=[];a&&a.children.forEach(t=>{const e=function(t){const{tag:e}=t;if("p:sp"===e||"sp"===e)return function(t){const e=Et.generateId("shape"),r=t.children,n=r.find(t=>"p:spPr"===t.tag||"spPr"===t.tag),s=r.find(t=>"p:txBody"===t.tag||"txBody"===t.tag);let i={x:0,y:0,width:0,height:0};if(n){const t=n.children.find(t=>"a:xfrm"===t.tag);if(t){const e=t.children.find(t=>"a:off"===t.tag),r=t.children.find(t=>"a:ext"===t.tag);e&&r&&(i=Et.parseXmlRect({x:e.attrs.x||"0",y:e.attrs.y||"0",cx:r.attrs.cx||"0",cy:r.attrs.cy||"0"}))}}let o="";if(s){const t=s.children.filter(t=>"a:p"===t.tag||"p"===t.tag),e=[];t.forEach(t=>{const r=t.children.filter(t=>"a:r"===t.tag||"r"===t.tag);r.forEach(t=>{const r=t.children.find(t=>"a:t"===t.tag||"t"===t.tag);if(r&&r.text){const n=t.children.find(t=>"a:rPr"===t.tag||"rPr"===t.tag);e.push({text:r.text,fontSize:n?.attrs.sz?parseInt(n.attrs.sz)/100:14,fontColor:n?.attrs.fill||"#333333",bold:"1"===n?.attrs.b,italic:"1"===n?.attrs.i})}})}),o={paragraphs:[{runs:e}]}}return{id:e,type:"text",rect:i,style:{fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1},content:o}}(t);if("p:pic"===e||"pic"===e)return function(t){const e=Et.generateId("image"),r=t.children,n=r.find(t=>"p:spPr"===t.tag||"spPr"===t.tag),s=r.find(t=>"p:blipFill"===t.tag||"blipFill"===t.tag);let i={x:0,y:0,width:0,height:0};if(n){const t=n.children.find(t=>"a:xfrm"===t.tag);if(t){const e=t.children.find(t=>"a:off"===t.tag),r=t.children.find(t=>"a:ext"===t.tag);e&&r&&(i=Et.parseXmlRect({x:e.attrs.x||"0",y:e.attrs.y||"0",cx:r.attrs.cx||"0",cy:r.attrs.cy||"0"}))}}let o="";if(s){const t=s.children.find(t=>"a:blip"===t.tag||"blip"===t.tag);o=t?.attrs["r:embed"]||t?.attrs.embed||""}return{id:e,type:"image",rect:i,style:{fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1},content:{url:"",imgId:o},props:{imgId:o,alt:"图片"}}}(t);if("p:graphicFrame"===e||"graphicFrame"===e)return function(t){const e=Et.generateId("graphic"),r=t.children,n=r.find(t=>"p:xfrm"===t.tag||"xfrm"===t.tag);let s={x:0,y:0,width:0,height:0};if(n){const t=n.children.find(t=>"a:off"===t.tag),e=n.children.find(t=>"a:ext"===t.tag);t&&e&&(s=Et.parseXmlRect({x:t.attrs.x||"0",y:t.attrs.y||"0",cx:e.attrs.cx||"0",cy:e.attrs.cy||"0"}))}const i=r.find(t=>"a:graphic"===t.tag||"graphic"===t.tag),o=i?.children.find(t=>"a:graphicData"===t.tag||"graphicData"===t.tag);if(!o)return null;const a=o.attrs.uri||"";if(a.includes("table"))return{id:e,type:"table",rect:s,style:{fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#cccccc",borderWidth:1},content:{rows:[]},props:{rowCount:0,colCount:0}};if(a.includes("chart"))return{id:e,type:"chart",rect:s,style:{fontSize:14,color:"#333333",fontWeight:"normal",textAlign:"left",backgroundColor:"transparent",borderColor:"#000000",borderWidth:1},content:{type:"unknown",data:[]},props:{legend:!0,grid:!0}};return null}(t);return null}(t);e&&l.push(e)});const c=function(t){const e=t.children.find(t=>"bg"===t.tag);if(!e)return"#ffffff";const r=e.children.find(t=>"fill"===t.tag);return r?.attrs.color||"#ffffff"}(i),p=function(t,e){const r=t.children.find(t=>"p:cSld"===t.tag||"cSld"===t.tag),n=r?.children.find(t=>"p:spTree"===t.tag||"spTree"===t.tag);if(!n)return`幻灯片${e}`;for(const t of n.children)if("p:sp"===t.tag||"sp"===t.tag){const e=t.children.find(t=>"p:nvSpPr"===t.tag||"nvSpPr"===t.tag),r=e?.children.find(t=>"p:nvPr"===t.tag||"nvPr"===t.tag),n=r?.children.find(t=>"p:ph"===t.tag||"ph"===t.tag);if("title"===n?.attrs.type){const e=t.children.find(t=>"p:txBody"===t.tag||"txBody"===t.tag),r=e?.children.find(t=>"a:p"===t.tag||"p"===t.tag),n=r?.children.find(t=>"a:r"===t.tag||"r"===t.tag),s=n?.children.find(t=>"a:t"===t.tag||"t"===t.tag);if(s?.text)return s.text}}return`幻灯片${e}`}(i,r+1);return{id:e.slideId,title:p,bgColor:c,elements:l,props:{width:1280,height:720,slideLayout:s}}}(0,t,e)));return{id:Et.generateId("ppt-doc"),title:e.title||"未命名PPT",slides:n,props:{width:e.width||1280,height:e.height||720,ratio:(e.width||1280)/(e.height||720)}}}(s):async function(t,e){try{P("info","Starting PPTX parsing...");const r=await async function(t){try{const e=await(t.file(`${a}core.xml`)?.async("string"));return e?x(e):(P("warn","core.xml not found"),{})}catch(t){return P("warn","Failed to parse core properties",t),{}}}(t),n=await async function(t){try{const e=await(t.file("ppt/presentation.xml")?.async("string"));if(e){const t=(new DOMParser).parseFromString(e,"application/xml"),r=t.documentElement.namespaceURI||"http://schemas.openxmlformats.org/presentationml/2006/main",n=t.getElementsByTagNameNS(r,"sldSz")[0];if(n){const t=n.getAttribute("cx"),e=n.getAttribute("cy");if(t&&e)return{width:c(t),height:c(e)}}}return{width:1280,height:720}}catch(t){return P("warn","Failed to parse slide size",t),{width:1280,height:720}}}(t),s=await at(t);P("info",s?"Theme parsed successfully":"Theme not found");const o=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/slideMasters/")&&t.endsWith(".xml")).sort();P("info",`Found ${e.length} master slide files`);const r=[];for(const n of e){const e=n.match(/slideMaster(\d+)\.xml/)?.[1];if(!e)continue;const s=await(t.file(n)?.async("string"));if(!s)continue;const i=n.replace("slideMasters/","slideMasters/_rels/").replace(".xml",".xml.rels");let o={};try{const r=await(t.file(i)?.async("string"));r&&(o=b(r,i),P("info",`Loaded ${Object.keys(o).length} relationships for master ${e}`),Object.entries(o).forEach(([t,e])=>{P("info",`  - ${t}: type=${e.type}, target=${e.target}`)}))}catch(t){P("warn",`Failed to read master rels: ${i}`,t)}const a=ct(s,o,e);r.push(a)}return r}catch(t){return P("error","Failed to parse master slides",t),[]}}(t);P("info",`Parsed ${o.length} master slides`);const l=new Map;o.forEach(t=>{t.masterId&&(l.set(t.masterId,t),P("info",`Master map: ${t.masterId} -> ${t.id}`))});const p=await async function(t){try{const e={},r=Object.keys(t.files).filter(t=>t.startsWith(pt.slideLayouts)&&t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort((t,e)=>parseInt(t.match(/slideLayout(\d+)\.xml/)?.[1]||"0",10)-parseInt(e.match(/slideLayout(\d+)\.xml/)?.[1]||"0",10));P("info",`Found ${r.length} layout files`);for(let n=0;n<r.length;n++){const s=r[n];P("info",`Parsing layout ${n+1}: ${s}`);const i=await(t.file(s)?.async("string"));if(!i){P("warn",`Failed to read layout: ${s}`);continue}const o=s.match(/slideLayout(\d+)\.xml/)?.[1];let a={};if(o){const e=`ppt/slideLayouts/_rels/slideLayout${o}.xml.rels`;try{const r=await(t.file(e)?.async("string"));r&&(a=b(r,e),P("info",`Loaded ${Object.keys(a).length} relationships for layout ${o}`),Object.entries(a).forEach(([t,e])=>{P("info",`  - ${t}: type=${e.type}, target=${e.target}`)}))}catch(t){P("warn",`Failed to read layout rels: ${e}`,t)}}const l=dt(i,a);l&&(e[`slideLayout${o}`]=l)}return e}catch(t){return P("error","Failed to parse slide layouts",t),{}}}(t);P("info",`Parsed ${Object.keys(p).length} slide layouts`),Object.entries(p).forEach(([t,e])=>{if(e.masterRef&&l.has(e.masterRef)){e.masterRefIndex=e.masterRef,P("info",`Layout ${t} references master: ${e.masterRef}`)}});const d=await async function(t,e){try{const r=Object.keys(t.files).filter(t=>t.startsWith(i)).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort((t,e)=>parseInt(t.match(/slide(\d+)\.xml/)?.[1]||"0",10)-parseInt(e.match(/slide(\d+)\.xml/)?.[1]||"0",10));P("info",`Found ${r.length} slide files`);const n=[];for(let s=0;s<r.length;s++){const i=r[s];P("info",`Parsing slide ${s+1}: ${i}`);const o=await(t.file(i)?.async("string"));if(!o){P("warn",`Failed to read slide: ${i}`);continue}const a=i.match(/slide(\d+)\.xml/)?.[1];let l={};if(a){const e=`slide${a}`;l=await tt(t,e),P("info",`Loaded ${Object.keys(l).length} relationships for slide ${e}`)}const c=et(o,l,s);e.keepRawXml&&(c.rawXml=o),n.push(c)}return n}catch(t){return P("error","Failed to parse slides",t),[]}}(t,e);d.forEach(t=>{const e=function(t){for(const[e,r]of Object.entries(t))if(r.type.includes("slideLayout")){const t=r.target.match(/slideLayout(\d+)\.xml/);if(t)return`slideLayout${t[1]}`}}(t.relsMap||{});if(e&&p[e]){const a=p[e],l=a,c=(r=t.background,n=a.background,i=l.masterRefIndex?o.find(t=>t.masterId===l.masterRefIndex)?.background:void 0,r&&"none"!==r.type?r:n&&"none"!==n.type?n:i||{type:"color",value:"#ffffff"});t.background=c,t.layoutId=e,t.masterRefIndex=l.masterRefIndex;W(t,a,l.masterRefIndex?o.find(t=>t.masterId===l.masterRefIndex):void 0,s);P("info",`Slide relationship chain: slide -> layout (${e}) -> master (${a.masterRef})`)}else e&&P("warn",`Layout ${e} referenced by slide not found in parsed layouts`);var r,n,i});const h=await async function(t){try{const e=await(t.file("_rels/.rels")?.async("string"));return e?b(e,"_rels/.rels"):{}}catch(t){return P("warn","Failed to parse global relationships",t),{}}}(t);P("info",`Parsed ${d.length} slides successfully`);const u=n.width/n.height,f=function(t){const e=.01;return Math.abs(t-1.33333)<e?"4:3":Math.abs(t-1.77778)<e?"16:9":Math.abs(t-1.6)<e?"16:10":"custom"}(u);s&&s.colors&&(o.forEach(t=>{if(t.background&&"object"==typeof t.background){const e=t.background;if(e.schemeRef){const r=lt(e.schemeRef,s.colors,t.colorMap||{});e.value=r,delete e.schemeRef}}}),Object.values(p).forEach(t=>{if(t.background&&"object"==typeof t.background){const e=t.background;if(e.schemeRef){const r=lt(e.schemeRef,s.colors,t.colorMap||{});e.value=r,delete e.schemeRef}}}),d.forEach((t,e)=>{if(t.background&&"object"==typeof t.background){const e=t.background;if(e.schemeRef){const t=lt(e.schemeRef,s.colors,{});e.value=t,delete e.schemeRef}}}));const g=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/notesMasters/")).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort((t,e)=>parseInt(t.match(/notesMaster(\d+)\.xml/)?.[1]||"0",10)-parseInt(e.match(/notesMaster(\d+)\.xml/)?.[1]||"0",10));P("info",`Found ${e.length} notes master files`);const r=[];for(const n of e){const e=await(t.file(n)?.async("string"));if(!e){P("warn",`Failed to read notes master: ${n}`);continue}const s=await ht(t,n,e);r.push(s)}return r}catch(t){return P("error","Failed to parse notes masters",t),[]}}(t),m=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/notesSlides/")).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort((t,e)=>parseInt(t.match(/notesSlide(\d+)\.xml/)?.[1]||"0",10)-parseInt(e.match(/notesSlide(\d+)\.xml/)?.[1]||"0",10));P("info",`Found ${e.length} notes slide files`);const r=[];for(const n of e){const e=await(t.file(n)?.async("string"));if(!e){P("warn",`Failed to read notes slide: ${n}`);continue}const s=await ut(t,n,e);r.push(s)}return r}catch(t){return P("error","Failed to parse notes slides",t),[]}}(t);!function(t,e){const r=new Map;e.forEach(t=>{const e=t.id.replace("notesMaster_","");r.set(e,t)}),t.forEach(t=>{if(t.masterRef){const e=t.masterRef.split("/").pop()?.replace(".xml","")||"";r.has(e)&&(t.master=r.get(e))}})}(m,g);const y=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/charts/")).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort();P("info",`Found ${e.length} chart files`);const r=[];for(const n of e){const e=await(t.file(n)?.async("string"));if(!e){P("warn",`Failed to read chart: ${n}`);continue}const s=n.match(/chart(\d+)\.xml/)?.[1]||"1",i=bt(e,s,await Tt(t,`chart${s}`));r.push(i)}return r}catch(t){return P("error","Failed to parse charts",t),[]}}(t),$=await async function(t){try{const e=Object.keys(t.files).filter(t=>t.startsWith("ppt/diagrams/")).filter(t=>t.endsWith(".xml")).filter(t=>!t.includes("_rels")).sort();P("info",`Found ${e.length} diagram files`);const r=[];for(const n of e){const e=await(t.file(n)?.async("string"));if(!e){P("warn",`Failed to read diagram: ${n}`);continue}const s=n.match(/data(\d+)\.xml/)?.[1]||"1",i=At(e,s,await Ct(t,s));r.push(i)}return r}catch(t){return P("error","Failed to parse diagrams",t),[]}}(t),w=await async function(t,e){try{const r=[];for(let n=1;n<=e;n++){const e=`slide${n}`,s=await Pt(t,e);r.push(s)}return P("info",`Parsed tags for ${e} slides`),r}catch(t){return P("error","Failed to parse slide tags",t),[]}}(t,d.length),v={id:k("ppt-doc"),title:r.title||"未命名PPT",author:r.author,subject:r.subject,keywords:r.keywords,description:r.description,created:r.created,modified:r.modified,slides:d,props:{width:n.width,height:n.height,ratio:u,pageSize:f},globalRelsMap:h,theme:s||void 0,masterSlides:o,slideLayouts:p,notesMasters:g.length>0?g:void 0,notesSlides:m.length>0?m:void 0,charts:y.length>0?y:void 0,diagrams:$.length>0?$:void 0,tags:w.length>0?w:void 0,mediaMap:void 0};return e.parseImages&&await async function(t,e){try{const r=new Map;for(const n of e.slides){if(n.background&&"string"!=typeof n.background){const e=n.background;if("image"===e.type&&e.relId){const s=await ot(t,e.relId,n.relsMap,r);s&&(e.value=s)}}let e=0;for(const s of n.elements)if("image"===s.type){e++;const i=s,o=i.relId;if(o){P("info",`Found image element in slide: relId=${o}, src=${i.src}`);const e=await ot(t,o,n.relsMap,r);e?(i.src=e,P("info",`Updated image src to base64 URL, length=${e.length}`)):P("warn",`Failed to resolve image relId=${o}`)}else P("warn","Image element missing relId")}e>0&&P("info",`Found ${e} image elements in slide ${n.id}`)}if(e.slideLayouts){P("info",`Processing ${Object.keys(e.slideLayouts).length} slide layouts`);for(const n in e.slideLayouts){const s=e.slideLayouts[n];P("info",`Processing layout: ${n}`),await it(t,s,s.relsMap,r)}}if(e.masterSlides){P("info",`Processing ${e.masterSlides.length} master slides`);for(const n of e.masterSlides)n.relsMap?(P("info",`Processing master: ${n.id}`),await it(t,n,n.relsMap,r)):P("warn",`Master ${n.id} missing relsMap`)}e.mediaMap=r,P("info",`Parsed ${r.size} images`)}catch(t){P("warn","Failed to parse images",t)}}(t,v),v}catch(t){throw P("error","PPTX parsing failed",t),new Error(`PPTX解析失败: ${t instanceof Error?t.message:String(t)}`)}}(s,n)}async function jt(e){const r=new t;return function(t){t.folder("ppt")?.folder("slides"),t.folder("ppt")?.folder("slideLayouts"),t.folder("ppt")?.folder("_rels"),t.folder("docProps"),t.folder("_rels")}(r),await async function(t,e){const{width:r,height:n}=e.props,s=Et.px2emu(r),i=Et.px2emu(n),o=`<sldLayout xmlns="http://schemas.openxmlformats.org/presentationml/2006/main"><cSld><sldSz cx="${s}" cy="${i}" type="screen"/></cSld></sldLayout>`;t.file("ppt/slideLayouts/slideLayout1.xml",o);const a=`<cp:coreProperties xmlns:cp="http://schemas.openxmlformats.org/package/2006/metadata/core-properties"><dc:title>${e.title}</dc:title></cp:coreProperties>`;t.file("docProps/core.xml",a)}(r,e),await async function(t,e){e.forEach(async(e,r)=>{const n=function(t){const{elements:e,bgColor:r,props:n}=t,s=Et.px2emu(n.width),i=Et.px2emu(n.height),o=e.map(t=>function(t){const{type:e,rect:r,style:n,content:s}=t,{x:i,y:o,width:a,height:l}=r,c=Et.px2emu(i),p=Et.px2emu(o),d=Et.px2emu(a),h=Et.px2emu(l);switch(e){case"text":return`<p:txBody><a:bodyPr/><a:lstStyle/><a:p><a:r><a:rPr sz="${100*(n.fontSize||14)}" b="${"bold"===n.fontWeight?1:0}"/><a:t>${s}</a:t></a:r></a:p></p:txBody><p:spPr><a:xfrm><a:off x="${c}" y="${p}"/><a:ext cx="${d}" cy="${h}"/></a:xfrm></p:spPr>`;case"shape":return`<p:sp><p:spPr><a:xfrm><a:off x="${c}" y="${p}"/><a:ext cx="${d}" cy="${h}"/></a:xfrm><a:solidFill><a:srgbClr val="${n.backgroundColor?.replace("#","")||"ffffff"}"/></a:solidFill><a:ln><a:solidFill><a:srgbClr val="${n.borderColor?.replace("#","")||"000000"}"/></a:solidFill></a:ln></p:spPr></p:sp>`;case"image":return`<p:pic><p:blipFill><a:blip r:embed="rId1"/></p:blipFill><p:spPr><a:xfrm><a:off x="${c}" y="${p}"/><a:ext cx="${d}" cy="${h}"/></a:xfrm></p:spPr></p:pic>`;case"table":return`<p:tbl><p:tblPr><a:tblW w="${d}" type="dxa"/></p:tblPr>${s.map(t=>`<a:tr><a:tc><a:txBody><a:p><a:r><a:t>${t.join("")}</a:t></a:r></a:p></a:txBody></a:tc></a:tr>`).join("")}</p:tbl>`;default:return""}}(t)).join("\n");return`<p:sld xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main"><p:cSld><p:spTree><p:grpSp><p:spPr><a:xfrm><a:off x="0" y="0"/><a:ext cx="${s}" cy="${i}"/></a:xfrm></p:spPr>${o}</p:grpSp></p:spTree></p:cSld><p:bg><p:bgPr><a:solidFill><a:srgbClr val="${r.replace("#","")}"/></a:solidFill></p:bgPr></p:bg></p:sld>`.replace(/\s+/g," ").trim()}(e);t.file(`ppt/slides/slide${r+1}.xml`,n)})}(r,e.slides),await r.generateAsync({type:"blob",compression:"DEFLATE"})}function Lt(t){return"number"!=typeof t||isNaN(t)?0:Math.round(t*(96/914400))}class Bt{constructor(t={}){this.options=t,this.styleTable=new Map,this.styleCounter=0}generate(t){let e=`<div class="${this.options.containerClass||"pptxjs-container"}">`;for(const r of t.slides)e+=this.generateSlide(r,t.props.width,t.props.height);return e+="</div>",!1!==this.options.includeGlobalCSS&&(e+=`<style>\n${this.generateGlobalCSS()}\n</style>`),e}generateSlide(t,e,r){const n="section"===this.options.slideType?"section":"div",s=t.width||e,i=t.height||r;let o=`<${n} class="slide" data-slide-id="${t.id}" style="width:${s}px;height:${i}px;position:relative;overflow:hidden;">`;if(t.bgFill?o+=this.generateBackground(t.bgFill):t.bgColor&&"transparent"!==t.bgColor&&(o+=`<div class="slide-background" style="width:100%;height:100%;position:absolute;top:0;left:0;background-color:${t.bgColor};"></div>`),t.elements)for(const e of t.elements)o+=this.generateElement(e);return o+=`</${n}>`,o}generateElement(t){switch(t.type){case"text":return this.generateTextElement(t);case"image":return this.generateImageElement(t);case"shape":return this.generateShapeElement(t);case"table":return this.generateTableElement(t);default:return""}}generateTextElement(t){const e=t.style||{},r=t.position||{x:0,y:0,width:100,height:50};let n=this.generateTextStyle(e,r);let s=`<div class="text-element ${this.getStyleClass(n)}" style="position:absolute;left:${Lt(r.x||0)}px;top:${Lt(r.y||0)}px;width:${Lt(r.width||100)}px;height:${Lt(r.height||50)}px;${n}">`;return t.text&&(s+=this.escapeHtml(t.text)),s+="</div>",s}generateTextStyle(t,e){const r=[];if(t.fontSize){const e="number"!=typeof(n=t.fontSize)||isNaN(n)?0:n/100*1.25;r.push(`font-size:${e}px`)}var n;return t.color&&r.push(`color:${t.color}`),t.fontFamily&&r.push(`font-family:${t.fontFamily}`),"bold"===t.fontWeight&&r.push("font-weight:bold"),"italic"===t.fontStyle&&r.push("font-style:italic"),t.textDecoration&&r.push(`text-decoration:${t.textDecoration}`),t.textAlign&&r.push(`text-align:${t.textAlign}`),t.textVerticalAlign&&r.push(`vertical-align:${t.textVerticalAlign}`),t.lineHeight&&r.push(`line-height:${t.lineHeight}`),t.backgroundColor&&"transparent"!==t.backgroundColor&&r.push(`background-color:${t.backgroundColor}`),t.padding&&r.push(`padding:${t.padding}`),r.join(";")}generateImageElement(t){const e=t.position||{x:0,y:0},r=t.size||{width:100,height:100},n=Lt(e.x),s=Lt(e.y),i=Lt(r.width),o=Lt(r.height);let a=t.src;if(t.data)if(t.data.startsWith("data:"))a=t.data;else{a=`data:${t.mimeType||"image/png"};base64,${t.data}`}return`<img class="slide-image" style="position:absolute;left:${n}px;top:${s}px;width:${i}px;height:${o}px;" src="${a}" alt="slide image" />`}generateBackground(t){const e=["width:100%","height:100%","position:absolute","top:0","left:0"];switch(t.type){case"solid":default:t.color&&e.push(`background-color:${t.color}`);break;case"gradient":if(t.colors&&t.colors.length>=2){const r=`linear-gradient(${t.direction||"to bottom"}, ${t.colors.join(", ")})`;e.push(`background:${r}`)}break;case"image":t.src&&(e.push("background-size:cover"),e.push("background-position:center"),e.push("background-repeat:no-repeat"),t.src.startsWith("data:"),e.push(`background-image:url('${t.src}')`))}return`<div class="slide-background" style="${e.join(";")}"></div>`}generateShapeElement(t){const e=t.style||{},r=t.position||{x:0,y:0},n=t.size||{width:100,height:100},s=Lt(r.x),i=Lt(r.y),o=Lt(n.width),a=Lt(n.height);let l="";return e.backgroundColor&&(l+=`background-color:${e.backgroundColor};`),e.borderColor&&(l+=`border:${e.borderWidth||1}px solid ${e.borderColor};`),`<div class="slide-shape" style="position:absolute;left:${s}px;top:${i}px;width:${o}px;height:${a}px;${l}"></div>`}generateTableElement(t){const e=t.position||{x:0,y:0};let r=`<table class="slide-table" style="position:absolute;left:${Lt(e.x)}px;top:${Lt(e.y)}px;">`;return t.rows&&t.rows.forEach(t=>{r+="<tr>",t.cells&&t.cells.forEach(t=>{r+="<td>",t.text&&(r+=this.escapeHtml(t.text)),r+="</td>"}),r+="</tr>"}),r+="</table>",r}generateGlobalCSS(){let t="";t+="\n.pptxjs-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow: auto;\n  background-color: #f0f0f0;\n  padding: 20px;\n  box-sizing: border-box;\n}\n",t+="\n.slide {\n  position: relative;\n  margin-bottom: 20px;\n  background-color: #ffffff;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  overflow: hidden;\n}\n",t+="\n.text-element {\n  display: flex;\n  align-items: center;\n  word-wrap: break-word;\n  overflow-wrap: break-word;\n  box-sizing: border-box;\n}\n",t+="\n.slide-image {\n  display: block;\n  object-fit: contain;\n}\n",t+="\n.slide-shape {\n  box-sizing: border-box;\n}\n",t+="\n.slide-table {\n  border-collapse: collapse;\n}\n.slide-table td {\n  border: 1px solid #cccccc;\n  padding: 8px;\n  text-align: left;\n}\n";for(const[,e]of this.styleTable)t+=`.${e.name} { ${e.css} }\n`;return t}getStyleClass(t){for(const[e,r]of this.styleTable.entries())if(e===t)return r.name;const e="_pptx_style_"+this.styleCounter++;return this.styleTable.set(t,{name:e,css:t}),e}escapeHtml(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}function Rt(t){let e="";const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(t),s=n.byteLength,i=s%3,o=s-i;let a,l,c,p,d;for(let t=0;t<o;t+=3)d=n[t]<<16|n[t+1]<<8|n[t+2],a=(16515072&d)>>18,l=(258048&d)>>12,c=(4032&d)>>6,p=63&d,e+=r[a]+r[l]+r[c]+r[p];return 1===i?(d=n[o],a=(252&d)>>2,l=(3&d)<<4,e+=r[a]+r[l]+"=="):2===i&&(d=n[o]<<8|n[o+1],a=(64512&d)>>10,l=(1008&d)>>4,c=(15&d)<<2,e+=r[a]+r[l]+r[c]+"="),e}function zt(t,e){try{const r=t.file(e);if(!r)return null;return Rt(r.asArrayBuffer())}catch(t){return console.error(`Error reading image ${e}:`,t),null}}function Ot(t){return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",bmp:"image/bmp",tiff:"image/tiff",webp:"image/webp",svg:"image/svg+xml"}[t.split(".").pop()?.toLowerCase()||""]||"image/png"}function Ht(t,e){return`data:${e};base64,${t}`}function Wt(t){return new Promise(e=>setTimeout(e,t))}function Gt(t){return t&&"object"==typeof t&&!Array.isArray(t)}const Xt={slideFactor:96/914400,fontSizeFactor:1.25,rtlLangs:["he-IL","ar-AE","ar-SA","dv-MV","fa-IR","ur-PK"],standardHeight:6858e3,standardWidth:9144e3};class _t{constructor(t,e={}){this.slideWidth=0,this.slideHeight=0,this.slideFactor=Xt.slideFactor,this.fontSizeFactor=Xt.fontSizeFactor,this.defaultTextStyle=null,this.appVersion=0,this.processFullTheme=!0,this.incSlide={width:0,height:0},this.zip=t,this.processFullTheme=!1!==e.processFullTheme,this.incSlide={width:e.incSlideWidth||0,height:e.incSlideHeight||0}}readXmlFile(t,e=!1){try{const r=this.zip.file(t);if(!r)return null;let n=r.asText();e&&this.appVersion<=12&&(n=n.replace(/<!\[CDATA\[(.*?)\]\]>/g,"$1"));const s=this.parseXml(n);return s&&void 0!==s["?xml"]?s["?xml"]:s}catch(e){return console.error(`Error reading XML file '${t}':`,e),null}}parseXml(t){try{const e=(new DOMParser).parseFromString(t,"text/xml");return this.domToJson(e)}catch(t){return console.error("XML parsing error:",t),null}}domToJson(t){if(t.nodeType===Node.TEXT_NODE)return t.textContent;const e={};if(t.nodeType===Node.ELEMENT_NODE&&t instanceof Element){const r={};for(let e=0;e<t.attributes.length;e++)r[t.attributes[e].name]=t.attributes[e].value;Object.keys(r).length>0&&(e.attrs=r)}const r=t.childNodes,n={};for(let t=0;t<r.length;t++){const s=r[t];if(s.nodeType===Node.TEXT_NODE){const t=s.textContent?.trim();t&&(e["#text"]=t);continue}if(s.nodeType===Node.ELEMENT_NODE){const t=this.domToJson(s),e=s.nodeName;n[e]||(n[e]=[]),n[e].push(t)}}for(const[t,r]of Object.entries(n))1===r.length?e[t]=r[0]:e[t]=r;return e}getContentTypes(){const t=this.readXmlFile("[Content_Types].xml");if(!t||!t.Types)return{slides:[],slideLayouts:[]};const e=t.Types.Override,r=[],n=[],s=Array.isArray(e)?e:[e];for(const t of s){const e=t.attrs;if(e)switch(e.ContentType){case"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":r.push(e.PartName.substring(1));break;case"application/vnd.openxmlformats-officedocument.presentationml.slideLayout+xml":n.push(e.PartName.substring(1))}}return{slides:r,slideLayouts:n}}getSlideSizeAndSetDefaultTextStyle(){const t=this.readXmlFile("docProps/app.xml");t&&t.Properties&&t.Properties.AppVersion&&(this.appVersion=parseInt(t.Properties.AppVersion),console.log(`Created by Office PowerPoint app version: ${t.Properties.AppVersion}`));const e=this.readXmlFile("ppt/presentation.xml");if(!e||!e["p:presentation"])return{width:960,height:720};const r=e["p:presentation"]["p:sldSz"]?.attrs;if(!r)return{width:960,height:720};const n=parseInt(r.cx),s=parseInt(r.cy),i=r.type;return console.log(`Presentation size type: ${i}`),this.defaultTextStyle=e["p:presentation"]["p:defaultTextStyle"],this.slideWidth=Math.floor(n*this.slideFactor+this.incSlide.width),this.slideHeight=Math.floor(s*this.slideFactor+this.incSlide.height),{width:this.slideWidth,height:this.slideHeight}}indexNodes(t){if(!t)return{idTable:{},idxTable:{},typeTable:{}};const e=Object.keys(t)[0];if(!t[e])return{idTable:{},idxTable:{},typeTable:{}};const r=t[e]["p:cSld"];if(!r)return{idTable:{},idxTable:{},typeTable:{}};const n=r["p:spTree"];if(!n)return{idTable:{},idxTable:{},typeTable:{}};const s={},i={},o={};for(const t in n){if("p:nvGrpSpPr"===t||"p:grpSpPr"===t)continue;const e=n[t],r=Array.isArray(e)?e:[e];for(const t of r){const e=t["p:nvSpPr"];if(!e)continue;const r=e["p:cNvPr"],n=e["p:nvPr"],a=n?.["p:ph"],l=r?.attrs?.id,c=a?.attrs?.idx,p=a?.attrs?.type;void 0!==l&&(s[l]=t),void 0!==c&&(i[c]=t),void 0!==p&&(o[p]=t)}}return{idTable:s,idxTable:i,typeTable:o}}getTextByPathList(t,e){if(!t||!e||0===e.length)return;let r=t;for(const t of e){if(null==r)return;r=r[t]}return r}getSlideWidth(){return this.slideWidth}getSlideHeight(){return this.slideHeight}getSlideFactor(){return this.slideFactor}getFontSizeFactor(){return this.fontSizeFactor}getDefaultTextStyle(){return this.defaultTextStyle}getAppVersion(){return this.appVersion}getProcessFullTheme(){return this.processFullTheme}}function Vt(t){return null==t?0:t/6e4}var qt;exports.ColorType=void 0,(qt=exports.ColorType||(exports.ColorType={})).SOLID="solid",qt.GRADIENT="gradient",qt.PATTERN="pattern",qt.NONE="none";const Ut={dk1:"000000",lt1:"FFFFFF",dk2:"1F497D",lt2:"EEECE1",accent1:"4F81BD",accent2:"C0504D",accent3:"9BBB59",accent4:"8064A2",accent5:"4BACC6",accent6:"F79646",hlink:"0000FF",folHlink:"800080"};function Yt(t){if(!t)return null;const e=re(t,["a:srgbClr","attrs","val"]);if(e)return"#"+e;const r=re(t,["a:schemeClr","attrs","val"]);if(r)return Jt(r);const n=re(t,["a:sysClr","attrs","lastClr"]);if(n)return"#"+n;const s=re(t,["a:prstClr","attrs","val"]);return s?Kt(s):null}function Jt(t){const e=Ut[t];return e?"#"+e:"#000000"}function Kt(t){const e={aliceBlue:"F0F8FF",antiqueWhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedAlmond:"FFEBCD",blue:"0000FF",blueViolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetBlue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerBlue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkBlue:"00008B",darkCyan:"008B8B",darkGoldenrod:"B8860B",darkGray:"A9A9A9",darkGreen:"006400",darkGrey:"A9A9A9",darkKhaki:"BDB76B",darkMagenta:"8B008B",darkOliveGreen:"556B2F",darkOrange:"FF8C00",darkOrchid:"9932CC",darkRed:"8B0000",darkSalmon:"E9967A",darkSeaGreen:"8FBC8F",darkSlateBlue:"483D8B",darkSlateGray:"2F4F4F",darkSlateGrey:"2F4F4F",darkTurquoise:"00CED1",darkViolet:"9400D3",deepPink:"FF1493",deepSkyBlue:"00BFFF",dimGray:"696969",dimGrey:"696969",dkBlue:"00008B",dkCyan:"008B8B",dkGoldenrod:"B8860B",dkGray:"A9A9A9",dkGreen:"006400",dkKhaki:"BDB76B",dkMagenta:"8B008B",dkOliveGreen:"556B2F",dkOrange:"FF8C00",dkOrchid:"9932CC",dkRed:"8B0000",dkSalmon:"E9967A",dkSeaGreen:"8FBC8F",dkSlateBlue:"483D8B",dkSlateGray:"2F4F4F",dkSlateGrey:"2F4F4F",dkTurquoise:"00CED1",dkViolet:"9400D3",dodgerBlue:"1E90FF",firebrick:"B22222",floralWhite:"FFFAF0",forestGreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostWhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",green:"008000",greenYellow:"ADFF2F",grey:"808080",honeydew:"F0FFF0",hotPink:"FF69B4",indianRed:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderBlush:"FFF0F5",lawnGreen:"7CFC00",lemonChiffon:"FFFACD",lightBlue:"ADD8E6",lightCoral:"F08080",lightCyan:"E0FFFF",lightGoldenrodYellow:"FAFAD2",lightGray:"D3D3D3",lightGreen:"90EE90",lightGrey:"D3D3D3",lightPink:"FFB6C1",lightSalmon:"FFA07A",lightSeaGreen:"20B2AA",lightSkyBlue:"87CEFA",lightSlateGray:"778899",lightSlateGrey:"778899",lightSteelBlue:"B0C4DE",lightYellow:"FFFFE0",lime:"00FF00",limeGreen:"32CD32",linen:"FAF0E6",ltBlue:"ADD8E6",ltCoral:"F08080",ltCyan:"E0FFFF",ltGoldenrodYellow:"FAFAD2",ltGray:"D3D3D3",ltGreen:"90EE90",ltGrey:"D3D3D3",ltPink:"FFB6C1",ltSalmon:"FFA07A",ltSeaGreen:"20B2AA",ltSkyBlue:"87CEFA",ltSlateGray:"778899",ltSlateGrey:"778899",ltSteelBlue:"B0C4DE",ltYellow:"FFFFE0",magenta:"FF00FF",maroon:"800000",mediumAquamarine:"66CDAA",mediumBlue:"0000CD",mediumOrchid:"BA55D3",mediumPurple:"9370DB",mediumSeaGreen:"3CB371",mediumSlateBlue:"7B68EE",mediumSpringGreen:"00FA9A",mediumTurquoise:"48D1CC",mediumVioletRed:"C71585",midnightBlue:"191970",mintCream:"F5FFFA",mistyRose:"FFE4E1",moccasin:"FFE4B5",navajoWhite:"FFDEAD",navy:"000080",oldLace:"FDF5E6",olive:"808000",oliveDrab:"6B8E23",orange:"FFA500",orangeRed:"FF4500",orchid:"DA70D6",paleGoldenrod:"EEE8AA",paleGreen:"98FB98",paleTurquoise:"AFEEEE",paleVioletRed:"DB7093",papayaWhip:"FFEFD5",peachPuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderBlue:"B0E0E6",purple:"800080",red:"FF0000",rosyBrown:"BC8F8F",royalBlue:"4169E1",saddleBrown:"8B4513",salmon:"FA8072",sandyBrown:"F4A460",seaGreen:"2E8B57",seaShell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyBlue:"87CEEB",slateBlue:"6A5ACD",slateGray:"708090",slateGrey:"708090",snow:"FFFAFA",springGreen:"00FF7F",steelBlue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whiteSmoke:"F5F5F5",yellow:"FFFF00",yellowGreen:"9ACD32"}[t];return e?"#"+e:"#000000"}function Zt(t){if(!t)return 1;const e=re(t,["a:alpha","attrs","val"]);if(e)return parseInt(e)/1e5;const r=re(t,["a:lumMod","attrs","val"]);return r?parseInt(r)/1e5:1}function Qt(t,e){return`rgba(${parseInt(t.slice(1,3),16)}, ${parseInt(t.slice(3,5),16)}, ${parseInt(t.slice(5,7),16)}, ${e})`}function te(t,e,r){const n={},s=re(t,["p:sld","p:clrMapOvr","a:overrideClrMapping","attrs"]);s&&(n.slide=ee(s));const i=re(e,["p:sldLayout","p:clrMapOvr","a:overrideClrMapping","attrs"]);i&&(n.layout=ee(i));const o=re(r,["p:sldMaster","p:clrMapOvr","a:overrideClrMapping","attrs"]);return o&&(n.master=ee(o)),n}function ee(t){const e={},r=["bg1","tx1","bg2","tx2","accent1","accent2","accent3","accent4","accent5","accent6","hlink","folHlink"];for(const n of r){const r=t[n];r&&(e[n]=Jt(r))}return e}function re(t,e){if(!t||!e||0===e.length)return;let r=t;for(const t of e){if(null==r)return;r=r[t]}return r}var ne,se;function ie(t){const e={},r=ce(t,["a:latin","attrs","typeface"]),n=ce(t,["a:ea","attrs","typeface"]),s=ce(t,["a:cs","attrs","typeface"]);r?e.fontFace=r:n?e.fontFace=n:s&&(e.fontFace=s);const i=ce(t,["a:sz","attrs","val"]);i&&(e.fontSize=parseInt(i)/100);const o=t["a:solidFill"];if(o){const{getColorValue:t}=require("./pptxjs-color-utils"),r=t(o);r&&(e.color=r)}const a=ce(t,["a:b","attrs","val"]);e.bold="0"!==a;const l=ce(t,["a:i","attrs","val"]);e.italic="0"!==l;const c=ce(t,["a:u","attrs","val"]);e.underline="none"!==c;const p=ce(t,["a:strike","attrs","val"]);e.strike="noStrike"!==p;const d=ce(t,["a:baseline","attrs","val"]);return d&&(e.baseline=parseInt(d)),e}function oe(t){const e={},r=ce(t,["a:lnSpc","attrs","algn"]);r&&(e.textAlign=r);const n=t["a:lnSpc"];if(n){const t=ce(n,["a:spcPct","attrs","val"]),r=ce(n,["a:spcPts","attrs","val"]);t?e.lineSpacing=parseInt(t)/1e3:r&&(e.lineSpacing=parseInt(r)/100)}const s=t["a:spcBef"];if(s){const t=ce(s,["a:spcPct","attrs","val"]),r=ce(s,["a:spcPts","attrs","val"]);t?e.spacingBefore=parseInt(t)/1e3:r&&(e.spacingBefore=parseInt(r)/100)}const i=t["a:spcAft"];if(i){const t=ce(i,["a:spcPct","attrs","val"]),r=ce(i,["a:spcPts","attrs","val"]);t?e.spacingAfter=parseInt(t)/1e3:r&&(e.spacingAfter=parseInt(r)/100)}const o=ce(t,["a:marL","attrs","val"]);o&&(e.indent=parseInt(o)/914400);const a=ce(t,["a:marL","attrs","val"]);a&&(e.marginLeft=parseInt(a)/914400);const l=ce(t,["a:marR","attrs","val"]);return l&&(e.marginRight=parseInt(l)/914400),e}function ae(t){const e=[];if(!t)return e;const r=t["a:p"],n=Array.isArray(r)?r:[r];for(const t of n){const r={text:"",styles:[]},n=t["a:pPr"];if(n){const t=oe(n);Object.assign(r,t)}const s=t["a:r"],i=Array.isArray(s)?s:[s],o=[],a=[];for(const t of i){if(!t)continue;const e=ce(t,["a:t"]);e&&o.push(e);const r=t["a:rPr"];if(r){const t=ie(r);a.push(t)}}r.text=o.join(""),a.length>0&&(r.styles=a),e.push(r)}return e}function le(t){const e=[];return t.fontFace&&e.push(`font-family: "${t.fontFace}", Arial, sans-serif`),t.fontSize&&e.push(`font-size: ${t.fontSize}pt`),t.color&&e.push(`color: ${t.color}`),t.bold&&e.push("font-weight: bold"),t.italic&&e.push("font-style: italic"),t.underline&&e.push("text-decoration: underline"),t.strike&&(e.includes("text-decoration: underline")?e.push("text-decoration: underline line-through"):e.push("text-decoration: line-through")),t.baseline&&(t.baseline>0?(e.push("vertical-align: super"),e.push("font-size: smaller")):t.baseline<0&&(e.push("vertical-align: sub"),e.push("font-size: smaller"))),t.textAlign&&e.push(`text-align: ${t.textAlign}`),t.textVerticalAlign&&e.push(`vertical-align: ${t.textVerticalAlign}`),t.lineSpacing&&(t.lineSpacing<1?e.push(`line-height: ${Math.round(100*t.lineSpacing)}%`):e.push(`line-height: ${t.lineSpacing}pt`)),t.spacingBefore&&e.push(`margin-top: ${t.spacingBefore}pt`),t.spacingAfter&&e.push(`margin-bottom: ${t.spacingAfter}pt`),t.indent&&e.push(`text-indent: ${t.indent}in`),t.marginLeft&&e.push(`margin-left: ${t.marginLeft}in`),t.marginRight&&e.push(`margin-right: ${t.marginRight}in`),e.join("; ")}function ce(t,e){if(!t||!e||0===e.length)return;let r=t;for(const t of e){if(null==r)return;r=r[t]}return r}!function(t){t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.JUSTIFY="justify",t.DISTRIBUTED="distributed"}(ne||(ne={})),function(t){t.TOP="top",t.MIDDLE="middle",t.BOTTOM="bottom",t.JUSTIFY="justify",t.DISTRIBUTED="distributed"}(se||(se={}));const pe=re;class de{constructor(t,e={}){this.tableStyles=null,this.zip=t,this.options={processFullTheme:!1!==e.processFullTheme,incSlideWidth:e.incSlideWidth||0,incSlideHeight:e.incSlideHeight||0,slideMode:e.slideMode||!1,slideType:e.slideType||"div",slidesScale:e.slidesScale||""},this.coreParser=new _t(t,{processFullTheme:this.options.processFullTheme,incSlideWidth:this.options.incSlideWidth,incSlideHeight:this.options.incSlideHeight})}async parse(){const t=new Date;let e;const r=this.zip.file("docProps/thumbnail.jpeg");if(r){e=Rt(r.asArrayBuffer())}const n=this.coreParser.getContentTypes(),s=this.coreParser.getSlideSizeAndSetDefaultTextStyle();this.tableStyles=this.coreParser.readXmlFile("ppt/tableStyles.xml");const i=[],o=n.slides;for(let t=0;t<o.length;t++){const e=o[t],r=t+1,n=await this.processSingleSlide(e,r,s);i.push(n)}const a=this.generateGlobalCSS(),l=(new Date).getTime()-t.getTime();return console.log(`PPTX parsing completed in ${l}ms`),{slides:i,size:s,thumb:e,globalCSS:a}}async processSingleSlide(t,e,r){const n=t.replace("slides/slide","slides/_rels/slide")+".rels",s=this.coreParser.readXmlFile(n);let i="",o="";const a={},l=s?.Relationships?.Relationship,c=Array.isArray(l)?l:[l];for(const t of c){const e=t?.attrs;if(e)switch(e.Type){case"http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideLayout":i=e.Target.replace("../","ppt/");break;case"http://schemas.microsoft.com/office/2007/relationships/diagramDrawing":o=e.Target.replace("../","ppt/");default:a[e.Id]={type:e.Type.replace("http://schemas.openxmlformats.org/officeDocument/2006/relationships/",""),target:e.Target.replace("../","ppt/")}}}const p=this.coreParser.readXmlFile(i),d=this.coreParser.indexNodes(p),h=i.replace("slideLayouts/slideLayout","slideLayouts/_rels/slideLayout")+".rels",u=this.coreParser.readXmlFile(h);let f="";const g={},m=u?.Relationships?.Relationship,y=Array.isArray(m)?m:[m];for(const t of y){const e=t?.attrs;if(e)if("http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideMaster"===e.Type)f=e.Target.replace("../","ppt/");else g[e.Id]={type:e.Type.replace("http://schemas.openxmlformats.org/officeDocument/2006/relationships/",""),target:e.Target.replace("../","ppt/")}}const b=this.coreParser.readXmlFile(f),x=re(b,["p:sldMaster","p:txStyles"]),$=this.coreParser.indexNodes(b),w=f.replace("slideMasters/slideMaster","slideMasters/_rels/slideMaster")+".rels",v=this.coreParser.readXmlFile(w);let S="";const A={},F=v?.Relationships?.Relationship,T=Array.isArray(F)?F:[F];for(const t of T){const e=t?.attrs;if(e)if("http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme"===e.Type)S=e.Target.replace("../","ppt/");else A[e.Id]={type:e.Type.replace("http://schemas.openxmlformats.org/officeDocument/2006/relationships/",""),target:e.Target.replace("../","ppt/")}}const C=this.coreParser.readXmlFile(S),k={};if(S){const t=S.split("/").pop(),e=S.replace(t,"_rels/"+t)+".rels",r=this.coreParser.readXmlFile(e),n=r?.Relationships?.Relationship,s=Array.isArray(n)?n:[n];for(const t of s){const e=t?.attrs;e&&(k[e.Id]={type:e.Type.replace("http://schemas.openxmlformats.org/officeDocument/2006/relationships/",""),target:e.Target.replace("../","ppt/")})}}let P=null;const I={};if(o&&(P=this.coreParser.readXmlFile(o),P)){const t=JSON.stringify(P);P=JSON.parse(t.replace(/dsp:/g,"p:"));const e=o.split("/").pop(),r=o.replace(e,"_rels/"+e)+".rels",n=this.coreParser.readXmlFile(r),s=n?.Relationships?.Relationship,i=Array.isArray(s)?s:[s];for(const t of i){const e=t?.attrs;e&&(I[e.Id]={type:e.Type.replace("http://schemas.openxmlformats.org/officeDocument/2006/relationships/",""),target:e.Target.replace("../","ppt/")})}}const M=this.coreParser.readXmlFile(t,!0),N=pe(M,["p:sld","p:cSld","p:spTree"]),E={zip:this.zip,slideLayoutContent:p,slideLayoutTables:d,slideMasterContent:b,slideMasterTables:$,slideContent:M,slideResObj:a,slideMasterTextStyles:x,layoutResObj:g,masterResObj:A,themeContent:C,themeResObj:k,diagramFileContent:P,diagramResObj:I,defaultTextStyle:this.coreParser.getDefaultTextStyle()};let D="",j="";this.options.processFullTheme?D=this.getBackground(E,e):"colorsAndImageOnly"===this.options.processFullTheme&&(j=this.getSlideBackgroundFill(E,e));const L=[],B=[],R=[],z=[];if(N)for(const t in N){const e=Array.isArray(N[t])?N[t]:[N[t]];for(const r of e){const e=this.processNodesInSlide(t,r,N,E,"slide");e&&("shape"===e.type?L.push(e):"image"===e.type?B.push(e):"table"===e.type?R.push(e):"chart"===e.type&&z.push(e))}}const O=te(M,p,b);return{id:e,fileName:t,width:r.width,height:r.height,bgColor:j,bgFill:D,shapes:L,images:B,tables:R,charts:z,layout:{fileName:i,content:p,tables:d,colorMapOvr:O.layout},master:{fileName:f,content:b,tables:$,colorMapOvr:O.master},theme:{fileName:S,content:C},warpObj:E}}processNodesInSlide(t,e,r,n,s,i){switch(t){case"p:sp":return this.processSpNode(e,r,n,s,i);case"p:cxnSp":return this.processCxnSpNode(e,r,n,s,i);case"p:pic":return this.processPicNode(e,n,s,i);case"p:graphicFrame":return this.processGraphicFrameNode(e,n,s,i);case"p:grpSp":return this.processGroupSpNode(e,n,s);case"mc:AlternateContent":const t=pe(e,["mc:Fallback"]);return this.processGroupSpNode(t,n,s);default:return null}}processSpNode(t,e,r,n,s){const i=pe(t,["p:nvSpPr","p:cNvPr","attrs","id"]),o=pe(t,["p:nvSpPr","p:cNvPr","attrs","name"]),a=pe(t,["p:nvSpPr","p:nvPr","p:ph","attrs","idx"]),l=pe(t,["p:nvSpPr","p:nvPr","p:ph","attrs","type"]),c=pe(t,["attrs","order"]);let p;void 0!==a?(p=r.slideLayoutTables.idxTable[a],void 0!==l?r.slideMasterTables.typeTable[l]:r.slideMasterTables.idxTable[a]):void 0!==l&&(p=r.slideLayoutTables.typeTable[l],r.slideMasterTables.typeTable[l]);let d=l;if(void 0===d){"1"===pe(t,["p:nvSpPr","p:cNvSpPr","attrs","txBox"])&&(d="textBox")}return void 0===d&&(d=pe(p,["p:nvSpPr","p:nvPr","p:ph","attrs","type"]),void 0===d&&(d="diagramBg"===n?"diagram":"obj")),{type:"shape",id:i,name:o,idx:a,shapeType:d,order:c}}processCxnSpNode(t,e,r,n,s){return{type:"shape",id:pe(t,["p:nvCxnSpPr","p:cNvPr","attrs","id"]),name:pe(t,["p:nvCxnSpPr","p:cNvPr","attrs","name"]),idx:pe(t,["p:nvCxnSpPr","p:nvPr","p:ph","attrs","idx"]),shapeType:pe(t,["p:nvCxnSpPr","p:nvPr","p:ph","attrs","type"]),order:pe(t,["attrs","order"]),isConnector:!0}}processPicNode(t,e,r,n){const s=pe(t,["p:nvPicPr","p:cNvPr","attrs","id"]),i=pe(t,["p:nvPicPr","p:cNvPr","attrs","name"]),o=pe(t,["attrs","order"]),a=pe(t,["p:blipFill","a:blip","attrs","r:embed"]);let l="";a&&e.slideResObj[a]&&(l=e.slideResObj[a].target);const c=re(t,["p:spPr","a:xfrm"]);let p={x:0,y:0},d={width:0,height:0};if(c){const t=c["a:off"]?.attrs,e=c["a:ext"]?.attrs;t&&(p={x:parseInt(t.x),y:parseInt(t.y)}),e&&(d={width:parseInt(e.cx),height:parseInt(e.cy)})}let h="";l&&(h=zt(e.zip,l)||"");const u=Ot(l);return{type:"image",id:s,name:i,order:o,position:p,size:d,imagePath:l,data:h,mimeType:u,src:h?Ht(h,u):""}}processGraphicFrameNode(t,e,r,n){const s=t["a:graphic"];if(!s)return null;const i=s["a:graphicData"]["a:tbl"];if(i)return this.processTableNode(t,i,e,r,n);const o=s["a:graphicData"]["c:chart"];return o?this.processChartNode(t,o,e,r,n):null}processTableNode(t,e,r,n,s){const i=pe(t,["p:nvGraphicFramePr","p:cNvPr","attrs","id"]),o=pe(t,["p:nvGraphicFramePr","p:cNvPr","attrs","name"]),a=pe(t,["attrs","order"]),l=re(t,["p:xfrm","a:xfrm"]);let c={x:0,y:0},p={width:0,height:0};if(l){const t=l["a:off"]?.attrs,e=l["a:ext"]?.attrs;t&&(c={x:parseInt(t.x),y:parseInt(t.y)}),e&&(p={width:parseInt(e.cx),height:parseInt(e.cy)})}const d=[],h=e["a:tr"],u=Array.isArray(h)?h:[h];for(const t of u){const e={cells:[]},r=t["a:tc"],n=Array.isArray(r)?r:[r];for(const t of n){const r={},n=t["a:txBody"];if(n){const t=ae(n);r.content=t}e.cells.push(r)}d.push(e)}return{type:"table",id:i,name:o,order:a,position:c,size:p,rows:d}}processChartNode(t,e,r,n,s){const i=pe(t,["p:nvGraphicFramePr","p:cNvPr","attrs","id"]),o=pe(t,["p:nvGraphicFramePr","p:cNvPr","attrs","name"]),a=pe(t,["attrs","order"]),l=re(t,["p:xfrm","a:xfrm"]);let c={x:0,y:0},p={width:0,height:0};if(l){const t=l["a:off"]?.attrs,e=l["a:ext"]?.attrs;t&&(c={x:parseInt(t.x),y:parseInt(t.y)}),e&&(p={width:parseInt(e.cx),height:parseInt(e.cy)})}return{type:"chart",id:i,name:o,order:a,position:c,size:p,chartData:e}}processGroupSpNode(t,e,r){const n=pe(t,["p:grpSpPr","a:xfrm"]);if(!n)return null;const s=parseInt(n["a:off"]?.attrs.x||"0"),i=parseInt(n["a:off"]?.attrs.y||"0"),o=parseInt(n["a:chOff"]?.attrs.x||"0"),a=parseInt(n["a:chOff"]?.attrs.y||"0"),l=parseInt(n["a:ext"]?.attrs.cx||"0"),c=parseInt(n["a:ext"]?.attrs.cy||"0"),p=parseInt(n["a:chExt"]?.attrs.cx||"0"),d=parseInt(n["a:chExt"]?.attrs.cy||"0");let h=parseInt(n.attrs?.rot||"0");h=Vt(h);let u=i-a,f=s-o,g=l-p,m=c-d,y="group";0!==h&&(u=i,f=s,g=l,m=c,y="group-rotate");const b=t.attrs?.order,x={type:"group",order:b,position:{x:f,y:u},size:{width:g,height:m},rotate:h,sType:y,children:[]};for(const n in t){if("p:nvGrpSpPr"===n||"p:grpSpPr"===n)continue;const s=Array.isArray(t[n])?t[n]:[t[n]];for(const i of s){const s=this.processNodesInSlide(n,i,t,e,r,y);s&&x.children.push(s)}}return x}getBackground(t,e){return""}getSlideBackgroundFill(t,e){return""}generateGlobalCSS(){return"\n.slide {\n  position: relative;\n  overflow: hidden;\n  margin: 0;\n  padding: 0;\n}\n\n.block {\n  position: absolute;\n}\n\n.text-content {\n  display: flex;\n  word-wrap: break-word;\n}\n    ".trim()}}class he{constructor(t,e={}){this.parser=null,this.parsedData=null,this.parser=new de({},e)}static async create(t,e={}){const r=new he(t,e);return await r.parse(),r}async parse(){if(!this.parser)throw new Error("Parser not initialized");this.parsedData=await this.parser.parse()}getResult(){return this.parsedData}getSlides(){return this.parsedData?.slides||[]}getSize(){return this.parsedData?.size||{width:960,height:720}}getThumb(){return this.parsedData?.thumb}getGlobalCSS(){return this.parsedData?.globalCSS||""}generateHtml(){if(!this.parsedData)throw new Error("Data not parsed. Call parse() first.");const{slides:t,size:e,globalCSS:r}=this.parsedData;let n=`\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>PPTX Presentation</title>\n  <style>\n    ${r}\n    \n    .slides-container {\n      position: relative;\n      width: ${e.width}px;\n      height: ${e.height*t.length}px;\n    }\n  </style>\n</head>\n<body>\n  <div class="slides-container">\n`;for(const e of t)n+=this.generateSlideHtml(e);return n+="\n  </div>\n</body>\n</html>\n",n}generateSlideHtml(t){const{id:e,width:r,height:n,bgColor:s,bgFill:i,shapes:o,images:a,tables:l,charts:c}=t;let p=`<div class="slide" id="slide-${e}" style="width:${r}px;height:${n}px;`;s?p+=`background-color:${s};`:i&&(p+=`background:${i};`),p+='">',i&&(p+=i);for(const t of o)p+=this.generateShapeHtml(t);for(const t of a)p+=this.generateImageHtml(t);for(const t of l)p+=this.generateTableHtml(t);for(const t of c)p+=this.generateChartHtml(t);return p+="</div>",p}generateShapeHtml(t){return`<div class="shape" id="shape-${t.id}">Shape: ${t.name}</div>`}generateImageHtml(t){const e=96/914400,r=Math.round(t.position.x*e),n=Math.round(t.position.y*e),s=Math.round(t.size.width*e),i=Math.round(t.size.height*e);return`<img \n      class="slide-image" \n      id="image-${t.id}" \n      style="position:absolute;left:${r}px;top:${n}px;width:${s}px;height:${i}px;" \n      src="${t.src}" \n      alt="${t.name}" \n    />`}generateTableHtml(t){const e=96/914400,r=Math.round(t.position.x*e),n=Math.round(t.position.y*e),s=Math.round(t.size.width*e),i=Math.round(t.size.height*e);let o=`<div \n      class="slide-table" \n      id="table-${t.id}" \n      style="position:absolute;left:${r}px;top:${n}px;width:${s}px;height:${i}px;overflow:auto;"\n    >`;o+='<table style="width:100%;height:100%;border-collapse:collapse;">';for(const e of t.rows){o+="<tr>";for(const t of e.cells){if(o+='<td style="border:1px solid #ccc;padding:4px;">',t.content){const{generateTextBoxHtml:e}=require("./pptxjs-text-utils");o+=e(t.content)}o+="</td>"}o+="</tr>"}return o+="</table>",o+="</div>",o}generateChartHtml(t){const e=96/914400,r=Math.round(t.position.x*e),n=Math.round(t.position.y*e),s=Math.round(t.size.width*e),i=Math.round(t.size.height*e);return`<div \n      class="slide-chart" \n      id="chart-${t.id}" \n      style="position:absolute;left:${r}px;top:${n}px;width:${s}px;height:${i}px;"\n    >Chart: ${t.name}</div>`}}const ue={utils:Et,parse:Dt,serialize:jt};exports.BaseElement=I,exports.ChartElement=D,exports.DiagramElement=j,exports.DocumentElement=Q,exports.EMU_PER_INCH=n,exports.GroupElement=B,exports.HtmlGenerator=Bt,exports.ImageElement=N,exports.LayoutElement=q,exports.MasterElement=U,exports.NS=r,exports.NotesMasterElement=K,exports.NotesSlideElement=Z,exports.OleElement=E,exports.PIXELS_PER_INCH=96,exports.PPTXJS_CONSTANTS=Xt,exports.PlaceholderElement=V,exports.PptParseUtils=Et,exports.PptxDocument=X,exports.Pptxjs=he,exports.PptxjsCoreParser=_t,exports.PptxjsParser=de,exports.ShapeElement=M,exports.SlideElement=G,exports.THEME_COLORS=Ut,exports.TableElement=L,exports.TagsElement=J,exports.angleToDegrees=Vt,exports.applyColorMap=function(t,e){if(!e)return t;const r=t.replace("#","").toLowerCase();for(const[t,n]of Object.entries(e))if(n&&n.replace("#","").toLowerCase()===r){const e=Ut[t];if(e)return"#"+e}return t},exports.base64ArrayBuffer=Rt,exports.createDocument=function(t){return Q.fromParseResult(t)},exports.createElementFromData=_,exports.createElementFromNode=function(t,e){const n=t.tagName;if("p:sp"===n||"sp"===n)return M.fromNode(t,e);if("p:pic"===n||"pic"===n)return N.fromNode(t,e);if("p:graphicFrame"===n||"graphicFrame"===n){const n=u(t,"graphic",r.a),s=n?u(n,"graphicData",r.a):null;if(!s)return null;const i=s.getAttribute("uri")||"";return i.includes("oleObject")?E.fromNode(t,e):i.includes("chart")?D.fromNode(t,e):i.includes("diagram")?j.fromNode(t,e):i.includes("table")?L.fromNode(t,e):null}return"p:grpSp"===n||"grpSp"===n?B.fromNode(t,e):null},exports.deepClone=function t(e){if(null===e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(e=>t(e));const r={};for(const n in e)e.hasOwnProperty(n)&&(r[n]=t(e[n]));return r},exports.deepMerge=function t(e,...r){if(!r.length)return e;const n=r.shift();if(Gt(e)&&Gt(n))for(const r in n)Gt(n[r])?(e[r]||Object.assign(e,{[r]:{}}),t(e[r],n[r])):Object.assign(e,{[r]:n[r]});return t(e,...r)},exports.default=ue,exports.degreesToRadians=function(t){return t*(Math.PI/180)},exports.delay=Wt,exports.emu2px=c,exports.formatFileSize=function(t){if(0===t)return"0 Bytes";const e=Math.floor(Math.log(t)/Math.log(1024));return Math.round(t/Math.pow(1024,e)*100)/100+" "+["Bytes","KB","MB","GB"][e]},exports.generateCssColor=function(t){if(!t||t.type===exports.ColorType.NONE)return"transparent";if(t.type===exports.ColorType.SOLID){let e=t.color||"#000000";return void 0!==t.alpha&&t.alpha<1&&(e=Qt(e,t.alpha)),e}if(t.type===exports.ColorType.GRADIENT&&t.stops){return`linear-gradient(to bottom, ${t.stops.map(t=>{let e=t.color;return void 0!==t.alpha&&t.alpha<1&&(e=Qt(e,t.alpha)),`${e} ${Math.round(100*t.position)}%`}).join(", ")})`}return t.color||"#000000"},exports.generateDataUrl=Ht,exports.generateHtml=function(t,e){return new Bt(e).generate(t)},exports.generateTextBoxHtml=function(t){return t&&0!==t.length?t.map(t=>function(t){const e=le({textAlign:t.textAlign,textVerticalAlign:t.textVerticalAlign,lineSpacing:t.lineSpacing,spacingBefore:t.spacingBefore,spacingAfter:t.spacingAfter,indent:t.indent,marginLeft:t.marginLeft,marginRight:t.marginRight});if(!t.styles||0===t.styles.length)return`<p${e?` style="${e}"`:""}>${t.text}</p>`;let r="";if(r+=e?`<p style="${e}">`:"<p>",1===t.styles.length){const e=le(t.styles[0]);r+=e?`<span style="${e}">${t.text}</span>`:t.text}else{const e=le(t.styles[0]);r+=e?`<span style="${e}">${t.text}</span>`:t.text}return r+="</p>",r}(t)).join(""):""},exports.generateUniqueId=function(t="id"){return`${t}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},exports.getAlphaValue=Zt,exports.getAttrs=d,exports.getColorValue=Yt,exports.getDefaultTextStyle=function(){return{fontFace:"Arial",fontSize:18,color:"#000000",bold:!1,italic:!1,underline:!1,strike:!1,baseline:0,textAlign:ne.LEFT,textVerticalAlign:se.TOP,lineSpacing:1,spacingBefore:0,spacingAfter:0,indent:0,marginLeft:0,marginRight:0}},exports.getImageBase64=zt,exports.getImageMimeType=Ot,exports.getPresetColor=Kt,exports.getTextByPathList=re,exports.getThemeColor=Jt,exports.hexToRgba=Qt,exports.isRtlLanguage=function(t){return["he-IL","ar-AE","ar-SA","dv-MV","fa-IR","ur-PK"].includes(t)},exports.isValidHexColor=function(t){if(!t)return!1;const e=t.replace("#","");return/^[0-9A-Fa-f]{3}$|^[0-9A-Fa-f]{6}$|^[0-9A-Fa-f]{8}$/.test(e)},exports.memoize=function(t){const e=new Map;return(...r)=>{const n=JSON.stringify(r);if(e.has(n))return e.get(n);const s=t(...r);return e.set(n,s),s}},exports.mergeTextStyles=function(t,...e){const r={...t};for(const t of e)t&&Object.assign(r,t);return r},exports.normalizeHexColor=function(t){if(!t)return"";let e=t.replace("#","");return(3===e.length||4===e.length)&&(e=e.split("").map(t=>t+t).join("")),e=e.toUpperCase(),e},exports.parseColorFill=function(t){if(!t)return null;if(t["a:solidFill"]){const e=Yt(t["a:solidFill"]),r=Zt(t["a:solidFill"]);if(e)return{type:exports.ColorType.SOLID,color:e,alpha:r}}if(t["a:gradFill"]){const e=[],r=t["a:gradFill"]["a:gsLst"];if(r){const t=Array.isArray(r["a:gs"])?r["a:gs"]:[r["a:gs"]];for(const r of t){const t=parseInt(r.attrs.pos)/1e5,n=Yt(r),s=Zt(r);n&&e.push({position:t,color:n,alpha:s})}}if(e.length>0)return{type:exports.ColorType.GRADIENT,stops:e.sort((t,e)=>t.position-e.position)}}if(t["a:pattFill"]){const e=Yt(t["a:pattFill"]["a:fgClr"]);if(Yt(t["a:pattFill"]["a:bgClr"]),e)return{type:exports.ColorType.PATTERN,color:e}}return null},exports.parseColorMapOverride=te,exports.parseMetadata=x,exports.parsePptx=Dt,exports.parseRels=m,exports.parseTextBoxContent=ae,exports.ppt2HTML=(t,e)=>{const{createDocument:r}=require("./elements");return r(t).slides.map(t=>t.toHTML())},exports.ppt2HTMLDocument=(t,e)=>{const{createDocument:r}=require("./elements");return r(t).toHTML({...e,withNavigation:!1})},exports.px2emu=p,exports.retry=async function(t,e=3,r=1e3){let n;for(let s=0;s<e;s++)try{return await t()}catch(t){n=t,s<e-1&&await Wt(r*(s+1))}throw n||new Error("Retry failed")},exports.safeParseFloat=function(t,e=0){if(null==t||""===t)return e;const r=parseFloat(String(t));return isNaN(r)?e:r},exports.safeParseInt=function(t,e=0){if(null==t||""===t)return e;const r=parseInt(String(t),10);return isNaN(r)?e:r},exports.serializePptx=jt,exports.slide2HTML=(t,e)=>{const{createDocument:r}=require("./elements"),n=r({slides:[t],props:{width:960,height:540}});return n.getSlide(0)?.toHTML()||""},exports.truncateString=function(t,e,r="..."){return t.length<=e?t:t.substring(0,e-r.length)+r},exports.unique=function(t){return Array.from(new Set(t))};
//# sourceMappingURL=ppt-parser.cjs.js.map
